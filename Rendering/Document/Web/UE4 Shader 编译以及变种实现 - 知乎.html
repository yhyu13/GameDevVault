<!DOCTYPE html>
<!-- saved from url=(0038)https://zhuanlan.zhihu.com/p/154081604 -->
<html lang="zh" data-hairline="true" data-theme="light" data-rh="data-theme"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>UE4 Shader 编译以及变种实现 - 知乎</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="google-site-verification" content="FTeR0c8arOPKh8c5DYh_9uu98_zJbaWw53J-Sch9MTg"><meta data-rh="true" name="keywords" content="虚幻 4（游戏引擎）,shader,渲染"><meta data-rh="true" name="description" content="一 , 动机这篇文章主要是我对UE4中Shader编译过程以及变种的理解，了解这一块挺有必要的，毕竟动辄几千上万个Shader的编译在UE里简直是家常便饭，了解它底层的实现机制后内心踏实一点，要去修改的话大方向也不错 …"><meta data-rh="true" property="og:title" content="UE4 Shader 编译以及变种实现"><meta data-rh="true" property="og:url" content="https://zhuanlan.zhihu.com/p/154081604"><meta data-rh="true" property="og:description" content="一 , 动机这篇文章主要是我对UE4中Shader编译过程以及变种的理解，了解这一块挺有必要的，毕竟动辄几千上万个Shader的编译在UE里简直是家常便饭，了解它底层的实现机制后内心踏实一点，要去修改的话大方向也不错 …"><meta data-rh="true" property="og:image" content="https://pica.zhimg.com/v2-3fe7283018ad0664acc581d80e9766f3_720w.jpg?source=172ae18b"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="og:site_name" content="知乎专栏"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.a53ae37b.png"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.a53ae37b.png" sizes="152x152"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-120.bbce8f18.png" sizes="120x120"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-76.cbade8f9.png" sizes="76x76"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-60.8f6c52aa.png" sizes="60x60"><link crossorigin="" rel="shortcut icon" type="image/x-icon" href="https://static.zhihu.com/heifetz/favicon.ico"><link crossorigin="" rel="search" type="application/opensearchdescription+xml" href="https://static.zhihu.com/heifetz/search.xml" title="知乎"><link rel="dns-prefetch" href="https://static.zhimg.com/"><link rel="dns-prefetch" href="https://pica.zhimg.com/"><link rel="dns-prefetch" href="https://pic1.zhimg.com/"><link rel="dns-prefetch" href="https://pic2.zhimg.com/"><link rel="dns-prefetch" href="https://pic3.zhimg.com/"><link rel="dns-prefetch" href="https://pic4.zhimg.com/"><link rel="dns-prefetch" href="https://static.zhihu.com/"><style data-emotion-css="1m4merm">.u-safeAreaInset-top{height:constant(safe-area-inset-top) !important;height:env(safe-area-inset-top) !important;}.u-safeAreaInset-bottom{height:constant(safe-area-inset-bottom) !important;height:env(safe-area-inset-bottom) !important;}</style><link href="./UE4 Shader 编译以及变种实现 - 知乎_files/column.app.216a26f4.da6bb3acea63642ce110.css" crossorigin="" rel="stylesheet"><script nonce="">!function(){"use strict";!function(e,n){var r=[];function t(e){return function(){r.push([e,arguments])}}n.Raven={captureException:t("captureException"),captureMessage:t("captureMessage"),captureBreadcrumb:t("captureBreadcrumb")};var a,o,c,i,s,u="undefined"!=typeof DOMError;function d(e){var n=e instanceof Error||e instanceof ErrorEvent||u&&e instanceof DOMError||e instanceof DOMException;Raven.captureException(n?e:new Error(e.message||e.reason))}n.addEventListener("unhandledrejection",d),n.addEventListener("error",d,!0),a=e.src,o=e,c=function(){r.forEach(function(e){var n;(n=Raven)[e[0]].apply(n,e[1])}),n.removeEventListener("unhandledrejection",d),n.removeEventListener("error",d,!0)},i=document.head||document.getElementsByTagName("head")[0],(s=document.createElement("script")).crossOrigin=o.crossOrigin,s.dataset.sentryConfig=o["data-sentry-config"],s.onload=c,s.src=a,i.appendChild(s)}({"defer":true,"crossOrigin":"anonymous","src":"https://unpkg.zhimg.com/@cfe/sentry-script@1.3.1/dist/init.js","data-sentry-config":"{\"dsn\":\"https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224\",\"sampleRate\":0.1,\"release\":\"201-e744d5ea\",\"ignoreErrorNames\":[\"NetworkError\",\"SecurityError\"],\"ignoreErrorsPreset\":\"ReactApp\",\"tags\":{\"app_name\":\"heifetz\"}}"},window)}();
</script><script crossorigin="anonymous" data-sentry-config="{&quot;dsn&quot;:&quot;https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224&quot;,&quot;sampleRate&quot;:0.1,&quot;release&quot;:&quot;201-e744d5ea&quot;,&quot;ignoreErrorNames&quot;:[&quot;NetworkError&quot;,&quot;SecurityError&quot;],&quot;ignoreErrorsPreset&quot;:&quot;ReactApp&quot;,&quot;tags&quot;:{&quot;app_name&quot;:&quot;heifetz&quot;}}" src="./UE4 Shader 编译以及变种实现 - 知乎_files/init.js.download"></script><style data-emotion-css="uzm3ri">.css-uzm3ri{position:fixed;top:0;right:0;left:0;z-index:101;display:none;height:2px;pointer-events:none;background:#056DE8;-webkit-transform:translateX(-100%);-ms-transform:translateX(-100%);transform:translateX(-100%);}</style><style data-emotion-css="1l12z7y">.css-1l12z7y{box-shadow:0px 16px 32px rgba(0,0,0,0.04);}</style><style data-emotion-css="1hlrcxk">.css-1hlrcxk{-webkit-transition-property:fill;transition-property:fill;-webkit-transition-duration:0.25s;transition-duration:0.25s;-webkit-transition-timing-function:ease-in;transition-timing-function:ease-in;}</style><style data-emotion-css="icip60">.css-icip60{border-radius:2px;}</style><style data-emotion-css="1tzrnvf">.css-1tzrnvf{box-sizing:border-box;margin:0;min-width:0;max-width:100%;height:auto;background-color:#FFFFFF;width:30px;height:30px;border-radius:2px;}</style><style data-emotion-css="78p1r9">.css-78p1r9{box-sizing:border-box;margin:0;min-width:0;margin-left:auto;margin-right:auto;max-width:690px;margin-top:0;}@media screen and (min-width:40em){.css-78p1r9{margin-top:1em;}}</style><style data-emotion-css="1p2zu2j">.css-1p2zu2j{position:relative;padding-bottom:62.5%;height:0;border-radius:inherit;}</style><style data-emotion-css="2v23m6">.css-2v23m6{box-sizing:border-box;margin:0;min-width:0;position:relative;padding-bottom:62.5%;height:0;border-radius:inherit;}</style><style data-emotion-css="1ld0bim">.css-1ld0bim{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:inherit;}</style><style data-emotion-css="1ujtx97">.css-1ujtx97{object-fit:cover;background-color:#F6F6F6;}</style><style data-emotion-css="uodor8">.css-uodor8{border-radius:50%;}</style><style data-emotion-css="1y9jkzv">.css-1y9jkzv{box-sizing:border-box;margin:0;min-width:0;max-width:100%;height:auto;background-color:#FFFFFF;width:38px;height:38px;border-radius:50%;}</style><style data-emotion-css="1cd9gw4">.css-1cd9gw4{margin-left:.3em;}</style><style data-emotion-css="n99yhz">.css-n99yhz{box-sizing:border-box;margin:0;min-width:0;color:#175199;display:inline-block;margin-left:.3em;}</style><style data-emotion-css="18biwo">.css-18biwo{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="1ifz0go">.css-1ifz0go{overflow:visible!important;}</style><style data-emotion-css="1yuhvjn">.css-1yuhvjn{margin-top:16px;}</style><style data-emotion-css="79elbk">.css-79elbk{position:relative;}</style><style data-emotion-css="3jt6os">.css-3jt6os .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(246,246,246,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-3jt6os .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-3jt6os .FileLinkCard-info{margin-left:12px;}.css-3jt6os .FileLinkCard-name{color:#121212;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-3jt6os .FileLinkCard-meta{color:#999999;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-3jt6os .FileLinkCard-source{white-space:pre;}</style><style data-emotion-css="1wr1m8">.css-1wr1m8 .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#F6F6F6;}.css-1wr1m8 .LinkCard.new,.css-1wr1m8 .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1wr1m8 .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-1wr1m8 .LinkCard.new .LinkCard-contents .loading{height:14px;background:#EBEBEB;border-radius:7px;}.css-1wr1m8 .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-1wr1m8 .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#121212;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1wr1m8 .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-1wr1m8 .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-1wr1m8 .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-1wr1m8 .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-1wr1m8 .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#999999;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1wr1m8 .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#444444;}.css-1wr1m8 .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#999999;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1wr1m8 .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-1wr1m8 .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(211,211,211,0.3);}.css-1wr1m8 .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-1wr1m8 .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-1wr1m8 .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#EBEBEB;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-1wr1m8 .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#EBEBEB;color:#D3D3D3;}.css-1wr1m8 .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#999999;}.css-1wr1m8 .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-1wr1m8 .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-1wr1m8 .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#444444;}.css-1wr1m8 .LinkCard.new .LinkCard-richText .text{color:#444444;}.css-1wr1m8 .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-1wr1m8 .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-1wr1m8 .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-1wr1m8 .LinkCard.old,.css-1wr1m8 .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1wr1m8 .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(246,246,246,0.88);color:#D3D3D3;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#EBEBEB;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#EBEBEB;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}</style><style data-emotion-css="hypxot">.css-hypxot .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-hypxot .LinkCard.old,.css-hypxot .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-hypxot .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(246,246,246,0.88);color:#D3D3D3;}.css-hypxot .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#EBEBEB;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-hypxot .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#EBEBEB;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}.css-hypxot .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#F6F6F6;}.css-hypxot .LinkCard.new,.css-hypxot .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-hypxot .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-hypxot .LinkCard.new .LinkCard-contents .loading{height:14px;background:#EBEBEB;border-radius:7px;}.css-hypxot .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-hypxot .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#121212;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hypxot .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-hypxot .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-hypxot .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-hypxot .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-hypxot .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#999999;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hypxot .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#444444;}.css-hypxot .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#999999;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hypxot .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-hypxot .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(211,211,211,0.3);}.css-hypxot .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-hypxot .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-hypxot .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#EBEBEB;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-hypxot .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#EBEBEB;color:#D3D3D3;}.css-hypxot .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#999999;}.css-hypxot .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-hypxot .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-hypxot .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#444444;}.css-hypxot .LinkCard.new .LinkCard-richText .text{color:#444444;}.css-hypxot .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-hypxot .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-hypxot .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(246,246,246,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-hypxot .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-hypxot .FileLinkCard-info{margin-left:12px;}.css-hypxot .FileLinkCard-name{color:#121212;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-hypxot .FileLinkCard-meta{color:#999999;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-hypxot .FileLinkCard-source{white-space:pre;}</style><style data-emotion-css="4em6pe animation-1yvu044">.css-4em6pe{word-break:break-word;line-height:1.6;}.css-4em6pe > [data-first-child]{margin-top:0;}.css-4em6pe > :last-child{margin-bottom:0;}.css-4em6pe h1,.css-4em6pe h2{clear:left;margin-top:calc((1.4em * 2) / 1.2);margin-bottom:calc(1.4em / 1.2);font-size:1.2em;line-height:1.5;font-weight:600;}.css-4em6pe h3,.css-4em6pe h4,.css-4em6pe h5,.css-4em6pe h6{clear:left;margin-top:calc((1.4em * 1.5) / 1.1);margin-bottom:calc(1.4em / 1.1);font-size:1.1em;line-height:1.5;font-weight:600;}.css-4em6pe u{-webkit-text-decoration:none;text-decoration:none;border-bottom:1px solid #444444;}.css-4em6pe b{font-weight:600;}.css-4em6pe sup{font-size:0.8em;}.css-4em6pe sup[data-draft-type='reference']{color:#175199;}.css-4em6pe a:focus{outline:none;-webkit-transition:box-shadow 0.3s;transition:box-shadow 0.3s;}html[data-focus-visible] .css-4em6pe a:focus{box-shadow:0 0 0 2px #FFFFFF,0 0 0 4px rgba(5,109,232,0.3);}.css-4em6pe a.ztext-link,.css-4em6pe a.internal,.css-4em6pe a.external{-webkit-text-decoration:none;text-decoration:none;cursor:pointer;border-bottom:1px solid #808080;}.css-4em6pe a.ztext-link:hover,.css-4em6pe a.internal:hover,.css-4em6pe a.external:hover{color:#175199;border-bottom:1px solid #175199;}.css-4em6pe a.ztext-link > .ellipsis::after,.css-4em6pe a.internal > .ellipsis::after,.css-4em6pe a.external > .ellipsis::after{content:'...';}.css-4em6pe a.ztext-link > .invisible,.css-4em6pe a.internal > .invisible,.css-4em6pe a.external > .invisible{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;}.css-4em6pe a.ztext-link u,.css-4em6pe a.internal u,.css-4em6pe a.external u{border:none;}.css-4em6pe a.member_mention{color:#175199;}.css-4em6pe a.member_mention:hover{border-bottom:1px solid #175199;}.css-4em6pe a.UserLink-link{color:#175199;}.css-4em6pe a.UserLink-link:hover{border-bottom:1px solid #175199;}.css-4em6pe p{margin:1.4em 0;}.css-4em6pe p.ztext-empty-paragraph{margin:calc((2.8em- (1.4em * 2 + 1.6em)) / 2) 0;}.css-4em6pe p.ztext-empty-paragraph + .ztext-empty-paragraph{margin:1.4em 0;}.css-4em6pe hr{margin:4em auto;width:240px;max-width:100%;border:none;border-top:1px solid #D3D3D3;}.css-4em6pe img[eeimg]{max-width:100%;vertical-align:middle;}.css-4em6pe img[eeimg="1"]{margin:0 3px;max-width:calc(100% - 6px);display:inline-block;}.css-4em6pe img[eeimg="2"]{margin:1.4em auto;display:block;}.css-4em6pe blockquote{margin:1.4em 0;padding-left:1em;color:#646464;border-left:3px solid #D3D3D3;}.css-4em6pe ol,.css-4em6pe ul{margin:1.4em 0;padding:0;width:100%;}.css-4em6pe ol ol,.css-4em6pe ul ol,.css-4em6pe ol ul,.css-4em6pe ul ul{margin:0;}.css-4em6pe ol li::before,.css-4em6pe ul li::before{width:1em;}.css-4em6pe ol > ol,.css-4em6pe ul > ol,.css-4em6pe ol > ul,.css-4em6pe ul > ul{display:table-row;}.css-4em6pe ol > ol::before,.css-4em6pe ul > ol::before,.css-4em6pe ol > ul::before,.css-4em6pe ul > ul::before{display:table-cell;content:'';}.css-4em6pe ul{display:table;}.css-4em6pe ul>li{display:table-row;list-style:none;}.css-4em6pe ul>li::before{display:table-cell;content:'•  ';white-space:pre;}.css-4em6pe ol{display:table;counter-reset:ol;}.css-4em6pe ol > li{display:table-row;list-style:none;}.css-4em6pe ol > li::before{display:table-cell;text-align:right;counter-increment:ol;content:counter(ol) '. ';white-space:pre;}.css-4em6pe ol ol{counter-reset:ol2;}.css-4em6pe ol ol li::before{counter-increment:ol2;content:counter(ol2) '. ';}.css-4em6pe ol ol ol{counter-reset:ol3;}.css-4em6pe ol ol ol li::before{counter-increment:ol3;content:counter(ol3) '. ';}.css-4em6pe ol ol ol ol{counter-reset:ol4;}.css-4em6pe ol ol ol ol li::before{counter-increment:ol4;content:counter(ol4) '. ';}.css-4em6pe figure{margin:1.4em 0;}.css-4em6pe figure .content_image,.css-4em6pe figure .origin_image{margin:0 auto;}.css-4em6pe figure figcaption{margin-top:calc(0.6em / 0.9);padding:0 1em;font-size:0.9em;line-height:1.5;text-align:center;color:#999999;}.css-4em6pe figure + figure{margin-top:calc(1.4em * 1.6);}.css-4em6pe figure[data-size='small'],.css-4em6pe figure:not([data-size]) > [data-size='small']{clear:both;}.css-4em6pe figure[data-size='left'],.css-4em6pe figure:not([data-size]) > [data-size='left']{float:left;margin:0 20px 20px 0;max-width:33%;}.css-4em6pe figure[data-size='right'],.css-4em6pe figure:not([data-size]) > [data-size='right']{float:right;margin:0 0 20px 20px;max-width:33%;}.css-4em6pe figure[data-size='collapse']{margin-bottom:0;}.css-4em6pe figure[data-size='collapse'] + figure{margin-top:0;}.css-4em6pe .content_image,.css-4em6pe .origin_image{display:block;max-width:100%;height:auto;margin:1.4em auto;}.css-4em6pe .content_image[data-size='small'],.css-4em6pe .origin_image[data-size='small']{max-width:40%;}.css-4em6pe .content_image.zh-lightbox-thumb,.css-4em6pe .origin_image.zh-lightbox-thumb{cursor:-webkit-zoom-in;cursor:-moz-zoom-in;cursor:zoom-in;}.css-4em6pe code{margin:0 2px;padding:3px 4px;border-radius:3px;font-family:Menlo,Monaco,Consolas,'Andale Mono','lucida console','Courier New',monospace;font-size:0.9em;background-color:#F6F6F6;}.css-4em6pe pre{margin:1.4em 0;padding:calc(0.8em / 0.9);font-size:0.9em;word-break:initial;word-wrap:initial;white-space:pre;overflow:auto;-webkit-overflow-scrolling:touch;background:#F6F6F6;border-radius:4px;}.css-4em6pe pre code{margin:0;padding:0;font-size:inherit;border-radius:0;background-color:inherit;}.css-4em6pe li pre{white-space:pre-wrap;}.css-4em6pe table[data-draft-type='table']{border-collapse:collapse;font-size:15px;margin:1.4em auto;max-width:100%;table-layout:fixed;text-align:left;width:100%;}.css-4em6pe table[data-draft-type='table'][data-size='small']{min-width:260px;width:40%;}.css-4em6pe table[data-draft-type='table'][data-row-style='striped'] tr:nth-of-type(2n + 1){background:#F6F6F6;}.css-4em6pe table[data-draft-type='table'] td,.css-4em6pe table[data-draft-type='table'] th{border:1px solid #D3D3D3;line-height:24px;height:24px;padding:3px 12px;}.css-4em6pe table[data-draft-type='table'] th{background:#EBEBEB;color:#121212;font-weight:500;}.css-4em6pe .video-box,.css-4em6pe .link-box{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin:1.4em 0;overflow:auto;white-space:normal;cursor:pointer;border:solid 1px #EBEBEB;border-radius:4px;}.css-4em6pe .lazy[data-lazy-status]{background-color:#F6F6F6;}.css-4em6pe .lazy[data-lazy-status="ok"]{background-color:transparent;-webkit-animation:animation-1yvu044 0.5s ease-in;animation:animation-1yvu044 0.5s ease-in;}.css-4em6pe .highlight{margin:1em 0;}.css-4em6pe .highlight pre{margin:0;}.css-4em6pe .highlight .hll{background-color:#FDFDFD;}.css-4em6pe .highlight .c{font-style:italic;color:#999999;}.css-4em6pe .highlight .err{color:#F1403C;}.css-4em6pe .highlight .k{font-weight:600;}.css-4em6pe .highlight .o{font-weight:600;}.css-4em6pe .highlight .cm{font-style:italic;color:#999999;}.css-4em6pe .highlight .cp{font-weight:600;color:#999999;}.css-4em6pe .highlight .c1{font-style:italic;color:#999999;}.css-4em6pe .highlight .cs{font-style:italic;font-weight:600;color:#999999;}.css-4em6pe .highlight .gd{color:#FF3366;}.css-4em6pe .highlight .ge{font-style:italic;}.css-4em6pe .highlight .gr{color:#F1403C;}.css-4em6pe .highlight .gh{color:#999999;}.css-4em6pe .highlight .gi{color:#12b370;}.css-4em6pe .highlight .go{color:#808080;}.css-4em6pe .highlight .gp{color:#646464;}.css-4em6pe .highlight .gs{font-weight:600;}.css-4em6pe .highlight .gu{color:#999999;}.css-4em6pe .highlight .gt{color:#F1403C;}.css-4em6pe .highlight .kc{font-weight:600;}.css-4em6pe .highlight .kd{font-weight:600;}.css-4em6pe .highlight .kn{font-weight:600;}.css-4em6pe .highlight .kp{font-weight:600;}.css-4em6pe .highlight .kr{font-weight:600;}.css-4em6pe .highlight .kt{font-weight:600;color:#175199;}.css-4em6pe .highlight .m{color:#056DE8;}.css-4em6pe .highlight .s{color:#F1403C;}.css-4em6pe .highlight .na{color:#056DE8;}.css-4em6pe .highlight .nb{color:#056DE8;}.css-4em6pe .highlight .nc{font-weight:600;color:#175199;}.css-4em6pe .highlight .no{color:#056DE8;}.css-4em6pe .highlight .ni{color:#5555DD;}.css-4em6pe .highlight .ne{font-weight:600;color:#F1403C;}.css-4em6pe .highlight .nf{font-weight:600;color:#F1403C;}.css-4em6pe .highlight .nn{color:#646464;}.css-4em6pe .highlight .nt{color:#175199;}.css-4em6pe .highlight .nv{color:#056DE8;}.css-4em6pe .highlight .ow{font-weight:600;}.css-4em6pe .highlight .w{color:#BFBFBF;}.css-4em6pe .highlight .mf{color:#056DE8;}.css-4em6pe .highlight .mh{color:#056DE8;}.css-4em6pe .highlight .mi{color:#056DE8;}.css-4em6pe .highlight .mo{color:#056DE8;}.css-4em6pe .highlight .sb{color:#F1403C;}.css-4em6pe .highlight .sc{color:#F1403C;}.css-4em6pe .highlight .sd{color:#F1403C;}.css-4em6pe .highlight .s2{color:#F1403C;}.css-4em6pe .highlight .se{color:#F1403C;}.css-4em6pe .highlight .sh{color:#F1403C;}.css-4em6pe .highlight .si{color:#F1403C;}.css-4em6pe .highlight .sx{color:#F1403C;}.css-4em6pe .highlight .sr{color:#A5542F;}.css-4em6pe .highlight .s1{color:#F1403C;}.css-4em6pe .highlight .ss{color:#F1403C;}.css-4em6pe .highlight .bp{color:#999999;}.css-4em6pe .highlight .vc{color:#056DE8;}.css-4em6pe .highlight .vg{color:#056DE8;}.css-4em6pe .highlight .vi{color:#056DE8;}.css-4em6pe .highlight .il{color:#056DE8;}.css-4em6pe .highlight::-webkit-scrollbar{width:6px;height:6px;}.css-4em6pe .highlight::-webkit-scrollbar-thumb:horizontal{background-color:rgba(18,18,18,0.5);border-radius:6px;}.css-4em6pe .highlight::-webkit-scrollbar-thumb:horizontal:hover{background-color:rgba(18,18,18,0.6);}.css-4em6pe .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-4em6pe .LinkCard.old,.css-4em6pe .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-4em6pe .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(246,246,246,0.88);color:#D3D3D3;}.css-4em6pe .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#EBEBEB;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-4em6pe .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-4em6pe .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-4em6pe .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#EBEBEB;}.css-4em6pe .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-4em6pe .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}.css-4em6pe .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#F6F6F6;}.css-4em6pe .LinkCard.new,.css-4em6pe .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-4em6pe .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-4em6pe .LinkCard.new .LinkCard-contents .loading{height:14px;background:#EBEBEB;border-radius:7px;}.css-4em6pe .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-4em6pe .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#121212;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-4em6pe .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-4em6pe .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-4em6pe .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-4em6pe .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-4em6pe .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#999999;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-4em6pe .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#444444;}.css-4em6pe .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#999999;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-4em6pe .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-4em6pe .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(211,211,211,0.3);}.css-4em6pe .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-4em6pe .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-4em6pe .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#EBEBEB;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-4em6pe .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#EBEBEB;color:#D3D3D3;}.css-4em6pe .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#999999;}.css-4em6pe .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-4em6pe .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-4em6pe .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#444444;}.css-4em6pe .LinkCard.new .LinkCard-richText .text{color:#444444;}.css-4em6pe .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-4em6pe .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-4em6pe .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(246,246,246,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-4em6pe .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-4em6pe .FileLinkCard-info{margin-left:12px;}.css-4em6pe .FileLinkCard-name{color:#121212;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-4em6pe .FileLinkCard-meta{color:#999999;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-4em6pe .FileLinkCard-source{white-space:pre;}@-webkit-keyframes animation-1yvu044{from{opacity:0;}to{opacity:1;}}@keyframes animation-1yvu044{from{opacity:0;}to{opacity:1;}}</style><style data-emotion-css="1s3a4zw">.css-1s3a4zw{position:relative;display:inline-block;height:30px;padding:0 12px;font-size:14px;line-height:30px;color:#056DE8;vertical-align:top;border-radius:100px;background:rgba(5,109,232,0.1);}.css-1s3a4zw:hover{background-color:rgba(5,109,232,0.15);}</style><style data-emotion-css="1xlfegr">.css-1xlfegr{background:transparent;box-shadow:none;}</style><style data-emotion-css="1gomreu">.css-1gomreu{position:relative;display:inline-block;}</style><style data-emotion-css="u1frr4">.css-u1frr4{width:724px;}.css-u1frr4 .Modal-content{margin:22px 0 5px;}.css-u1frr4 .Creator-QuestionShared-title{padding-right:65px;}</style><style>.kwai-player{position:relative;z-index:1;display:inline-block}.kwai-player video{display:block;width:100%;height:100%}.kwai-player canvas{display:block;margin:0 auto;max-width:100%;max-height:100%}.kwai-player-poster{width:100%;height:100%;position:absolute;left:0;top:0;background-color:#333;background-size:cover}.kwai-player-hotzone{display:block;width:100%;height:100%;position:absolute;left:0;top:0}.kwai-player-controls{position:absolute;left:0;bottom:0;width:100%}</style><style></style><style></style><style>.controls{position:absolute;top:0;left:0;width:100%;height:100%;font-size:16px;font-family:Roboto,Noto,sans-serif;overflow:hidden}.controls .large{font-size:18px}.panel{position:relative;display:flex;flex-direction:column;justify-content:flex-end;height:100%;width:100%;background:0 bottom repeat-x linear-gradient(rgba(0,0,0,0),rgb(0,0,0));background-size:auto 5.75em;transition:opacity .3s ease-in}.button-panel{display:flex;position:relative;z-index:1;width:100%;justify-content:space-between}.button-panel-left,.button-panel-right{display:flex;flex-direction:row;align-items:center}.panel-button{position:relative;width:3em;height:3em;background:center no-repeat;background-size:1.25em 1.25em;cursor:pointer;-webkit-tap-highlight-color:transparent}.panel-button:hover>.panel-button-bg{background-color:#202124b5}.panel-button.disabled,.panel-button.disabled:hover>.panel-button-bg{background-color:initial;opacity:.3;cursor:default}.panel-button-wrapper{position:relative}.panel-button-wrapper.disabled:hover .panel-button-bg{left:0;background-color:transparent}.panel-button-wrapper:hover .panel-button-bg{left:0;background-color:#202124b5}.panel-button-wrapper .panel-button-bg{width:100%;left:0}.panel-button-bg{background-size:24px;position:absolute;width:36px;height:36px;left:6px;top:6px;pointer-events:none;z-index:-1;background-repeat:no-repeat;background-position:center center;border-radius:18px;transition:background-color .25s ease 0s}.panel-button-bg:hover{background-color:#202124b5}.current-time-display{font-size:.875em;color:#fff}.time-remaining-display{margin-left:.25em;font-size:.875em;color:#fff;white-space:nowrap}.timeline{display:block;margin:0 1em;padding-bottom:1.25em;cursor:pointer}.timeline:hover .thumb{opacity:1}.volume-button{display:flex;align-items:center;padding-left:1em}.volume-button .segmented-track{width:0em;transition:width .3s ease 0s,opacity .28s step-end 0s}.volume-button.disabled:hover .segmented-track{width:0em}.volume-button:hover .segmented-track{width:3.25em;transition:width .3s ease 0s,opacity .28s step-end 0s}.volume-progress{padding:1em 0;cursor:pointer}.segmented-track{position:relative;height:.25em;user-select:none}.thumb{position:absolute;top:-4px;width:12px;height:12px;background:rgb(255,255,255);border-radius:50%;opacity:0;transition:opacity .3s ease 0s}.segment-background{height:.25em;background-color:#ffffff4d}.segment-highlight-before{position:absolute;height:4px;border-radius:2px;background:rgb(255,255,255)}.segment-highlight-after{position:absolute;height:4px;border-radius:2px;background:rgba(255,255,255,.54)}.overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:center no-repeat;background-size:contain}.overflow{position:absolute;right:16px;bottom:4px;z-index:20;max-height:250px;width:200px;overflow-x:hidden;white-space:nowrap;font-size:12px;box-shadow:#0006 0 1px 9px;background:#ffffff;border-radius:2px;transition:transform .3s ease-out,opacity .2s linear;transform-origin:right bottom;opacity:1;transform:scale(1)}.overflow.closed{transform:scale(0);transform-origin:right bottom;opacity:0}.overflow-item{height:3.75em;padding:0 1.375em;display:flex;align-items:center;cursor:pointer;user-select:none}.overflow-item:active,.overflow-item:focus,.overflow-item:hover{background-color:#e0e0e0}@media screen and (max-width: 600px){.overflow-item.overflow-item:hover{background-color:#fff}}.overflow-icon{width:2em;height:2em;margin-right:1em}.overflow-checkbox{-webkit-appearance:none;appearance:none;width:1.125em;height:1.125em;margin:.9375em;border:none}.overflow-checkbox:checked{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjIuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjQgMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDpub25lO30KCS5zdDF7ZmlsbDojNDI4NUY0O30KPC9zdHlsZT4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTAsMGgyNHYyNEgwVjB6Ii8+CjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik05LDE2LjJMNC44LDEybC0xLjQsMS40TDksMTlMMjEsN2wtMS40LTEuNEw5LDE2LjJ6Ii8+Cjwvc3ZnPgo=)}.overflow-content{flex:1;display:flex;align-items:center;justify-content:space-between}.loading{position:absolute;left:0px;top:0px;right:0px;bottom:0px;z-index:1;pointer-events:none;overflow:hidden}.spinner{animation:container-rotate 1568ms linear infinite;height:100%;width:100%}.spinner:after{position:absolute;content:" ";top:-25%;left:-25%;width:150%;height:150%}.spinner:before{position:absolute;content:" ";top:2px;left:2px;right:2px;bottom:2px;border-radius:100%}.kwai-layer{width:100%;height:100%;white-space:nowrap;animation-name:fill-unfill-rotate;animation-duration:5332ms;animation-timing-function:cubic-bezier(.4,0,.2,1);animation-iteration-count:infinite}.spinner-mask-1{left:-50%}.spinner-mask-2{right:-50%}.spinner-mask-1,.spinner-mask-2{position:absolute;width:100%;height:200%;top:-50%;overflow:hidden}.loading-spinner-frame,.loading-panel-spinner-frame{position:absolute;top:50%;left:50%;height:72px;width:72px;margin-left:-36px;margin-top:-48px;overflow:hidden}.loading-spinner-mask-2-bg{animation-name:mask-2-spin}.loading .loading-spinner-mask-2-bg{left:-100%;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjIuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxOTYgMTk2IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxOTYgMTk2OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xNDcsOThjMCwxOS42LTExLjUsMzYuNS0yOC4yLDQ0LjRsMCwwYy0wLjEsMC0wLjIsMC4xLTAuMywwLjEKCWMwLjEsMCwwLjItMC4xLDAuMy0wLjFsLTEuNy0zLjZDMTMyLjQsMTMxLjYsMTQzLDExNiwxNDMsOThjMC0yNC45LTIwLjEtNDUtNDUtNDV2LTRDMTI1LjEsNDksMTQ3LDcwLjksMTQ3LDk4eiIvPgo8L3N2Zz4K);background-position:right center}.loading-spinner-mask-1-bg{animation-name:mask-1-spin}.loading-spinner-mask-1-bg,.loading-spinner-mask-2-bg{position:absolute;background-repeat:no-repeat;width:200%;height:100%;top:0;animation-duration:1333ms;animation-timing-function:cubic-bezier(.4,0,.2,1);animation-iteration-count:infinite;animation-fill-mode:forwards}.loading .loading-spinner-mask-1-bg{left:0px;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjIuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxOTYgMTk2IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxOTYgMTk2OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik05OCw0OXY0Yy0yNC45LDAtNDUsMjAuMS00NSw0NQoJYzAsMTgsMTAuNiwzMy42LDI1LjksNDAuOGwtMS43LDMuNmMwLjEsMCwwLjIsMC4xLDAuMywwLjFjLTAuMSwwLTAuMi0wLjEtMC4zLTAuMWwwLDBDNjAuNSwxMzQuNSw0OSwxMTcuNiw0OSw5OAoJQzQ5LDcwLjksNzAuOSw0OSw5OCw0OXoiLz4KPC9zdmc+Cg==);background-position:left center}.switchPanel{position:absolute;left:0;top:0;width:251px;background:rgba(19,18,18,.8);border:1px solid rgb(50,49,49);color:#fff;z-index:20;border-radius:2px}.switchMenu{padding:5px 0}.line{cursor:pointer;display:table-row;height:40px}.line:hover{background-color:#5559;color:#eee}.icon{display:table-cell;vertical-align:middle;width:47px;height:20px;padding:0 10px}.iconImg{width:1.5em;height:1.5em;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjY2MjQ5Mjk5MTA5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQxNTAiIHdpZHRoPSIyNTAiIGhlaWdodD0iMjUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PHBhdGggZD0iTTUxMiAxMDI0QTUxMiA1MTIgMCAxIDEgNTEyIDBhNTEyIDUxMiAwIDAgMSAwIDEwMjR6IG0zLjAwOC05Mi45OTJhNDE2IDQxNiAwIDEgMCAwLTgzMiA0MTYgNDE2IDAgMCAwIDAgODMyek00NDggNDQ4aDEyOHYzODRINDQ4VjQ0OHogbTAtMjU2aDEyOHYxMjhINDQ4VjE5MnoiIGZpbGw9IiNmZmZmZmYiIHAtaWQ9IjQxNTEiPjwvcGF0aD48L3N2Zz4=);background-size:contain}.label{display:table-cell;vertical-align:middle;padding:0 15px 0 0;width:191px;font-weight:400;font-size:13.3px}.switchPanel-checkbox{-webkit-appearance:none;appearance:none;width:1.125em;height:1.125em;margin:.9375em}.switchPanel-checkbox:checked{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjY2MTczNTA3OTc2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQ0MjUiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjUwIiBoZWlnaHQ9IjI1MCI+PHBhdGggZD0iTTgxNy43MjggMTk4LjcybDExMS43NDQgMTE0LjU2LTU0NS4yMTYgNTMyLjEyOC0yODUuOTItMjczLjAyNCAxMTAuNTI4LTExNS43MTIgMTc0LjE3NiAxNjYuMzM2eiIgcC1pZD0iNDQyNiIgZmlsbD0iI2ZmZmZmZiI+PC9wYXRoPjwvc3ZnPg==);background-size:contain}@keyframes container-rotate{to{transform:rotate(360deg)}}@keyframes fill-unfill-rotate{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}to{transform:rotate(1080deg)}}@keyframes mask-1-spin{0%{transform:rotate(157deg)}50%{transform:rotate(30deg)}to{transform:rotate(157deg)}}@keyframes mask-2-spin{0%{transform:rotate(-155deg)}50%{transform:rotate(-30deg)}to{transform:rotate(-155deg)}}</style><style>._container_1m0zi_1{position:absolute;left:0;top:0;padding:5px;width:90%;max-width:300px;max-height:100%;overflow:scroll;background:rgba(0,0,0,.8);word-break:break-all;white-space:normal}._container-h5_1m0zi_15{position:absolute;left:0;top:0;padding:5px;width:100%;height:100%;overflow:scroll;background:rgba(0,0,0,.8);word-break:break-all;white-space:normal}._closeEventLog-btn_1m0zi_28{position:absolute;right:10px;top:2px;cursor:pointer}._eventLogItem_1m0zi_35{display:flex}._eventLogItem-name_1m0zi_39{min-width:30%;text-align:right}._eventLogItem-colon_1m0zi_44{text-align:center;flex:5% 0 0}._eventLogItem-value_1m0zi_49{flex:1;cursor:pointer}</style><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.zswsdid.5bb695fcd05d84fd15ca.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.shared_da7c8ae9ba4d3befc7c2f1c0b3e151cc8ee375ec.46bf172c7aeac9f5ae11.js.download" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./UE4 Shader 编译以及变种实现 - 知乎_files/column.user-hover-card.216a26f4.eabb3dfa660799d5f829.css" crossorigin="anonymous"><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.user-hover-card.513059ec149ce9c62576.js.download" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./UE4 Shader 编译以及变种实现 - 知乎_files/column.Labels.216a26f4.7d19d2afdc588e36471f.css" crossorigin="anonymous"><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.Labels.99df6fe93d8447bc27f9.js.download" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./UE4 Shader 编译以及变种实现 - 知乎_files/column.GoodsRecommendGoodsCardList.216a26f4.fa4bea774ed719d42a42.css" crossorigin="anonymous"><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.GoodsRecommendGoodsCardList.8af7137eaa8961dc01f5.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.report_modals.8f5020365d67291c787c.js.download" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./UE4 Shader 编译以及变种实现 - 知乎_files/column.modals.216a26f4.28903b70481acfdc9ee2.css" crossorigin="anonymous"><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.modals.722d9c30e43170814f90.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.lib_cf230269.a532add9245cdb169cfd.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.comments-v3.5e88d6f29b731c6589cb.js.download" crossorigin="anonymous"></script><style data-emotion="css"></style><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.85.0812fcf1ea2dfbfd754b.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.lib_9974496f.37f7e4d7be895c5a9034.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.shared_bf8e55f747b1310da866a56e0f5656c66d9272a4.c2860ebe27292a5c17b9.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.shared_03103dc5b8182a3433c5ef33bacb88093fd08a38.6ee14818e0f663c75523.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.shared_889419e066c38251e2dcbb9a7c42dbfc379cadeb.16d1996aee0be528166b.js.download" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./UE4 Shader 编译以及变种实现 - 知乎_files/column.EditableV2.216a26f4.55b44f79780ebb4322e0.css" crossorigin="anonymous"><script charset="utf-8" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.EditableV2.205fb6363c10d7013b54.js.download" crossorigin="anonymous"></script></head><body class="WhiteBg-body PostIndex-body" data-rh="class"><div id="root"><div class="App"><div class="LoadingBar  css-uzm3ri"></div><div><span style="position:absolute;top:-10000px;left:-10000px" role="log" aria-live="assertive"></span></div><main role="main" class="App-main"><div class="Post-content" data-zop-usertoken="{&quot;userToken&quot;:&quot;ao-ta-kang-007&quot;}" data-zop="{&quot;authorName&quot;:&quot;YiQiuuu&quot;,&quot;itemId&quot;:154081604,&quot;title&quot;:&quot;UE4 Shader 编译以及变种实现&quot;,&quot;type&quot;:&quot;article&quot;}" data-za-detail-view-path-module="PostItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;token&quot;:&quot;154081604&quot;}}}"><div class="ColumnPageHeader-Wrapper"><div><div class="Sticky ColumnPageHeader css-1l12z7y" style=""><div class="ColumnPageHeader-content"><a href="https://www.zhihu.com/" aria-label="知乎"><svg viewBox="0 0 64 30" fill="#056DE8" width="64" height="30" class="css-1hlrcxk"><path d="M29.05 4.582H16.733V25.94h3.018l.403 2.572 4.081-2.572h4.815V4.582zm-5.207 18.69l-2.396 1.509-.235-1.508h-1.724V7.233h6.78v16.04h-2.425zM14.46 14.191H9.982c0-.471.033-.954.039-1.458v-5.5h5.106V5.935a1.352 1.352 0 0 0-.404-.957 1.378 1.378 0 0 0-.968-.396H5.783c.028-.088.056-.177.084-.255.274-.82 1.153-3.326 1.153-3.326a4.262 4.262 0 0 0-2.413.698c-.57.4-.912.682-1.371 1.946-.532 1.453-.997 2.856-1.31 3.693C1.444 8.674.28 11.025.28 11.025a5.85 5.85 0 0 0 2.52-.61c1.119-.593 1.679-1.502 2.054-2.883l.09-.3h2.334v5.5c0 .5-.045.982-.073 1.46h-4.12c-.71 0-1.39.278-1.893.775a2.638 2.638 0 0 0-.783 1.874h6.527a17.717 17.717 0 0 1-.778 3.649 16.796 16.796 0 0 1-3.012 5.273A33.104 33.104 0 0 1 0 28.74s3.13 1.175 5.425-.954c1.388-1.292 2.631-3.814 3.23-5.727a28.09 28.09 0 0 0 1.12-5.229h5.967v-1.37a1.254 1.254 0 0 0-.373-.899 1.279 1.279 0 0 0-.909-.37z"></path><path d="M11.27 19.675l-2.312 1.491 5.038 7.458a6.905 6.905 0 0 0 .672-2.218 3.15 3.15 0 0 0-.28-2.168l-3.118-4.563zM51.449 15.195V5.842c4.181-.205 7.988-.405 9.438-.483l.851-.05c.387-.399.885-2.395.689-3.021-.073-.25-.213-.666-.638-.555a33.279 33.279 0 0 1-4.277.727c-2.766.321-3.97.404-7.804.682-6.718.487-12.709.72-12.709.72a2.518 2.518 0 0 0 .788 1.834 2.567 2.567 0 0 0 1.883.706c2.278-.095 5.598-.25 8.996-.41v9.203h-12.78c0 .703.281 1.377.783 1.874a2.69 2.69 0 0 0 1.892.777h10.105v7.075c0 .887-.464 1.192-1.231 1.214h-3.92a4.15 4.15 0 0 0 .837 1.544 4.2 4.2 0 0 0 1.403 1.067 6.215 6.215 0 0 0 2.71.277c1.36-.066 2.967-.826 2.967-3.57v-7.607h11.28c.342 0 .67-.135.91-.374.242-.239.378-.563.378-.902v-1.375H51.449z"></path><path d="M42.614 8.873a2.304 2.304 0 0 0-1.508-.926 2.334 2.334 0 0 0-1.727.405l-.376.272 4.255 5.85 2.24-1.62-2.884-3.98zM57.35 8.68l-3.125 4.097 2.24 1.663 4.517-5.927-.375-.277a2.32 2.32 0 0 0-1.722-.452 2.327 2.327 0 0 0-1.536.896z"></path></svg></a><div class="ColumnPageHeader-Button"><div class="Popover"><button title="更多" id="Popover1-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover1-content" type="button" class="Button ColumnPageHeader-MenuToggler Button--plain"><svg width="24" height="24" viewBox="0 0 24 24" class="Zi Zi--Dots" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></button></div><button type="button" class="Button ColumnPageHeader-WriteButton Button--blue"><svg width="24" height="24" viewBox="0 0 24 24" class="Zi Zi--EditSurround" fill="currentColor"><path fill-rule="evenodd" d="M3.55 5.97a2.415 2.415 0 0 1 2.415-2.416h7.56a.75.75 0 0 1 0 1.5h-7.56a.915.915 0 0 0-.915.915v12.072c0 .505.41.915.915.915h12.074c.506 0 .915-.41.915-.915v-7.557a.75.75 0 0 1 1.5 0v7.557a2.415 2.415 0 0 1-2.415 2.415H5.965A2.415 2.415 0 0 1 3.55 18.04V5.969Z" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M20.239 3.77a.75.75 0 0 1 0 1.06l-8.206 8.206a.75.75 0 0 1-1.06-1.06l8.205-8.206a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd"></path></svg>写文章</button></div></div><div class="ColumnPageHeader-profile"><div class="Popover AppHeader-menu"><button id="Popover4-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover4-content" type="button" class="Button AppHeader-profileEntry Button--plain"><img class="Avatar AppHeader-profileAvatar css-1tzrnvf" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-ef69d369588e9764f9252225e6dc29ce_l.jpg" srcset="https://picd.zhimg.com/v2-ef69d369588e9764f9252225e6dc29ce_l.jpg?source=32738c0c 2x" alt="点击打开奥塔康007的主页"></button></div><div class="Popover AppHeaderProfileMenu-creatorHintPopover"><div class="AppHeaderProfileMenu-creatorHintToggler" id="Popover5-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover5-content"></div></div></div></div></div></div><div class="css-78p1r9"><div class="css-2v23m6"><div class="css-1ld0bim"><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-3fe7283018ad0664acc581d80e9766f3_720w.jpg" alt="UE4 Shader 编译以及变种实现" width="100%" height="100%" class="css-1phd9a0" srcset="https://pica.zhimg.com/v2-3fe7283018ad0664acc581d80e9766f3_200x0.jpg?source=172ae18b 200w,https://pica.zhimg.com/v2-3fe7283018ad0664acc581d80e9766f3_qhd.jpg?source=172ae18b 480w,https://pica.zhimg.com/v2-3fe7283018ad0664acc581d80e9766f3_720w.jpg?source=172ae18b 720w,https://pica.zhimg.com/v2-3fe7283018ad0664acc581d80e9766f3_1440w.jpg?source=172ae18b 1440w" loading="lazy"></div></div></div><article class="Post-Main Post-NormalMain" tabindex="-1"><header class="Post-Header"><h1 class="Post-Title">UE4 Shader 编译以及变种实现</h1><div class="Post-Author"><div class="AuthorInfo" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><div class="AuthorInfo"><meta itemprop="name" content="YiQiuuu"><meta itemprop="image" content="https://picd.zhimg.com/v2-578535b731d14d93a031e43b1ff3be50_l.jpg?source=172ae18b"><meta itemprop="url" content="https://www.zhihu.com/people/xie-jie-62-1"><meta itemprop="zhihu:followerCount"><span class="UserLink AuthorInfo-avatarWrapper"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/xie-jie-62-1" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar AuthorInfo-avatar css-1y9jkzv" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-578535b731d14d93a031e43b1ff3be50_l.jpg" srcset="https://picd.zhimg.com/v2-578535b731d14d93a031e43b1ff3be50_l.jpg?source=172ae18b 2x" alt="YiQiuuu"></a></div></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/xie-jie-62-1" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">YiQiuuu</a></div><a href="https://www.zhihu.com/question/48510028" target="_blank" class="css-n99yhz" aria-label="网易游戏 游戏研发" data-tooltip="网易游戏 游戏研发"><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-1ifz0go" width="18" height="18"><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#FFFFFF" width="30" height="30"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="#0066FF"></path><svg class="Zi Zi--Check" fill="#fff" x="6" y="6" viewBox="0 0 24 24" width="12" height="12"><path d="M10.229 17.516c-.318.327-.75.484-1.199.484-.453 0-.884-.16-1.202-.488l-4.335-4.47a1.77 1.77 0 0 1 .007-2.459 1.663 1.663 0 0 1 2.397.01l3.137 3.246 9.072-9.329a1.662 1.662 0 0 1 2.397 0c.663.681.663 1.786 0 2.466L10.23 17.516z" fill-rule="evenodd"></path></svg></svg></span></a></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"><div class="ztext AuthorInfo-badgeText css-0">网易游戏 游戏研发</div></div></div></div></div></div><button type="button" class="Button FollowButton Button--primary Button--blue"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Plus FollowButton-icon" fill="currentColor"><path fill-rule="evenodd" d="M13.25 3.25a1.25 1.25 0 1 0-2.5 0v7.5h-7.5a1.25 1.25 0 1 0 0 2.5h7.5v7.5a1.25 1.25 0 1 0 2.5 0v-7.5h7.5a1.25 1.25 0 0 0 0-2.5h-7.5v-7.5Z" clip-rule="evenodd"></path></svg></span>关注他</button></div><div class="LabelContainer-wrapper"></div><div role="button" tabindex="0"><span class="Voters"><span><span class="UserLink"><div class="css-1gomreu"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/chang-xiao-qi-86">Jerish</a></div></span></span><span>、<span class="UserLink"><div class="css-1gomreu"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/puzzledboy">PZZZB</a></div></span></span> 等 <button type="button" class="Button Button--plain">283 人赞同了该文章</button></span></div></header><div class="Post-RichTextContainer"><div class="css-1yuhvjn"><div class="css-79elbk"><div class="RichText ztext Post-RichText css-4em6pe" options="[object Object]"><p data-first-child="" data-pid="O3HuydD2"><b>一 , 动机</b></p><p data-pid="SWzJjPke">这篇文章主要是我对UE4中Shader编译过程以及变种的理解，了解这一块挺有必要的，毕竟动辄几千上万个Shader的编译在UE里简直是家常便饭，了解它底层的实现机制后内心踏实一点，要去修改的话大方向也不错</p><p data-pid="KRsxTDGZ">这部分工作是我之前就做好的，文章里涉及内部修改的地方都被我阉割掉了（阉割版，之后还有内容我再加。。 工作繁忙外加懒）</p><p data-pid="HRMcpKxH">所以这篇文章主要用于知识普及，分享给广大被UE4中的Shader编译折磨的码农们，凑活着看把，看完其实应该都了解了，有收获的记得点赞哟。</p><p class="ztext-empty-paragraph"><br></p><p data-pid="VCx1YVZs"><b>二 , UE4中Shader的组织和获取</b></p><p data-pid="noNqw8Th">在讲具体的Shader编译过程时，先讲UE4的渲染过程，渲染过程中是怎么拿Shader的，最后再讲这些Shader是怎么生成的</p><p data-pid="vHkgF_E2">虚幻引擎中讲到线程主要有三个：游戏线程，渲染线程，RHI线程。</p><p data-pid="CfQer8y5">其中我们平时关心的比较多的就是游戏线程和渲染线程了，至于RHI线程偏向于底层硬件接口，是甚少关心的，一般情况下也很少有需要改动到RHI线程的东西</p><p data-pid="WAZCrHDd"><b>2.1 渲染线程</b></p><p data-pid="78z9z_Kp">虚幻引擎在FEngineLoop::PreInit中对渲染线程进行初始化</p><p data-pid="hUongrnA">具体的位置是在StartRenderingThread函数里面，此时虚幻引擎主窗口是尚未被绘制出来的，渲染线程的启动位于StartRenderingThread函数里面，这个函数大概做了以下几件事</p><p data-pid="TZny-EN9">1：通过FRunnableThread::Create函数创建渲染线程</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-ac0ef9efde715fdac58d62d30068ab25_b.jpg" data-caption="" data-size="normal" data-rawwidth="866" data-rawheight="110" class="origin_image zh-lightbox-thumb" width="866" data-original="https://pic2.zhimg.com/v2-ac0ef9efde715fdac58d62d30068ab25_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-ac0ef9efde715fdac58d62d30068ab25_1440w.webp" data-caption="" data-size="normal" data-rawwidth="866" data-rawheight="110" class="origin_image zh-lightbox-thumb lazy" width="866" data-original="https://pic2.zhimg.com/v2-ac0ef9efde715fdac58d62d30068ab25_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-ac0ef9efde715fdac58d62d30068ab25_b.jpg" height="110" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="8-UIPG9Q">2：等待渲染线程准备好从自己的TaskGraph取出任务并执行</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-50a1f4db64e8dadebe4a40932210f954_b.jpg" data-caption="" data-size="normal" data-rawwidth="752" data-rawheight="56" class="origin_image zh-lightbox-thumb" width="752" data-original="https://pic1.zhimg.com/v2-50a1f4db64e8dadebe4a40932210f954_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-50a1f4db64e8dadebe4a40932210f954_1440w.webp" data-caption="" data-size="normal" data-rawwidth="752" data-rawheight="56" class="origin_image zh-lightbox-thumb lazy" width="752" data-original="https://pic1.zhimg.com/v2-50a1f4db64e8dadebe4a40932210f954_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-50a1f4db64e8dadebe4a40932210f954_b.jpg" height="56" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="HSC6HS08">3：注册渲染线程</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-c197e14e7e051a4a494682b316747c59_b.jpg" data-caption="" data-size="normal" data-rawwidth="1157" data-rawheight="62" class="origin_image zh-lightbox-thumb" width="1157" data-original="https://pic2.zhimg.com/v2-c197e14e7e051a4a494682b316747c59_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-c197e14e7e051a4a494682b316747c59_1440w.webp" data-caption="" data-size="normal" data-rawwidth="1157" data-rawheight="62" class="origin_image zh-lightbox-thumb lazy" width="1157" data-original="https://pic2.zhimg.com/v2-c197e14e7e051a4a494682b316747c59_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-c197e14e7e051a4a494682b316747c59_b.jpg" height="62" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="8I2pw7x8">4：创建渲染线程心跳更新线程</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-07faa35be46431aae72b7d5a8126b988_b.jpg" data-caption="" data-size="normal" data-rawwidth="1082" data-rawheight="82" class="origin_image zh-lightbox-thumb" width="1082" data-original="https://pic1.zhimg.com/v2-07faa35be46431aae72b7d5a8126b988_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-07faa35be46431aae72b7d5a8126b988_1440w.webp" data-caption="" data-size="normal" data-rawwidth="1082" data-rawheight="82" class="origin_image zh-lightbox-thumb lazy" width="1082" data-original="https://pic1.zhimg.com/v2-07faa35be46431aae72b7d5a8126b988_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-07faa35be46431aae72b7d5a8126b988_b.jpg" height="82" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="g7HJ7fMF"><b>2.2 渲染线程的运行</b></p><p data-pid="TM-Ql1Qs"><b>在ue4的体系中，</b></p><p data-pid="7fYf4MHz">渲染线程的主要执行内容在全局函数RenderingThreadMain(RenderingThread.cpp)中</p><p data-pid="dRY3k5vw">从本质上来讲它更像是一个员工，等着老板给他派任务，老板塞给他的任务都会放在TaskMap中，他则负责不断的提取这些任务去执行</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-a4a7190591579e4b72347914a62c9049_b.jpg" data-caption="" data-size="normal" data-rawwidth="586" data-rawheight="102" class="origin_image zh-lightbox-thumb" width="586" data-original="https://pic2.zhimg.com/v2-a4a7190591579e4b72347914a62c9049_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-a4a7190591579e4b72347914a62c9049_1440w.webp" data-caption="" data-size="normal" data-rawwidth="586" data-rawheight="102" class="origin_image zh-lightbox-thumb lazy" width="586" data-original="https://pic2.zhimg.com/v2-a4a7190591579e4b72347914a62c9049_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-a4a7190591579e4b72347914a62c9049_b.jpg" height="102" data-lazy-status="ok"></div></figure><p data-pid="bi02Nb2d">老板可以通过ENQUEUE_RENDER_COMMAND系列宏，给员工派发任务(添加到TaskMap中)，下图说明了这个过程</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-10dec6626838f45deb29e0cb8d421530_b.jpg" data-caption="" data-size="normal" data-rawwidth="417" data-rawheight="168" class="content_image" width="417"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-10dec6626838f45deb29e0cb8d421530_1440w.webp" data-caption="" data-size="normal" data-rawwidth="417" data-rawheight="168" class="content_image lazy" width="417" data-actualsrc="https://pic1.zhimg.com/v2-10dec6626838f45deb29e0cb8d421530_b.jpg" height="168" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="o2rR8JlK">具体代码调用实例如下，这个宏是在游戏线程中调用的，有时候游戏线程中有一些资源发生了变动，或者添加了一些新的资源，抑或是因为一些逻辑而要去改到渲染线程的一些操作，都需要有一种方法去通知到渲染线程，就像是两艘并行飞驰的船，各自走自己的路，另一艘船上发生了什么是完全不知道的，而UE4就通过设置一系列宏为两艘船之间的通信提供了方法</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-52f86ee82f90cd6d0085bdbb8ad955c5_b.jpg" data-size="normal" data-rawwidth="659" data-rawheight="198" class="origin_image zh-lightbox-thumb" width="659" data-original="https://pic2.zhimg.com/v2-52f86ee82f90cd6d0085bdbb8ad955c5_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-52f86ee82f90cd6d0085bdbb8ad955c5_1440w.webp" data-size="normal" data-rawwidth="659" data-rawheight="198" class="origin_image zh-lightbox-thumb lazy" width="659" data-original="https://pic2.zhimg.com/v2-52f86ee82f90cd6d0085bdbb8ad955c5_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-52f86ee82f90cd6d0085bdbb8ad955c5_b.jpg" height="198" data-lazy-status="ok"></div><figcaption>em。。 马赛克忽略把</figcaption></figure><p data-pid="4M5IRyvW">员工执行任务时也不是直接向GPU发送指令，而是将渲染命令添加到RHICommandList，也就是RHI命令列表中，由RHI线程不断取出指令，向GPU发送，并阻塞等待结果</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-7f7d4c3e46d5684ab57780e30921788f_b.jpg" data-caption="" data-size="normal" data-rawwidth="407" data-rawheight="137" class="content_image" width="407"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-7f7d4c3e46d5684ab57780e30921788f_1440w.webp" data-caption="" data-size="normal" data-rawwidth="407" data-rawheight="137" class="content_image lazy" width="407" data-actualsrc="https://pic4.zhimg.com/v2-7f7d4c3e46d5684ab57780e30921788f_b.jpg" height="137" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="is1Q0pfN">此时RHI线程虽然阻塞，但是渲染线程依然正常工作，可以继续处理向RHI命令列表填充指令</p><p class="ztext-empty-paragraph"><br></p><p data-pid="VEa3rHmh"><b>2.3 渲染过程中Shader的来源及选择</b></p><p data-pid="0XypwGyl">明白了上述那些概念我们知道，屏幕结果就像是我们最终要做出来的产品，老板就像是产品经理，告诉员工这个产品要怎么做，并交给员工对应的资源，员工根据这些资源，和老板的命令去完成最终的产品（绘制到屏幕上）</p><p data-pid="fgGdOtaA">首先讲这些资源在ue4中对应的是什么，以及员工在完成不同的工作阶段（绘制Pass）时是如何从这么多资源中拿到自己想要的资源的，再去讲这些资源的生成</p><p class="ztext-empty-paragraph"><br></p><p data-pid="4kPpeSnv"><b>资源的组织：ShaderMap</b></p><p data-pid="pVXVxT1v">那么屏幕上的画面究竟是如何呈现的呢？员工是怎么样去用这些资源的呢，换句话说就是老板给员工的资源，员工是怎么处理成最终能用的资源的？并且这些资源是怎么组织的？</p><p data-pid="90vtxCbB">这里就涉及到一个名词：ShaderMap</p><p data-pid="yoWrrYPZ">用过虚幻4的渲染的都知道，虚幻引擎中的着色器数量是非常庞大的，如果改动一个材质，经常就需要编几千个甚至上万个Shader，其实也就是说单个材质会编译出多个Shader，这一点是非常重要的</p><p data-pid="0PXdP9IN">用一个简单点的概念来理解ShaderMap，可以把它理解成一个三维矩阵，长度为每个材质类型，宽度为每个渲染阶段，高度为每个顶点工厂类型，矩阵的每一个方格都对应了一组着色器组合(顶点着色器，像素着色器)，材质也不一定参与全部阶段，所以这个三维矩阵中是存在有很多空缺的</p><p data-pid="EFJueMTI">顶点工厂在ue4中的含义是负责抽象顶点数据以供后面的着色器获取，从而让着色器能够忽略由于顶点类型造成的差异，比如说普通的静态网格物体和使用GPU进行蒙皮的物体，二者的顶点数据不同，但是通过顶点工厂进行抽象后，提供统一的数据获取接口，供后面的着色器使用</p><p class="ztext-empty-paragraph"><br></p><p data-pid="MlnJrLSg"><b>资源的选择：怎么从ShaderMap中拿到想要的Shader</b></p><p data-pid="oXX-_dFf">现在是第二个问题，如何根据当前阶段，当前的材质类型，当前顶点工厂类型，从这个三维矩阵中获得需要的着色器组合呢</p><p data-pid="cX_Own3y">以一个StaticMesh物体的渲染为例（动态物体不同），对着色器数据选择的过程如下：</p><p data-pid="Os6SwvFr">1：渲染线程把这个物体添加进场景 AddToScene</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-6b0ed3ceba8a579e1882d8d7b763352a_b.jpg" data-caption="" data-size="normal" data-rawwidth="1181" data-rawheight="67" class="origin_image zh-lightbox-thumb" width="1181" data-original="https://pic3.zhimg.com/v2-6b0ed3ceba8a579e1882d8d7b763352a_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-6b0ed3ceba8a579e1882d8d7b763352a_1440w.webp" data-caption="" data-size="normal" data-rawwidth="1181" data-rawheight="67" class="origin_image zh-lightbox-thumb lazy" width="1181" data-original="https://pic3.zhimg.com/v2-6b0ed3ceba8a579e1882d8d7b763352a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-6b0ed3ceba8a579e1882d8d7b763352a_b.jpg" height="67" data-lazy-status="ok" style=""></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="_SS-BGhS">2：更新场景的静态物体绘制列表 AddStaticMeshes</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-43eac107d4f84c533730dbc3fac35809_b.jpg" data-caption="" data-size="normal" data-rawwidth="496" data-rawheight="83" class="origin_image zh-lightbox-thumb" width="496" data-original="https://pic2.zhimg.com/v2-43eac107d4f84c533730dbc3fac35809_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-43eac107d4f84c533730dbc3fac35809_1440w.webp" data-caption="" data-size="normal" data-rawwidth="496" data-rawheight="83" class="origin_image zh-lightbox-thumb lazy" width="496" data-original="https://pic2.zhimg.com/v2-43eac107d4f84c533730dbc3fac35809_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-43eac107d4f84c533730dbc3fac35809_b.jpg" height="83" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="x7gEpQ0g">3: 调用CacheMeshDrawCommands，开始生成当前物体的绘制命令MeshDrawCommands并缓存住</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-9e51f4bedd8c60285f2c71f4ba9c7633_b.jpg" data-caption="" data-size="normal" data-rawwidth="333" data-rawheight="93" class="content_image" width="333"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-9e51f4bedd8c60285f2c71f4ba9c7633_1440w.webp" data-caption="" data-size="normal" data-rawwidth="333" data-rawheight="93" class="content_image lazy" width="333" data-actualsrc="https://pic4.zhimg.com/v2-9e51f4bedd8c60285f2c71f4ba9c7633_b.jpg" height="93" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="lxHWNrJY">4：遍历所有的Rendering Pass类型，获取当前场景的CachedDrawLists生成Drawlistcontext</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-343c04595d5ab1c1ee8dfadf825ec792_b.jpg" data-caption="" data-size="normal" data-rawwidth="908" data-rawheight="235" class="origin_image zh-lightbox-thumb" width="908" data-original="https://pic3.zhimg.com/v2-343c04595d5ab1c1ee8dfadf825ec792_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-343c04595d5ab1c1ee8dfadf825ec792_1440w.webp" data-caption="" data-size="normal" data-rawwidth="908" data-rawheight="235" class="origin_image zh-lightbox-thumb lazy" width="908" data-original="https://pic3.zhimg.com/v2-343c04595d5ab1c1ee8dfadf825ec792_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-343c04595d5ab1c1ee8dfadf825ec792_b.jpg" height="235" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="NSy5ZXcm">5：调用不同Pass(以BasePass为例)的AddMeshBatch函数，并将Drawlistcontext作为参数传入（方便之后把生成的绘制命令缓存住）</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-ad24f92c1bbe519c6d9799884c8f398b_b.jpg" data-caption="" data-size="normal" data-rawwidth="1020" data-rawheight="261" class="origin_image zh-lightbox-thumb" width="1020" data-original="https://pic4.zhimg.com/v2-ad24f92c1bbe519c6d9799884c8f398b_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-ad24f92c1bbe519c6d9799884c8f398b_1440w.webp" data-caption="" data-size="normal" data-rawwidth="1020" data-rawheight="261" class="origin_image zh-lightbox-thumb lazy" width="1020" data-original="https://pic4.zhimg.com/v2-ad24f92c1bbe519c6d9799884c8f398b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-ad24f92c1bbe519c6d9799884c8f398b_b.jpg" height="261" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="SLZGgbX2">6：通过一系列参数判断该Mesh应不应该在当前Pass（BasePass为例）生成绘制命令，如果验证通过，那么调用当前Pass的Process函数</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-89312ccfb265dc5610ecabe37db9889a_b.jpg" data-size="normal" data-rawwidth="656" data-rawheight="127" class="origin_image zh-lightbox-thumb" width="656" data-original="https://pic3.zhimg.com/v2-89312ccfb265dc5610ecabe37db9889a_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-89312ccfb265dc5610ecabe37db9889a_1440w.webp" data-size="normal" data-rawwidth="656" data-rawheight="127" class="origin_image zh-lightbox-thumb lazy" width="656" data-original="https://pic3.zhimg.com/v2-89312ccfb265dc5610ecabe37db9889a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-89312ccfb265dc5610ecabe37db9889a_b.jpg" height="127" data-lazy-status="ok"></div><figcaption>其实也没啥，但是还是加马赛克</figcaption></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="f_OSdl6h">7：获取该Mesh在当前Pass绘制需要的Shaders，绘制状态，光栅化状态，并最终生成该Mesh的绘制命令</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-8df979e5cb94045a5b0b580213937f00_b.jpg" data-caption="" data-size="normal" data-rawwidth="353" data-rawheight="210" class="content_image" width="353"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-8df979e5cb94045a5b0b580213937f00_1440w.webp" data-caption="" data-size="normal" data-rawwidth="353" data-rawheight="210" class="content_image lazy" width="353" data-actualsrc="https://pic1.zhimg.com/v2-8df979e5cb94045a5b0b580213937f00_b.jpg" height="210" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-db14a2f5c97135001a0884262fd22f6e_b.jpg" data-caption="" data-size="normal" data-rawwidth="762" data-rawheight="195" class="origin_image zh-lightbox-thumb" width="762" data-original="https://pic3.zhimg.com/v2-db14a2f5c97135001a0884262fd22f6e_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-db14a2f5c97135001a0884262fd22f6e_1440w.webp" data-caption="" data-size="normal" data-rawwidth="762" data-rawheight="195" class="origin_image zh-lightbox-thumb lazy" width="762" data-original="https://pic3.zhimg.com/v2-db14a2f5c97135001a0884262fd22f6e_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-db14a2f5c97135001a0884262fd22f6e_b.jpg" height="195" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-c2493b490e410530a715991e89e2f162_b.jpg" data-caption="" data-size="normal" data-rawwidth="753" data-rawheight="72" class="origin_image zh-lightbox-thumb" width="753" data-original="https://pic3.zhimg.com/v2-c2493b490e410530a715991e89e2f162_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-c2493b490e410530a715991e89e2f162_1440w.webp" data-caption="" data-size="normal" data-rawwidth="753" data-rawheight="72" class="origin_image zh-lightbox-thumb lazy" width="753" data-original="https://pic3.zhimg.com/v2-c2493b490e410530a715991e89e2f162_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-c2493b490e410530a715991e89e2f162_b.jpg" height="72" data-lazy-status="ok"></div></figure><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-096be7dfd53fffdbc2571d08144e22fd_b.jpg" data-caption="" data-size="normal" data-rawwidth="312" data-rawheight="265" class="content_image" width="312"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-096be7dfd53fffdbc2571d08144e22fd_1440w.webp" data-caption="" data-size="normal" data-rawwidth="312" data-rawheight="265" class="content_image lazy" width="312" data-actualsrc="https://pic2.zhimg.com/v2-096be7dfd53fffdbc2571d08144e22fd_b.jpg" height="265" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="V8bLhmKB">所以到这一步就讲清楚了渲染时怎么去拿Shader的流程，需要去看不同Pass的GetShaders函数，结合之前对ShaderMap的分析来看它的传入参数，MaterialResource对应它使用的材质资源，VertexFactory的type对应所用到的顶点工厂类型，最后还有用到的顶点和像素着色器</p><p data-pid="q4l9PpRd">最终得到顶点着色器和像素着色器的调用如下（此时材质类型和渲染Pass已经确定）</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-fbed4381b35abe2cb117d19db8662e22_b.jpg" data-caption="" data-size="normal" data-rawwidth="1194" data-rawheight="28" class="origin_image zh-lightbox-thumb" width="1194" data-original="https://pic3.zhimg.com/v2-fbed4381b35abe2cb117d19db8662e22_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-fbed4381b35abe2cb117d19db8662e22_1440w.webp" data-caption="" data-size="normal" data-rawwidth="1194" data-rawheight="28" class="origin_image zh-lightbox-thumb lazy" width="1194" data-original="https://pic3.zhimg.com/v2-fbed4381b35abe2cb117d19db8662e22_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-fbed4381b35abe2cb117d19db8662e22_b.jpg" height="28" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-ae9fd54c468aa1d896f8ac9d5aa41943_b.jpg" data-caption="" data-size="normal" data-rawwidth="1167" data-rawheight="49" class="origin_image zh-lightbox-thumb" width="1167" data-original="https://pic4.zhimg.com/v2-ae9fd54c468aa1d896f8ac9d5aa41943_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-ae9fd54c468aa1d896f8ac9d5aa41943_1440w.webp" data-caption="" data-size="normal" data-rawwidth="1167" data-rawheight="49" class="origin_image zh-lightbox-thumb lazy" width="1167" data-original="https://pic4.zhimg.com/v2-ae9fd54c468aa1d896f8ac9d5aa41943_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-ae9fd54c468aa1d896f8ac9d5aa41943_b.jpg" height="49" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="zr4BJEZ_">材质的GetShader函数首先以当前顶点工厂类型的id为索引，通过GetMeshShaderMap函数从OrderedMeshShaderMaps成员变量中查询到对应顶点工厂类型的MeshShaderMap，随后调用当前MeshShaderMap的GetShader函数，以当前着色器类型为参数查询，查询到实际对应的着色器</p><p class="ztext-empty-paragraph"><br></p><p data-pid="DA-4FB2x"><b>总结如下：实质上获取一组着色器组合需要的三个变量：渲染Pass，顶点工厂类型，材质类型，这也就不难理解UE4中对资源的组织形式了</b></p><p class="ztext-empty-paragraph"><br></p><p data-pid="a4lHBR_t"><b>三 , UE4中Shader的生成</b></p><p data-pid="M2cPEvvx"><b>MaterialShader的编译</b></p><p data-pid="m632nFop">在第二部分的内容中已经说清楚了ue4中Shader的组织形式以及具体是怎么去获取，那么接下来的问题就是如何去生成这些Shader，及材质如何编译，产生ShaderMap并缓存起来</p><p data-pid="025okgk7">在之前一篇对材质分析的文章中已经说到当HLSL代码生成后（这篇文章在我的笔记里，之后考虑放出来），就需要进入到真正的着色器编译阶段</p><p data-pid="aq2qtvni">材质节点图生成的HLSL代码只是一批函数，并不具备完整的着色器信息，这些代码会镶嵌到真正的着色器编译环境中(FShaderCompilerEnvironment)，重新编译成最终的ShaderMap中每一个着色器，主要流程如下</p><p data-pid="N1cI6suH">1：保存材质并编译当前材质，触发Shader编译，调用FMaterial::BeginCompileShaderMap()</p><p data-pid="SBDaQi2O">2：新建一个ShaderMap实例，调用HLSLTranslator把材质节点翻译成HLSL代码</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-897b31b74c76c4c564d1ec5dd5141f8a_b.jpg" data-caption="" data-size="normal" data-rawwidth="650" data-rawheight="32" class="origin_image zh-lightbox-thumb" width="650" data-original="https://pic3.zhimg.com/v2-897b31b74c76c4c564d1ec5dd5141f8a_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-897b31b74c76c4c564d1ec5dd5141f8a_1440w.webp" data-caption="" data-size="normal" data-rawwidth="650" data-rawheight="32" class="origin_image zh-lightbox-thumb lazy" width="650" data-original="https://pic3.zhimg.com/v2-897b31b74c76c4c564d1ec5dd5141f8a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-897b31b74c76c4c564d1ec5dd5141f8a_b.jpg" height="32" data-lazy-status="ok"></div></figure><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-cf7d76d6a3834c444629c9b58810a540_b.jpg" data-caption="" data-size="normal" data-rawwidth="612" data-rawheight="89" class="origin_image zh-lightbox-thumb" width="612" data-original="https://pic1.zhimg.com/v2-cf7d76d6a3834c444629c9b58810a540_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-cf7d76d6a3834c444629c9b58810a540_1440w.webp" data-caption="" data-size="normal" data-rawwidth="612" data-rawheight="89" class="origin_image zh-lightbox-thumb lazy" width="612" data-original="https://pic1.zhimg.com/v2-cf7d76d6a3834c444629c9b58810a540_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-cf7d76d6a3834c444629c9b58810a540_b.jpg" height="89" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="E_9pd5zP">3：初始化着色器编译环境，FShaderCompilerEnvironment通过MaterialTraslator::GetMaterialEnvironment初始化实例，主要就是去设置宏</p><p data-pid="RsQuVtwM">3.1：根据当前Material的各种属性，初始化各种着色器宏定义，从而控制编译过程中的各种宏开关是否启动</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-202709ae35ca9ae19000bad8ac4fd8f7_b.jpg" data-caption="" data-size="normal" data-rawwidth="905" data-rawheight="80" class="origin_image zh-lightbox-thumb" width="905" data-original="https://pic4.zhimg.com/v2-202709ae35ca9ae19000bad8ac4fd8f7_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-202709ae35ca9ae19000bad8ac4fd8f7_1440w.webp" data-caption="" data-size="normal" data-rawwidth="905" data-rawheight="80" class="origin_image zh-lightbox-thumb lazy" width="905" data-original="https://pic4.zhimg.com/v2-202709ae35ca9ae19000bad8ac4fd8f7_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-202709ae35ca9ae19000bad8ac4fd8f7_b.jpg" height="80" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="8YkagoU2">3.2：根据FHLSLMaterialTranslator在解析过程中得出当前的参数集合，添加参数定义到环境中</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-33aed76b93d28c6564d0ce1abfb5fac6_b.jpg" data-caption="" data-size="normal" data-rawwidth="721" data-rawheight="98" class="origin_image zh-lightbox-thumb" width="721" data-original="https://pic3.zhimg.com/v2-33aed76b93d28c6564d0ce1abfb5fac6_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-33aed76b93d28c6564d0ce1abfb5fac6_1440w.webp" data-caption="" data-size="normal" data-rawwidth="721" data-rawheight="98" class="origin_image zh-lightbox-thumb lazy" width="721" data-original="https://pic3.zhimg.com/v2-33aed76b93d28c6564d0ce1abfb5fac6_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-33aed76b93d28c6564d0ce1abfb5fac6_b.jpg" height="98" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="jYfahR4P">4：开始实际的编译工作</p><p data-pid="QMEIhnW8">4.1：调用NewShaderMap的Compile函数：</p><p data-pid="CSNxuXOA">a，调用FMaterial::SetupMaterialEnvironment函数，设置当前的编译环境，这里面也会去设置各种宏定义</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-c374eb1b3fa8231eed019f0159eee449_b.jpg" data-caption="" data-size="normal" data-rawwidth="903" data-rawheight="338" class="origin_image zh-lightbox-thumb" width="903" data-original="https://pic2.zhimg.com/v2-c374eb1b3fa8231eed019f0159eee449_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-c374eb1b3fa8231eed019f0159eee449_1440w.webp" data-caption="" data-size="normal" data-rawwidth="903" data-rawheight="338" class="origin_image zh-lightbox-thumb lazy" width="903" data-original="https://pic2.zhimg.com/v2-c374eb1b3fa8231eed019f0159eee449_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-c374eb1b3fa8231eed019f0159eee449_b.jpg" height="338" data-lazy-status="ok" style=""></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="D5ALJ2vR">b，获取所有顶点工厂类型，对于每一种顶点工厂类型，查看该类型对应的ShaderMap是不是已经被使用，如果被使用就去BeginCompile</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-3615466afce3666accb0580e74c67d87_b.jpg" data-caption="" data-size="normal" data-rawwidth="706" data-rawheight="188" class="origin_image zh-lightbox-thumb" width="706" data-original="https://pic4.zhimg.com/v2-3615466afce3666accb0580e74c67d87_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-3615466afce3666accb0580e74c67d87_1440w.webp" data-caption="" data-size="normal" data-rawwidth="706" data-rawheight="188" class="origin_image zh-lightbox-thumb lazy" width="706" data-original="https://pic4.zhimg.com/v2-3615466afce3666accb0580e74c67d87_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-3615466afce3666accb0580e74c67d87_b.jpg" height="188" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="kEEiVtZ5">c，BeginCompile函数中会去遍历所有的ShaderType,中间会调到实例类的ModifyCompilationEnvironment,最终调用全局函数GlobalBeginCompileShader，这个全局函数会去填充FShaderCompileJob，包括设置shader格式、usf路径、注入宏等等</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-e63921d8d281fbee9b7fc6938f83eefc_b.jpg" data-caption="" data-size="normal" data-rawwidth="945" data-rawheight="184" class="origin_image zh-lightbox-thumb" width="945" data-original="https://pic1.zhimg.com/v2-e63921d8d281fbee9b7fc6938f83eefc_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-e63921d8d281fbee9b7fc6938f83eefc_1440w.webp" data-caption="" data-size="normal" data-rawwidth="945" data-rawheight="184" class="origin_image zh-lightbox-thumb lazy" width="945" data-original="https://pic1.zhimg.com/v2-e63921d8d281fbee9b7fc6938f83eefc_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-e63921d8d281fbee9b7fc6938f83eefc_b.jpg" height="184" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="6nvwSj7N">d，真正执行编译任务的是把所有FShaderCompileJob交给FShaderCompilingManager，并且让其马上执行编译并返回</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-03cd6f0eac9f5a39079eaf229a7c3d17_b.jpg" data-caption="" data-size="normal" data-rawwidth="590" data-rawheight="327" class="origin_image zh-lightbox-thumb" width="590" data-original="https://pic4.zhimg.com/v2-03cd6f0eac9f5a39079eaf229a7c3d17_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-03cd6f0eac9f5a39079eaf229a7c3d17_1440w.webp" data-caption="" data-size="normal" data-rawwidth="590" data-rawheight="327" class="origin_image zh-lightbox-thumb lazy" width="590" data-original="https://pic4.zhimg.com/v2-03cd6f0eac9f5a39079eaf229a7c3d17_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-03cd6f0eac9f5a39079eaf229a7c3d17_b.jpg" height="327" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="2_w0AdMp"><b>如何实现Shader变种？</b></p><p data-pid="C_h6pkL8">FMeshMaterialShaderType继承自FShaderType，他存有模板类的两个静态函数指针：ModifyCompilationEnvironment和ShouldCompilePermutation，因此每次遍历我们都可以访问到这两个函数</p><p data-pid="FbvUPc9Z">上文中的c阶段会先调用ShouldCompilePermutation询问TMobileBasePassPS是否为当前Template、VertexFactory、Material组合编译Shader</p><p data-pid="cFYczNn8">如果需要编译，则调用ModifyCompilationEnvironment注入该当前模板确定的宏，以此实现Shader的变种。</p><p class="ztext-empty-paragraph"><br></p><p data-pid="97bKw6DI"><b>GlobalShader的编译</b></p><p data-pid="pdtDhxwe">在使用编辑器的时候，经常会有需要改动到Shader文件，并且需要在编辑器中查看效果的需求，与材质编辑器中的材质Shader不一样，材质编辑器提供了编译按钮，对材质的改动都可以保存并编译出Shader保存到ShaderMap中，所以如果改动了目录下的Shader文件怎么告诉引擎去帮我们编译修改后的Shader</p><p data-pid="n41Zcu5V">虚幻针对这个功能已经提供了相应的指令</p><p data-pid="v3hboXJA">recompileshaders changed ，recompileshaders global，recompileshaders material &lt;MaterialName&gt;，recompileshaders all，recompileshaders &lt;path&gt;</p><p data-pid="G713-gBQ">如果不知道这些指令，一个比较死的办法自然是重启编辑器，让它重编改动过的Shader，当然也可以不重启编辑器来重编这些改动过的shader，比如使用 recompileshaders changed，这里首先讲通过指令重编的方法，它的具体流程是怎样？</p><p class="ztext-empty-paragraph"><br></p><p data-pid="qSEV1eNp">一：动态重编Shader 不需要重开编辑器</p><p data-pid="UbcScT3C">1: 修改Shader文件，保存，在控制台输入 recompileshaders changed</p><p class="ztext-empty-paragraph"><br></p><p data-pid="Rwk4Vr_W">2：调用RecompileShaders，根据指令的内容进入不同的分支，先去匹配具体的命令内容</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-30f4e2bd8269c8d92339744afd24e988_b.jpg" data-caption="" data-size="normal" data-rawwidth="463" data-rawheight="50" class="origin_image zh-lightbox-thumb" width="463" data-original="https://pic1.zhimg.com/v2-30f4e2bd8269c8d92339744afd24e988_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-30f4e2bd8269c8d92339744afd24e988_1440w.webp" data-caption="" data-size="normal" data-rawwidth="463" data-rawheight="50" class="origin_image zh-lightbox-thumb lazy" width="463" data-original="https://pic1.zhimg.com/v2-30f4e2bd8269c8d92339744afd24e988_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-30f4e2bd8269c8d92339744afd24e988_b.jpg" height="50" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="14LHWaXS">3：寻找过期的Shader文件（改动过的Shader）</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-7f415efe69033f00033ab20d149b890a_b.jpg" data-caption="" data-size="normal" data-rawwidth="999" data-rawheight="172" class="origin_image zh-lightbox-thumb" width="999" data-original="https://pic3.zhimg.com/v2-7f415efe69033f00033ab20d149b890a_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-7f415efe69033f00033ab20d149b890a_1440w.webp" data-caption="" data-size="normal" data-rawwidth="999" data-rawheight="172" class="origin_image zh-lightbox-thumb lazy" width="999" data-original="https://pic3.zhimg.com/v2-7f415efe69033f00033ab20d149b890a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-7f415efe69033f00033ab20d149b890a_b.jpg" height="172" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="-4437jZ4">4：如果当前对Shader文件(.usf)没有任何改动，直接返回No Shader changes found，如果有改动，调用BeginRecompileGlobalShaders</p><p data-pid="SpGy1PnE">a,调用FlushRenderingCommands，等待渲染线程执行完所有挂起的渲染命令</p><p data-pid="uIb7YNxw">b,根据当前平台得到GlobalShaderMap，GetGlobalShaderMap(ShaderPlatform)，这里也可以看出来不同的ShaderType是存在不同的ShaderMap中的</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-097a83a0a52bae53b443d03320c7d72f_b.jpg" data-caption="" data-size="normal" data-rawwidth="736" data-rawheight="27" class="origin_image zh-lightbox-thumb" width="736" data-original="https://pic4.zhimg.com/v2-097a83a0a52bae53b443d03320c7d72f_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-097a83a0a52bae53b443d03320c7d72f_1440w.webp" data-caption="" data-size="normal" data-rawwidth="736" data-rawheight="27" class="origin_image zh-lightbox-thumb lazy" width="736" data-original="https://pic4.zhimg.com/v2-097a83a0a52bae53b443d03320c7d72f_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-097a83a0a52bae53b443d03320c7d72f_b.jpg" height="27" data-lazy-status="ok"></div></figure><p data-pid="XAwq_IQr">c，从ShaderMap中移除过期的CurrentGlobalShaderType和ShaderPipline（顶点还是像素着色器等等..）的Shader</p><p data-pid="GNGjI2E1">d，调用VerifyGlobalShaders重编ShaderMap中的Shader</p><p class="ztext-empty-paragraph"><br></p><p data-pid="Z3VJNzPN">5：完成GlobalShader的重编，调用FinishRecompileGlobalShaders()，该函数会阻塞直到所有的Global Shaders被编译和处理完毕</p><p class="ztext-empty-paragraph"><br></p><p data-pid="8MpLdFpR">二：重开编辑器</p><p data-pid="La3TKkhm">1：在引擎的preinit函数中调用CompileGlobalShaderMap</p><p data-pid="6-pJcMeq">2：新建一个GlobalShaderMap实例</p><p data-pid="Daoekk6-">3：查看Shader缓存DDC中的内容与设定的KeyString是否一致，如果不一致说明缓存中对应部分的内容已经失效了，UE就会去重编这部分内容(对应最开始说到的重编Shader问题)，并且去重新生成这部分的DDC</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-aa564a6b43f89239225874c8c62332e3_b.jpg" data-caption="" data-size="normal" data-rawwidth="980" data-rawheight="221" class="origin_image zh-lightbox-thumb" width="980" data-original="https://pic4.zhimg.com/v2-aa564a6b43f89239225874c8c62332e3_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-aa564a6b43f89239225874c8c62332e3_1440w.webp" data-caption="" data-size="normal" data-rawwidth="980" data-rawheight="221" class="origin_image zh-lightbox-thumb lazy" width="980" data-original="https://pic4.zhimg.com/v2-aa564a6b43f89239225874c8c62332e3_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-aa564a6b43f89239225874c8c62332e3_b.jpg" height="221" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="PTozoWMV">4：从DDC中反序列化出来GlobalShaderMap实例的内容</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-c434059c8c4fd35a9064e15e54410503_b.jpg" data-caption="" data-size="normal" data-rawwidth="578" data-rawheight="50" class="origin_image zh-lightbox-thumb" width="578" data-original="https://pic4.zhimg.com/v2-c434059c8c4fd35a9064e15e54410503_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-c434059c8c4fd35a9064e15e54410503_1440w.webp" data-caption="" data-size="normal" data-rawwidth="578" data-rawheight="50" class="origin_image zh-lightbox-thumb lazy" width="578" data-original="https://pic4.zhimg.com/v2-c434059c8c4fd35a9064e15e54410503_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-c434059c8c4fd35a9064e15e54410503_b.jpg" height="50" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="aBpP3Vip">5：接下来就是一些Shader资源的初始化操作...</p><p class="ztext-empty-paragraph"><br></p><p data-pid="e4DSbOMl"><b>三 , UE4中材质Cook保存的是什么</b></p><p data-pid="fqNC3dOg">所谓的Cook是指把平台无关的编辑向数据转化为特定平台运行时所需的数据，对于材质来说就是把上述的usf文件和材质连线编译成安卓运行时需要的GLSL源码。</p><p data-pid="CrExhCTY">1：Cook Commandlet会首先调用一个Package里面所有的UObject的BeginCacheForCookedPlatformData(const ITargetPlatform *TargetPlatform)方法，该方法由各个UObject派生类各自实现，目的是生成特定所需数据并缓存下来，对于材质来讲就是UMaterial的BeginCacheForCookedPlatformData</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-ec63015663ffcd1ede8a07369d45579f_b.jpg" data-caption="" data-size="normal" data-rawwidth="861" data-rawheight="122" class="origin_image zh-lightbox-thumb" width="861" data-original="https://pic4.zhimg.com/v2-ec63015663ffcd1ede8a07369d45579f_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-ec63015663ffcd1ede8a07369d45579f_1440w.webp" data-caption="" data-size="normal" data-rawwidth="861" data-rawheight="122" class="origin_image zh-lightbox-thumb lazy" width="861" data-original="https://pic4.zhimg.com/v2-ec63015663ffcd1ede8a07369d45579f_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-ec63015663ffcd1ede8a07369d45579f_b.jpg" height="122" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="ICWRbYHJ">a,开始为目标平台缓存着色器，并将正在编译的材质资源存储到CachedMaterialResourcesForCooking中</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-4a270cac89bedaa4a21528c0393b5791_b.jpg" data-caption="" data-size="normal" data-rawwidth="940" data-rawheight="29" class="origin_image zh-lightbox-thumb" width="940" data-original="https://pic2.zhimg.com/v2-4a270cac89bedaa4a21528c0393b5791_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-4a270cac89bedaa4a21528c0393b5791_1440w.webp" data-caption="" data-size="normal" data-rawwidth="940" data-rawheight="29" class="origin_image zh-lightbox-thumb lazy" width="940" data-original="https://pic2.zhimg.com/v2-4a270cac89bedaa4a21528c0393b5791_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-4a270cac89bedaa4a21528c0393b5791_b.jpg" height="29" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="QL6pJ1US">b,为当前ShaderFormat/FeatureLevel、QualityLevel生成一个FMaterialResource数组，并调用CacheShadersForResources填充其内容</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-d3be4d12fb8175db82cec340feb8ff6f_b.jpg" data-caption="" data-size="normal" data-rawwidth="745" data-rawheight="255" class="origin_image zh-lightbox-thumb" width="745" data-original="https://pic4.zhimg.com/v2-d3be4d12fb8175db82cec340feb8ff6f_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-d3be4d12fb8175db82cec340feb8ff6f_1440w.webp" data-caption="" data-size="normal" data-rawwidth="745" data-rawheight="255" class="origin_image zh-lightbox-thumb lazy" width="745" data-original="https://pic4.zhimg.com/v2-d3be4d12fb8175db82cec340feb8ff6f_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-d3be4d12fb8175db82cec340feb8ff6f_b.jpg" height="255" data-lazy-status="ok"></div></figure><p class="ztext-empty-paragraph"><br></p><p data-pid="ACtR2HZv">2：之后Cook Commandlet会保存该Package，也就是是去执行到UMaterial里面的Serialize方法</p><p data-pid="Woyn0YCK">实际上前面部分提到的usf文件和材质连线都通过CacheShadersForResources被转化成了一个个FMaterialResource，所以FMaterialResource到底是什么东西？</p><p data-pid="D4Gl9eG7">在UMaterial能找到如下成员</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-c229c7278a4e9f0e428357f17ead7dc0_b.jpg" data-caption="" data-size="normal" data-rawwidth="1218" data-rawheight="141" class="origin_image zh-lightbox-thumb" width="1218" data-original="https://pic1.zhimg.com/v2-c229c7278a4e9f0e428357f17ead7dc0_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-c229c7278a4e9f0e428357f17ead7dc0_1440w.webp" data-caption="" data-size="normal" data-rawwidth="1218" data-rawheight="141" class="origin_image zh-lightbox-thumb lazy" width="1218" data-original="https://pic1.zhimg.com/v2-c229c7278a4e9f0e428357f17ead7dc0_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-c229c7278a4e9f0e428357f17ead7dc0_b.jpg" height="141" data-lazy-status="ok"></div></figure><p data-pid="PPcXUYuf">结合之前的分析，不难得出 UMaterial持有 QualityLevelNum * FeatureLevelNum 个FMaterialResource，可以通过QualityLevel和FeatureLevel索引到FMaterialResource</p><p data-pid="d5zqqtGR">FMaterialResource里有一个关键的成员FMaterialShaderMap，FMaterialShaderMap可以通过FVertexFactoryType::GetId()来索引到FMeshMaterialShaderMap；而FMeshMaterialShaderMap可以通过FShaderType来索引FShader</p><p data-pid="ixdTe0AD">因此FMaterialResource里面存放的实际上是FShader的集合，而FShader里面存放的就是最终使用的Shader代码了</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-e23b571fc2e0962c0778e1626a490546_b.jpg" data-caption="" data-size="normal" data-rawwidth="577" data-rawheight="62" class="origin_image zh-lightbox-thumb" width="577" data-original="https://pic3.zhimg.com/v2-e23b571fc2e0962c0778e1626a490546_r.jpg"/></noscript><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-e23b571fc2e0962c0778e1626a490546_1440w.webp" data-caption="" data-size="normal" data-rawwidth="577" data-rawheight="62" class="origin_image zh-lightbox-thumb lazy" width="577" data-original="https://pic3.zhimg.com/v2-e23b571fc2e0962c0778e1626a490546_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-e23b571fc2e0962c0778e1626a490546_b.jpg" height="62" data-lazy-status="ok"></div></figure><p></p><p></p><p></p><p></p><p></p><p></p></div></div></div></div><div role="button" tabindex="0" class="ContentItem-time">编辑于 2020-07-09 11:53</div><div class="Post-topicsAndReviewer"><div class="TopicList Post-Topics"><div class="Tag Topic css-1s3a4zw" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;20052447&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/20052447" target="_blank"><div class="css-1gomreu">虚幻 4（游戏引擎）</div></a></span></div><div class="Tag Topic css-1s3a4zw" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;20018494&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/20018494" target="_blank"><div class="css-1gomreu">shader</div></a></span></div><div class="Tag Topic css-1s3a4zw" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19575468&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/19575468" target="_blank"><div class="css-1gomreu">渲染</div></a></span></div></div></div><div><div class="Sticky RichContent-actions is-fixed is-bottom" style="width: 690px; bottom: 0px; left: 417.889px;"><div class="ContentItem-actions" data-za-detail-view-path-module="BottomBar" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;id&quot;:&quot;154081604&quot;}}}"><span><button aria-label="赞同 283 " aria-live="polite" type="button" class="Button VoteButton VoteButton--up"><span style="display:inline-flex;align-items:center">​<svg width="10" height="10" viewBox="0 0 24 24" class="Zi Zi--TriangleUp VoteButton-TriangleUp" fill="currentColor"><path fill-rule="evenodd" d="M13.792 3.681c-.781-1.406-2.803-1.406-3.584 0l-7.79 14.023c-.76 1.367.228 3.046 1.791 3.046h15.582c1.563 0 2.55-1.68 1.791-3.046l-7.79-14.023Z" clip-rule="evenodd"></path></svg></span>赞同 283</button><button aria-label="反对" aria-live="polite" type="button" class="Button VoteButton VoteButton--down"><span style="display:inline-flex;align-items:center">​<svg width="10" height="10" viewBox="0 0 24 24" class="Zi Zi--TriangleDown" fill="currentColor"><path fill-rule="evenodd" d="M13.792 20.319c-.781 1.406-2.803 1.406-3.584 0L2.418 6.296c-.76-1.367.228-3.046 1.791-3.046h15.582c1.563 0 2.55 1.68 1.791 3.046l-7.79 14.023Z" clip-rule="evenodd"></path></svg></span></button></span><button type="button" class="Button BottomActions-CommentBtn Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Comment Button-zi" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>33 条评论</button><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="Popover2-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover2-content"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Share Button-zi" fill="currentColor"><path d="M19.47 1.914a.8.8 0 0 1 1.204.778l-1.872 16.386a.9.9 0 0 1-1.204.743l-4.615-1.692a.7.7 0 0 0-.831.28l-1.927 3.02c-.43.674-1.474.369-1.474-.43v-3.865a.8.8 0 0 1 .179-.504l5.808-7.148a.595.595 0 0 0-.897-.781l-5.93 6.354a1.1 1.1 0 0 1-1.258.252L2.57 13.46a.8.8 0 0 1-.08-1.415l16.98-10.13Z"></path></svg></span>分享</button></div></div><button aria-live="polite" type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Heart Button-zi" fill="currentColor"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Star Button-zi" fill="currentColor"><path d="M10.484 3.307c.673-1.168 2.358-1.168 3.032 0l2.377 4.122a.25.25 0 0 0 .165.12l4.655.987c1.319.28 1.84 1.882.937 2.884l-3.186 3.535a.25.25 0 0 0-.063.193l.5 4.733c.142 1.34-1.222 2.33-2.453 1.782l-4.346-1.938a.25.25 0 0 0-.204 0l-4.346 1.938c-1.231.549-2.595-.442-2.453-1.782l.5-4.733a.25.25 0 0 0-.064-.193L2.35 11.42c-.903-1.002-.382-2.604.937-2.884l4.655-.987a.25.25 0 0 0 .164-.12l2.378-4.122Z"></path></svg></span>收藏</button><button type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Deliver Button-zi" fill="currentColor"><g fill-rule="evenodd" clip-rule="evenodd"><path d="M7.821 12a.75.75 0 0 1 .75-.75h6.857a.75.75 0 0 1 0 1.5H8.571a.75.75 0 0 1-.75-.75ZM8.965 8a.75.75 0 0 1 .75-.75h4.571a.75.75 0 0 1 0 1.5H9.715a.75.75 0 0 1-.75-.75Z"></path><path d="M7.527 3.15a2.35 2.35 0 0 0-2.309 1.91L3.165 15.84a.85.85 0 0 0-.015.16v2.5a2.35 2.35 0 0 0 2.35 2.35h13a2.35 2.35 0 0 0 2.35-2.35V16a.848.848 0 0 0-.015-.16L18.78 5.06a2.35 2.35 0 0 0-2.308-1.91H7.527Zm0 1.7a.65.65 0 0 0-.639.528l-1.88 9.872h13.984l-1.88-9.872a.65.65 0 0 0-.64-.528H7.528Z"></path></g></svg></span>申请转载</button><div class="Post-ActionMenuButton"><div class="Popover"><div id="Popover3-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover3-content"><button type="button" class="Button Button--plain Button--withIcon Button--iconOnly"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Dots Button-zi" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></span></button></div></div></div></div></div><div class="Sticky--holder" style="position: static; inset: auto auto 0px 0px; display: block; float: none; margin: 0px 0px 10px; height: 54px;"></div></div></article><div class="Post-Sub Post-NormalSub"><div style="overflow: unset;" data-za-detail-view-path-module="CommentList" data-za-extra-module="{}"><div class="Comments-container css-plbgu"><div class="css-79elbk"><div><div class="css-1fo89v5"><img class="Avatar css-1oi6kgx" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-ef69d369588e9764f9252225e6dc29ce_l.jpg" srcset="https://picd.zhimg.com/v2-ef69d369588e9764f9252225e6dc29ce_l.jpg?source=32738c0c 2x"><div class="css-x0pxoz"><div class="css-i6bazn"><div class="css-0"><div class="InputLike css-ip4bff Editable"><div class="Dropzone Editable-content RichText RichText--editable RichText--clearBoth ztext" style="min-height: 38px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner" id="placeholder-69drh" style="white-space: pre-wrap;">写评论 | Jerish 等 6 个人关注了作者</div></div><div class="DraftEditor-editorContainer"><div aria-describedby="placeholder-69drh" class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; user-select: text; white-space: pre-wrap; overflow-wrap: break-word;"><div data-contents="true"><div class="Editable-unstyled" data-block="true" data-editor="69drh" data-offset-key="7godv-0-0"><div data-offset-key="7godv-0-0" class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr"><span data-offset-key="7godv-0-0"><br data-text="true"></span></div></div></div></div></div></div></div><div></div><input multiple="" type="file" accept="image/webp,image/jpg,image/jpeg,image/png,image/gif" style="display: none;"></div></div></div></div></div></div><div class="css-z07uxh"><div class="css-we6n55"><div class="css-vpssrj"><div class="css-1k10w8f">33 条评论</div></div><div class="css-59erns"></div><div class="css-1hnxfhy"><div class="css-gjiv4z">默认</div><div class="css-1v9si9f">最新</div></div></div><div class="css-840pn3"><div class="css-1frn93x"><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/4933dda45c12188b21791e39438e2b1c" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg" srcset="https://pica.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="keyEpoch" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/4933dda45c12188b21791e39438e2b1c" target="_blank" class="css-1rd0h6f">keyEpoch</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">小白求问，所以编译后的shader是保存在Engine下面的DDC目录中嘛？</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2021-10-25</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/7807c5a3ca4557e731a9698eb435439b" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-2cfeb3738db6cbbe43169a8d917f6b91_l.jpg" srcset="https://pic1.zhimg.com/v2-2cfeb3738db6cbbe43169a8d917f6b91_l.jpg?source=06d4cd63 2x" alt="演奇" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/7807c5a3ca4557e731a9698eb435439b" target="_blank" class="css-1rd0h6f">演奇</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">代码是比Rap更高难度的文字游戏，而且还夹杂着各种强盗逻辑。<img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-ca0015e8ed8462cfce839fba518df585.png" class="sticker" alt="[笑哭]"></div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2021-09-23</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/b15e1220f3f407505b74456a4b4aaa77" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-a51341f8d3e98450fe1ff2f99e98a681_l.jpg" srcset="https://pic1.zhimg.com/v2-a51341f8d3e98450fe1ff2f99e98a681_l.jpg?source=06d4cd63 2x" alt="MarsZhou" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/b15e1220f3f407505b74456a4b4aaa77" target="_blank" class="css-1rd0h6f">MarsZhou</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">文章是不是没有结束？文章是不是没结束呢？打开材质为什么会触发shader为什么编译？即便编译过了，关闭材质再打开又会编译。</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2021-02-23</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/9eb8db4e68d6549be0d42cf9c3106f47" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-1674a44d07bc79e7638375acc2ddfef9_l.jpg" srcset="https://pic1.zhimg.com/v2-1674a44d07bc79e7638375acc2ddfef9_l.jpg?source=06d4cd63 2x" alt="四角裤裤" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/9eb8db4e68d6549be0d42cf9c3106f47" target="_blank" class="css-1rd0h6f">四角裤裤</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">和dx的那些有啥区别啊，最近也在想试试ue4</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-08-03</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/709f2cbe791b3ceac3f3ac4e304359e5" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l(1).jpg" srcset="https://picd.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="书童" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/709f2cbe791b3ceac3f3ac4e304359e5" target="_blank" class="css-1rd0h6f">书童</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">首先大佬分析的非常棒，补充一下FShader 到FShaderType这部分的对应关系实现就更好了，DECLARE_SHADER_TYPE和IMPLEMENT_MATERIAL_SHADER_TYPE两个宏实现很关键，是实现这些功能的基础</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-30</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div><div><div class="css-8j5fyx"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-578535b731d14d93a031e43b1ff3be50_l(1).jpg" srcset="https://pic1.zhimg.com/v2-578535b731d14d93a031e43b1ff3be50_l.jpg?source=06d4cd63 2x" alt="YiQiuuu" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-1rd0h6f">YiQiuuu</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-h9ndtl" href="">作者</span><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-paut93" width="18" height="18"><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#FFFFFF" width="30" height="30"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="#0066FF"></path><svg width="12" height="12" viewBox="0 0 24 24" fill="#fff" x="6" y="6" class="Zi Zi--Check"><path fill-rule="evenodd" d="M21.864 5.347a1.25 1.25 0 0 1 .04 1.767L10.976 18.537a1.35 1.35 0 0 1-1.965-.014L2.584 11.6a1.25 1.25 0 0 1 1.832-1.702l5.598 6.029L20.096 5.386a1.25 1.25 0 0 1 1.767-.04Z" clip-rule="evenodd"></path></svg></svg></span></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">其实这一整套，从内存中的加载卸载，到cook之后的大小差异，到组织构建都分析完了，搞了很久，现在基本透明了，以后考虑放出来，编译只是很小的一部分</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-30</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>1</button></div></div></div></div></div><div><div class="css-8j5fyx"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/709f2cbe791b3ceac3f3ac4e304359e5" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l(1).jpg" srcset="https://picd.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="书童" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/709f2cbe791b3ceac3f3ac4e304359e5" target="_blank" class="css-1rd0h6f">书童</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div><svg width="12" height="12" viewBox="0 0 16 16" class="ZDI ZDI--ArrowRightAlt16 css-gx7lzm" fill="currentColor"><path d="M10.727 7.48a.63.63 0 0 1 0 1.039l-4.299 2.88c-.399.268-.926-.028-.926-.519V5.12c0-.491.527-.787.926-.52l4.299 2.881Z"></path></svg><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-1rd0h6f">YiQiuuu</a></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">对 是看shader。 把r.shader.optimize和r.shader.keepdebuginfo打开  在VS下看 hlsl的代码没有被优化 在Xcode上看Metal被优化了</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-30</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div><button type="button" class="Button css-1p04wnp">查看全部 7 条回复<span style="display: inline-flex; align-items: center;">​<svg width="24" height="24" viewBox="0 0 24 24" class="ZDI ZDI--ArrowRightSmall24" fill="currentColor"><path fill-rule="evenodd" d="m13.248 12-4.025 3.78a.684.684 0 0 0 0 1.01.796.796 0 0 0 1.075 0l4.42-4.15a.867.867 0 0 0 0-1.28l-4.42-4.15a.796.796 0 0 0-1.075 0 .684.684 0 0 0 0 1.01L13.248 12Z" clip-rule="evenodd"></path></svg></span></button></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/e54d1bf7fe9a008421bf1c95e70c16ea" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/b41e8a744_l.jpg" srcset="https://pic1.zhimg.com/b41e8a744_l.jpg?source=06d4cd63 2x" alt="鱼与熊掌" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/e54d1bf7fe9a008421bf1c95e70c16ea" target="_blank" class="css-1rd0h6f">鱼与熊掌</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8"><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-419a1a3ed02b7cfadc20af558aabc897.png" class="sticker" alt="[赞同]"></div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-25</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/2377b3035985ee5b35ee433efd686383" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-334f4272d643949ea482f988a3cd6f18_l.jpg" srcset="https://pic1.zhimg.com/v2-334f4272d643949ea482f988a3cd6f18_l.jpg?source=06d4cd63 2x" alt="源源 Yuenyuen" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/2377b3035985ee5b35ee433efd686383" target="_blank" class="css-1rd0h6f">源源 Yuenyuen</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-4812630bc27d642f7cafcd6cdeca3d7a.jpg" class="css-1pj8qrb"></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">大佬我想问一下学习unity shader有unityshader这种书。。。学习ue4的着色器有什么…书吗QAQ</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-22</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div><div><div class="css-8j5fyx"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/2377b3035985ee5b35ee433efd686383" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-334f4272d643949ea482f988a3cd6f18_l(1).jpg" srcset="https://picd.zhimg.com/v2-334f4272d643949ea482f988a3cd6f18_l.jpg?source=06d4cd63 2x" alt="源源 Yuenyuen" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/2377b3035985ee5b35ee433efd686383" target="_blank" class="css-1rd0h6f">源源 Yuenyuen</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-4812630bc27d642f7cafcd6cdeca3d7a.jpg" class="css-1pj8qrb"></div></div><svg width="12" height="12" viewBox="0 0 16 16" class="ZDI ZDI--ArrowRightAlt16 css-gx7lzm" fill="currentColor"><path d="M10.727 7.48a.63.63 0 0 1 0 1.039l-4.299 2.88c-.399.268-.926-.028-.926-.519V5.12c0-.491.527-.787.926-.52l4.299 2.881Z"></path></svg><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-1rd0h6f">YiQiuuu</a></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">谢谢🙏</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-22</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div><div><div class="css-8j5fyx"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-578535b731d14d93a031e43b1ff3be50_l(2).jpg" srcset="https://picd.zhimg.com/v2-578535b731d14d93a031e43b1ff3be50_l.jpg?source=06d4cd63 2x" alt="YiQiuuu" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-1rd0h6f">YiQiuuu</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-h9ndtl" href="">作者</span><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-paut93" width="18" height="18"><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#FFFFFF" width="30" height="30"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="#0066FF"></path><svg width="12" height="12" viewBox="0 0 24 24" fill="#fff" x="6" y="6" class="Zi Zi--Check"><path fill-rule="evenodd" d="M21.864 5.347a1.25 1.25 0 0 1 .04 1.767L10.976 18.537a1.35 1.35 0 0 1-1.965-.014L2.584 11.6a1.25 1.25 0 0 1 1.832-1.702l5.598 6.029L20.096 5.386a1.25 1.25 0 0 1 1.767-.04Z" clip-rule="evenodd"></path></svg></svg></span></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8"><p>官方文档呀   源代码呀  还有技术文章之类 比如<a href="http://link.zhihu.com/?target=https%3A//medium.com/%40lordned/unreal-engine-4-rendering-part-5-shader-permutations-2b975e503dd4" class=" external css-134a7ny" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">medium.com/@lordned/unr</span><span class="invisible">eal-engine-4-rendering-part-5-shader-permutations-2b975e503dd4</span><span class="ellipsis"></span></a></p></div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-22</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/92c5c7686ec0196dfd164943b3b7cf6d" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-119b1959e4d11c13ed2a0e3cf0f64915_l.jpg" srcset="https://pic1.zhimg.com/v2-119b1959e4d11c13ed2a0e3cf0f64915_l.jpg?source=06d4cd63 2x" alt="Raphael" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/92c5c7686ec0196dfd164943b3b7cf6d" target="_blank" class="css-1rd0h6f">Raphael</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">学习了，谢谢博主</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-20</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/66c320ab337ef1d865e889d2f075a174" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-8bc13b94b8b82063264e13203ca0082e_l.jpg" srcset="https://pic1.zhimg.com/v2-8bc13b94b8b82063264e13203ca0082e_l.jpg?source=06d4cd63 2x" alt="罗密欧与猪过夜" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/66c320ab337ef1d865e889d2f075a174" target="_blank" class="css-1rd0h6f">罗密欧与猪过夜</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8"><p>好文</p></div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-16</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/7d6687aa54c72a13b2b6d544f8f0189f" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/5b59524400650866070402ad2729e7fa_l.jpg" srcset="https://picd.zhimg.com/5b59524400650866070402ad2729e7fa_l.jpg?source=06d4cd63 2x" alt="papalqi" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/7d6687aa54c72a13b2b6d544f8f0189f" target="_blank" class="css-1rd0h6f">papalqi</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-paut93" width="18" height="18"><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#FFFFFF" width="30" height="30"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="#0066FF"></path><svg width="12" height="12" viewBox="0 0 24 24" fill="#fff" x="6" y="6" class="Zi Zi--Check"><path fill-rule="evenodd" d="M21.864 5.347a1.25 1.25 0 0 1 .04 1.767L10.976 18.537a1.35 1.35 0 0 1-1.965-.014L2.584 11.6a1.25 1.25 0 0 1 1.832-1.702l5.598 6.029L20.096 5.386a1.25 1.25 0 0 1 1.767-.04Z" clip-rule="evenodd"></path></svg></svg></span><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-4812630bc27d642f7cafcd6cdeca3d7a(1).jpg" class="css-1pj8qrb"></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8"><p>重新编译不是有个快捷键嘛</p></div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-14</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div><div><div class="css-8j5fyx"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-578535b731d14d93a031e43b1ff3be50_l(2).jpg" srcset="https://picd.zhimg.com/v2-578535b731d14d93a031e43b1ff3be50_l.jpg?source=06d4cd63 2x" alt="YiQiuuu" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-1rd0h6f">YiQiuuu</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-h9ndtl" href="">作者</span><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-paut93" width="18" height="18"><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#FFFFFF" width="30" height="30"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="#0066FF"></path><svg width="12" height="12" viewBox="0 0 24 24" fill="#fff" x="6" y="6" class="Zi Zi--Check"><path fill-rule="evenodd" d="M21.864 5.347a1.25 1.25 0 0 1 .04 1.767L10.976 18.537a1.35 1.35 0 0 1-1.965-.014L2.584 11.6a1.25 1.25 0 0 1 1.832-1.702l5.598 6.029L20.096 5.386a1.25 1.25 0 0 1 1.767-.04Z" clip-rule="evenodd"></path></svg></svg></span></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8"><p>recompileshaders changed =  应该是 control + shift +,  具体看官网记不太清</p></div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-14</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/37aea7374636aae4d6292e99fe0ef311" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/3b9b67e62ae03a1edf82d93b6dac0a39_l.jpg" srcset="https://picd.zhimg.com/3b9b67e62ae03a1edf82d93b6dac0a39_l.jpg?source=06d4cd63 2x" alt="逍遥剑客" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/37aea7374636aae4d6292e99fe0ef311" target="_blank" class="css-1rd0h6f">逍遥剑客</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-paut93" width="18" height="18"><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#FFFFFF" width="30" height="30"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="#FF9607"></path><svg width="12" height="12" viewBox="0 0 24 24" fill="#fff" x="6" y="6" class="Zi Zi--Star"><path d="M10.484 3.307c.673-1.168 2.358-1.168 3.032 0l2.377 4.122a.25.25 0 0 0 .165.12l4.655.987c1.319.28 1.84 1.882.937 2.884l-3.186 3.535a.25.25 0 0 0-.063.193l.5 4.733c.142 1.34-1.222 2.33-2.453 1.782l-4.346-1.938a.25.25 0 0 0-.204 0l-4.346 1.938c-1.231.549-2.595-.442-2.453-1.782l.5-4.733a.25.25 0 0 0-.064-.193L2.35 11.42c-.903-1.002-.382-2.604.937-2.884l4.655-.987a.25.25 0 0 0 .164-.12l2.378-4.122Z"></path></svg></svg></span><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-aa8a1823abfc46f14136f01d55224925.jpg" class="css-1pj8qrb"></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">有减少permutation的思路吗？</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-03</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div><div><div class="css-8j5fyx"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/e3962214448324c94299539e1c2ba499" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-b7ee7c4f612da27e521e1bb88896cf8b_l.jpg" srcset="https://picd.zhimg.com/v2-b7ee7c4f612da27e521e1bb88896cf8b_l.jpg?source=06d4cd63 2x" alt="Sparrowfc" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/e3962214448324c94299539e1c2ba499" target="_blank" class="css-1rd0h6f">Sparrowfc</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div><svg width="12" height="12" viewBox="0 0 16 16" class="ZDI ZDI--ArrowRightAlt16 css-gx7lzm" fill="currentColor"><path d="M10.727 7.48a.63.63 0 0 1 0 1.039l-4.299 2.88c-.399.268-.926-.028-.926-.519V5.12c0-.491.527-.787.926-.52l4.299 2.881Z"></path></svg><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-1rd0h6f">YiQiuuu</a></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">思路有啥不好说的，核心思路不在于减少premutation，而在于降低编译粒度，UE4要把整个MaterialShaderMap都编译好，才会在渲染线程去使用，在此之前都用的是DefaultMaterialShaderMap，而最好能做到的应该是使用哪个变体编译哪个，编译好之前用default材质中对应的变体去替代。<br><br>另外仅考虑减少变体的话，简单粗暴一点的做法是直接把源码中不需要的光照模式变体Shader的定义都删掉，LDR也删掉，这就缩减N倍了。另外制作材质的时候保证每个材质只对应一种用途，这样也能降低编译粒度</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-05</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>1</button></div></div></div></div></div><div><div class="css-8j5fyx"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ec53ec8a25959f4fb7c3c53df233c12f" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-48cbc7109d8a140f0b46ec4674b22fe8_l.jpg" srcset="https://pic1.zhimg.com/v2-48cbc7109d8a140f0b46ec4674b22fe8_l.jpg?source=06d4cd63 2x" alt="minggoddess" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ec53ec8a25959f4fb7c3c53df233c12f" target="_blank" class="css-1rd0h6f">minggoddess</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8">用延迟着色</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2021-05-14</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div><button type="button" class="Button css-1p04wnp">查看全部 8 条回复<span style="display: inline-flex; align-items: center;">​<svg width="24" height="24" viewBox="0 0 24 24" class="ZDI ZDI--ArrowRightSmall24" fill="currentColor"><path fill-rule="evenodd" d="m13.248 12-4.025 3.78a.684.684 0 0 0 0 1.01.796.796 0 0 0 1.075 0l4.42-4.15a.867.867 0 0 0 0-1.28l-4.42-4.15a.796.796 0 0 0-1.075 0 .684.684 0 0 0 0 1.01L13.248 12Z" clip-rule="evenodd"></path></svg></span></button></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/d139ec7f234dd2049afa0cc197daecc2" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-2225e2c00b5b06a9cebac1d6ca0d1379_l.jpg" srcset="https://pic1.zhimg.com/v2-2225e2c00b5b06a9cebac1d6ca0d1379_l.jpg?source=06d4cd63 2x" alt="leesanghoy" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/d139ec7f234dd2049afa0cc197daecc2" target="_blank" class="css-1rd0h6f">leesanghoy</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8"><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-419a1a3ed02b7cfadc20af558aabc897.png" class="sticker" alt="[赞同]">感谢分享</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-03</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div><div><div class="css-8j5fyx"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-578535b731d14d93a031e43b1ff3be50_l(1).jpg" srcset="https://pic1.zhimg.com/v2-578535b731d14d93a031e43b1ff3be50_l.jpg?source=06d4cd63 2x" alt="YiQiuuu" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-1rd0h6f">YiQiuuu</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-h9ndtl" href="">作者</span><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-paut93" width="18" height="18"><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#FFFFFF" width="30" height="30"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="#0066FF"></path><svg width="12" height="12" viewBox="0 0 24 24" fill="#fff" x="6" y="6" class="Zi Zi--Check"><path fill-rule="evenodd" d="M21.864 5.347a1.25 1.25 0 0 1 .04 1.767L10.976 18.537a1.35 1.35 0 0 1-1.965-.014L2.584 11.6a1.25 1.25 0 0 1 1.832-1.702l5.598 6.029L20.096 5.386a1.25 1.25 0 0 1 1.767-.04Z" clip-rule="evenodd"></path></svg></svg></span></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8"><p>都是一些微小的工作~</p></div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-03</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ee6f88705a6c1b11325063268a831443" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-eba5138d370af14f98ba3cff891ba064_l.jpg" srcset="https://pic1.zhimg.com/v2-eba5138d370af14f98ba3cff891ba064_l.jpg?source=06d4cd63 2x" alt="lingzerg" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ee6f88705a6c1b11325063268a831443" target="_blank" class="css-1rd0h6f">lingzerg</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-paut93" width="18" height="18"><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#FFFFFF" width="30" height="30"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="#0066FF"></path><svg width="12" height="12" viewBox="0 0 24 24" fill="#fff" x="6" y="6" class="Zi Zi--Check"><path fill-rule="evenodd" d="M21.864 5.347a1.25 1.25 0 0 1 .04 1.767L10.976 18.537a1.35 1.35 0 0 1-1.965-.014L2.584 11.6a1.25 1.25 0 0 1 1.832-1.702l5.598 6.029L20.096 5.386a1.25 1.25 0 0 1 1.767-.04Z" clip-rule="evenodd"></path></svg></svg></span><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-4812630bc27d642f7cafcd6cdeca3d7a(1).jpg" class="css-1pj8qrb"></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8"><p>牛逼啊,学习了学习了, UE的shader变体实在是太变态了</p></div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-03</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div><div><div class="css-8j5fyx"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-y06ck6"><img class="Avatar css-1s1htbw" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-578535b731d14d93a031e43b1ff3be50_l(3).jpg" srcset="https://pica.zhimg.com/v2-578535b731d14d93a031e43b1ff3be50_l.jpg?source=06d4cd63 2x" alt="YiQiuuu" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/ceff05619b2a2206960d57b0ad2791af" target="_blank" class="css-1rd0h6f">YiQiuuu</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-h9ndtl" href="">作者</span><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-paut93" width="18" height="18"><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#FFFFFF" width="30" height="30"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="#0066FF"></path><svg width="12" height="12" viewBox="0 0 24 24" fill="#fff" x="6" y="6" class="Zi Zi--Check"><path fill-rule="evenodd" d="M21.864 5.347a1.25 1.25 0 0 1 .04 1.767L10.976 18.537a1.35 1.35 0 0 1-1.965-.014L2.584 11.6a1.25 1.25 0 0 1 1.832-1.702l5.598 6.029L20.096 5.386a1.25 1.25 0 0 1 1.767-.04Z" clip-rule="evenodd"></path></svg></svg></span></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM21.99 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0Z"></path></svg></div><div class="CommentContent css-1ygdre8"><p>哈哈 花点心思看看源码应该都明白的 只是要整理就很麻烦</p></div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">2020-07-03</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 0 1 2.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 0 1-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 0 1 2.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 0 0 3.19-2.191c.115-.296.173-.611.173-.928v-.553Z"></path></svg></span>赞</button></div></div></div></div></div></div><div></div></div></div></div><div class="css-l8iyjs"></div><div class="css-805ti0" style="position: relative; box-shadow: 0px 0px; transform: translateY(100%) translateZ(0px);"><div><div class="css-59erns"><img class="Avatar css-1oi6kgx" src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-ef69d369588e9764f9252225e6dc29ce_l.jpg" srcset="https://picd.zhimg.com/v2-ef69d369588e9764f9252225e6dc29ce_l.jpg?source=32738c0c 2x"><div class="css-x0pxoz"><div class="css-i6bazn"><div class="css-1ryozpy"><div class="InputLike css-ip4bff Editable"><div class="Dropzone Editable-content RichText RichText--editable RichText--clearBoth ztext" style="min-height: 38px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner" id="placeholder-dm2t4" style="white-space: pre-wrap;">写评论 | Jerish 等 6 个人关注了作者</div></div><div class="DraftEditor-editorContainer"><div aria-describedby="placeholder-dm2t4" class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; user-select: text; white-space: pre-wrap; overflow-wrap: break-word;"><div data-contents="true"><div class="Editable-unstyled" data-block="true" data-editor="dm2t4" data-offset-key="am6q7-0-0"><div data-offset-key="am6q7-0-0" class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr"><span data-offset-key="am6q7-0-0"><br data-text="true"></span></div></div></div></div></div></div></div><div></div><input multiple="" type="file" accept="image/webp,image/jpg,image/jpeg,image/png,image/gif" style="display: none;"></div></div></div></div></div></div></div><div></div></div></div></div><div role="complementary" aria-label="推荐阅读" class="Recommendations-Main" style="width: 1526px;"><h3 class="BlockTitle Recommendations-BlockTitle">推荐阅读</h3><ul class="Recommendations-List"><button class="PagingButton PagingButton-Previous" disabled="" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg width="40" height="40" viewBox="0 0 24 24" fill="#d3d3d3" class="Zi Zi--ArrowLeft"><path fill-rule="evenodd" d="m10.752 12 4.025-3.78a.684.684 0 0 0 0-1.01.796.796 0 0 0-1.075 0l-4.42 4.15a.866.866 0 0 0 0 1.28l4.42 4.15a.796.796 0 0 0 1.075 0 .684.684 0 0 0 0-1.01L10.752 12Z" clip-rule="evenodd"></path></svg></button><a href="https://zhuanlan.zhihu.com/p/469915399" class="PostItem"><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-b9669104b71c3d77612a038f4c0c0abc_250x0.jpg" srcset="https://picd.zhimg.com/v2-b9669104b71c3d77612a038f4c0c0abc_qhd.jpg?source=172ae18b 2x" class="PostItem-TitleImage" alt="UE4 编译系统"><h1 class="PostItem-Title">UE4 编译系统</h1><div class="PostItem-Footer"><span>所以然</span><span class="PostItem-FooterTitle">发表于Unrea...</span></div></div></a><a href="https://zhuanlan.zhihu.com/p/524290621" class="PostItem"><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-75b81676ec2b41d87bc4a74fcff2b899_250x0.jpg" srcset="https://pica.zhimg.com/v2-75b81676ec2b41d87bc4a74fcff2b899_qhd.jpg?source=172ae18b 2x" class="PostItem-TitleImage" alt="UE4 关闭Shader编译"><h1 class="PostItem-Title">UE4 关闭Shader编译</h1><div class="PostItem-Footer"><span>ShaVe...</span><span class="PostItem-FooterTitle">发表于初窥UE</span></div></div></a><a href="https://zhuanlan.zhihu.com/p/475766095" class="PostItem"><div><h1 class="PostItem-Title">UE4编译shader内存占用过大问题分析</h1><p class="PostItem-Summary">更新： UE5.0.2 hotfix修复了该问题，修改方法如下： 为了使用renderdoc来调试分析UE制作的产品中的渲染bug，往往需要开启shader的调试信息以及关闭优化。 r.Shaders.KeepDebugInfo=1 r.Sha…</p><div class="PostItem-Footer"><span>吉林小伙</span><span class="PostItem-FooterTitle"></span></div></div></a><a href="https://zhuanlan.zhihu.com/p/57218085" class="PostItem"><div><img src="./UE4 Shader 编译以及变种实现 - 知乎_files/v2-89ab46e2ce2c768d7b1ee5effe54582c_250x0.jpg" srcset="https://picd.zhimg.com/v2-89ab46e2ce2c768d7b1ee5effe54582c_qhd.jpg?source=172ae18b 2x" class="PostItem-TitleImage" alt="UE4[C++]在虚幻引擎实现单例模式"><h1 class="PostItem-Title">UE4[C++]在虚幻引擎实现单例模式</h1><div class="PostItem-Footer"><span>大侠刘茗</span><span class="PostItem-FooterTitle">发表于UE4/U...</span></div></div></a><button class="PagingButton PagingButton-Next" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg width="40" height="40" viewBox="0 0 24 24" fill="#d3d3d3" class="Zi Zi--ArrowRight"><path fill-rule="evenodd" d="m13.248 12-4.025 3.78a.684.684 0 0 0 0 1.01.796.796 0 0 0 1.075 0l4.42-4.15a.867.867 0 0 0 0-1.28l-4.42-4.15a.796.796 0 0 0-1.075 0 .684.684 0 0 0 0 1.01L13.248 12Z" clip-rule="evenodd"></path></svg></button></ul></div></div></div></main><div role="complementary"><div class="CornerButtons"><div class="CornerAnimayedFlex CornerAnimayedFlex--hidden"><button data-tooltip="回到顶部" data-tooltip-position="left" data-tooltip-will-hide-on-click="true" aria-label="回到顶部" type="button" class="Button CornerButton css-gdd4kf"><svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true" class="Zi Zi--BackToTop" fill="currentColor"><path fill-rule="evenodd" d="M13.204 3.107a1.75 1.75 0 0 0-2.408 0L3.806 9.73c-1.148 1.088-.378 3.02 1.204 3.02h2.24V20c0 .966.784 1.75 1.75 1.75h6A1.75 1.75 0 0 0 16.75 20v-7.25h2.24c1.582 0 2.353-1.932 1.204-3.02l-6.99-6.623Z" clip-rule="evenodd"></path></svg></button></div></div></div></div></div><script id="js-clientConfig" type="text/json">{"fetchRoot":{"www":"https:\u002F\u002Fwww.zhihu.com","api":"https:\u002F\u002Fapi.zhihu.com","lens":"https:\u002F\u002Flens.zhihu.com","zhuanlan":"https:\u002F\u002Fzhuanlan.zhihu.com","walletpay":"https:\u002F\u002Fwalletpay.zhihu.com","captcha":"https:\u002F\u002Fcaptcha.zhihu.com","vzuu":"https:\u002F\u002Fv.vzuu.com","openapi":"https:\u002F\u002Fopenapi.zhihu.com","svip":"https:\u002F\u002Fsvip.zhihu.com"},"host":"zhihu.com","protocol":"https:","wwwHost":"www.zhihu.com","videoHost":"video.zhihu.com","zhuanlanHost":"zhuanlan.zhihu.com","allowSignUp":true,"refreshValidityPeriod":"30","refreshLimit":"0.8"}</script><script id="js-initialData" type="text/json">{"initialState":{"common":{"ask":{}},"loading":{"global":{"count":0},"local":{"env\u002FgetIpinfo\u002F":false,"article\u002Fget\u002F":false,"brand\u002FgetUrl\u002F":false,"article\u002FloadPostSearchEntity\u002F":false}},"entities":{"users":{"9b939bd116cd066ce372288d50538da8":{"uid":1437579071195046000,"userType":"people","id":"9b939bd116cd066ce372288d50538da8"},"xie-jie-62-1":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-578535b731d14d93a031e43b1ff3be50.jpg?source=172ae18b","uid":"728233288363184128","userType":"people","isFollowing":false,"urlToken":"xie-jie-62-1","id":"ceff05619b2a2206960d57b0ad2791af","description":"开满花的院子，柔风暖阳，友人在旁，笑语绕梁，就是平凡的一天","name":"YiQiuuu","isAdvertiser":false,"headline":"unreal engine 4 rendering","gender":1,"url":"\u002Fpeople\u002Fceff05619b2a2206960d57b0ad2791af","avatarUrl":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-578535b731d14d93a031e43b1ff3be50_l.jpg?source=172ae18b","isOrg":false,"type":"people","badge":[{"type":"identity","topics":[],"description":"网易游戏 游戏研发"}],"badgeV2":{"title":"网易游戏 游戏研发","mergedBadges":[{"type":"identity","detailType":"identity","title":"认证","description":"网易游戏 游戏研发","url":"https:\u002F\u002Fwww.zhihu.com\u002Faccount\u002Fverification\u002Fintro","sources":[],"icon":"","nightIcon":""}],"detailBadges":[{"type":"identity","detailType":"identity_people","title":"已认证的个人","description":"网易游戏 游戏研发","url":"https:\u002F\u002Fwww.zhihu.com\u002Faccount\u002Fverification\u002Fintro","sources":[],"icon":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-235258cecb8a0f184c4d38483cd6f6b6_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-45e870b8f0982bcd7537ea4627afbd00_l.png?source=32738c0c"}],"icon":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-235258cecb8a0f184c4d38483cd6f6b6_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-45e870b8f0982bcd7537ea4627afbd00_l.png?source=32738c0c"},"exposedMedal":{"medalId":"972480281613197312","medalName":"每天逛逛","avatarUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-cdc7c578bc7555f8113a409eaf2704b8_r.png?source=172ae18b","miniAvatarUrl":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-cdc7c578bc7555f8113a409eaf2704b8_l.png?source=172ae18b","description":"累计登录 365 天","medalAvatarFrame":""}}},"questions":{},"answers":{},"articles":{"154081604":{"trackUrl":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper\u002Fcontent_monitor_log?si=__SESSIONID__&ti=__ATOKEN__&at=view&pf=__OS__&ed=BiBUKF0xBSkqGGpRA2R6CFx1ClFNgfJERpdg&idfa=__IDFA__&imei=__IMEI__&androidid=__ANDROIDID__&oaid=__OAID__&ci=__CREATIVEID__&zid=__ZONEID__"],"id":154081604,"title":"UE4 Shader 编译以及变种实现","type":"article","articleType":"normal","excerptTitle":"","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F154081604","imageUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-3fe7283018ad0664acc581d80e9766f3_720w.jpg?source=172ae18b","titleImage":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-3fe7283018ad0664acc581d80e9766f3_720w.jpg?source=172ae18b","excerpt":"\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-10dec6626838f45deb29e0cb8d421530_200x112.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"417\" data-rawheight=\"168\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\" class=\"origin_image inline-img zh-lightbox-thumb\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-10dec6626838f45deb29e0cb8d421530_r.jpg\"\u002F\u003E\u003Cb\u003E一 , 动机\u003C\u002Fb\u003E这篇文章主要是我对UE4中Shader编译过程以及变种的理解，了解这一块挺有必要的，毕竟动辄几千上万个Shader的编译在UE里简直是家常便饭，了解它底层的实现机制后内心踏实一点，要去修改的话大方向也不错 这部分工作是我之前就做好的，文章里涉及内…","created":1593743932,"updated":1594266826,"author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-578535b731d14d93a031e43b1ff3be50.jpg?source=172ae18b","uid":"728233288363184128","userType":"people","isFollowing":false,"urlToken":"xie-jie-62-1","id":"ceff05619b2a2206960d57b0ad2791af","description":"开满花的院子，柔风暖阳，友人在旁，笑语绕梁，就是平凡的一天","name":"YiQiuuu","isAdvertiser":false,"headline":"unreal engine 4 rendering","gender":1,"url":"\u002Fpeople\u002Fceff05619b2a2206960d57b0ad2791af","avatarUrl":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-578535b731d14d93a031e43b1ff3be50_l.jpg?source=172ae18b","isOrg":false,"type":"people","badge":[{"type":"identity","topics":[],"description":"网易游戏 游戏研发"}],"badgeV2":{"title":"网易游戏 游戏研发","mergedBadges":[{"type":"identity","detailType":"identity","title":"认证","description":"网易游戏 游戏研发","url":"https:\u002F\u002Fwww.zhihu.com\u002Faccount\u002Fverification\u002Fintro","sources":[],"icon":"","nightIcon":""}],"detailBadges":[{"type":"identity","detailType":"identity_people","title":"已认证的个人","description":"网易游戏 游戏研发","url":"https:\u002F\u002Fwww.zhihu.com\u002Faccount\u002Fverification\u002Fintro","sources":[],"icon":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-235258cecb8a0f184c4d38483cd6f6b6_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-45e870b8f0982bcd7537ea4627afbd00_l.png?source=32738c0c"}],"icon":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-235258cecb8a0f184c4d38483cd6f6b6_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-45e870b8f0982bcd7537ea4627afbd00_l.png?source=32738c0c"},"exposedMedal":{"medalId":"972480281613197312","medalName":"每天逛逛","avatarUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-cdc7c578bc7555f8113a409eaf2704b8_r.png?source=172ae18b","miniAvatarUrl":"https:\u002F\u002Fpicd.zhimg.com\u002Fv2-cdc7c578bc7555f8113a409eaf2704b8_l.png?source=172ae18b","description":"累计登录 365 天","medalAvatarFrame":""}},"commentPermission":"all","copyrightPermission":"need_review","state":"published","ipInfo":"","imageWidth":1080,"imageHeight":675,"content":"\u003Cp data-pid=\"O3HuydD2\"\u003E\u003Cb\u003E一 , 动机\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"SWzJjPke\"\u003E这篇文章主要是我对UE4中Shader编译过程以及变种的理解，了解这一块挺有必要的，毕竟动辄几千上万个Shader的编译在UE里简直是家常便饭，了解它底层的实现机制后内心踏实一点，要去修改的话大方向也不错\u003C\u002Fp\u003E\u003Cp data-pid=\"KRsxTDGZ\"\u003E这部分工作是我之前就做好的，文章里涉及内部修改的地方都被我阉割掉了（阉割版，之后还有内容我再加。。 工作繁忙外加懒）\u003C\u002Fp\u003E\u003Cp data-pid=\"HRMcpKxH\"\u003E所以这篇文章主要用于知识普及，分享给广大被UE4中的Shader编译折磨的码农们，凑活着看把，看完其实应该都了解了，有收获的记得点赞哟。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"VCx1YVZs\"\u003E\u003Cb\u003E二 , UE4中Shader的组织和获取\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"noNqw8Th\"\u003E在讲具体的Shader编译过程时，先讲UE4的渲染过程，渲染过程中是怎么拿Shader的，最后再讲这些Shader是怎么生成的\u003C\u002Fp\u003E\u003Cp data-pid=\"vHkgF_E2\"\u003E虚幻引擎中讲到线程主要有三个：游戏线程，渲染线程，RHI线程。\u003C\u002Fp\u003E\u003Cp data-pid=\"CfQer8y5\"\u003E其中我们平时关心的比较多的就是游戏线程和渲染线程了，至于RHI线程偏向于底层硬件接口，是甚少关心的，一般情况下也很少有需要改动到RHI线程的东西\u003C\u002Fp\u003E\u003Cp data-pid=\"WAZCrHDd\"\u003E\u003Cb\u003E2.1 渲染线程\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"78z9z_Kp\"\u003E虚幻引擎在FEngineLoop::PreInit中对渲染线程进行初始化\u003C\u002Fp\u003E\u003Cp data-pid=\"hUongrnA\"\u003E具体的位置是在StartRenderingThread函数里面，此时虚幻引擎主窗口是尚未被绘制出来的，渲染线程的启动位于StartRenderingThread函数里面，这个函数大概做了以下几件事\u003C\u002Fp\u003E\u003Cp data-pid=\"TZny-EN9\"\u003E1：通过FRunnableThread::Create函数创建渲染线程\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-ac0ef9efde715fdac58d62d30068ab25_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"866\" data-rawheight=\"110\" class=\"origin_image zh-lightbox-thumb\" width=\"866\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-ac0ef9efde715fdac58d62d30068ab25_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;866&#39; height=&#39;110&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"866\" data-rawheight=\"110\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"866\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-ac0ef9efde715fdac58d62d30068ab25_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-ac0ef9efde715fdac58d62d30068ab25_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"8-UIPG9Q\"\u003E2：等待渲染线程准备好从自己的TaskGraph取出任务并执行\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-50a1f4db64e8dadebe4a40932210f954_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"752\" data-rawheight=\"56\" class=\"origin_image zh-lightbox-thumb\" width=\"752\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-50a1f4db64e8dadebe4a40932210f954_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;752&#39; height=&#39;56&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"752\" data-rawheight=\"56\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"752\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-50a1f4db64e8dadebe4a40932210f954_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-50a1f4db64e8dadebe4a40932210f954_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"HSC6HS08\"\u003E3：注册渲染线程\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-c197e14e7e051a4a494682b316747c59_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1157\" data-rawheight=\"62\" class=\"origin_image zh-lightbox-thumb\" width=\"1157\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-c197e14e7e051a4a494682b316747c59_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1157&#39; height=&#39;62&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1157\" data-rawheight=\"62\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1157\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-c197e14e7e051a4a494682b316747c59_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-c197e14e7e051a4a494682b316747c59_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"8I2pw7x8\"\u003E4：创建渲染线程心跳更新线程\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-07faa35be46431aae72b7d5a8126b988_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1082\" data-rawheight=\"82\" class=\"origin_image zh-lightbox-thumb\" width=\"1082\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-07faa35be46431aae72b7d5a8126b988_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1082&#39; height=&#39;82&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1082\" data-rawheight=\"82\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1082\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-07faa35be46431aae72b7d5a8126b988_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-07faa35be46431aae72b7d5a8126b988_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"g7HJ7fMF\"\u003E\u003Cb\u003E2.2 渲染线程的运行\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"TM-Ql1Qs\"\u003E\u003Cb\u003E在ue4的体系中，\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"7fYf4MHz\"\u003E渲染线程的主要执行内容在全局函数RenderingThreadMain(RenderingThread.cpp)中\u003C\u002Fp\u003E\u003Cp data-pid=\"dRY3k5vw\"\u003E从本质上来讲它更像是一个员工，等着老板给他派任务，老板塞给他的任务都会放在TaskMap中，他则负责不断的提取这些任务去执行\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-a4a7190591579e4b72347914a62c9049_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"586\" data-rawheight=\"102\" class=\"origin_image zh-lightbox-thumb\" width=\"586\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-a4a7190591579e4b72347914a62c9049_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;586&#39; height=&#39;102&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"586\" data-rawheight=\"102\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"586\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-a4a7190591579e4b72347914a62c9049_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-a4a7190591579e4b72347914a62c9049_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"bi02Nb2d\"\u003E老板可以通过ENQUEUE_RENDER_COMMAND系列宏，给员工派发任务(添加到TaskMap中)，下图说明了这个过程\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-10dec6626838f45deb29e0cb8d421530_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"417\" data-rawheight=\"168\" class=\"content_image\" width=\"417\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;417&#39; height=&#39;168&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"417\" data-rawheight=\"168\" class=\"content_image lazy\" width=\"417\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-10dec6626838f45deb29e0cb8d421530_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"o2rR8JlK\"\u003E具体代码调用实例如下，这个宏是在游戏线程中调用的，有时候游戏线程中有一些资源发生了变动，或者添加了一些新的资源，抑或是因为一些逻辑而要去改到渲染线程的一些操作，都需要有一种方法去通知到渲染线程，就像是两艘并行飞驰的船，各自走自己的路，另一艘船上发生了什么是完全不知道的，而UE4就通过设置一系列宏为两艘船之间的通信提供了方法\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-52f86ee82f90cd6d0085bdbb8ad955c5_b.jpg\" data-size=\"normal\" data-rawwidth=\"659\" data-rawheight=\"198\" class=\"origin_image zh-lightbox-thumb\" width=\"659\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-52f86ee82f90cd6d0085bdbb8ad955c5_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;659&#39; height=&#39;198&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"659\" data-rawheight=\"198\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"659\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-52f86ee82f90cd6d0085bdbb8ad955c5_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-52f86ee82f90cd6d0085bdbb8ad955c5_b.jpg\"\u002F\u003E\u003Cfigcaption\u003Eem。。 马赛克忽略把\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"4M5IRyvW\"\u003E员工执行任务时也不是直接向GPU发送指令，而是将渲染命令添加到RHICommandList，也就是RHI命令列表中，由RHI线程不断取出指令，向GPU发送，并阻塞等待结果\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-7f7d4c3e46d5684ab57780e30921788f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"407\" data-rawheight=\"137\" class=\"content_image\" width=\"407\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;407&#39; height=&#39;137&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"407\" data-rawheight=\"137\" class=\"content_image lazy\" width=\"407\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-7f7d4c3e46d5684ab57780e30921788f_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"is1Q0pfN\"\u003E此时RHI线程虽然阻塞，但是渲染线程依然正常工作，可以继续处理向RHI命令列表填充指令\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"VEa3rHmh\"\u003E\u003Cb\u003E2.3 渲染过程中Shader的来源及选择\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"0XypwGyl\"\u003E明白了上述那些概念我们知道，屏幕结果就像是我们最终要做出来的产品，老板就像是产品经理，告诉员工这个产品要怎么做，并交给员工对应的资源，员工根据这些资源，和老板的命令去完成最终的产品（绘制到屏幕上）\u003C\u002Fp\u003E\u003Cp data-pid=\"fgGdOtaA\"\u003E首先讲这些资源在ue4中对应的是什么，以及员工在完成不同的工作阶段（绘制Pass）时是如何从这么多资源中拿到自己想要的资源的，再去讲这些资源的生成\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"4kPpeSnv\"\u003E\u003Cb\u003E资源的组织：ShaderMap\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"pVXVxT1v\"\u003E那么屏幕上的画面究竟是如何呈现的呢？员工是怎么样去用这些资源的呢，换句话说就是老板给员工的资源，员工是怎么处理成最终能用的资源的？并且这些资源是怎么组织的？\u003C\u002Fp\u003E\u003Cp data-pid=\"90vtxCbB\"\u003E这里就涉及到一个名词：ShaderMap\u003C\u002Fp\u003E\u003Cp data-pid=\"yoWrrYPZ\"\u003E用过虚幻4的渲染的都知道，虚幻引擎中的着色器数量是非常庞大的，如果改动一个材质，经常就需要编几千个甚至上万个Shader，其实也就是说单个材质会编译出多个Shader，这一点是非常重要的\u003C\u002Fp\u003E\u003Cp data-pid=\"0PXdP9IN\"\u003E用一个简单点的概念来理解ShaderMap，可以把它理解成一个三维矩阵，长度为每个材质类型，宽度为每个渲染阶段，高度为每个顶点工厂类型，矩阵的每一个方格都对应了一组着色器组合(顶点着色器，像素着色器)，材质也不一定参与全部阶段，所以这个三维矩阵中是存在有很多空缺的\u003C\u002Fp\u003E\u003Cp data-pid=\"EFJueMTI\"\u003E顶点工厂在ue4中的含义是负责抽象顶点数据以供后面的着色器获取，从而让着色器能够忽略由于顶点类型造成的差异，比如说普通的静态网格物体和使用GPU进行蒙皮的物体，二者的顶点数据不同，但是通过顶点工厂进行抽象后，提供统一的数据获取接口，供后面的着色器使用\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"MlnJrLSg\"\u003E\u003Cb\u003E资源的选择：怎么从ShaderMap中拿到想要的Shader\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"oXX-_dFf\"\u003E现在是第二个问题，如何根据当前阶段，当前的材质类型，当前顶点工厂类型，从这个三维矩阵中获得需要的着色器组合呢\u003C\u002Fp\u003E\u003Cp data-pid=\"cX_Own3y\"\u003E以一个StaticMesh物体的渲染为例（动态物体不同），对着色器数据选择的过程如下：\u003C\u002Fp\u003E\u003Cp data-pid=\"Os6SwvFr\"\u003E1：渲染线程把这个物体添加进场景 AddToScene\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-6b0ed3ceba8a579e1882d8d7b763352a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1181\" data-rawheight=\"67\" class=\"origin_image zh-lightbox-thumb\" width=\"1181\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-6b0ed3ceba8a579e1882d8d7b763352a_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1181&#39; height=&#39;67&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1181\" data-rawheight=\"67\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1181\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-6b0ed3ceba8a579e1882d8d7b763352a_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-6b0ed3ceba8a579e1882d8d7b763352a_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"_SS-BGhS\"\u003E2：更新场景的静态物体绘制列表 AddStaticMeshes\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-43eac107d4f84c533730dbc3fac35809_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"496\" data-rawheight=\"83\" class=\"origin_image zh-lightbox-thumb\" width=\"496\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-43eac107d4f84c533730dbc3fac35809_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;496&#39; height=&#39;83&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"496\" data-rawheight=\"83\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"496\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-43eac107d4f84c533730dbc3fac35809_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-43eac107d4f84c533730dbc3fac35809_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"x7gEpQ0g\"\u003E3: 调用CacheMeshDrawCommands，开始生成当前物体的绘制命令MeshDrawCommands并缓存住\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-9e51f4bedd8c60285f2c71f4ba9c7633_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"333\" data-rawheight=\"93\" class=\"content_image\" width=\"333\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;333&#39; height=&#39;93&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"333\" data-rawheight=\"93\" class=\"content_image lazy\" width=\"333\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-9e51f4bedd8c60285f2c71f4ba9c7633_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"lxHWNrJY\"\u003E4：遍历所有的Rendering Pass类型，获取当前场景的CachedDrawLists生成Drawlistcontext\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-343c04595d5ab1c1ee8dfadf825ec792_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"908\" data-rawheight=\"235\" class=\"origin_image zh-lightbox-thumb\" width=\"908\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-343c04595d5ab1c1ee8dfadf825ec792_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;908&#39; height=&#39;235&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"908\" data-rawheight=\"235\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"908\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-343c04595d5ab1c1ee8dfadf825ec792_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-343c04595d5ab1c1ee8dfadf825ec792_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"NSy5ZXcm\"\u003E5：调用不同Pass(以BasePass为例)的AddMeshBatch函数，并将Drawlistcontext作为参数传入（方便之后把生成的绘制命令缓存住）\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ad24f92c1bbe519c6d9799884c8f398b_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1020\" data-rawheight=\"261\" class=\"origin_image zh-lightbox-thumb\" width=\"1020\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ad24f92c1bbe519c6d9799884c8f398b_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1020&#39; height=&#39;261&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1020\" data-rawheight=\"261\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1020\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ad24f92c1bbe519c6d9799884c8f398b_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ad24f92c1bbe519c6d9799884c8f398b_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"SLZGgbX2\"\u003E6：通过一系列参数判断该Mesh应不应该在当前Pass（BasePass为例）生成绘制命令，如果验证通过，那么调用当前Pass的Process函数\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-89312ccfb265dc5610ecabe37db9889a_b.jpg\" data-size=\"normal\" data-rawwidth=\"656\" data-rawheight=\"127\" class=\"origin_image zh-lightbox-thumb\" width=\"656\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-89312ccfb265dc5610ecabe37db9889a_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;656&#39; height=&#39;127&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" data-rawwidth=\"656\" data-rawheight=\"127\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"656\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-89312ccfb265dc5610ecabe37db9889a_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-89312ccfb265dc5610ecabe37db9889a_b.jpg\"\u002F\u003E\u003Cfigcaption\u003E其实也没啥，但是还是加马赛克\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"f_OSdl6h\"\u003E7：获取该Mesh在当前Pass绘制需要的Shaders，绘制状态，光栅化状态，并最终生成该Mesh的绘制命令\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-8df979e5cb94045a5b0b580213937f00_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"353\" data-rawheight=\"210\" class=\"content_image\" width=\"353\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;353&#39; height=&#39;210&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"353\" data-rawheight=\"210\" class=\"content_image lazy\" width=\"353\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-8df979e5cb94045a5b0b580213937f00_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-db14a2f5c97135001a0884262fd22f6e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"762\" data-rawheight=\"195\" class=\"origin_image zh-lightbox-thumb\" width=\"762\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-db14a2f5c97135001a0884262fd22f6e_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;762&#39; height=&#39;195&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"762\" data-rawheight=\"195\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"762\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-db14a2f5c97135001a0884262fd22f6e_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-db14a2f5c97135001a0884262fd22f6e_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-c2493b490e410530a715991e89e2f162_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"753\" data-rawheight=\"72\" class=\"origin_image zh-lightbox-thumb\" width=\"753\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-c2493b490e410530a715991e89e2f162_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;753&#39; height=&#39;72&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"753\" data-rawheight=\"72\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"753\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-c2493b490e410530a715991e89e2f162_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-c2493b490e410530a715991e89e2f162_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-096be7dfd53fffdbc2571d08144e22fd_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"312\" data-rawheight=\"265\" class=\"content_image\" width=\"312\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;312&#39; height=&#39;265&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"312\" data-rawheight=\"265\" class=\"content_image lazy\" width=\"312\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-096be7dfd53fffdbc2571d08144e22fd_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"V8bLhmKB\"\u003E所以到这一步就讲清楚了渲染时怎么去拿Shader的流程，需要去看不同Pass的GetShaders函数，结合之前对ShaderMap的分析来看它的传入参数，MaterialResource对应它使用的材质资源，VertexFactory的type对应所用到的顶点工厂类型，最后还有用到的顶点和像素着色器\u003C\u002Fp\u003E\u003Cp data-pid=\"q4l9PpRd\"\u003E最终得到顶点着色器和像素着色器的调用如下（此时材质类型和渲染Pass已经确定）\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-fbed4381b35abe2cb117d19db8662e22_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1194\" data-rawheight=\"28\" class=\"origin_image zh-lightbox-thumb\" width=\"1194\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-fbed4381b35abe2cb117d19db8662e22_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1194&#39; height=&#39;28&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1194\" data-rawheight=\"28\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1194\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-fbed4381b35abe2cb117d19db8662e22_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-fbed4381b35abe2cb117d19db8662e22_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ae9fd54c468aa1d896f8ac9d5aa41943_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1167\" data-rawheight=\"49\" class=\"origin_image zh-lightbox-thumb\" width=\"1167\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ae9fd54c468aa1d896f8ac9d5aa41943_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1167&#39; height=&#39;49&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1167\" data-rawheight=\"49\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1167\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ae9fd54c468aa1d896f8ac9d5aa41943_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ae9fd54c468aa1d896f8ac9d5aa41943_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"zr4BJEZ_\"\u003E材质的GetShader函数首先以当前顶点工厂类型的id为索引，通过GetMeshShaderMap函数从OrderedMeshShaderMaps成员变量中查询到对应顶点工厂类型的MeshShaderMap，随后调用当前MeshShaderMap的GetShader函数，以当前着色器类型为参数查询，查询到实际对应的着色器\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"DA-4FB2x\"\u003E\u003Cb\u003E总结如下：实质上获取一组着色器组合需要的三个变量：渲染Pass，顶点工厂类型，材质类型，这也就不难理解UE4中对资源的组织形式了\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"a4lHBR_t\"\u003E\u003Cb\u003E三 , UE4中Shader的生成\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"M2cPEvvx\"\u003E\u003Cb\u003EMaterialShader的编译\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"m632nFop\"\u003E在第二部分的内容中已经说清楚了ue4中Shader的组织形式以及具体是怎么去获取，那么接下来的问题就是如何去生成这些Shader，及材质如何编译，产生ShaderMap并缓存起来\u003C\u002Fp\u003E\u003Cp data-pid=\"025okgk7\"\u003E在之前一篇对材质分析的文章中已经说到当HLSL代码生成后（这篇文章在我的笔记里，之后考虑放出来），就需要进入到真正的着色器编译阶段\u003C\u002Fp\u003E\u003Cp data-pid=\"aq2qtvni\"\u003E材质节点图生成的HLSL代码只是一批函数，并不具备完整的着色器信息，这些代码会镶嵌到真正的着色器编译环境中(FShaderCompilerEnvironment)，重新编译成最终的ShaderMap中每一个着色器，主要流程如下\u003C\u002Fp\u003E\u003Cp data-pid=\"N1cI6suH\"\u003E1：保存材质并编译当前材质，触发Shader编译，调用FMaterial::BeginCompileShaderMap()\u003C\u002Fp\u003E\u003Cp data-pid=\"SBDaQi2O\"\u003E2：新建一个ShaderMap实例，调用HLSLTranslator把材质节点翻译成HLSL代码\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-897b31b74c76c4c564d1ec5dd5141f8a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"650\" data-rawheight=\"32\" class=\"origin_image zh-lightbox-thumb\" width=\"650\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-897b31b74c76c4c564d1ec5dd5141f8a_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;650&#39; height=&#39;32&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"650\" data-rawheight=\"32\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"650\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-897b31b74c76c4c564d1ec5dd5141f8a_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-897b31b74c76c4c564d1ec5dd5141f8a_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-cf7d76d6a3834c444629c9b58810a540_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"612\" data-rawheight=\"89\" class=\"origin_image zh-lightbox-thumb\" width=\"612\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-cf7d76d6a3834c444629c9b58810a540_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;612&#39; height=&#39;89&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"612\" data-rawheight=\"89\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"612\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-cf7d76d6a3834c444629c9b58810a540_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-cf7d76d6a3834c444629c9b58810a540_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"E_9pd5zP\"\u003E3：初始化着色器编译环境，FShaderCompilerEnvironment通过MaterialTraslator::GetMaterialEnvironment初始化实例，主要就是去设置宏\u003C\u002Fp\u003E\u003Cp data-pid=\"RsQuVtwM\"\u003E3.1：根据当前Material的各种属性，初始化各种着色器宏定义，从而控制编译过程中的各种宏开关是否启动\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-202709ae35ca9ae19000bad8ac4fd8f7_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"905\" data-rawheight=\"80\" class=\"origin_image zh-lightbox-thumb\" width=\"905\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-202709ae35ca9ae19000bad8ac4fd8f7_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;905&#39; height=&#39;80&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"905\" data-rawheight=\"80\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"905\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-202709ae35ca9ae19000bad8ac4fd8f7_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-202709ae35ca9ae19000bad8ac4fd8f7_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"8YkagoU2\"\u003E3.2：根据FHLSLMaterialTranslator在解析过程中得出当前的参数集合，添加参数定义到环境中\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-33aed76b93d28c6564d0ce1abfb5fac6_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"721\" data-rawheight=\"98\" class=\"origin_image zh-lightbox-thumb\" width=\"721\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-33aed76b93d28c6564d0ce1abfb5fac6_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;721&#39; height=&#39;98&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"721\" data-rawheight=\"98\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"721\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-33aed76b93d28c6564d0ce1abfb5fac6_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-33aed76b93d28c6564d0ce1abfb5fac6_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"jYfahR4P\"\u003E4：开始实际的编译工作\u003C\u002Fp\u003E\u003Cp data-pid=\"QMEIhnW8\"\u003E4.1：调用NewShaderMap的Compile函数：\u003C\u002Fp\u003E\u003Cp data-pid=\"CSNxuXOA\"\u003Ea，调用FMaterial::SetupMaterialEnvironment函数，设置当前的编译环境，这里面也会去设置各种宏定义\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-c374eb1b3fa8231eed019f0159eee449_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"903\" data-rawheight=\"338\" class=\"origin_image zh-lightbox-thumb\" width=\"903\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-c374eb1b3fa8231eed019f0159eee449_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;903&#39; height=&#39;338&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"903\" data-rawheight=\"338\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"903\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-c374eb1b3fa8231eed019f0159eee449_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-c374eb1b3fa8231eed019f0159eee449_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"D5ALJ2vR\"\u003Eb，获取所有顶点工厂类型，对于每一种顶点工厂类型，查看该类型对应的ShaderMap是不是已经被使用，如果被使用就去BeginCompile\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-3615466afce3666accb0580e74c67d87_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"706\" data-rawheight=\"188\" class=\"origin_image zh-lightbox-thumb\" width=\"706\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-3615466afce3666accb0580e74c67d87_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;706&#39; height=&#39;188&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"706\" data-rawheight=\"188\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"706\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-3615466afce3666accb0580e74c67d87_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-3615466afce3666accb0580e74c67d87_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"kEEiVtZ5\"\u003Ec，BeginCompile函数中会去遍历所有的ShaderType,中间会调到实例类的ModifyCompilationEnvironment,最终调用全局函数GlobalBeginCompileShader，这个全局函数会去填充FShaderCompileJob，包括设置shader格式、usf路径、注入宏等等\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e63921d8d281fbee9b7fc6938f83eefc_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"945\" data-rawheight=\"184\" class=\"origin_image zh-lightbox-thumb\" width=\"945\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e63921d8d281fbee9b7fc6938f83eefc_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;945&#39; height=&#39;184&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"945\" data-rawheight=\"184\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"945\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e63921d8d281fbee9b7fc6938f83eefc_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e63921d8d281fbee9b7fc6938f83eefc_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"6nvwSj7N\"\u003Ed，真正执行编译任务的是把所有FShaderCompileJob交给FShaderCompilingManager，并且让其马上执行编译并返回\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-03cd6f0eac9f5a39079eaf229a7c3d17_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"590\" data-rawheight=\"327\" class=\"origin_image zh-lightbox-thumb\" width=\"590\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-03cd6f0eac9f5a39079eaf229a7c3d17_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;590&#39; height=&#39;327&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"590\" data-rawheight=\"327\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"590\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-03cd6f0eac9f5a39079eaf229a7c3d17_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-03cd6f0eac9f5a39079eaf229a7c3d17_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"2_w0AdMp\"\u003E\u003Cb\u003E如何实现Shader变种？\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"C_h6pkL8\"\u003EFMeshMaterialShaderType继承自FShaderType，他存有模板类的两个静态函数指针：ModifyCompilationEnvironment和ShouldCompilePermutation，因此每次遍历我们都可以访问到这两个函数\u003C\u002Fp\u003E\u003Cp data-pid=\"FbvUPc9Z\"\u003E上文中的c阶段会先调用ShouldCompilePermutation询问TMobileBasePassPS是否为当前Template、VertexFactory、Material组合编译Shader\u003C\u002Fp\u003E\u003Cp data-pid=\"cFYczNn8\"\u003E如果需要编译，则调用ModifyCompilationEnvironment注入该当前模板确定的宏，以此实现Shader的变种。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"97bKw6DI\"\u003E\u003Cb\u003EGlobalShader的编译\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"pdtDhxwe\"\u003E在使用编辑器的时候，经常会有需要改动到Shader文件，并且需要在编辑器中查看效果的需求，与材质编辑器中的材质Shader不一样，材质编辑器提供了编译按钮，对材质的改动都可以保存并编译出Shader保存到ShaderMap中，所以如果改动了目录下的Shader文件怎么告诉引擎去帮我们编译修改后的Shader\u003C\u002Fp\u003E\u003Cp data-pid=\"n41Zcu5V\"\u003E虚幻针对这个功能已经提供了相应的指令\u003C\u002Fp\u003E\u003Cp data-pid=\"v3hboXJA\"\u003Erecompileshaders changed ，recompileshaders global，recompileshaders material &lt;MaterialName&gt;，recompileshaders all，recompileshaders &lt;path&gt;\u003C\u002Fp\u003E\u003Cp data-pid=\"G713-gBQ\"\u003E如果不知道这些指令，一个比较死的办法自然是重启编辑器，让它重编改动过的Shader，当然也可以不重启编辑器来重编这些改动过的shader，比如使用 recompileshaders changed，这里首先讲通过指令重编的方法，它的具体流程是怎样？\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"qSEV1eNp\"\u003E一：动态重编Shader 不需要重开编辑器\u003C\u002Fp\u003E\u003Cp data-pid=\"UbcScT3C\"\u003E1: 修改Shader文件，保存，在控制台输入 recompileshaders changed\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"Rwk4Vr_W\"\u003E2：调用RecompileShaders，根据指令的内容进入不同的分支，先去匹配具体的命令内容\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-30f4e2bd8269c8d92339744afd24e988_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"463\" data-rawheight=\"50\" class=\"origin_image zh-lightbox-thumb\" width=\"463\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-30f4e2bd8269c8d92339744afd24e988_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;463&#39; height=&#39;50&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"463\" data-rawheight=\"50\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"463\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-30f4e2bd8269c8d92339744afd24e988_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-30f4e2bd8269c8d92339744afd24e988_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"14LHWaXS\"\u003E3：寻找过期的Shader文件（改动过的Shader）\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-7f415efe69033f00033ab20d149b890a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"999\" data-rawheight=\"172\" class=\"origin_image zh-lightbox-thumb\" width=\"999\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-7f415efe69033f00033ab20d149b890a_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;999&#39; height=&#39;172&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"999\" data-rawheight=\"172\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"999\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-7f415efe69033f00033ab20d149b890a_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-7f415efe69033f00033ab20d149b890a_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"-4437jZ4\"\u003E4：如果当前对Shader文件(.usf)没有任何改动，直接返回No Shader changes found，如果有改动，调用BeginRecompileGlobalShaders\u003C\u002Fp\u003E\u003Cp data-pid=\"SpGy1PnE\"\u003Ea,调用FlushRenderingCommands，等待渲染线程执行完所有挂起的渲染命令\u003C\u002Fp\u003E\u003Cp data-pid=\"uIb7YNxw\"\u003Eb,根据当前平台得到GlobalShaderMap，GetGlobalShaderMap(ShaderPlatform)，这里也可以看出来不同的ShaderType是存在不同的ShaderMap中的\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-097a83a0a52bae53b443d03320c7d72f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"736\" data-rawheight=\"27\" class=\"origin_image zh-lightbox-thumb\" width=\"736\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-097a83a0a52bae53b443d03320c7d72f_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;736&#39; height=&#39;27&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"736\" data-rawheight=\"27\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"736\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-097a83a0a52bae53b443d03320c7d72f_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-097a83a0a52bae53b443d03320c7d72f_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"XAwq_IQr\"\u003Ec，从ShaderMap中移除过期的CurrentGlobalShaderType和ShaderPipline（顶点还是像素着色器等等..）的Shader\u003C\u002Fp\u003E\u003Cp data-pid=\"GNGjI2E1\"\u003Ed，调用VerifyGlobalShaders重编ShaderMap中的Shader\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"Z3VJNzPN\"\u003E5：完成GlobalShader的重编，调用FinishRecompileGlobalShaders()，该函数会阻塞直到所有的Global Shaders被编译和处理完毕\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"8MpLdFpR\"\u003E二：重开编辑器\u003C\u002Fp\u003E\u003Cp data-pid=\"La3TKkhm\"\u003E1：在引擎的preinit函数中调用CompileGlobalShaderMap\u003C\u002Fp\u003E\u003Cp data-pid=\"6-pJcMeq\"\u003E2：新建一个GlobalShaderMap实例\u003C\u002Fp\u003E\u003Cp data-pid=\"Daoekk6-\"\u003E3：查看Shader缓存DDC中的内容与设定的KeyString是否一致，如果不一致说明缓存中对应部分的内容已经失效了，UE就会去重编这部分内容(对应最开始说到的重编Shader问题)，并且去重新生成这部分的DDC\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-aa564a6b43f89239225874c8c62332e3_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"980\" data-rawheight=\"221\" class=\"origin_image zh-lightbox-thumb\" width=\"980\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-aa564a6b43f89239225874c8c62332e3_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;980&#39; height=&#39;221&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"980\" data-rawheight=\"221\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"980\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-aa564a6b43f89239225874c8c62332e3_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-aa564a6b43f89239225874c8c62332e3_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"PTozoWMV\"\u003E4：从DDC中反序列化出来GlobalShaderMap实例的内容\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-c434059c8c4fd35a9064e15e54410503_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"578\" data-rawheight=\"50\" class=\"origin_image zh-lightbox-thumb\" width=\"578\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-c434059c8c4fd35a9064e15e54410503_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;578&#39; height=&#39;50&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"578\" data-rawheight=\"50\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"578\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-c434059c8c4fd35a9064e15e54410503_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-c434059c8c4fd35a9064e15e54410503_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"aBpP3Vip\"\u003E5：接下来就是一些Shader资源的初始化操作...\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"e4DSbOMl\"\u003E\u003Cb\u003E三 , UE4中材质Cook保存的是什么\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"fqNC3dOg\"\u003E所谓的Cook是指把平台无关的编辑向数据转化为特定平台运行时所需的数据，对于材质来说就是把上述的usf文件和材质连线编译成安卓运行时需要的GLSL源码。\u003C\u002Fp\u003E\u003Cp data-pid=\"CrExhCTY\"\u003E1：Cook Commandlet会首先调用一个Package里面所有的UObject的BeginCacheForCookedPlatformData(const ITargetPlatform *TargetPlatform)方法，该方法由各个UObject派生类各自实现，目的是生成特定所需数据并缓存下来，对于材质来讲就是UMaterial的BeginCacheForCookedPlatformData\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ec63015663ffcd1ede8a07369d45579f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"861\" data-rawheight=\"122\" class=\"origin_image zh-lightbox-thumb\" width=\"861\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ec63015663ffcd1ede8a07369d45579f_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;861&#39; height=&#39;122&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"861\" data-rawheight=\"122\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"861\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ec63015663ffcd1ede8a07369d45579f_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-ec63015663ffcd1ede8a07369d45579f_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"ICWRbYHJ\"\u003Ea,开始为目标平台缓存着色器，并将正在编译的材质资源存储到CachedMaterialResourcesForCooking中\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-4a270cac89bedaa4a21528c0393b5791_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"940\" data-rawheight=\"29\" class=\"origin_image zh-lightbox-thumb\" width=\"940\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-4a270cac89bedaa4a21528c0393b5791_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;940&#39; height=&#39;29&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"940\" data-rawheight=\"29\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"940\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-4a270cac89bedaa4a21528c0393b5791_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-4a270cac89bedaa4a21528c0393b5791_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"QL6pJ1US\"\u003Eb,为当前ShaderFormat\u002FFeatureLevel、QualityLevel生成一个FMaterialResource数组，并调用CacheShadersForResources填充其内容\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-d3be4d12fb8175db82cec340feb8ff6f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"745\" data-rawheight=\"255\" class=\"origin_image zh-lightbox-thumb\" width=\"745\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-d3be4d12fb8175db82cec340feb8ff6f_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;745&#39; height=&#39;255&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"745\" data-rawheight=\"255\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"745\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-d3be4d12fb8175db82cec340feb8ff6f_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-d3be4d12fb8175db82cec340feb8ff6f_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"ACtR2HZv\"\u003E2：之后Cook Commandlet会保存该Package，也就是是去执行到UMaterial里面的Serialize方法\u003C\u002Fp\u003E\u003Cp data-pid=\"Woyn0YCK\"\u003E实际上前面部分提到的usf文件和材质连线都通过CacheShadersForResources被转化成了一个个FMaterialResource，所以FMaterialResource到底是什么东西？\u003C\u002Fp\u003E\u003Cp data-pid=\"D4Gl9eG7\"\u003E在UMaterial能找到如下成员\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-c229c7278a4e9f0e428357f17ead7dc0_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1218\" data-rawheight=\"141\" class=\"origin_image zh-lightbox-thumb\" width=\"1218\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-c229c7278a4e9f0e428357f17ead7dc0_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1218&#39; height=&#39;141&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1218\" data-rawheight=\"141\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1218\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-c229c7278a4e9f0e428357f17ead7dc0_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-c229c7278a4e9f0e428357f17ead7dc0_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"PPcXUYuf\"\u003E结合之前的分析，不难得出 UMaterial持有 QualityLevelNum * FeatureLevelNum 个FMaterialResource，可以通过QualityLevel和FeatureLevel索引到FMaterialResource\u003C\u002Fp\u003E\u003Cp data-pid=\"d5zqqtGR\"\u003EFMaterialResource里有一个关键的成员FMaterialShaderMap，FMaterialShaderMap可以通过FVertexFactoryType::GetId()来索引到FMeshMaterialShaderMap；而FMeshMaterialShaderMap可以通过FShaderType来索引FShader\u003C\u002Fp\u003E\u003Cp data-pid=\"ixdTe0AD\"\u003E因此FMaterialResource里面存放的实际上是FShader的集合，而FShader里面存放的就是最终使用的Shader代码了\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-e23b571fc2e0962c0778e1626a490546_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"577\" data-rawheight=\"62\" class=\"origin_image zh-lightbox-thumb\" width=\"577\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-e23b571fc2e0962c0778e1626a490546_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;577&#39; height=&#39;62&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"577\" data-rawheight=\"62\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"577\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-e23b571fc2e0962c0778e1626a490546_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-e23b571fc2e0962c0778e1626a490546_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003C\u002Fp\u003E","adminClosedComment":false,"topics":[{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F20052447","type":"topic","id":"20052447","name":"虚幻 4（游戏引擎）"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F20018494","type":"topic","id":"20018494","name":"shader"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19575468","type":"topic","id":"19575468","name":"渲染"}],"voteupCount":283,"voting":0,"heavyUpStatus":"allow_heavy_up","commentCount":33,"contributions":[],"isTitleImageFullScreen":false,"upvotedFollowees":[],"commercialInfo":{"isCommercial":false,"plugin":{}},"suggestEdit":{"status":false,"reason":"","tip":"","url":"","title":""},"reason":"","annotationAction":[],"canTip":false,"tipjarorsCount":0,"isLabeled":false,"hasPublishingDraft":false,"isFavorited":false,"favlistsCount":631,"isNormal":true,"status":0,"shareText":"UE4 Shader 编译以及变种实现 - 来自知乎专栏，作者: YiQiuuu https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F154081604 （想看更多？下载 @知乎 App：http:\u002F\u002Fweibo.com\u002Fp\u002F100404711598 ）","canComment":{"status":true,"reason":""},"mcnFpShow":-1,"isVisible":true,"isLiked":false,"likedCount":46,"hasColumn":false,"republishers":[],"isNewLinkCard":true,"emojiReaction":{"cryFaceCount":0,"cryFaceHasSet":false,"hugCount":0,"hugHasSet":false,"likeCount":46,"likeHasSet":false,"onlookerCount":0,"onlookerHasSet":false},"abParam":{"shangyebiaoshi":"1"},"attachedInfo":"kgIkCgkxMjIzNzIzNTkSCTE1NDA4MTYwNBgHIgpJTUFHRV9URVhU","shareGuide":{"hasPositiveBubble":false,"hasTimeBubble":false,"hitShareGuideCluster":false},"settings":{"tableOfContents":{"enabled":false}},"canReference":false,"reactionInstruction":{},"entityWords":[{"name":"虚幻引擎","mention":"虚幻引擎","matchorder":1,"begin":558,"end":562,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Game","score":0,"attachedInfoBytes":"sgJUCgzomZrlubvlvJXmk44SBEdhbWUYrgQgsgQoATUAAAAAOgdhcnRpY2xlQABIAFIkYjk2YTQ0ZmYtMThmZC00MDExLWE2ODAtZGM5NTJlNDRkMGJm","isOnAB":false,"isNatural":1,"isDelete":false},{"name":"虚幻4","mention":"虚幻4","matchorder":1,"begin":5074,"end":5077,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Game","score":0,"attachedInfoBytes":"sgJPCgfomZrlubs0EgRHYW1lGNInINUnKAE1AAAAADoHYXJ0aWNsZUAASABSJGI5NmE0NGZmLTE4ZmQtNDAxMS1hNjgwLWRjOTUyZTQ0ZDBiZg==","isOnAB":false,"isNatural":1,"isDelete":false},{"name":"材质节点图","mention":"材质节点图","matchorder":1,"begin":11307,"end":11312,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0,"attachedInfoBytes":"sgJbCg\u002FmnZDotKjoioLngrnlm74SCENvbXB1dGVyGKtYILBYKAE1AAAAADoHYXJ0aWNsZUAASABSJGI5NmE0NGZmLTE4ZmQtNDAxMS1hNjgwLWRjOTUyZTQ0ZDBiZg==","isOnAB":false,"isNatural":1,"isDelete":false},{"name":"材质Cook","mention":"材质Cook","matchorder":1,"begin":19622,"end":19628,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Chemistry","score":0,"attachedInfoBytes":"sgJZCgrmnZDotKhDb29rEglDaGVtaXN0cnkYppkBIKyZASgBNQAAAAA6B2FydGljbGVAAEgAUiRiOTZhNDRmZi0xOGZkLTQwMTEtYTY4MC1kYzk1MmU0NGQwYmY=","isOnAB":false,"isNatural":1,"isDelete":false},{"name":"顶点工厂","mention":"顶点工厂","matchorder":2,"begin":5253,"end":5257,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0,"attachedInfoBytes":"sgJYCgzpobbngrnlt6XljoISCENvbXB1dGVyGIUpIIkpKAI1AAAAADoHYXJ0aWNsZUAASABSJGI5NmE0NGZmLTE4ZmQtNDAxMS1hNjgwLWRjOTUyZTQ0ZDBiZg==","isOnAB":false,"isNatural":1,"isDelete":false},{"name":"顶点着色器","mention":"顶点着色器","matchorder":1,"begin":5280,"end":5285,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0,"attachedInfoBytes":"sgJbCg\u002FpobbngrnnnYDoibLlmagSCENvbXB1dGVyGKApIKUpKAE1AAAAADoHYXJ0aWNsZUAASABSJGI5NmE0NGZmLTE4ZmQtNDAxMS1hNjgwLWRjOTUyZTQ0ZDBiZg==","isOnAB":false,"isNatural":1,"isDelete":false},{"name":"RHI线程","mention":"RHI线程","matchorder":2,"begin":583,"end":588,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"OtherTerm","score":0,"attachedInfoBytes":"sgJWCglSSEnnur\u002FnqIsSCU90aGVyVGVybRjHBCDMBCgCNQAAAAA6B2FydGljbGVAAEgAUiRiOTZhNDRmZi0xOGZkLTQwMTEtYTY4MC1kYzk1MmU0NGQwYmY=","isOnAB":false,"isNatural":1,"isDelete":false},{"name":"AddMeshBatch函数","mention":"AddMeshBatch函数","matchorder":1,"begin":7426,"end":7440,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0,"attachedInfoBytes":"sgJaChJBZGRNZXNoQmF0Y2jlh73mlbASBE1hdGgYgjogkDooATUAAAAAOgdhcnRpY2xlQABIAFIkYjk2YTQ0ZmYtMThmZC00MDExLWE2ODAtZGM5NTJlNDRkMGJm","isOnAB":false,"isNatural":1,"isDelete":false},{"name":"GetShaders函数","mention":"GetShaders函数","matchorder":1,"begin":9693,"end":9705,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0,"attachedInfoBytes":"sgJYChBHZXRTaGFkZXJz5Ye95pWwEgRNYXRoGN1LIOlLKAE1AAAAADoHYXJ0aWNsZUAASABSJGI5NmE0NGZmLTE4ZmQtNDAxMS1hNjgwLWRjOTUyZTQ0ZDBiZg==","isOnAB":false,"isNatural":1,"isDelete":false},{"name":"Compile函数","mention":"Compile函数","matchorder":1,"begin":13358,"end":13367,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0,"attachedInfoBytes":"sgJVCg1Db21waWxl5Ye95pWwEgRNYXRoGK5oILdoKAE1AAAAADoHYXJ0aWNsZUAASABSJGI5NmE0NGZmLTE4ZmQtNDAxMS1hNjgwLWRjOTUyZTQ0ZDBiZg==","isOnAB":false,"isNatural":1,"isDelete":false}]}},"columns":{},"topics":{},"roundtables":{},"favlists":{},"comments":{},"notifications":{},"ebooks":{},"activities":{},"feeds":{},"pins":{},"promotions":{},"drafts":{},"chats":{},"posts":{},"clubs":{},"clubTags":{},"zvideos":{},"zvideoContributions":{},"briefs":{},"eduCourses":{}},"currentUser":"9b939bd116cd066ce372288d50538da8","account":{"lockLevel":{},"unlockTicketStatus":false,"unlockTicket":null,"challenge":[],"errorStatus":false,"message":"","isFetching":false,"accountInfo":{},"urlToken":{"loading":false},"cardUserInfo":{"vipInfo":{}},"handleWidget":{},"widgetList":[],"userWidgetId":""},"settings":{"socialBind":null,"inboxMsg":null,"notification":{},"email":{},"privacyFlag":null,"blockedUsers":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"blockedFollowees":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"ignoredTopics":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"restrictedTopics":null,"laboratory":{}},"notification":{},"people":{"profileStatus":{},"activitiesByUser":{},"answersByUser":{},"answersSortByVotesByUser":{},"answersIncludedByUser":{},"votedAnswersByUser":{},"thankedAnswersByUser":{},"voteAnswersByUser":{},"thankAnswersByUser":{},"topicAnswersByUser":{},"zvideosByUser":{},"articlesByUser":{},"articlesSortByVotesByUser":{},"articlesIncludedByUser":{},"pinsByUser":{},"questionsByUser":{},"commercialQuestionsByUser":{},"favlistsByUser":{},"followingByUser":{},"followersByUser":{},"mutualsByUser":{},"followingColumnsByUser":{},"followingQuestionsByUser":{},"followingFavlistsByUser":{},"followingTopicsByUser":{},"publicationsByUser":{},"columnsByUser":{},"allFavlistsByUser":{},"brands":null,"creationsByUser":{},"creationsSortByVotesByUser":{},"creationsFeed":{},"infinity":{},"batchUsers":{},"profileInfinity":null},"env":{"ab":{"config":{"params":[{"id":"vessay_v2_sdk","type":"Int","value":"1","layerId":"Qtkm"},{"id":"pc_ppt_publish","type":"Int","value":"1","layerId":"pc_ppt_publish"},{"id":"helpcenter_pc","type":"Int","value":"1","layerId":"helpcenter_pc"},{"id":"pc_comment","type":"Int","value":"1","layerId":"EsOR"},{"id":"pc_follow","type":"Int","value":"1","layerId":"pc_follow"},{"id":"pc_player_rp","type":"Int","value":"1","layerId":"pc_player_rp"},{"id":"use_biz_comment","type":"Int","value":"1","layerId":"use_biz_comment"},{"id":"pc_pin","type":"Int","value":"1","layerId":"pc_pin"},{"id":"player_vendors","type":"Int","value":"0","layerId":"player_vendors"},{"id":"report_page","type":"Int","value":"0","layerId":"report_page"},{"id":"img_notwell","type":"Int","value":"0","layerId":"img_notwell"},{"id":"update_react","type":"Int","value":"0","layerId":"update_react"}],"experiments":[{"expId":"pc_ppt_publish-2_v2","expPrefix":"pc_ppt_publish","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"helpcenter_pc-2_v11","expPrefix":"helpcenter_pc","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"pc_comment-2_v4","expPrefix":"pc_comment","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"pc_follow-3_v5","expPrefix":"pc_follow","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"pc_player_rp-2_v8","expPrefix":"pc_player_rp","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"use_biz_comment-2_v5","expPrefix":"use_biz_comment","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"pc_pin-2_v3","expPrefix":"pc_pin","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"player_vendors-1_v8","expPrefix":"player_vendors","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"update_react-1_v3","expPrefix":"update_react","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false}],"chains":[{"chainId":"_all_"}],"encodedParams":"CsIBCAAbAD8ARwC0AGkBagF0ATsCzALXAtgCTwNQA6ADoQOiA7cD8wP0AzMEjASNBKYE1gQRBVEFiwWMBZ4FMAYxBusGJwd3B3gH2AfcB90HZwh0CHYIeQjaCD8JQglgCY0JwwnECcUJxgnHCcgJyQnKCcsJzAnRCfQJBApJCmUKawqYCqUKqQq+CsQK1ArdCu0K\u002FQr+CjsLPAtDC0YLcQt2C4ULhwuNC8AL1wvgC+UL5gssDDgMcQyPDKwMuQzDDMkM+AwSYQIAAAABAAEAAgMAAAAAAAAAAAAAAAQEAAQAAQAAAQABAAAAAAACAgQAAAYAAAEAAAAAAAAAAAAAAAAAAwAAAAABAAAAAQEBAAACAQABAAAAAAAFAAIAAAAGAgYAAAAAAAA="},"triggers":{}},"userAgent":{"Edge":false,"IE":false,"Wechat":false,"Weibo":false,"QQ":false,"MQQBrowser":false,"Qzone":false,"Mobile":false,"Android":false,"iOS":false,"isAppleDevice":false,"Zhihu":false,"ZhihuHybrid":false,"isBot":false,"Tablet":false,"UC":false,"Quark":false,"Sogou":false,"Qihoo":false,"Baidu":false,"BaiduApp":false,"Safari":false,"GoogleBot":false,"AndroidDaily":false,"iOSDaily":false,"WxMiniProgram":false,"BaiduMiniProgram":false,"QQMiniProgram":false,"JDMiniProgram":false,"isWebView":false,"isMiniProgram":false,"origin":"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F107.0.0.0 Safari\u002F537.36 Edg\u002F107.0.1418.35"},"appViewConfig":{},"ctx":{"path":"\u002Fp\u002F154081604","query":{},"href":"http:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F154081604","host":"zhuanlan.zhihu.com"},"trafficSource":"production","edition":{"beijing":false,"baidu":false,"sogou":false,"baiduBeijing":false,"sogouBeijing":false,"sogouInput":false,"baiduSearch":false,"googleSearch":false,"shenma":false,"miniProgram":false,"xiaomi":false},"theme":"light","appHeaderTheme":{"current":"normal","disable":true,"normal":{"bgColor":"GBK99A"},"custom":{"bgColor":"GBK99A"}},"enableShortcut":true,"referer":"https:\u002F\u002Fwww.bing.com\u002F","xUDId":"ADAds6PjzxOPTmBuqv67KXaBAfLOjNtmuyk=","mode":"ssr","conf":{},"xTrafficFreeOrigin":"","ipInfo":{"cityName":"上海","countryName":"中国","regionName":"上海","countryCode":"CN"},"logged":true,"vars":{"passThroughHeaders":{}}},"me":{"columnContributions":[]},"label":{"recognizerLists":{}},"ecommerce":{},"comments":{"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"parent":{}},"commentsV2":{"stickers":[],"commentWithPicPermission":{},"notificationsComments":{},"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"conversationMore":{},"parent":{}},"pushNotifications":{"default":{"isFetching":false,"isDrained":false,"ids":[]},"follow":{"isFetching":false,"isDrained":false,"ids":[]},"vote_thank":{"isFetching":false,"isDrained":false,"ids":[]},"currentTab":"default","notificationsCount":{"default":0,"follow":0,"vote_thank":0}},"messages":{"data":{},"currentTab":"common","messageCount":0},"register":{"registerValidateSucceeded":null,"registerValidateErrors":{},"registerConfirmError":null,"sendDigitsError":null,"registerConfirmSucceeded":null},"login":{"loginUnregisteredError":false,"loginBindWechatError":false,"loginConfirmError":null,"sendDigitsError":null,"needSMSIdentify":false,"validateDigitsError":false,"loginConfirmSucceeded":null,"qrcodeLoginToken":"","qrcodeLoginScanStatus":0,"qrcodeLoginError":null,"qrcodeLoginReturnNewToken":false},"switches":{},"captcha":{"captchaNeeded":false,"captchaValidated":false},"sms":{"supportedCountries":[]},"chat":{"chats":{},"inbox":{"recents":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"strangers":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"friends":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"search":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"config":{"newCount":0,"strangerMessageSwitch":false,"strangerMessageUnread":false,"friendCount":0}},"global":{"isChatMqttExisted":false}},"emoticons":{"emoticonGroupList":[],"emoticonGroupDetail":{}},"creator":{"currentCreatorUrlToken":null,"homeData":{"recommendQuestions":[]},"tools":{"question":{"invitationCount":{"questionFolloweeCount":0,"questionTotalCount":0},"goodatTopics":[]},"customPromotion":{"itemLists":{}},"recommend":{"recommendTimes":{}}},"explore":{},"rights":[],"newRights":[],"rightsStatus":{},"levelUpperLimit":10,"account":{"growthLevel":{}},"mcn":{},"applyStatus":{},"videoSupport":{},"textBenefit":{},"mcnManage":{},"tasks":{},"newTasks":{"creatorTask":{"tasks":[],"des":[]}},"scoreInfo":{},"recentlyCreated":[],"announcement":{},"bannerList":[],"creatorsRecommendInfo":{},"menusShowControlByServer":{"bVipRecomend":false,"creationRelationship":false},"income":{"aggregation":{}},"editModal":{"status":false}},"answers":{"voters":{},"copyrightApplicants":{},"favlists":{},"newAnswer":{},"entityWords":{},"concernedUpvoters":{},"simpleConcernedUpvoters":{},"paidContent":{},"settings":{}},"recommendation":{"homeRecommendations":[]},"shareTexts":{},"articles":{"voters":{},"concernedUpvoters":{}},"previewPost":{},"favlists":{"relations":{}},"columns":{"voters":{}},"reward":{"answer":{},"article":{},"question":{}},"video":{"data":{},"shareVideoDetail":{},"last":{}},"topstory":{"recommend":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"follow":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"room":{"meta":{},"isFetching":false,"afterId":0,"items":[],"next":null},"followWonderful":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"sidebar":null,"announcement":{},"hotList":[],"guestFeeds":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followExtra":{"isNewUser":null,"isFetched":false,"followCount":0,"followers":[]},"hotDaily":{"data":[],"paging":{}},"hotHighlight":{"isFetching":false,"isDrained":false,"data":[],"paging":{}},"banner":{},"commercialBanner":{"show":false,"banner":{},"trackData":{}},"video":{"items":[],"next":null,"isLoading":false,"isDrained":false}},"readStatus":{},"column":{},"requestColumn":{"categories":[],"error":null},"articleContribution":{"contributeRequests":[],"deleteContributeIdList":[],"handledContributeIdList":[],"recommendedColumns":[],"pinnedColumns":[],"sentContributeRequestsIdList":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]},"columnContribution":{"contributeRequests":[],"autoInviteEnabled":false,"recommendedContributors":[],"contributionInvitation":null},"draftHistory":{"history":{},"drafts":{}},"upload":{},"articleDraft":{"titleImage":"","titleImageSize":{},"isTitleImageFullScreen":false,"canTitleImageFullScreen":false,"title":"","titleImageUploading":false,"error":"","content":"","draftLoading":false,"updating":false,"globalLoading":false,"pendingVideo":{"resource":null,"error":null},"deleteFail":{"fail":false},"recommendTopics":[],"selectedColumn":0,"articleDisclaimers":[]},"articleDrafts":{"isDrained":false,"isLoading":false,"items":[]},"columnAutocomplete":{"users":[],"friends":[]},"columnCollection":{},"userProfit":{"permission":{"permissionStatus":{"zhiZixuan":0,"recommend":-1,"task":0,"plugin":0,"infinity":0},"visible":false}},"mcn":{"bindInfo":{},"memberCategoryList":[],"producerList":[],"categoryList":[],"lists":{},"banners":{},"protocolStatus":{"isAgreedNew":true,"isAgreedOld":true},"probationCountdownDays":0},"zvideos":{"campaignVideoList":{},"campaigns":{},"tagoreCategory":[],"recommendations":{},"insertable":{},"recruit":{"form":{"platform":"","nickname":"","followerCount":"","domain":"","contact":""},"submited":false,"ranking":[]},"club":{},"qyActivityData":{},"talkActivityData":{},"party2022ActivityData":{},"batchVideos":{},"contribution":{"selectedContribution":null,"campaign":null,"configs":{},"contributionLists":{},"recommendQuestions":{"isLoading":true,"paging":{"isEnd":false,"isStart":true,"totals":0},"data":[]},"questionSearchResults":{"isLoading":true,"paging":{"isEnd":false,"isStart":true,"totals":0},"data":[]}},"creationReferences":{},"zvideoCollection":{},"zvideoGrant":{},"collectData":{"isFetching":false,"list":[]},"videoSource":{"isLoaded":false}},"republish":{},"commentPermission":{},"creatorRightStatus":{"list":[]},"adPromotion":{"answer":{},"article":{}}},"fetchHost":"www.zhihu.com","subAppName":"column"}</script><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/vendor.a49f6a20b8521c39871a.js.download"></script><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/react.production.min.js.download"></script><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/react-dom.production.min.js.download"></script><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/react-dom-server.browser.production.min.js.download"></script><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.lib_0e5ce61e.e15f8b3774e01ad26c97.js.download"></script><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.lib_6efc30be.7e5f573d64f5b04f2b42.js.download"></script><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.lib_b3b2c8c3.50b0bd326567de8e3b6a.js.download"></script><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.lib_330004dc.9697633a4900d4a3e8e1.js.download"></script><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.lib_79b5cf47.ceab09413d36430dcdc1.js.download"></script><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.lib_29107295.0229f4908688d743e90b.js.download"></script><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/column.app.480d902224a19d50436e.js.download"></script><script defer="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/aria.js.download"></script><script src="./UE4 Shader 编译以及变种实现 - 知乎_files/hm.js.download" async=""></script><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/zap.js.download"></script><div><div style="display: none;"><i>想来知乎工作？请发送邮件到 jobs@zhihu.com</i></div></div><script src="./UE4 Shader 编译以及变种实现 - 知乎_files/push.js.download"></script><div><div><div class="css-8pdeid"></div></div></div><script crossorigin="" src="./UE4 Shader 编译以及变种实现 - 知乎_files/emoticon.js.download"></script><div><div><div class="Editable-languageSuggestions" style="left: -1179px; top: -999px;"><div><div class="Popover"><label class="Editable-languageSuggestionsInput Input-wrapper"><input autocomplete="off" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-activedescendant="AutoComplete7-0" id="Popover6-toggle" aria-haspopup="true" aria-owns="Popover6-content" class="Input" placeholder="选择语言" value=""><svg width="24" height="24" viewBox="0 0 24 24" fill="#afbdcf" class="Zi Zi--Select"><path fill-rule="evenodd" d="M12.53 3.47a.75.75 0 0 0-1.06 0l-5 5a.75.75 0 0 0 1.06 1.06L12 5.06l4.47 4.47a.75.75 0 1 0 1.06-1.06l-5-5Zm-5 11a.75.75 0 0 0-1.06 1.06l5 5a.75.75 0 0 0 1.06 0l5-5a.75.75 0 1 0-1.06-1.06L12 18.94l-4.47-4.47Z" clip-rule="evenodd"></path></svg></label></div></div></div></div></div><div><div><div class="Editable-languageSuggestions" style="left: -1179px; top: -999px;"><div><div class="Popover"><label class="Editable-languageSuggestionsInput Input-wrapper"><input autocomplete="off" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-activedescendant="AutoComplete9-0" id="Popover8-toggle" aria-haspopup="true" aria-owns="Popover8-content" class="Input" placeholder="选择语言" value=""><svg width="24" height="24" viewBox="0 0 24 24" fill="#afbdcf" class="Zi Zi--Select"><path fill-rule="evenodd" d="M12.53 3.47a.75.75 0 0 0-1.06 0l-5 5a.75.75 0 0 0 1.06 1.06L12 5.06l4.47 4.47a.75.75 0 1 0 1.06-1.06l-5-5Zm-5 11a.75.75 0 0 0-1.06 1.06l5 5a.75.75 0 0 0 1.06 0l5-5a.75.75 0 1 0-1.06-1.06L12 18.94l-4.47-4.47Z" clip-rule="evenodd"></path></svg></label></div></div></div></div></div></body></html>