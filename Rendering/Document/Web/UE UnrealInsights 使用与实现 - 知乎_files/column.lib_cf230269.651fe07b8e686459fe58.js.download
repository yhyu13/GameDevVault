(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{1784:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Zn}));var r,o,c,i=n(1462),a=n.n(i),s=n(136),l=n.n(s),u=n(36),d=n.n(u),b=n(30),p=n.n(b),h=n(32),f=n.n(h),m=n(71),O=n.n(m),g=n(48),j=n.n(g),v=n(20),x=n.n(v),y=n(0),C=n(1),k=n.n(C),T=n(105),w=n(1346),A=n(928),B=n(78),I=n(5),S=n(9),E=n(89),z=n.n(E),L=n(665),D=n(1582),M=n(1785),R=n(54),G=n.n(R),F=n(42),P=n(1425),N=n(1862),K=n(735),H=n(1424),_=n(1868),U=n(293),Z=n(27),W=n(828),V=n.n(W),q=n(263),J=n.n(q),X=n(45),Y=n.n(X),$=n(256),Q=n.n($),ee=n(18),te=n(161),ne=n(43),re=n(1266),oe=n(1273),ce=n(290),ie=n(456),ae=n(1376),se=n(930),le=n(738),ue=n(1367),de=n(931),be=n(1863),pe=n(1787),he=n(1270),fe=n(1864),me=n(1271),Oe=n(1788),ge=n(1865),je=n(1356),ve=n(1866),xe=n(1867),ye=n(1869),Ce=n(1870),ke=n(932),Te=n(3),we=n(561),Ae=n(96),Be=n(538),Ie=n(64),Se=n(181),Ee=n(79),ze=n(1786),Le=n(171),De=n(1274),Me=["children"],Re=["showConfirm"],Ge=["sortType"],Fe=["liked","disabled","onClick"];function Pe(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ke(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ke(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,c=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw c}}}}function Ne(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return Ke(t,void 0!==n&&n<r?n:r)}return e(t,n)}function Ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function He(e,t){var n=Object(C.useRef)(),r=Object(C.useRef)(),o=Object(C.useState)({}),c=Ne(x.a,o,2)[1],i=Object(T.a)((function(e){e!==r.current&&(r.current="function"==typeof e?e(r.current):e,c({}))}));return function(e,t){return!e||!t||e.length!==t.length||e.some((function(e,n){return e!==t[n]}))}(n.current,t)&&(n.current=t,r.current=e()),[r.current,i]}var _e=function(e){var t=e.isOpen,n=e.title,r=e.content,o=e.onOK,c=e.onCancel;return Object(y.b)(P.a,{title:n,closeButton:" ",maskClosable:!1,hotKeyClosable:!1,children:t&&Object(y.c)(y.a,{children:[Boolean(r)&&Object(y.b)(I.Text,{textAlign:"center",mb:"-15px",children:r}),Object(y.c)(N.a,{direction:"horizontal",children:[Object(y.b)(K.a,{onClick:c,children:"取消"}),Object(y.b)(K.a,{preset:"primary",color:"blue",onClick:o,children:"确定"})]})]})})},Ue="https://www.zhihu.com/api/v4/comment_v5",Ze=function(e){var t,n;return(null===(n=null===(t=e.payload)||void 0===t?void 0:t.error)||void 0===n?void 0:n.message)||e.statusMessage||e.message},We=new Z.b.Entity("comments"),Ve=new Z.b.Array(We);We.define({childComments:Ve});var qe,Je,Xe=function(e){return Object(Z.a)(e,Ve)},Ye=function(e){return{elementLocation:{block:{blockText:e}}}},$e=function(e){var t=e.Mobile,n=e.ZhihuHybrid;return t&&!n},Qe={root:"root_comment",sub:"child_comment",collapsed:"collapse_comments",reviewing:"reviewing_comments",anchor:"anchor_comment"},et=function(e){var t=e.resourceId,n=e.resourceType,r=e.onError,o=e.children,c=Object(U.b)(),i=Object(L.d)().cache,a=Object(C.useMemo)((function(){return function(e,t){return function(n){return function(r,o,c){return Array.isArray(r)?n([e,t].concat(Ne(j.a,r)),o,c):n(r,o,c)}}}(n,t)}),[n,t]),s=Object(T.a)((function(e,r,o,c,a){var s,l,u=Object(L.c)([n,t,e,r,o]),d="".concat(u).concat(JSON.stringify(c||""),","),b=Pe(i.keys(),!0);try{for(b.s();!(l=b.n()).done;){var p=l.value;p.startsWith(u)&&p!==d&&function(){var e=(null===(s=i.get(p))||void 0===s?void 0:s.entities)||{};a.data=a.data.filter((function(t){return!e[t.id]}))}()}}catch(e){b.e(e)}finally{b.f()}})),l=Object(T.a)(function(){var e=O()(f.a.mark((function e(t,n,o,i,a,l){var u,d,b,p,h;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u="sub"!==o&&"anchor"!==o||!a?"".concat(t,"s/").concat(n):"comment/".concat(a),e.next=4,c("".concat(Ue,"/").concat(u,"/").concat(Qe[o]),{query:{order_by:i,limit:20,offset:l}});case 4:return d=e.sent,s(o,i,a,l,d),b=Xe(d.data),p=b.result,h=b.entities,d.data=p||[],d.entities=h.comments||{},e.abrupt("return",d);case 12:throw e.prev=12,e.t0=e.catch(0),null==r||r("commentFetchError",Ze(e.t0)),e.t0;case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n,r,o,c,i){return e.apply(this,arguments)}}());return Object(y.b)(L.a,{value:{use:[a],fetcher:l,revalidateOnFocus:!1,errorRetryCount:3},children:o})},tt=Object(C.createContext)({}),nt=function(e){var t=e.children,n=p()(e,Me),r=n.resourceType,o=n.resourceId,c=n.onError,i=Object(B.b)().ZhihuHybrid,a=function(){var e=Object(C.useState)({isOpen:!1,title:""}),t=Ne(x.a,e,2),n=t[0],r=n.isOpen,o=n.title,c=n.content,i=t[1],a=Object(B.b)().ZhihuHybrid,s=Object(C.useRef)(),l=Object(T.a)((function(e,t){return a?Object(F.a)("ui/showAlert").dispatch({title:e,content:t,affirm:"确定",dismiss:"取消"}).then((function(e){return"AFFIRM"===e.result})):(i({isOpen:!0,title:e,content:t}),new Promise((function(e){s.current=e})))}));return{isOpen:r,title:o,content:c,onOK:Object(T.a)((function(){var e;i({isOpen:!1,title:""}),null===(e=s.current)||void 0===e||e.call(s,!0),s.current=void 0})),onCancel:Object(T.a)((function(){var e;i({isOpen:!1,title:""}),null===(e=s.current)||void 0===e||e.call(s,!1),s.current=void 0})),showConfirm:l}}(),s=a.showConfirm,l=p()(a,Re),u=Object(C.useMemo)((function(){var e=n.onMessage,t=n.onError;return i&&(e=e||function(e){Object(F.a)("ui/showToast").dispatch({text:e})},t=t||function(e,t){Object(F.a)("ui/showToast").dispatch({text:t||e,icon:"fail"})}),Object.assign(Object.assign({showConfirm:s},n),{},{onMessage:e,onError:t})}),Object.values(n));return r&&o?Object(y.c)(tt.Provider,{value:u,children:[Object(y.b)(et,{resourceType:r,resourceId:o,onError:c,children:t}),i||Object(y.b)(_e,Object.assign({},l))]}):null},rt=function(){return Object(C.useContext)(tt)},ot=k.a.createContext({push:G.a,pop:G.a,changeLayerData:G.a,layers:[]}),ct=k.a.createContext({}),it=function(e){var t=e.children,n=rt(),r=n.shown,o=n.displayType,c=n.anchorCommentId,i=n.onClose,a=He((function(){if(!r)return[];var e=[{index:0,sortType:"score",commentType:"root",displayType:o}];return c&&e.push({index:1,sortType:"score",commentType:"anchor",displayType:"modal",fetchCommentId:c}),e}),[r,o,c]),s=Ne(x.a,a,2),l=s[0],u=s[1],d=Object(T.a)((function(e){var t=e.sortType,n=p()(e,Ge);u((function(e){return[].concat(Ne(j.a,e),[Object.assign({index:e.length,sortType:t||"score",displayType:"modal"},n)])}))})),b=Object(T.a)((function(e){1===l.length?null==i||i():u("number"==typeof e?function(t){return t.slice(0,e+1)}:function(e){return e.slice(0,e.length-1)})})),h=Object(T.a)((function(e,t){u(Object(M.b)((function(n){n[t]=Object.assign(Object.assign({},n[t]),e)})))})),f={layers:l,push:d,pop:b,changeLayerData:h};return Object(y.b)(ot.Provider,{value:f,children:t})},at=function(){return Object(C.useContext)(ot)},st=Object(C.memo)((function(e){var t=e.data,n=e.children,r=at(),o=r.changeLayerData,c=Object(T.a)((function(e){o(e,t.index)})),i=Object(T.a)((function(){return t.index===r.layers.length-1}));return t&&n?Object(y.b)(ct.Provider,{value:Object.assign(Object.assign({},t),{},{changeLayerData:c,isTopLayer:i,router:r}),children:n}):null})),lt=function(){return Object(C.useContext)(ct)},ut=function(e,t){var n=lt(),r=n.displayType,o=n.commentType,c=n.sortType,i=n.fetchCommentId;return Object(L.b)([o,c,i,e],Object.assign({revalidateIfStale:Boolean("list"===r||(null==t?void 0:t.isInfinitePage))},t))},dt=function(e,t){var n=e.data,r=e.customFetchKey,o=t.changePageData,c=t.sharedData;return o((function(e){var t;e.entities[n.id]=n,e.data.unshift(n.id),e.counts.totalCounts+=1,null===(t=c.onMessage)||void 0===t||t.call(c,"评论发布成功！")}),void 0,r)},bt=function(e,t){var n=t.pageOffset,r=t.layer,o=t.changePageData,c=r.commentType,i=r.sortType;""!==n&&o(e,void 0,[c,i,void 0,""])},pt=function(){var e=O()(f.a.mark((function e(t,n){var r,o,c,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,o=t.replyCommentId,c=t.customFetchKey,e.next=3,n.changePageData((function(e){e.entities[r.id]=r;var t=e.entities[o].replyRootCommentId,c=e.entities[t];e.counts.totalCounts+=1,t===o?(c.childComments.unshift(r.id),c.childCommentCount+=1):"root"===n.layer.commentType?c.childComments.splice(c.childComments.indexOf(o)+1,0,r.id):e.data.splice(e.data.indexOf(o)+1,0,r.id)}),void 0,c);case 3:null===(a=(i=n.sharedData).onMessage)||void 0===a||a.call(i,"评论发布成功！"),bt((function(e){e.counts.totalCounts+=1}),n);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ht=function(e){var t=e.layer;(0,e.changePageData)(void 0,void 0,["root",t.router.layers[0].sortType,void 0,""],!0)},ft=function(e,t){var n=e.id,r=e.type,o=t.changePageData,c=t.fetcher,i=t.sharedData;return o(function(){var e=O()(f.a.mark((function e(t){var o,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.entities[n]["".concat(r,"d")],e.next=3,c("".concat(Ue,"/comment/").concat(n,"/reaction/").concat(r),{method:a?"PUT":"DELETE"});case 3:"dislike"===r&&(null===(o=i.onMessage)||void 0===o||o.call(i,a?"已踩评论":"已取消踩"));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){var t=e.entities[n];if("like"===r)t.liked=!t.liked,t.disliked&&(t.disliked=!t.liked),t.likeCount+=t.liked?1:-1;else{t.disliked=!t.disliked;var o=t.liked;t.liked&&(t.liked=!t.disliked),o!==t.liked&&(t.likeCount+=t.liked?1:-1)}}))},mt=function(e,t){return ft({id:e,type:"like"},t)},Ot=function(e,t){return ft({id:e.id,type:"dislike"},t)},gt=function(){var e=O()(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=Number(Y.a.get("zhihu::comment_replace_top_count"))||0)>=3)){e.next=3;break}return e.abrupt("return",!0);case 3:return Y.a.set("zhihu::comment_replace_top_count",n+1),e.next=6,t("确定替换已置顶的评论？","当前已有置顶评论，你只能置顶一条评论");case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),jt=function(){var e=O()(f.a.mark((function e(t,n){var r,o,c,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.commentData,o=t.alreadyToppedId,c=n.changePageData,i=n.fetcher,a=n.layer,e.abrupt("return",c(function(){var e=O()(f.a.mark((function e(t){var n,c,a,s,l,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=7;break}return n=t.entities[o],e.next=4,i("".concat(Ue,"/comment/").concat(o));case 4:(c=e.sent).childComments=n.childComments,t.entities[o]=c;case 7:a=Xe([r]),s=a.result,l=a.entities,u=t.data.findIndex((function(e){return t.entities[e].top})),t.data.splice(u+1,0,s[0]),t.entities=Object.assign(Object.assign({},t.entities),l.comments);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),void 0,["root",a.sortType,void 0,""]));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),vt=function(){var e=O()(f.a.mark((function e(t,n){var r,o,c,i,a,s,l,u,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.changePageData,c=n.getCache,i=n.sharedData,a=n.fetcher,s=n.layer,e.next=3,o(function(){var e=O()(f.a.mark((function e(n){var r,o,b,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.entities[t],o=r.isAuthorTop){e.next=12;break}if(b=c(["root",s.sortType,void 0,""]),u=null==b?void 0:b.data.find((function(e){return b.entities[e].isAuthorTop})),e.t0=u,!e.t0){e.next=10;break}return e.next=9,gt(i.showConfirm);case 9:e.t0=!e.sent;case 10:if(!e.t0){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,a("".concat(Ue,"/comment/").concat(t,"/operation/top"),{method:o?"DELETE":"PUT"});case 14:p=e.sent,o?(p.childComments=r.childComments,n.entities[t]=p):(r.childComments.forEach((function(e){delete n.entities[e]})),delete n.entities[t],n.data=n.data.filter((function(e){return t!==e})),l=p),d=o?"已取消置顶":"已置顶";case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:l&&jt({commentData:l,alreadyToppedId:u},n),d&&(null===(r=i.onMessage)||void 0===r||r.call(i,d));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),xt=function(){var e=O()(f.a.mark((function e(t,n){var r,o,c,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,o=n.fetcher,c=n.changePageData,i=n.sharedData,e.next=4,i.showConfirm("你确定要删除这条评论吗？");case 4:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,c(function(){var e=O()(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o("".concat(Ue,"/comment/").concat(r),{method:"DELETE"});case 2:t.entities[r].isDelete=!0;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),yt=function(e,t){var n=e.id,r=t.fetcher;return(0,t.changePageData)(function(){var e=O()(f.a.mark((function e(t){var o,c,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.entities[n],c=o.hot,e.next=4,r("".concat(Ue,"/comment/").concat(n,"/operation/hot"),{method:c?"DELETE":"PUT"});case 4:(i=e.sent).childComments=o.childComments,t.entities[n]=i;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},Ct=function(){var e=O()(f.a.mark((function e(t,n){var r,o,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,o=n.changePageData,c=n.fetcher,e.next=4,o(function(){var e=O()(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.entities[r].collapsed,e.next=3,c("".concat(Ue,"/comment/").concat(r,"/operation/collapse"),{method:n?"DELETE":"PUT"});case 3:n?(delete t.entities[r],t.data=t.data.filter((function(e){return e!==r})),t.counts.totalCounts-=1):t.entities[r].collapsed=!0;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:bt((function(e){e.counts.totalCounts-=1}),n),ht(n);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),kt=function(){var e=O()(f.a.mark((function e(t,n){var r,o,c,i,a,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.changePageData,o=n.fetcher,e.next=3,o("".concat(Ue,"/comment/").concat(t,"/child_comment"));case 3:return c=e.sent,i=Xe(c.data),a=i.entities.comments,s=i.result,e.abrupt("return",r((function(e){var n=e.entities[t];e.entities=Object.assign(Object.assign({},e.entities),a),n.childComments=J()(n.childComments,s)})));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Tt=function(e,t){t.sharedData.onReport(e)},wt=function(){var e=O()(f.a.mark((function e(t,n){var r,o,c,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.sharedData,o=n.fetcher,e.next=3,r.showConfirm("确定屏蔽该用户吗？","屏蔽后，对方将不能关注你、向你发私信、评论你的实名回答、使用「@」提及你、邀请你回答问题，但仍然可以查看你的公开信息。");case 3:if(!e.sent){e.next=9;break}return a=t.author.urlToken,e.next=7,o("https://www.zhihu.com/api/v4/members/".concat(encodeURIComponent(a),"/actions/block"),{method:"POST"});case 7:null===(c=r.onMessage)||void 0===c||c.call(r,"屏蔽成功"),null===(i=r.onUserBlocked)||void 0===i||i.call(r,t.author);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),At=function(e,t){var n,r=t.sharedData,o=document.createElement("span");o.innerHTML=e.content,V()(o.innerText),null===(n=r.onMessage)||void 0===n||n.call(r,"已复制到剪贴板")},Bt={addComment:dt,replyComment:pt,toggleLike:mt,toggleDislike:Ot,toggleAuthorTop:vt,toggleHot:yt,toggleCollapse:Ct,deleteComment:xt,reviewComment:function(){var e=O()(f.a.mark((function e(t,n){var r,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.changePageData,o=n.fetcher,e.next=3,r(function(){var e=O()(f.a.mark((function e(n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o("".concat(Ue,"/comment/").concat(t,"/operation/approve"),{method:"PUT"});case 2:delete n.entities[t],n.data=n.data.filter((function(e){return e!==t})),n.counts.totalCounts-=1;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:bt((function(e){e.counts.totalCounts-=1}),n),ht(n);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),expandChildComments:kt,report:Tt,block:wt,copy:At},It=function(){var e=O()(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n("".concat(Ue,"/comment/").concat(t)));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),St={changeComment:function(){var e=O()(f.a.mark((function e(t,n){var r,o,c,i,a,s,l,u,b,p,h,m,O,g;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.type,o=t.data,c=n.layer,i=n.changePageData,a=n.fetcher,e.t0=r,e.next="addComment"===e.t0?5:"replyComment"===e.t0?10:"changeComment"===e.t0?18:26;break;case 5:return e.next=7,It(o.commentId,a);case 7:return s=e.sent,dt({data:s,customFetchKey:[c.commentType,c.sortType,void 0,""]},n),e.abrupt("return");case 10:if(l=o.commentId,u=o.replyCommentId,!qe||qe.id!==u){e.next=17;break}return b=qe.key,e.next=15,It(l,a);case 15:p=e.sent,pt({replyCommentId:u,data:p,customFetchKey:b},n);case 17:return e.abrupt("return");case 18:if(Je){e.next=20;break}return e.abrupt("return");case 20:return m=(h=Je).id,O=h.key,e.next=23,It(m,a);case 23:return g=e.sent,i((function(e){var t=e.entities[m];g.childComments=t.childComments,g.childCommentCount=t.childCommentCount,e.entities=Object.assign(Object.assign({},e.entities),{},d()({},m,g))}),void 0,O),e.abrupt("return");case 26:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),clearWaiting:function(){qe=void 0,Je=void 0},replyComment:function(e,t){var n=e.replyCommentId,r=e.pageOffset,o=t.getCache,c=t.sharedData,i=t.layer,a=c.resourceType,s=c.resourceId,l=[i.commentType,i.sortType,i.fetchCommentId,r];qe={key:l,id:n};var u=o(l),d=null==u?void 0:u.entities[n];if(d){var b=new URLSearchParams(Object(ee.decamelizeKeys)({replyCommentId:n,replyAuthorName:d.author.name})).toString().replace(/\+/g,"%20");Object(F.a)("base/openURL").dispatch({url:"".concat("zhihu://comment/editor","/").concat(a,"/").concat(s,"?").concat(b)})}},toggleLike:mt,toggleDislike:Ot,toggleAuthorTop:vt,toggleHot:yt,toggleCollapse:Ct,deleteComment:xt,expandChildComments:kt,showCommentList:function(e,t){var n=e.commentType,r=e.rootCommentId,o=e.pageOffset,c=t.sharedData,i=t.layer,a=c.resourceType,s=c.resourceId;if(r){var l=i.sortType,u=i.fetchCommentId;Je={key:[i.commentType,l,u,o],id:r}}var d=new URLSearchParams(Object(ee.decamelizeKeys)(Q()({listType:n,isChild:Boolean(r),rootCommentId:r},Boolean)));Object(F.a)("base/openURL").dispatch({url:"".concat("https://www.zhihu.com/comment/list","/").concat(a,"/").concat(s,"?").concat(d.toString())})},report:Tt,block:wt,copy:At},Et=function(e,t){var n,r=t.sharedData;null===(n=r.openInApp)||void 0===n||n.call(r)},zt={addComment:Et,replyComment:Et,toggleLike:Et,toggleDislike:Et,toggleAuthorTop:Et,toggleHot:Et,toggleCollapse:Et,deleteComment:Et,reviewComment:Et,expandChildComments:Et,report:Et,showCommentList:Et,block:wt,copy:At},Lt=function(){var e=Object(U.b)(),t=rt().onError;return Object(T.a)(O()(f.a.mark((function n(){var r,o=arguments;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.apply(void 0,o);case 3:return n.abrupt("return",n.sent);case 6:throw n.prev=6,n.t0=n.catch(0),r=n.t0,null==t||t("commentActionError",Ze(r),r),n.t0;case 11:case"end":return n.stop()}}),n,null,[[0,6]])}))))},Dt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Object(B.b)(),n=t.ZhihuHybrid,r=t.Mobile,o=Object(L.d)(),c=o.mutate,i=o.cache,a=Lt(),s=lt(),l=rt(),u=l.resourceType,d=l.resourceId,b=s.commentType,p=s.sortType,h=s.fetchCommentId,f=Object(T.a)((function(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return c(r?[u,d].concat(Ne(j.a,r)):[u,d,b,p,h,e],t&&Object(M.a)(t),{optimisticData:n&&Object(M.a)(n),revalidate:o,populateCache:!n,rollbackOnError:!0})})),m=Object(T.a)((function(t){return i.get(Object(L.c)(t?[u,d].concat(Ne(j.a,t)):[u,d,b,p,h,e]))}));return Object(T.a)((function(t,o){var i={changePageData:f,layer:s,fetcher:a,mutate:c,getCache:m,pageOffset:e,sharedData:l};return"string"==typeof t?(r?n?St:zt:Bt)[t](o,i):t(i)}))},Mt={1:"评论区已关闭",2:"评论内容由作者筛选后展示",3:"因作者设置，评论区已关闭"},Rt=function(e){var t=e.noComments,n=e.type,r=void 0===n?0:n,o=Object(B.b)().Mobile,c=lt(),i=c.displayType,a=c.commentType,s="list"===i?{height:o?"168px":"400px"}:{height:"100%"};if(t){var l="root"===a||"sub"===a;return Object(y.b)(te.a.EI1,{image:"noWorks",content:l?"还没有评论，发表第一个评论吧":"无内容",preset:o?"compact":"normal",css:s})}return Object(y.b)(te.a.EI1,{image:"contentError",content:Mt[r],preset:o?"compact":"normal",css:s})},Gt=Object(C.createContext)(G.a),Ft=function(e){var t=e.pageOffset,n=e.isResourceAuthor,r=e.children,o=Object(B.b)().ZhihuHybrid,c=Object(C.useState)(!1),i=Ne(x.a,c,2),a=i[0],s=i[1],l=Object(C.useState)(),u=Ne(x.a,l,2),d=u[0],b=u[1],p=Object(C.useState)([]),h=Ne(x.a,p,2),m=h[0],g=h[1],j=Object(C.useRef)(),v=lt().displayType,k=rt().authorInfo,w=Dt(t),A=Object(T.a)((function(e,t,n,r){var o;null===(o=j.current)||void 0===o||o.trackEvent({eventType:"Click",action:"report"===t?"Report":void 0,elementLocation:{type:"Text",content:{type:"Comment",id:r},text:e,block:{blockText:n}}})})),E=Object(T.a)(function(){var e=O()(f.a.mark((function e(t,n){var r,c,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n.id,i="modal"===v?"comment_popup":"comment_list",null===(r=j.current)||void 0===r||r.trackEvent({eventType:"Click",action:"Expand",elementLocation:{type:"Button",content:{type:"Comment",id:c},text:m.map((function(e){return Ne(x.a,e,1)[0]})).join(" "),block:{blockText:i}}}),!o){e.next=10;break}return e.next=6,Object(F.a)("ui/showActionSheet").dispatch({items:t.map((function(e){var t=Ne(x.a,e,2),n=t[0];return{id:t[1],text:n,data:{text:n}}}))});case 6:(a=e.sent).id&&(A(a.data.text,a.id,i,c),w(a.id,n)),e.next=12;break;case 10:g(t.map((function(e){var t=Ne(x.a,e,2),r=t[0],o=t[1];return[r,function(){s(!1),A(r,o,i,c),w(o,n)}]}))),s(!0);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),z=Object(T.a)((function(e,t){if(a)s(!1);else{b(e);var r=t.author,o=t.isAuthor,c=t.disliked,i=t.hot,l=t.collapsed,u=t.canDislike,d=t.canHot,p=t.canCollapse,h=t.canDelete,f=r.id===(null==k?void 0:k.id)&&o,m=[!f&&["屏蔽","block"],!f&&["举报","report"],!f&&u&&[c?"取消踩":"踩评论","toggleDislike"],n&&d&&[i?"取消推荐":"推荐为热门","toggleHot"],n&&p&&[l?"取消折叠":"折叠评论","toggleCollapse"],(n||f)&&h&&["删除评论","deleteComment"],["复制","copy"]].filter(Boolean);E(m,t)}})),L=Object(T.a)((function(){s(!1)}));return Object(y.c)(y.a,{children:[Object(y.b)(Gt.Provider,{value:z,children:r}),Object(y.b)(S.e,{ref:j}),o||Object(y.b)(H.a,{globalClose:!0,placement:"bottom",target:d,isOpen:a,onClose:L,children:Object(y.b)(I.Box,{py:"5px",children:m.map((function(e){var t=Ne(x.a,e,2),n=t[0],r=t[1];return Object(y.b)(I.Flex,{onClick:r,alignItems:"center",justifyContent:"center",width:"95px",height:"40px",fontSize:"14px",color:"GBL05A",sx:{cursor:"pointer",":hover":{background:"GBK10A"}},children:n},n)}))})})]})},Pt=Object(C.createContext)({}),Nt=function(e){var t=e.data,n=e.children;return Object(y.b)(Pt.Provider,{value:t,children:n})},Kt={score:"默认",ts:"时间"},Ht={root:function(e){return e.totalCounts?"".concat(e.totalCounts," 条评论"):"暂无评论"},sub:function(){return"评论回复"},collapsed:function(e){return e.totalCounts?"".concat(e.totalCounts," 条已折叠评论"):"暂无评论"},reviewing:function(e){return e.totalCounts?"".concat(e.totalCounts," 条待筛选评论"):"暂无评论"},anchor:function(){return"返回评论"}},_t=function(e){var t=e.title,n=e.children,r=Object(B.b)().Mobile;return Object(y.c)(I.Flex,{flex:"0 0 auto",px:r?0:"20px",height:r?"31px":"50px",alignItems:"center",justifyContent:"space-between",sx:r?null:Object(re.a)({borderBottom:"1px solid",borderBottomColor:"GBK09A"}),children:[Object(y.b)(I.Text,{fontSize:"15px",color:"GBK03A",fontWeight:"bold",children:t}),n]})},Ut=Object(C.memo)((function(e){var t=e.title,n=e.counts,r=e.onChangeSortType,o=rt(),c=o.targetLink,i=o.hideSort,a=o.onClose,s=o.displayType,l=o.openInApp,u=lt(),d=u.commentType,b=u.index,p=u.sortType,h=u.changeLayerData,f=u.router,m=Object(B.b)(),O=m.Mobile,g=m.ZhihuHybrid,j="modal"===s?b>0:b>1,v="modal"===s,x=t||Object(y.c)(I.Text,{onClick:j?f.pop.bind(void 0,void 0):void 0,css:{cursor:j?"pointer":"default"},children:[j&&Object(y.b)(ae.b,{center:!0,size:24}),Ht[d](n||{})]});return Object(y.c)(_t,{title:x,children:[0===b&&Object(y.b)(I.Flex,{flex:"1 1 auto",children:c}),Boolean(!i&&n&&"root"===d)&&Object(y.b)(I.Flex,{fontSize:"12px",lineHeight:"24px",fontWeight:"bold",bg:"GBK10A",sx:{border:"2px solid",borderColor:"GBK10A",borderRadius:"3px"},children:["score","ts"].map((function(e){return Object(y.b)(S.a,{as:I.Box,zaType:"Button",zaText:!0,view:Ye("sort"),width:"50px",height:"24px",bg:e===p?"GBK99A":"transparent",sx:{color:p===e?"GBK02A":"GBK05A",borderRadius:"2px",textAlign:"center",cursor:"pointer"},onClick:function(){$e({Mobile:O,ZhihuHybrid:g})?null==l||l():(null==r||r(e),h({sortType:e,prevLayerOffset:void 0}))},children:Kt[e]},e)}))}),O&&v&&Object(y.b)(K.a,{preset:"outline",css:{padding:"12px",border:"0",lineHeight:"normal"},"aria-label":"关闭",onClick:function(){null==a||a()},children:Object(y.b)(se.b,{size:24,css:{verticalAlign:"top",fill:"GBK99B"}})})]})})),Zt=function(e){var t=e.id,n=e.urlToken,r=e.children,o=Object(B.b)().Mobile,c=rt().userHoverCard;return o||!c?r:Object(y.b)(c,{id:t,urlToken:n,toggler:k.a.cloneElement(r,{key:t})})},Wt=function(e){var t=e.medalAvatarFrame;return Object(y.b)("div",{css:{position:"absolute",width:"44px",height:"44px",pointerEvents:"none",top:"-7px",left:"-7px"},children:Object(y.b)(I.Image,{alt:"头像挂件",src:t})})},Vt=Object(C.memo)((function(e){var t=e.user,n=t.avatarUrl,r=t.isOrg,o=t.id,c=t.name,i=t.exposedMedal,a="0"===o||""===o,s=Object(B.b)(),l=s.Mobile,u=s.ZhihuHybrid,d=Object(y.b)(we.b,{url:a?we.a:n,alt:c,size:l?30:24,round:l,css:Object.assign(Object.assign({},Object(oe.a)()),{},{flex:"0 0 auto"}),loading:"lazy"}),b=rt().openInApp,p=Object(T.a)((function(e){$e({Mobile:l,ZhihuHybrid:u})&&(e.preventDefault(),null==b||b())}));return a?d:Object(y.b)(I.Box,{flex:"0 0 auto",children:Object(y.b)(Zt,{id:o,children:Object(y.c)(Ae.b,{href:"https://www.zhihu.com/".concat(r?"org":"people","/").concat(o),target:"_blank",zaType:"Button",zaText:"头像",css:{height:l?"30px":"24px",width:l?"30px":"24px",display:"block",position:"relative"},onClick:p,children:[d,u&&(null==i?void 0:i.medalAvatarFrame)&&Object(y.b)(Wt,{medalAvatarFrame:i.medalAvatarFrame})]})})})})),qt=Object(C.createContext)([]),Jt=function(e){var t=e.children,n=Object(C.useState)([]),r=Ne(x.a,n,2),o=r[0],c=r[1];return Object(C.useEffect)((function(){Object(Be.c)().then((function(e){c(e)}))}),[]),Object(y.b)(qt.Provider,{value:o,children:t})},Xt=function(){return Object(C.useContext)(qt)},Yt=function(e){var t=e.className,n=e.height,r=e.width,o=e.url,c=e.onClick,i=Object(C.useMemo)((function(){return function(e,t){var n=parseInt(t,10)||120,r=parseInt(e,10)||120,o=Math.max(120,Math.min(202,r)),c=Math.max(120,Math.min(202,n)),i=Math.min(Math.max(r/n,.5),2);return{width:i>1?o:c*i,height:i>1?o/i:c,ratio:i}}(r,n)}),[r,n]),a=i.width,s=i.height,l=i.ratio,u=Object(C.useMemo)((function(){return o.endsWith("gif")?[o,o]:[Object(Ie.imgUrl)(o,"xld"),Object(Ie.imgUrl)(o,"")]}),[o]),d=Ne(x.a,u,2),b=d[0],p=d[1],h=Object(T.a)((function(e){null==c||c(e,p)}));return Object(y.b)(I.Box,{width:a,height:s,sx:{backgroundColor:"GBK10B",position:"relative",borderRadius:"8px"},className:t,children:Object(y.b)("img",{alt:"",src:b,"data-rawwidth":r||a,"data-rawheight":n||a,"data-original":p,css:{width:"100%",height:"100%",borderRadius:"8px",objectFit:"cover",cursor:"zoom-in",objectPosition:l<1?"center top":"unset",".comment_sticker &":{cursor:"default"}},loading:"lazy",onClick:h})})},$t=function(e){var t=e["data-height"],n=e["data-rawheight"],r=e["data-width"],o=e["data-rawwidth"],c=e["data-original"],i=e.className,a=e.href,s=Object(B.b)().ZhihuHybrid,l=rt().onShowImage,u=Object(T.a)((function(e,t){(null==i?void 0:i.match("comment_sticker"))||(s&&!l?Object(F.a)("base/openImage").dispatch({images:[t]}):null==l||l(t,e.currentTarget))}));return Object(y.b)(Yt,{height:t||n,width:r||o,url:a||c,css:{marginTop:"12px"},className:i,onClick:u})},Qt=function(e){var t=e.href,n=e["data-hash"],r=e.children;return Object(y.b)(Zt,{id:n,children:Object(y.b)(Ae.b,{href:t,target:"_blank",className:"member_mention",children:r})})},en=function(e){return Object(y.b)(Ae.b,Object.assign(Object.assign({},e),{},{target:"_blank"}))},tn=function(e){var t=e.children;return Object(y.b)(y.a,{children:t})},nn=function(e,t){return Object(Be.a)(e,{convertEmoticon:!0,emoticonList:t,traverseCallback:function(e,t){if(e.nodeType===Node.ELEMENT_NODE){var n=e.classList,r=e.textContent;if(n.contains("member_mention"))return t(Qt);if(n.contains("comment_img")||n.contains("comment_gif")||n.contains("comment_sticker")||n.contains("origin_image"))return t($t);if(null==r?void 0:r.match("http"))return t("A"===e.tagName?en:void 0);if("FIGURE"===e.tagName)return t(tn)}return t()}})},rn=function(e){var t=e.data,n=e.commentType,r=Xt(),o=t.content,c=t.isDelete,i=t.collapsed,a=Object(C.useMemo)((function(){if("collapsed"!==n){if(c)return[!0,"该条评论已删除"];if(i)return[!0,"该条评论被折叠"]}else if("collapsed"===n&&c)return[!0,"该条评论已删除"];return[!1,nn(o,r)]}),[n,c,i,o,r]),s=Ne(x.a,a,2),l=s[0],u=s[1];return Object(y.b)(I.Text,{className:"CommentContent",mt:"4px",fontSize:"15px",lineHeight:"21px",sx:{color:l?"GBL05A":"GBK03A",overflowWrap:"break-word",p:{margin:0},".sticker":{width:"20px",height:"20px",marginBottom:"-4px"},".member_mention":{color:"GBL07A"},"a.internal,a.external":{textDecoration:"none",color:"GBK03A",borderBottom:"1px solid",borderColor:"GBK03A",":hover":{color:"GBL07A",borderBottom:"1px solid",borderColor:"GBL07A"},".invisible":{display:"none"},".ellipsis::after":{content:'"..."'}}},children:u})},on=Object(C.memo)((function(e){var t=e.text;return Object(Be.d)(t)})),cn=function(e){var t=e.data,n=e.responseLink,r=e.richText,o=e.className,c=Object(ce.a)(),i=c.colors,a=i.GBK06A,s=i.GBK08A,l=i.GBL01A,u=c.isDarkMode,d=t.text,b=t.color,p=t.nightColor,h=t.hasBorder,f=t.borderColor,m=t.borderNightColor,O=t.targetLink,g=n&&O,j=g?Ae.b:"span";return Object(y.c)(j,{css:Object.assign(Object.assign(Object.assign({},h&&Object.assign(Object.assign({},Object(re.a)({border:"1px solid ".concat((u?m:f)||s),borderRadius:"4px"})),{},{padding:"0 4px"})),{},{color:(u?p:b)||a},g&&{textDecoration:"none"}),{},{height:"16px",fontSize:"12px",lineHeight:"16px",boxSizing:"border-box","& a":{color:l,textDecoration:"none"}}),className:o,href:g?O:"",children:[r?Object(y.b)(on,{text:d}):d,Boolean(O)&&Object(y.b)(le.b,{css:{fill:b,marginRight:"-2px"},center:!0,size:12})]})},an=function(e){var t=e.data,n=Object(B.b)().Mobile,r=Object(ce.a)().isDarkMode,o=rt().onNeedVip;if(!t)return null;var c=t.vipIcon,i=(c=void 0===c?{}:c).url,a=c.nightModeUrl,s=t.isVip;return i&&s?Object(y.b)(I.Image,{src:r?a:i,size:n?14:16,css:{cursor:"pointer",marginLeft:"4px"},onClick:function(){o("vip_badge")}}):null},sn=function(e){var t=e.user,n=Object(B.b)(),r=n.Mobile,o=n.ZhihuHybrid,c=t.id,i=t.name,a=t.isOrg,s="0"===c||""===c,l=function(e){return{fontSize:r?"14px":"15px",fontWeight:"bold",textDecoration:"none",color:e.colors.GBK03A,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},u=rt().openInApp,d=Object(T.a)((function(e){$e({Mobile:r,ZhihuHybrid:o})&&(e.preventDefault(),null==u||u())})),b=Object(T.a)((function(e){r&&e.stopPropagation()}));return s?Object(y.b)("span",{onTouchEnd:b,css:l,children:i}):Object(y.b)(Zt,{id:c,children:Object(y.b)(Ae.b,{href:"https://www.zhihu.com/".concat(a?"org":"people","/").concat(c),target:"_blank",css:l,onClick:d,children:i})})},ln=function(e){var t=e.user,n=e.authorTag,r=e.isReplyTo,o=t.badge,c=t.badgeV2,i=t.vipInfo,a=Object(B.b)().Mobile;return Object(y.c)(I.Flex,{alignItems:"center",height:"16px",children:[Object(y.b)(sn,{user:t}),Boolean(r)||Object(y.c)(I.Flex,{alignItems:"center",justifyContent:"stretch",flexWrap:"wrap",flex:"1 999999 auto",css:{maxHeight:"30px",overflow:"hidden"},children:[Object(y.b)("div",{css:{height:"30px"}}),null==n?void 0:n.map((function(e){return Object(y.b)(cn,{data:e,css:{marginLeft:"4px",fontSize:a?"10px":"12px"}},e.text)})),Object(y.b)(Se.c,{size:a?16:18,badge:null!=c?c:o,css:{marginLeft:"4px",flexShrink:0}}),Object(y.b)(an,{data:i})]})]})},un=function(e){var t=e.onClick,n=rt().authorInfo;return(null==n?void 0:n.id)?Object(y.b)(ue.d,{size:16,css:{margin:"2px",cursor:"pointer",flexShrink:0},onClick:t}):null},dn=function(e){var t=e.id,n=e.author,r=e.childComments,o=e.childCommentCount,c=e.pageOffset,i=e.onAction,a=Object(ce.a)().colors.GBL05A,s=Object(B.b)().Mobile,l=o>(null==r?void 0:r.length),u=o<=5,d=Object(T.a)((function(){u?i("expandChildComments",t):s?i("showCommentList",{rootCommentId:t,pageOffset:c}):i((function(e){e.layer.router.push({commentType:"sub",sortType:"ts",fetchCommentId:t,rootCommentAuthor:n,prevLayerOffset:c})}))}));return l?Object(y.c)(S.a,{as:K.a,shouldTrackShow:!0,zaType:"Block",zaAction:"Expand",view:Ye("show_reply"),preset:"secondary",color:"grey",onClick:d,css:s?function(e){return{margin:"10px 0 10px 54px",padding:"0 10px 0 16px",fontSize:"12px",borderRadius:"14px",height:"28px",lineHeight:"28px",background:e.colors.GBK10A,color:e.colors.GBK03A,svg:{marginBottom:"1px"}}}:{margin:"10px 0 10px 54px",padding:"0 6px 0 12px",height:"32px",color:a,fontWeight:500,svg:{marginBottom:"1px"}},children:[u?"展开其他 ".concat(o-r.length," 条回复"):"查看全部 ".concat(o," 条回复"),Object(y.b)(de.b,{center:!0,size:s?20:24})]}):null},bn=function(e){var t=e.data,n=t.author,r=t.authorTag,o=t.replyToAuthor,c=t.replyAuthorTag;return Object(y.c)(I.Flex,{alignItems:"center",flex:"0 1 auto",children:[Object(y.b)(ln,{user:n,authorTag:r}),o&&Object(y.b)(be.a,{size:12,css:{margin:"0 4px",flexShrink:0}}),o&&Object(y.b)(ln,{user:o,isReplyTo:!0,authorTag:c})]})},pn=function(e){var t=e.isReply,n=e.isSticky,r=e.autoFocus,o=e.replyCommentId,c=e.localCache,i=e.disabled,a=e.placeholder,s=e.maxLine,l=e.onSubmit,u=e.className,d=Object(C.useRef)(),b=rt(),p=b.authorInfo,h=b.resourceType,f=b.resourceId,m=b.onNeedLogin,O=b.onNeedVip,g=b.onError,j=Xt(),v=t?void 0:n?"悬浮":"常驻",x=t?"reply_comment":"direct_comment",k=Object(T.a)((function(e){var t;null===(t=d.current)||void 0===t||t.trackEvent({eventType:"Click",action:"Comment",elementLocation:{type:"Button",text:v,block:{blockText:x}}}),l(e)}));return Object(y.c)(y.a,{children:[Object(y.b)(S.e,{ref:d}),Object(y.b)(S.f,{zaType:"Block",zaText:v,view:Ye(x),children:Object(y.b)(ze.a,{className:u,authorInfo:p,resourceType:h,resourceId:f,isReply:t,disabled:i,autoFocus:r,placeholder:a,localCache:c,replyCommentId:o,maxLine:s,emoticonList:j,onSubmit:k,onNeedLogin:m,onNeedPurchaseVip:O,onError:g})})]})},hn=Object(Le.a)(K.a),fn=function(e){var t=e.liked,n=e.disabled,r=e.onClick,o=p()(e,Fe),c=Object(ce.a)().colors.GBK06A,i=Object(B.b)(),a=i.Mobile,s=i.ZhihuHybrid,l=!$e({Mobile:a,ZhihuHybrid:s}),u=Object(De.a)(),d=Object(w.a)(function(){var e=O()(f.a.mark((function e(o){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=2;break}return e.abrupt("return");case 2:if(null==r||r(o),!a||t){e.next=9;break}return Object(F.a)("iOS/hapticFeedback").dispatch(),e.next=7,u.start({scale:1.3,transition:{type:"tween",duration:.2,ease:[0,0,.58,1]}});case 7:return e.next=9,u.start({scale:1,transition:{type:"tween",duration:.3,ease:[.42,0,.2,1.8]}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),300,{leading:!0,trailing:!1});return Object(y.b)(hn,Object.assign(Object.assign({},o),{},{initial:{scale:1},animate:!!l&&u,css:Object.assign(Object.assign({},a&&{color:t?void 0:c,fontSize:"12px",svg:{fontSize:"16px"}}),n&&{cursor:"default",opacity:"0.5"}),onClick:d}))},mn=function(e){var t=Object(B.b)().Mobile,n=Object(w.a)(e.onClick||G.a,300,{leading:!0,trailing:!1});return Object(y.b)(K.a,Object.assign(Object.assign({},e),{},{onClick:n},t?{label:"",css:function(e){return{svg:{fontSize:"16px"},color:e.colors.GBK06A}}}:null))},On=function(e){var t,n=e.data,r=e.subIntro,o=e.commentType,c=e.pageOffset,i=e.onAction,a=n.id,s=n.createdTime,l=n.commentTag,u=n.canReply,d=n.canLike,b=n.isAuthorTop,p=n.canAuthorTop,h=n.liked,f=n.likeCount,m=n.reviewing,O=n.collapsed,g=n.author,j=Object(B.b)().Mobile,v=rt().authorInfo,k=!r&&!m&&!O&&u,w=g.id!==(null==v?void 0:v.id)&&d,A=!m&&!O&&p,E=Object(C.useState)(!1),z=Ne(x.a,E,2),L=z[0],D=z[1],M=Object(T.a)((function(){j?i("replyComment",{replyCommentId:a,pageOffset:c}):D(!L)})),R=Object(T.a)((function(e){D(!1),i("replyComment",{replyCommentId:a,data:e,pageOffset:c})})),G=Object(T.a)((function(){i("toggleLike",a)})),F=Object(T.a)((function(){i("reviewComment",a)})),P=Object(T.a)((function(){i("toggleAuthorTop",a)}));return t=!m||"root"!==o&&"sub"!==o?Object(y.c)(I.Flex,{alignItems:"center",flex:"0 0 auto",css:{".Button":{marginLeft:"16px"}},children:[k&&Object(y.b)(S.a,{as:mn,zaType:"Card",zaAction:"Comment",preset:"plain",icon:j?pe.b:he.b,label:"回复",onClick:M}),m&&Object(y.b)(S.a,{as:mn,zaType:"Button",zaText:!0,preset:"plain",icon:fe.a,label:"公开此评论",onClick:F}),!m&&!O&&Object(y.b)(S.a,{as:fn,zaType:"Card",zaAction:h?"UnUpvote":"Upvote",preset:"plain",disabled:!w,icon:!j||h?me.b:Oe.b,label:f?String(f):"赞",color:h?"blue":"grey",liked:h,onClick:G}),A&&Object(y.b)(S.a,{as:mn,shouldTrackShow:!0,zaType:"Button",zaText:!0,preset:"plain",icon:j?b?ge.a:je.c:b?ve.a:xe.a,label:b?"取消置顶":"置顶",onClick:P})]}):null,Object(y.c)(y.a,{children:[Object(y.c)(I.Flex,{alignItems:"center",justifyContent:"space-between",mt:"4px",children:[Object(y.c)(I.Flex,{alignItems:"center",flex:"0 0 auto",fontSize:j?"12px":"14px",color:"GBK06A",children:[Object(y.b)(I.Text,{mr:"4px",children:Object(Ee.toSmartString)(s)}),l.map((function(e){return Object(y.c)(C.Fragment,{children:[Object(y.b)("span",{children:" · "}),Object(y.b)(cn,{data:e,css:{fontSize:j?"12px":"14px",margin:"0 4px"}})]},e.type)}))]}),t]}),L&&Object(y.b)(pn,{isReply:!0,autoFocus:!0,localCache:!0,placeholder:"回复 ".concat(g.name),replyCommentId:a,onSubmit:R,css:{marginTop:"8px"}})]})},gn=function(e){var t=e.enable,n=e.clickDelay,r=void 0===n?300:n,o=e.longPressDelay,c=void 0===o?800:o,i=e.onPress,a=e.onLongPress,s=e.children,l=Object(C.useRef)(0),u=Object(C.useRef)();var d=Object(w.a)(i,r,{leading:!0,trailing:!1}),b=Object(T.a)((function(e){for(var t=e.target;t!==e.currentTarget;){if(["A","SVG","BUTTON","IMG"].includes(t.tagName.toUpperCase()))return!1;t=t.parentElement}return!0})),p=Object(T.a)((function(){clearTimeout(u.current),u.current=void 0,l.current=0})),h=Object(T.a)((function(e){l.current=Date.now(),u.current=setTimeout((function(){a(e),p()}),c)})),f=Object(T.a)((function(e){u.current&&(Date.now()-l.current<r&&b(e)&&d(e),p())}));return t?Object(y.b)(I.Box,{css:{userSelect:"none"},onTouchStart:h,onTouchEnd:f,onTouchMove:p,children:s}):Object(y.b)(y.a,{children:s})},jn=Object(Te.h)(r||(r=l()(["\n  0%, 100% {background-color: rgba(255,255,255,1);}\n  50% {background-color: rgba(0,102,255,.08);}\n"]))),vn=Object(Te.h)(o||(o=l()(["\n  0%, 100% {background-color: rgba(0,0,0,1);}\n  50% {background-color: rgba(85, 142, 255,.08);}\n"]))),xn=Object(C.memo)(Object(C.forwardRef)((function(e,t){var n=e.className,r=e.data,o=e.commentType,c=e.sub,i=e.subIntro,a=e.blink,s=e.pageOffset,l=e.onAction,u=r.id,d=r.author,b=r.isDelete,p=r.childComments,h=r.childCommentCount,f=Object(B.b)(),m=f.Mobile,O=f.ZhihuHybrid,g=Object(C.useContext)(Gt),j=Object(w.a)((function(e){g(e.currentTarget,r)}),300,{leading:!0,trailing:!1}),v=Object(T.a)((function(){l("replyComment",{replyCommentId:u,pageOffset:s})}));return Object(y.c)("div",{ref:t,children:[Object(y.b)(S.b,{content:{type:"Comment",id:u},children:Object(y.b)(gn,{enable:m&&!b,onPress:v,onLongPress:j,children:Object(y.c)(S.f,{as:I.Flex,zaType:"Card",extra:{configMap:{commentLevel:c?"2":"1"}},css:function(e){return{animation:a?"".concat(e.isDarkMode?vn:jn," 1s linear forwards"):void 0,padding:m?"10px 0 6px ".concat(c?"40px":0):"10px 20px 14px ".concat(c?"54px":"20px")}},className:n,children:[Object(y.b)(Vt,{user:d}),Object(y.c)(I.Box,{ml:"10px",flex:"1 1 auto",children:[Object(y.c)(I.Flex,{justifyContent:"space-between",color:"GBK06A",children:[Object(y.b)(bn,{data:r}),!$e({Mobile:m,ZhihuHybrid:O})&&Object(y.b)(un,{onClick:j})]}),Object(y.b)(rn,{data:r,commentType:o}),Object(y.b)(On,{data:r,subIntro:i,commentType:o,pageOffset:s,onAction:l})]})]})})}),Boolean(i)||(null==p?void 0:p.map((function(e){return Object(y.b)(yn,{id:e,sub:!0,commentType:o,pageOffset:s,onAction:l},e)}))),Boolean(i)||Object(y.b)(dn,{id:u,author:d,childComments:p,childCommentCount:h,pageOffset:s,onAction:l})]})}))),yn=Object(C.forwardRef)((function(e,t){var n,r=(n=e.id,Object(C.useContext)(Pt)[n]);return Object(y.b)(xn,Object.assign(Object.assign({ref:t},e),{},{data:r}))})),Cn=function(e){var t=e.pageOffset,n=e.rootCommentId,r=ut(t).data,o=Dt(t);return r&&n?Object(y.c)(Nt,{data:r.entities,children:[Object(y.b)(yn,{id:n,commentType:"sub",pageOffset:t,subIntro:!0,css:function(e){return{padding:"20px",background:e.colors.GBK99A,borderBottom:"20px solid ".concat(e.colorMod(e.colors.GBL05A).alpha(.1))}},onAction:o}),Object(y.b)(_t,{title:"".concat(Object(ne.cnNiceNumber)(r.entities[n].childCommentCount),"条回复")})]}):null},kn=function(e){var t=e.isResourceAuthor,n=lt(),r=n.prevLayerOffset,o=void 0===r?"":r,c=n.fetchCommentId,i=n.router.layers,a=n.displayType,s=Object(C.useState)((function(){return Object.assign(Object.assign({},i[0]),{},{displayType:a})})),l=Ne(x.a,s,1)[0];return Object(y.b)(st,{data:l,children:Object(y.b)(Ft,{pageOffset:o,isResourceAuthor:t,children:Object(y.b)(Cn,{pageOffset:o,rootCommentId:c})})})},Tn=Object(C.memo)((function(e){var t=e.containerRef,n=e.className,r=e.commentType,o=e.scrollAndBlink,c=e.list,i=e.entities,a=e.paging,s=e.counts,l=e.pageOffset,u=e.isInfinite,d=e.onNextPage,b=e.onAction,p=Object(C.useRef)(null),h=Object(C.useRef)(null),f=Object(C.useRef)(null),m=Object(B.b)().Mobile,O=Object(C.useMemo)((function(){return o?"last"===o?c.length-1:c.findIndex((function(e){return e===o})):-1}),[c,o]);return Object(A.a)((function(){-1!==O&&t.current&&p.current&&h.current&&t.current.scrollTo({top:p.current.offsetTop+h.current.offsetTop-10})})),Object(C.useEffect)((function(){if(u&&!a.isEnd&&f.current){var e=new IntersectionObserver((function(e){if(e[0].isIntersecting&&a.next){var t=new URL(a.next).searchParams.get("offset");null==d||d(t)}}),{root:m?void 0:t.current,rootMargin:"0px 0px 200px 0px"});return e.observe(f.current),function(){e.disconnect()}}}),[u,a,d,t,m]),Object(y.c)(I.Box,{ref:p,className:n,children:[Object(y.b)(Nt,{data:i,children:c.map((function(e,t){var n=t===O;return Object(y.b)(yn,{ref:n?h:void 0,id:e,commentType:r,pageOffset:l,blink:n,onAction:b},e)}))}),m&&a.isEnd&&0===(null==s?void 0:s.collapsedCounts)&&Object(y.b)(I.Box,{mt:"20px",color:"GBK06A",fontSize:"13px",textAlign:"center",children:"没有更多评论了"}),Object(y.b)("div",{ref:f})]})})),wn=Object(Te.h)(c||(c=l()(["\n0% {transform: translateX(-56%);}\n100% {transform: translateX(56%);}\n"]))),An=function(e){var t=e.className,n=Object(ce.a)().colors,r=n.GBK10A,o=n.GBK09A,c=n.GBK99A;return Object(y.c)("div",{className:t,css:{position:"relative",overflow:"hidden",background:r,color:c},children:[Object(y.b)("div",{css:{position:"absolute",width:"200%",height:"100%",background:"linear-gradient(to right, ".concat(r," 0%, ").concat(o," 20%, ").concat(r," 40%, ").concat(r," 100%)"),animation:"".concat(wn," 1s linear 1ms infinite forwards")}}),Object(y.b)("svg",{width:"656",height:"44",viewBox:"0 0 656 44",css:{position:"relative",minWidth:"100%",verticalAlign:"top",boxSizing:"border-box"},children:Object(y.b)("path",{d:"M0 0h656v44H0V0zm0 0h480v12H0V0zm0 32h238v12H0V32z",fill:"currentColor",fillRule:"evenodd"})})]})},Bn=function(e){var t=e.isInfinite,n=e.fullHeight;return t?Object(y.b)("div",{css:{boxSizing:"border-box",padding:"10px 20px 14px 20px",height:n?"calc(100vh - 24px * 2 - 50px - 62px - 20px)":void 0},children:Object(y.b)(An,{})}):Object(y.b)(I.Flex,{justifyContent:"center",alignItems:"center",height:"96px",children:Object(y.b)(_.a,{})})},In=function(e){var t=e.containerRef,n=e.commentType,r=e.scrollAndBlink,o=e.fullHeightLoading,c=e.pageOffset,i=e.isResourceAuthor,a=e.isInfinite,s=e.onNextPage,l=ut(c,{isInfinitePage:a}),u=l.data,d=l.isValidating,b=Dt(c);if(d&&!u)return Object(y.b)(Bn,{isInfinite:a,fullHeight:o});var p=u||{},h=p.data,f=p.entities,m=p.paging,O=p.counts;return h&&h.length>0&&f&&m&&O?Object(y.b)(Ft,{pageOffset:c,isResourceAuthor:i,children:Object(y.b)(Tn,{containerRef:t,commentType:n,scrollAndBlink:r,list:h,entities:f,paging:m,counts:O,pageOffset:c,isInfinite:a,onNextPage:s,onAction:b})}):null},Sn=function(e){var t=e.paging,n=Object(C.useMemo)((function(){return t?[t.isEnd,new URL(t.next).searchParams.get("offset")||void 0]:[!0]}),[t]),r=Ne(x.a,n,2),o=r[0],c=r[1],i=lt(),a=i.sortType,s=i.router,l=Object(T.a)((function(){!o&&c&&s.push({commentType:"root",sortType:a,prevLayerOffset:c})}));return o?null:Object(y.c)(S.a,{as:I.Flex,zaType:"Button",zaAction:"Expand",shouldTrackShow:!0,zaText:"查看全部评论",css:function(e){return Object.assign({alignItems:"center",justifyContent:"center",color:e.colors.GBL05A,fontSize:"15px",padding:"20px 0",margin:"0 20px",cursor:"pointer"},Object(re.a)({borderTop:"1px solid ".concat(e.colors.GBK10A)}))},onClick:l,children:[Object(y.b)(I.Text,{children:"点击查看全部评论"}),Object(y.b)(de.b,{size:24})]})},En=Object(C.memo)((function(e){var t=e.type,n=e.counts,r=e.isResourceAuthor,o=e.onAction,c=Object(B.b)().Mobile,i=at().push,a=Object(T.a)((function(){r&&(c?o("showCommentList",{commentType:"review"}):i({commentType:"reviewing"}))})),s=Object(T.a)((function(){c?o("showCommentList",{commentType:"collapsed"}):i({commentType:"collapsed"})}));if(!n)return null;if("reviewing"===t){var l=r&&n.reviewingCounts>0;return Object(y.c)(S.a,{as:I.Flex,shouldTrackShow:!0,zaType:"Button",zaAction:"Expand",zaText:!0,css:function(e){return{flex:"0 0 auto",alignItems:"center",margin:c?"20px 0 0":"20px 20px 0",padding:"0 10px",height:"36px",fontSize:"14px",color:r?e.colors.GBL01A:e.colors.GBL05A,borderRadius:"3px",backgroundColor:e.colorMod(r?e.colors.GBL01A:e.colors.GBL05A).alpha(.1),cursor:l?"pointer":"default"}},onClick:l?a:G.a,children:[Object(y.b)(ye.a,{text:!0,size:16}),Object(y.b)(I.Text,{ml:"8px",flex:"1 1 auto",children:r?"".concat(n.reviewingCounts," 条新评论待筛选"):"评论内容由作者筛选后展示"}),l&&Object(y.b)(de.b,{size:24})]})}return"collapsed"===t&&n.collapsedCounts>0?Object(y.c)(I.Flex,{alignItems:"center",justifyContent:"center",color:"GBL05A",fontSize:"15px",p:c?"0 0 10px 0":"20px 0",mx:"20px",sx:Object.assign(Object.assign({},c?void 0:Object(re.a)({borderTop:"1px solid",borderTopColor:"GBK10A"})),{},{cursor:"pointer"}),onClick:s,children:[Object(y.b)(I.Text,{children:"查看被折叠评论"}),Object(y.b)(Ce.a,{size:16,css:{marginLeft:"4px"},onClick:function(e){e.stopPropagation(),window.open("https://www.zhihu.com/question/52029856/answer/128623557")}})]}):null})),zn=function(e){return{flex:"0 0 auto",padding:"10px 20px",boxShadow:"0px -1px 3px ".concat(e.colorMod(e.colors.GBK02B).alpha(.12))}},Ln=function(){var e=rt(),t=e.hideFoldButton,n=e.onClose;return t||!n?null:Object(y.b)(Le.a.div,{variants:{initial:{opacity:0,transitionEnd:{display:"none"}},sticky:{opacity:1,display:"block"},unSticky:{opacity:0,transitionEnd:{display:"none"}}},css:{position:"absolute",top:"-52px",right:"20px"},children:Object(y.c)(K.a,{preset:"secondary",color:"grey",onClick:n,css:function(e){return{margin:"10px 0 10px 54px",padding:"0 6px 0 12px",height:"32px",color:e.colors.GBL05A,backgroundColor:e.colors.GBK10A,fontWeight:500,":hover":{backgroundColor:e.colors.GBK10A},svg:{marginBottom:"1px"}}},children:["收起评论",Object(y.b)(ke.b,{center:!0,size:24})]})})},Dn=function(e){var t=e.disabled,n=e.autoFocus,r=e.placeholder,o=e.onSubmit,c=e.children,i=rt().hideBottomEditorShadow,a=Object(C.useRef)(null),s=Object(C.useRef)(null),l=Object(C.useRef)(null),u=Object(C.useState)(!1),d=Ne(x.a,u,2),b=d[0],p=d[1],h=Object(De.a)(),m=Object(ce.a)().colors,g=m.GBK99A,j=m.GBK02B;return Object(C.useEffect)((function(){if(a.current){var e=a.current.offsetHeight;p(e>1.5*window.innerHeight)}}),[c]),Object(C.useEffect)((function(){if(b&&a.current&&s.current&&l.current){var e=function(){var e=O()(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.set(t?"unSticky":"sticky"),e.next=3,h.start(t?"sticky":"unSticky");case 3:t||h.set("initial");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t=new IntersectionObserver((function(t){var n=Ne(x.a,t,2),r=n[0],o=n[1];2===t.length||!1===(null==o?void 0:o.isIntersecting)?h.start("initial"):r.target===l.current?h.start(r.isIntersecting?"initial":"sticky"):r.target===s.current&&e(r.isIntersecting)}));return t.observe(s.current),t.observe(l.current),function(){return t.disconnect()}}}),[h,b]),Object(y.c)("div",{css:{position:"relative"},ref:a,children:[Object(y.b)(S.b,{content:{type:"Comment"},children:Object(y.b)(pn,{disabled:t,autoFocus:n,placeholder:r,localCache:!0,css:{marginBottom:"10px"},onSubmit:o})}),c,b&&Object(y.b)("div",{ref:s,css:{position:"absolute",top:"100vh",bottom:0}}),t||b&&Object(y.c)(Le.a.div,{initial:"initial",animate:h,variants:{initial:{position:"relative",boxShadow:"0 0"},sticky:{position:"sticky",y:0,boxShadow:i?"0 0":"0px -1px 3px ".concat(Object(ie.a)(j).alpha(.12))},unSticky:{position:"sticky",y:"100%",boxShadow:"0 0"}},css:{zIndex:1,margin:"0 -20px",padding:"10px 20px",bottom:0,background:g},children:[Object(y.b)(Ln,{}),Object(y.b)(S.b,{content:{type:"Comment"},children:Object(y.b)(pn,{isSticky:!0,autoFocus:!1,placeholder:r,maxLine:6,onSubmit:o})})]}),b&&Object(y.b)("div",{ref:l})]})},Mn=function(e){var t=e.hide,n=e.disabled,r=e.autoFocus,o=e.placeholder,c=e.onAction,i=e.children,a=lt(),s=a.displayType,l=a.fetchCommentId,u=a.rootCommentAuthor,d=u?"回复 ".concat(u.name):o,b=Object(T.a)((function(e){c("addComment",{data:e})}));return t?Object(y.b)(y.a,{children:i}):"list"===s?Object(y.b)(Dn,{disabled:n,autoFocus:r,placeholder:d,onSubmit:b,children:i}):Object(y.c)(y.a,{children:[i,Object(y.b)(S.b,{content:{type:"Comment"},children:Object(y.b)(pn,{disabled:n,autoFocus:r,placeholder:d,maxLine:6,localCache:!0,replyCommentId:l,css:zn,onSubmit:b})})]})},Rn=function(e){var t=e.className,n=e.hideEditor,r=e.disableEditor,o=e.autoFocusEditor,c=e.editorPlaceholder,i=e.onAction,a=e.children,s=lt(),l=s.displayType,u=s.commentType,d="root"!==u&&"sub"!==u||n;return Object(B.b)().Mobile?Object(y.b)(S.b,{block:"comment_list",children:Object(y.b)(I.Flex,{flexDirection:"column",alignItems:"stretch",sx:{position:"relative"},className:t,children:a})}):"list"===l?Object(y.b)(S.b,{block:"comment_list",children:Object(y.b)(I.Box,{className:t,children:Object(y.b)(Mn,{hide:d,disabled:r,autoFocus:o,placeholder:c,onAction:i,children:Object(y.b)(I.Flex,{flexDirection:"column",alignItems:"stretch",sx:{position:"relative",border:"1px solid",borderColor:"GBK09A",borderRadius:"4px"},children:a})})})}):Object(y.b)(S.b,{block:"comment_popup",children:Object(y.b)(I.Flex,{flexDirection:"column",alignItems:"stretch",height:"100%",css:{position:"relative"},className:t,children:Object(y.b)(Mn,{hide:d,disabled:r,autoFocus:o,placeholder:c,onAction:i,children:a})})})},Gn={avatarUrl:"https://pic1.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_s.jpeg",id:"0",urlToken:"",name:""},Fn=["1","0.7","0.4"],Pn=["[谢邀]","[赞同]"],Nn=function(e){var t=e.commentStatus,n=e.onInputShowTips,r=rt(),o=r.resourceId,c=r.resourceType,i=r.openInApp,a=Object(B.b)(),s=a.Mobile,l=a.ZhihuHybrid,u=Object(ce.a)().colors,d=u.GBK10A,b=u.GBK06A,p=Xt(),h=Object(C.useState)([]),f=Ne(x.a,h,2),m=f[0],O=f[1],g=Object(C.useState)(Gn),j=Ne(x.a,g,2),v=j[0],k=j[1],w=t.type,A=t.text,S=t.induceText,E=4===w,z=5===w,L=E||z,D=L&&A,M=$e({Mobile:s,ZhihuHybrid:l});Object(C.useEffect)((function(){!M&&p.length>0&&Object(F.a)("base/getFrequentlyUsedEmoticon").dispatch({count:3}).then((function(e){var t=null==e?void 0:e.data;return t&&0!==t.length||(t=Pn),O(t.map((function(e){return function(e,t){return t.find((function(t){return t.placeholder===e}))}(e,p)})))}))}),[p,M]),Object(C.useEffect)((function(){Object(F.a)("account/me").dispatch().then((function(e){if(null==e?void 0:e.url_token){var t=e.avatar_url,n=void 0===t?"":t,r=e.url_token,o=e.id,c=e.name;k({avatarUrl:n,id:o,name:void 0===c?"":c,urlToken:r})}}))}),[]);var R=Object(T.a)((function(e){if(M)return e.preventDefault(),void(null==i||i());L&&e.preventDefault(),E&&Object(F.a)("ui/showToast").dispatch({text:A}),z&&(null==n||n(S||"评论区功能升级中，暂时无法发送评论，可以使用「赞同并推荐」功能参与互动"))}));return Object(y.c)(I.Flex,{css:{width:"100%",alignItems:"center"},children:[Object(y.b)(Vt,{user:v}),Object(y.c)(Ae.b,{as:I.Flex,css:{flex:1,marginLeft:"10px",height:"36px",color:b,backgroundColor:d,borderRadius:"18px",padding:"0 4px 0 16px",fontSize:"14px",justifyContent:"space-between",alignItems:"center"},href:"zhihu://comment/list/".concat(c,"/").concat(o,"?open_editor=true"),onClick:R,children:[Object(y.b)(I.Text,{css:{lineHeight:"normal"},children:D||"写下你的评论..."}),m.length>0&&Object(y.b)(I.Flex,{css:{height:"34px",alignItems:"center",marginRight:"4px"},children:m.filter(Boolean).map((function(e,t){var n=e.static_image_url,r=e.title;return Object(y.b)("img",{alt:"icon",src:n,css:{width:"20px",height:"20px",marginRight:"4px",opacity:Fn[t]}},r)}))})]})]})},Kn=function(e){var t,n,r,o,c,i,a=e.className,s=Object(C.useRef)(null),l=rt(),u=l.onInputShowTips,d=l.hideEditor,b=Object(B.b)(),p=b.Mobile,h=b.ZhihuHybrid,f=lt(),m=f.index,O=f.displayType,g=f.commentType,v=f.sortType,k=f.prevLayerOffset,w=f.fetchCommentId,A="modal"===O,E="list"===O,L="root"===g,M="sub"===g,R="anchor"===g,G=function(){var e=lt().commentType,t=Object(C.useMemo)((function(){return[["sub","anchor"].includes(e)?"root":e,"score",void 0,""]}),[e]),n=Object(D.a)(t),r=n.data,o=n.error,c=null==r?void 0:r.data;return t?o&&!c?{error:Ze(o)}:c?z()(r,"entities"):{error:"请求数据失败"}:{}}(),P=Dt();c=P,i=0===m&&h,Object(C.useEffect)((function(){if(i){var e=Object(F.a)("comment/onMessage").listen((function(e){var t=e.type,n=e.data;c("changeComment",{type:t,data:n})})),t=Object(F.a)("base/viewDidAppear").listen((function(){c("clearWaiting")}));return function(){e(),t()}}}),[i,c]);var N=Boolean(A&&L&&k),K=R?w:void 0,H=He((function(){return[N&&k||""]}),[N,k,v]),_=Ne(x.a,H,2),U=_[0],Z=_[1],W=Object(T.a)((function(e){U.find((function(t){return t===e}))||Z((function(t){return[].concat(Ne(j.a,t),[e])}))})),V=Object(T.a)((function(){var e;A&&(null===(e=s.current)||void 0===e||e.scrollTo({top:0}))})),q=(null===(t=G.commentStatus)||void 0===t?void 0:t.type)||0;if(1===q||3===q)return Object(y.c)(Rn,{className:a,hideEditor:!0,onAction:P,children:[p&&Object(y.b)(Ut,{title:"评论"}),Object(y.b)(Rt,{type:q})]});var J=null===(n=G.commentStatus)||void 0===n?void 0:n.induceText,X=Boolean(G.error||J),Y=L&&2===q,$=!d&&p&&G.commentStatus&&Object(y.b)(I.Box,{mt:16,children:Object(y.b)(Nn,{commentStatus:G.commentStatus,onInputShowTips:u})});return 0===(null===(r=G.counts)||void 0===r?void 0:r.totalCounts)&&0===(null===(o=G.data)||void 0===o?void 0:o.length)?Object(y.c)(Rn,{className:a,disableEditor:X,autoFocusEditor:!X,editorPlaceholder:J,onAction:P,hideEditor:d,children:[p&&Object(y.b)(Ut,{title:"评论"}),$,Y&&Object(y.b)(En,{type:"reviewing",counts:G.counts,isResourceAuthor:G.isContentAuthor,onAction:P}),Object(y.b)(Rt,{noComments:!0})]}):Object(y.c)(Rn,{className:a,disableEditor:X,editorPlaceholder:J,onAction:P,hideEditor:d,children:[(Boolean(p&&G.counts)||!p)&&Object(y.b)(Ut,{counts:G.counts,onChangeSortType:V}),$,Object(y.c)(S.f,{zaType:"Block",ref:s,css:{flex:"1 1 auto",overflowY:A?"scroll":void 0,position:"relative"},children:[M&&Object(y.b)(kn,{isResourceAuthor:G.isContentAuthor}),Y&&Object(y.b)(En,{type:"reviewing",counts:G.counts,isResourceAuthor:G.isContentAuthor,onAction:P}),Object(y.c)(I.Box,{py:"10px",css:{minHeight:"100%"},children:[Boolean(N)&&Object(y.b)(In,{containerRef:s,commentType:g,pageOffset:"",isResourceAuthor:G.isContentAuthor,scrollAndBlink:"last"}),U.map((function(e,t){return Object(y.b)(In,{commentType:g,containerRef:s,fullHeightLoading:0===t&&N,scrollAndBlink:K,pageOffset:e,isResourceAuthor:G.isContentAuthor,isInfinite:p||A&&!R,onNextPage:W},e)}))]}),L&&Object(y.b)(En,{type:"collapsed",counts:G.counts,isResourceAuthor:G.isContentAuthor,onAction:P})]}),!p&&E&&U.length>0&&Object(y.b)(Sn,{paging:G.paging})]})},Hn=function(e){var t=e.onClose,n=e.onExit,r=e.children,o=rt().styles,c=void 0===o?{}:o,i=at().pop,a=Object(T.a)((function(){t&&t(),i(0)})),s=Object(B.b)().Mobile;return Object(y.b)(P.a,{size:"fullPage",styles:Object.assign(Object.assign({},s&&{root:{width:"100vw",height:"100%",maxHeight:"unset"},content:Object.assign(Object.assign({},s?{padding:"18px 16px 20px 16px"}:{padding:0}),{},{marginTop:0,position:"relative"})}),c.modal),maskClosable:!1,onClose:a,onExitComplete:n,children:r})},_n=function(e,t){return t<e-1?{display:"none"}:{}},Un=function(e){var t=e.onExit,n=at().layers,r=rt(),o=r.className,c=r.displayType,i=r.onClose;if(Object(C.useEffect)((function(){"list"===c&&0===n.length&&t()}),[c,n.length,t]),"list"===c){var s=Ne(a.a,n),l=s[0],u=s.slice(1);return l?Object(y.c)(y.a,{children:[Object(y.b)(st,{data:l,children:Object(y.b)(Kn,{className:o})}),Object(y.b)(Hn,{children:u.length>0?u.map((function(e,t){return Object(y.b)(st,{data:e,children:Object(y.b)(Kn,{css:_n(u.length,t)})},e.index)})):null})]}):null}return Object(y.b)(Hn,{onClose:i,onExit:t,children:n.length>0?n.map((function(e,t){return Object(y.b)(st,{data:e,children:Object(y.b)(Kn,{css:_n(n.length,t)})},e.index)})):null})},Zn=function(e){var t=e.shown,n=Object(C.useState)(t),r=Ne(x.a,n,2),o=r[0],c=r[1],i=Object(T.a)((function(){c(!1)}));return Object(C.useEffect)((function(){t&&c(!0)}),[t]),o?Object(y.b)(nt,Object.assign(Object.assign({},e),{},{children:Object(y.b)(Jt,{children:Object(y.b)(it,{children:Object(y.b)(Un,{onExit:i})})})})):null}}).call(this,n(251))}}]);
//# sourceMappingURL=column.lib_cf230269.651fe07b8e686459fe58.js.map