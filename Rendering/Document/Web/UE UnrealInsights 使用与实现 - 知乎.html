<!DOCTYPE html>
<!-- saved from url=(0038)https://zhuanlan.zhihu.com/p/458086085 -->
<html lang="zh" data-hairline="true" data-theme="light" data-rh="data-theme"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>UE UnrealInsights 使用与实现 - 知乎</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="google-site-verification" content="FTeR0c8arOPKh8c5DYh_9uu98_zJbaWw53J-Sch9MTg"><meta data-rh="true" name="keywords" content="虚幻引擎"><meta data-rh="true" name="description" content="Unreal Insights使用UnrealInsights是UE的新一代Profile工具，用于替代原先的Stats，比如Frontend。它可以Profile CPU，GPU，Network，Animation，Slate，功能更强大，界面也更友好易用。比较常用的是CPU Profile…"><meta data-rh="true" property="og:title" content="UE UnrealInsights 使用与实现"><meta data-rh="true" property="og:url" content="https://zhuanlan.zhihu.com/p/458086085"><meta data-rh="true" property="og:description" content="Unreal Insights使用UnrealInsights是UE的新一代Profile工具，用于替代原先的Stats，比如Frontend。它可以Profile CPU，GPU，Network，Animation，Slate，功能更强大，界面也更友好易用。比较常用的是CPU Profile…"><meta data-rh="true" property="og:image" content="https://pic1.zhimg.com/v2-66158357a4b02c2e832dfe63798cca01_720w.jpg?source=172ae18b"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="og:site_name" content="知乎专栏"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.a53ae37b.png"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.a53ae37b.png" sizes="152x152"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-120.bbce8f18.png" sizes="120x120"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-76.cbade8f9.png" sizes="76x76"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-60.8f6c52aa.png" sizes="60x60"><link crossorigin="" rel="shortcut icon" type="image/x-icon" href="https://static.zhihu.com/heifetz/favicon.ico"><link crossorigin="" rel="search" type="application/opensearchdescription+xml" href="https://static.zhihu.com/heifetz/search.xml" title="知乎"><link rel="dns-prefetch" href="https://static.zhimg.com/"><link rel="dns-prefetch" href="https://pica.zhimg.com/"><link rel="dns-prefetch" href="https://pic1.zhimg.com/"><link rel="dns-prefetch" href="https://pic2.zhimg.com/"><link rel="dns-prefetch" href="https://pic3.zhimg.com/"><link rel="dns-prefetch" href="https://pic4.zhimg.com/"><link rel="dns-prefetch" href="https://static.zhihu.com/"><style data-emotion-css="1m4merm">.u-safeAreaInset-top{height:constant(safe-area-inset-top) !important;height:env(safe-area-inset-top) !important;}.u-safeAreaInset-bottom{height:constant(safe-area-inset-bottom) !important;height:env(safe-area-inset-bottom) !important;}</style><link href="./UE UnrealInsights 使用与实现 - 知乎_files/column.app.216a26f4.05772ea41548f390319f.css" crossorigin="" rel="stylesheet"><script nonce="">!function(){"use strict";!function(e,n){var r=[];function t(e){return function(){r.push([e,arguments])}}n.Raven={captureException:t("captureException"),captureMessage:t("captureMessage"),captureBreadcrumb:t("captureBreadcrumb")};var a,o,c,i,s,u="undefined"!=typeof DOMError;function d(e){var n=e instanceof Error||e instanceof ErrorEvent||u&&e instanceof DOMError||e instanceof DOMException;Raven.captureException(n?e:new Error(e.message||e.reason))}n.addEventListener("unhandledrejection",d),n.addEventListener("error",d,!0),a=e.src,o=e,c=function(){r.forEach(function(e){var n;(n=Raven)[e[0]].apply(n,e[1])}),n.removeEventListener("unhandledrejection",d),n.removeEventListener("error",d,!0)},i=document.head||document.getElementsByTagName("head")[0],(s=document.createElement("script")).crossOrigin=o.crossOrigin,s.dataset.sentryConfig=o["data-sentry-config"],s.onload=c,s.src=a,i.appendChild(s)}({"defer":true,"crossOrigin":"anonymous","src":"https://unpkg.zhimg.com/@cfe/sentry-script@1.3.1/dist/init.js","data-sentry-config":"{\"dsn\":\"https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224\",\"sampleRate\":0.1,\"release\":\"4678-bb634356\",\"ignoreErrorNames\":[\"NetworkError\",\"SecurityError\"],\"ignoreErrorsPreset\":\"ReactApp\",\"tags\":{\"app_name\":\"heifetz\"}}"},window)}();
</script><script crossorigin="anonymous" data-sentry-config="{&quot;dsn&quot;:&quot;https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224&quot;,&quot;sampleRate&quot;:0.1,&quot;release&quot;:&quot;4678-bb634356&quot;,&quot;ignoreErrorNames&quot;:[&quot;NetworkError&quot;,&quot;SecurityError&quot;],&quot;ignoreErrorsPreset&quot;:&quot;ReactApp&quot;,&quot;tags&quot;:{&quot;app_name&quot;:&quot;heifetz&quot;}}" src="./UE UnrealInsights 使用与实现 - 知乎_files/init.js.download"></script><style data-emotion-css="1l12z7y">.css-1l12z7y{box-shadow:0px 16px 32px rgba(0,0,0,0.04);}</style><style data-emotion-css="1hlrcxk">.css-1hlrcxk{-webkit-transition-property:fill;transition-property:fill;-webkit-transition-duration:0.25s;transition-duration:0.25s;-webkit-transition-timing-function:ease-in;transition-timing-function:ease-in;}</style><style data-emotion-css="1cd9gw4">.css-1cd9gw4{margin-left:.3em;}</style><style data-emotion-css="1yuhvjn">.css-1yuhvjn{margin-top:16px;}</style><style data-emotion-css="3jt6os">.css-3jt6os .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(246,246,246,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-3jt6os .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-3jt6os .FileLinkCard-info{margin-left:12px;}.css-3jt6os .FileLinkCard-name{color:#121212;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-3jt6os .FileLinkCard-meta{color:#999999;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-3jt6os .FileLinkCard-source{white-space:pre;}</style><style data-emotion-css="1wr1m8">.css-1wr1m8 .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#F6F6F6;}.css-1wr1m8 .LinkCard.new,.css-1wr1m8 .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1wr1m8 .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-1wr1m8 .LinkCard.new .LinkCard-contents .loading{height:14px;background:#EBEBEB;border-radius:7px;}.css-1wr1m8 .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-1wr1m8 .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#121212;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1wr1m8 .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-1wr1m8 .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-1wr1m8 .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-1wr1m8 .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-1wr1m8 .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#999999;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1wr1m8 .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#444444;}.css-1wr1m8 .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#999999;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1wr1m8 .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-1wr1m8 .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(211,211,211,0.3);}.css-1wr1m8 .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-1wr1m8 .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-1wr1m8 .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#EBEBEB;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-1wr1m8 .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#EBEBEB;color:#D3D3D3;}.css-1wr1m8 .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#999999;}.css-1wr1m8 .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-1wr1m8 .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-1wr1m8 .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#444444;}.css-1wr1m8 .LinkCard.new .LinkCard-richText .text{color:#444444;}.css-1wr1m8 .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-1wr1m8 .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-1wr1m8 .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-1wr1m8 .LinkCard.old,.css-1wr1m8 .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1wr1m8 .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(246,246,246,0.88);color:#D3D3D3;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#EBEBEB;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#EBEBEB;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}</style><style data-emotion-css="hypxot">.css-hypxot .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-hypxot .LinkCard.old,.css-hypxot .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-hypxot .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(246,246,246,0.88);color:#D3D3D3;}.css-hypxot .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#EBEBEB;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-hypxot .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#EBEBEB;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}.css-hypxot .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#F6F6F6;}.css-hypxot .LinkCard.new,.css-hypxot .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-hypxot .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-hypxot .LinkCard.new .LinkCard-contents .loading{height:14px;background:#EBEBEB;border-radius:7px;}.css-hypxot .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-hypxot .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#121212;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hypxot .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-hypxot .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-hypxot .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-hypxot .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-hypxot .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#999999;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hypxot .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#444444;}.css-hypxot .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#999999;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hypxot .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-hypxot .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(211,211,211,0.3);}.css-hypxot .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-hypxot .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-hypxot .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#EBEBEB;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-hypxot .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#EBEBEB;color:#D3D3D3;}.css-hypxot .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#999999;}.css-hypxot .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-hypxot .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-hypxot .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#444444;}.css-hypxot .LinkCard.new .LinkCard-richText .text{color:#444444;}.css-hypxot .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-hypxot .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-hypxot .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(246,246,246,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-hypxot .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-hypxot .FileLinkCard-info{margin-left:12px;}.css-hypxot .FileLinkCard-name{color:#121212;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-hypxot .FileLinkCard-meta{color:#999999;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-hypxot .FileLinkCard-source{white-space:pre;}</style><style data-emotion-css="yvdm7v animation-1sh55c5">.css-yvdm7v{word-break:break-word;line-height:1.6;}.css-yvdm7v a.UserLink-link{color:#175199;}.css-yvdm7v a.UserLink-link:hover{border-bottom:1px solid #175199;}.css-yvdm7v lazy[data-lazy-status]{background-color:#F6F6F6;}.css-yvdm7v lazy[data-lazy-status="ok"]{background-color:transparent;-webkit-animation:animation-1sh55c5 0.5s ease-in;animation:animation-1sh55c5 0.5s ease-in;}.css-yvdm7v > [data-first-child]{margin-top:0;}.css-yvdm7v > :last-child{margin-bottom:0;}.css-yvdm7v h1,.css-yvdm7v h2{clear:left;margin-top:calc((1.4em * 2) / 1.2);margin-bottom:calc(1.4em / 1.2);font-size:1.2em;line-height:1.5;font-weight:600;}.css-yvdm7v h3,.css-yvdm7v h4,.css-yvdm7v h5,.css-yvdm7v h6{clear:left;margin-top:calc((1.4em * 1.5) / 1.1);margin-bottom:calc(1.4em / 1.1);font-size:1.1em;line-height:1.5;font-weight:600;}.css-yvdm7v u{-webkit-text-decoration:none;text-decoration:none;border-bottom:1px solid #444444;}.css-yvdm7v b{font-weight:600;}.css-yvdm7v sup{font-size:0.8em;}.css-yvdm7v sup[data-draft-type='reference']{color:#175199;}.css-yvdm7v a:focus{outline:none;-webkit-transition:box-shadow 0.3s;transition:box-shadow 0.3s;}html[data-focus-visible] .css-yvdm7v a:focus{box-shadow:0 0 0 2px #FFFFFF,0 0 0 4px rgba(5,109,232,0.3);}.css-yvdm7v a.ztext-link,.css-yvdm7v a.internal,.css-yvdm7v a.external{-webkit-text-decoration:none;text-decoration:none;cursor:pointer;border-bottom:1px solid #808080;}.css-yvdm7v a.ztext-link:hover,.css-yvdm7v a.internal:hover,.css-yvdm7v a.external:hover{color:#175199;border-bottom:1px solid #175199;}.css-yvdm7v a.ztext-link > .ellipsis::after,.css-yvdm7v a.internal > .ellipsis::after,.css-yvdm7v a.external > .ellipsis::after{content:'...';}.css-yvdm7v a.ztext-link > .invisible,.css-yvdm7v a.internal > .invisible,.css-yvdm7v a.external > .invisible{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;}.css-yvdm7v a.ztext-link u,.css-yvdm7v a.internal u,.css-yvdm7v a.external u{border:none;}.css-yvdm7v a.member_mention{color:#175199;}.css-yvdm7v a.member_mention:hover{border-bottom:1px solid #175199;}.css-yvdm7v p{margin:1.4em 0;}.css-yvdm7v p.ztext-empty-paragraph{margin:calc((2.8em- (1.4em * 2 + 1.6em)) / 2) 0;}.css-yvdm7v p.ztext-empty-paragraph + .ztext-empty-paragraph{margin:1.4em 0;}.css-yvdm7v hr{margin:4em auto;width:240px;max-width:100%;border:none;border-top:1px solid #D3D3D3;}.css-yvdm7v img[eeimg]{max-width:100%;vertical-align:middle;}.css-yvdm7v img[eeimg="1"]{margin:0 3px;max-width:calc(100% - 6px);display:inline-block;}.css-yvdm7v img[eeimg="2"]{margin:1.4em auto;display:block;}.css-yvdm7v blockquote{margin:1.4em 0;padding-left:1em;color:#646464;border-left:3px solid #D3D3D3;}.css-yvdm7v ol,.css-yvdm7v ul{margin:1.4em 0;padding:0;width:100%;}.css-yvdm7v ol ol,.css-yvdm7v ul ol,.css-yvdm7v ol ul,.css-yvdm7v ul ul{margin:0;}.css-yvdm7v ol li::before,.css-yvdm7v ul li::before{width:1em;}.css-yvdm7v ol > ol,.css-yvdm7v ul > ol,.css-yvdm7v ol > ul,.css-yvdm7v ul > ul{display:table-row;}.css-yvdm7v ol > ol::before,.css-yvdm7v ul > ol::before,.css-yvdm7v ol > ul::before,.css-yvdm7v ul > ul::before{display:table-cell;content:'';}.css-yvdm7v ul{display:table;}.css-yvdm7v ul>li{display:table-row;list-style:none;}.css-yvdm7v ul>li::before{display:table-cell;content:'•  ';white-space:pre;}.css-yvdm7v ol{display:table;counter-reset:ol;}.css-yvdm7v ol > li{display:table-row;list-style:none;}.css-yvdm7v ol > li::before{display:table-cell;text-align:right;counter-increment:ol;content:counter(ol) '. ';white-space:pre;}.css-yvdm7v ol ol{counter-reset:ol2;}.css-yvdm7v ol ol li::before{counter-increment:ol2;content:counter(ol2) '. ';}.css-yvdm7v ol ol ol{counter-reset:ol3;}.css-yvdm7v ol ol ol li::before{counter-increment:ol3;content:counter(ol3) '. ';}.css-yvdm7v ol ol ol ol{counter-reset:ol4;}.css-yvdm7v ol ol ol ol li::before{counter-increment:ol4;content:counter(ol4) '. ';}.css-yvdm7v figure{margin:1.4em 0;}.css-yvdm7v figure .content_image,.css-yvdm7v figure .origin_image{margin:0 auto;}.css-yvdm7v figure figcaption{margin-top:calc(0.6em / 0.9);padding:0 1em;font-size:0.9em;line-height:1.5;text-align:center;color:#999999;}.css-yvdm7v figure + figure{margin-top:calc(1.4em * 1.6);}.css-yvdm7v figure[data-size='small'],.css-yvdm7v figure:not([data-size]) > [data-size='small']{clear:both;}.css-yvdm7v figure[data-size='left'],.css-yvdm7v figure:not([data-size]) > [data-size='left']{float:left;margin:0 20px 20px 0;max-width:33%;}.css-yvdm7v figure[data-size='right'],.css-yvdm7v figure:not([data-size]) > [data-size='right']{float:right;margin:0 0 20px 20px;max-width:33%;}.css-yvdm7v figure[data-size='collapse']{margin-bottom:0;}.css-yvdm7v figure[data-size='collapse'] + figure{margin-top:0;}.css-yvdm7v .content_image,.css-yvdm7v .origin_image{display:block;max-width:100%;margin:1.4em auto;}.css-yvdm7v .content_image[data-size='small'],.css-yvdm7v .origin_image[data-size='small']{max-width:40%;}.css-yvdm7v .content_image.zh-lightbox-thumb,.css-yvdm7v .origin_image.zh-lightbox-thumb{cursor:-webkit-zoom-in;cursor:-moz-zoom-in;cursor:zoom-in;}.css-yvdm7v code{margin:0 2px;padding:3px 4px;border-radius:3px;font-size:0.9em;background-color:#F6F6F6;}.css-yvdm7v pre{margin:1.4em 0;padding:calc(0.8em / 0.9);font-size:0.9em;word-break:initial;word-wrap:initial;white-space:pre;overflow:auto;-webkit-overflow-scrolling:touch;background:#F6F6F6;border-radius:4px;}.css-yvdm7v pre code{margin:0;padding:0;font-size:inherit;border-radius:0;background-color:inherit;}.css-yvdm7v li pre{white-space:pre-wrap;}.css-yvdm7v table[data-draft-type='table']{border-collapse:collapse;font-size:15px;margin:1.4em auto;max-width:100%;table-layout:fixed;text-align:left;width:100%;}.css-yvdm7v table[data-draft-type='table'][data-size='small']{min-width:260px;width:40%;}.css-yvdm7v table[data-draft-type='table'][data-row-style='striped'] tr:nth-of-type(2n + 1){background:#F6F6F6;}.css-yvdm7v table[data-draft-type='table'] td,.css-yvdm7v table[data-draft-type='table'] th{border:1px solid #D3D3D3;line-height:24px;height:24px;padding:3px 12px;}.css-yvdm7v table[data-draft-type='table'] th{background:#EBEBEB;color:#121212;font-weight:500;}.css-yvdm7v .video-box,.css-yvdm7v .link-box{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin:1.4em 0;overflow:auto;white-space:normal;cursor:pointer;border:solid 1px #EBEBEB;border-radius:4px;}.css-yvdm7v .highlight{margin:1em 0;}.css-yvdm7v .highlight pre{margin:0;}.css-yvdm7v .highlight .hll{background-color:#FDFDFD;}.css-yvdm7v .highlight .c{font-style:italic;color:#999999;}.css-yvdm7v .highlight .err{color:#F1403C;}.css-yvdm7v .highlight .k{font-weight:600;}.css-yvdm7v .highlight .o{font-weight:600;}.css-yvdm7v .highlight .cm{font-style:italic;color:#999999;}.css-yvdm7v .highlight .cp{font-weight:600;color:#999999;}.css-yvdm7v .highlight .c1{font-style:italic;color:#999999;}.css-yvdm7v .highlight .cs{font-style:italic;font-weight:600;color:#999999;}.css-yvdm7v .highlight .gd{color:#FF3366;}.css-yvdm7v .highlight .ge{font-style:italic;}.css-yvdm7v .highlight .gr{color:#F1403C;}.css-yvdm7v .highlight .gh{color:#999999;}.css-yvdm7v .highlight .gi{color:#12b370;}.css-yvdm7v .highlight .go{color:#808080;}.css-yvdm7v .highlight .gp{color:#646464;}.css-yvdm7v .highlight .gs{font-weight:600;}.css-yvdm7v .highlight .gu{color:#999999;}.css-yvdm7v .highlight .gt{color:#F1403C;}.css-yvdm7v .highlight .kc{font-weight:600;}.css-yvdm7v .highlight .kd{font-weight:600;}.css-yvdm7v .highlight .kn{font-weight:600;}.css-yvdm7v .highlight .kp{font-weight:600;}.css-yvdm7v .highlight .kr{font-weight:600;}.css-yvdm7v .highlight .kt{font-weight:600;color:#175199;}.css-yvdm7v .highlight .m{color:#056DE8;}.css-yvdm7v .highlight .s{color:#F1403C;}.css-yvdm7v .highlight .na{color:#056DE8;}.css-yvdm7v .highlight .nb{color:#056DE8;}.css-yvdm7v .highlight .nc{font-weight:600;color:#175199;}.css-yvdm7v .highlight .no{color:#056DE8;}.css-yvdm7v .highlight .ni{color:#5555DD;}.css-yvdm7v .highlight .ne{font-weight:600;color:#F1403C;}.css-yvdm7v .highlight .nf{font-weight:600;color:#F1403C;}.css-yvdm7v .highlight .nn{color:#646464;}.css-yvdm7v .highlight .nt{color:#175199;}.css-yvdm7v .highlight .nv{color:#056DE8;}.css-yvdm7v .highlight .ow{font-weight:600;}.css-yvdm7v .highlight .w{color:#BFBFBF;}.css-yvdm7v .highlight .mf{color:#056DE8;}.css-yvdm7v .highlight .mh{color:#056DE8;}.css-yvdm7v .highlight .mi{color:#056DE8;}.css-yvdm7v .highlight .mo{color:#056DE8;}.css-yvdm7v .highlight .sb{color:#F1403C;}.css-yvdm7v .highlight .sc{color:#F1403C;}.css-yvdm7v .highlight .sd{color:#F1403C;}.css-yvdm7v .highlight .s2{color:#F1403C;}.css-yvdm7v .highlight .se{color:#F1403C;}.css-yvdm7v .highlight .sh{color:#F1403C;}.css-yvdm7v .highlight .si{color:#F1403C;}.css-yvdm7v .highlight .sx{color:#F1403C;}.css-yvdm7v .highlight .sr{color:#A5542F;}.css-yvdm7v .highlight .s1{color:#F1403C;}.css-yvdm7v .highlight .ss{color:#F1403C;}.css-yvdm7v .highlight .bp{color:#999999;}.css-yvdm7v .highlight .vc{color:#056DE8;}.css-yvdm7v .highlight .vg{color:#056DE8;}.css-yvdm7v .highlight .vi{color:#056DE8;}.css-yvdm7v .highlight .il{color:#056DE8;}.css-yvdm7v .highlight::-webkit-scrollbar{width:6px;height:6px;}.css-yvdm7v .highlight::-webkit-scrollbar-thumb:horizontal{background-color:rgba(18,18,18,0.5);border-radius:6px;}.css-yvdm7v .highlight::-webkit-scrollbar-thumb:horizontal:hover{background-color:rgba(18,18,18,0.6);}.css-yvdm7v .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-yvdm7v .LinkCard.old,.css-yvdm7v .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-yvdm7v .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(246,246,246,0.88);color:#D3D3D3;}.css-yvdm7v .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#EBEBEB;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-yvdm7v .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-yvdm7v .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-yvdm7v .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#EBEBEB;}.css-yvdm7v .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-yvdm7v .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}.css-yvdm7v .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#F6F6F6;}.css-yvdm7v .LinkCard.new,.css-yvdm7v .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-yvdm7v .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-yvdm7v .LinkCard.new .LinkCard-contents .loading{height:14px;background:#EBEBEB;border-radius:7px;}.css-yvdm7v .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-yvdm7v .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#121212;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-yvdm7v .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-yvdm7v .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-yvdm7v .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-yvdm7v .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-yvdm7v .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#999999;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-yvdm7v .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#444444;}.css-yvdm7v .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#999999;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-yvdm7v .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-yvdm7v .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(211,211,211,0.3);}.css-yvdm7v .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-yvdm7v .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-yvdm7v .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#EBEBEB;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-yvdm7v .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#EBEBEB;color:#D3D3D3;}.css-yvdm7v .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#999999;}.css-yvdm7v .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-yvdm7v .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-yvdm7v .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#444444;}.css-yvdm7v .LinkCard.new .LinkCard-richText .text{color:#444444;}.css-yvdm7v .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-yvdm7v .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-yvdm7v .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(246,246,246,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-yvdm7v .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-yvdm7v .FileLinkCard-info{margin-left:12px;}.css-yvdm7v .FileLinkCard-name{color:#121212;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-yvdm7v .FileLinkCard-meta{color:#999999;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-yvdm7v .FileLinkCard-source{white-space:pre;}@-webkit-keyframes animation-1sh55c5{from{opacity:0;}to{opacity:1;}}@keyframes animation-1sh55c5{from{opacity:0;}to{opacity:1;}}</style><style data-emotion-css="1s3a4zw">.css-1s3a4zw{position:relative;display:inline-block;height:30px;padding:0 12px;font-size:14px;line-height:30px;color:#056DE8;vertical-align:top;border-radius:100px;background:rgba(5,109,232,0.1);}.css-1s3a4zw:hover{background-color:rgba(5,109,232,0.15);}</style><style data-emotion-css="u1frr4">.css-u1frr4{width:724px;}.css-u1frr4 .Modal-content{margin:22px 0 5px;}.css-u1frr4 .Creator-QuestionShared-title{padding-right:65px;}</style><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.zswsdid.2cc328e23d7862d71b15.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.shared_da7c8ae9ba4d3befc7c2f1c0b3e151cc8ee375ec.4f345cab0cd0b6a503cb.js.download" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./UE UnrealInsights 使用与实现 - 知乎_files/column.user-hover-card.216a26f4.2325354b564ca3c742a9.css" crossorigin="anonymous"><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.user-hover-card.e87bd5c7db1ff02c3ce4.js.download" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./UE UnrealInsights 使用与实现 - 知乎_files/column.Labels.216a26f4.7d19d2afdc588e36471f.css" crossorigin="anonymous"><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.Labels.25fadde6407133a2ad02.js.download" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./UE UnrealInsights 使用与实现 - 知乎_files/column.GoodsRecommendGoodsCardList.216a26f4.fa4bea774ed719d42a42.css" crossorigin="anonymous"><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.GoodsRecommendGoodsCardList.190473a9b75a37ce9cf2.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.report_modals.f2d5fb1489ceb67917fe.js.download" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./UE UnrealInsights 使用与实现 - 知乎_files/column.modals.216a26f4.4cc94e5a02bc6d62ae13.css" crossorigin="anonymous"><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.modals.7427bf5d37d675b109a9.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.lib_cf230269.651fe07b8e686459fe58.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.comments-v3.8b56d754fdc37da78fe9.js.download" crossorigin="anonymous"></script><style data-emotion="css"></style><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.lib_9974496f.52c2110d3401aef4e8b3.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.shared_03103dc5b8182a3433c5ef33bacb88093fd08a38.9ca8f4a418b67f92c939.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.shared_889419e066c38251e2dcbb9a7c42dbfc379cadeb.254e4f3e730a6b488d17.js.download" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./UE UnrealInsights 使用与实现 - 知乎_files/column.EditableV2.216a26f4.56bfcd6fcf02391f767f.css" crossorigin="anonymous"><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.EditableV2.9f0e35d0c4103cc5b4ea.js.download" crossorigin="anonymous"></script><script charset="utf-8" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.83.5124800e486d3a602647.js.download" crossorigin="anonymous"></script></head><body class="WhiteBg-body PostIndex-body" data-rh="class"><div id="root"><div class="App"><div class="LoadingBar"></div><div><span style="position:absolute;top:-10000px;left:-10000px" role="log" aria-live="assertive"></span></div><main role="main" class="App-main"><div class="Post-content" data-zop-usertoken="{&quot;userToken&quot;:&quot;ao-ta-kang-007&quot;}" data-zop="{&quot;authorName&quot;:&quot;南京周润发&quot;,&quot;itemId&quot;:458086085,&quot;title&quot;:&quot;UE UnrealInsights 使用与实现&quot;,&quot;type&quot;:&quot;article&quot;}" data-za-detail-view-path-module="PostItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;token&quot;:&quot;458086085&quot;}}}"><div class="ColumnPageHeader-Wrapper"><div><div class="Sticky ColumnPageHeader is-fixed css-1l12z7y" style="width: 1581.33px; top: 0px; left: 0px;"><div class="ColumnPageHeader-content"><a href="https://www.zhihu.com/" aria-label="知乎"><svg viewBox="0 0 64 30" fill="#056DE8" width="64" height="30" class="css-1hlrcxk"><path d="M29.05 4.582H16.733V25.94h3.018l.403 2.572 4.081-2.572h4.815V4.582zm-5.207 18.69l-2.396 1.509-.235-1.508h-1.724V7.233h6.78v16.04h-2.425zM14.46 14.191H9.982c0-.471.033-.954.039-1.458v-5.5h5.106V5.935a1.352 1.352 0 0 0-.404-.957 1.378 1.378 0 0 0-.968-.396H5.783c.028-.088.056-.177.084-.255.274-.82 1.153-3.326 1.153-3.326a4.262 4.262 0 0 0-2.413.698c-.57.4-.912.682-1.371 1.946-.532 1.453-.997 2.856-1.31 3.693C1.444 8.674.28 11.025.28 11.025a5.85 5.85 0 0 0 2.52-.61c1.119-.593 1.679-1.502 2.054-2.883l.09-.3h2.334v5.5c0 .5-.045.982-.073 1.46h-4.12c-.71 0-1.39.278-1.893.775a2.638 2.638 0 0 0-.783 1.874h6.527a17.717 17.717 0 0 1-.778 3.649 16.796 16.796 0 0 1-3.012 5.273A33.104 33.104 0 0 1 0 28.74s3.13 1.175 5.425-.954c1.388-1.292 2.631-3.814 3.23-5.727a28.09 28.09 0 0 0 1.12-5.229h5.967v-1.37a1.254 1.254 0 0 0-.373-.899 1.279 1.279 0 0 0-.909-.37z"></path><path d="M11.27 19.675l-2.312 1.491 5.038 7.458a6.905 6.905 0 0 0 .672-2.218 3.15 3.15 0 0 0-.28-2.168l-3.118-4.563zM51.449 15.195V5.842c4.181-.205 7.988-.405 9.438-.483l.851-.05c.387-.399.885-2.395.689-3.021-.073-.25-.213-.666-.638-.555a33.279 33.279 0 0 1-4.277.727c-2.766.321-3.97.404-7.804.682-6.718.487-12.709.72-12.709.72a2.518 2.518 0 0 0 .788 1.834 2.567 2.567 0 0 0 1.883.706c2.278-.095 5.598-.25 8.996-.41v9.203h-12.78c0 .703.281 1.377.783 1.874a2.69 2.69 0 0 0 1.892.777h10.105v7.075c0 .887-.464 1.192-1.231 1.214h-3.92a4.15 4.15 0 0 0 .837 1.544 4.2 4.2 0 0 0 1.403 1.067 6.215 6.215 0 0 0 2.71.277c1.36-.066 2.967-.826 2.967-3.57v-7.607h11.28c.342 0 .67-.135.91-.374.242-.239.378-.563.378-.902v-1.375H51.449z"></path><path d="M42.614 8.873a2.304 2.304 0 0 0-1.508-.926 2.334 2.334 0 0 0-1.727.405l-.376.272 4.255 5.85 2.24-1.62-2.884-3.98zM57.35 8.68l-3.125 4.097 2.24 1.663 4.517-5.927-.375-.277a2.32 2.32 0 0 0-1.722-.452 2.327 2.327 0 0 0-1.536.896z"></path></svg></a><i class="ColumnPageHeader-Line"></i><div class="ColumnPageHeader-Title"><div class="ColumnPageHeader-TitleName"><span class="ColumnPageHeader-TitleMeta">首发于</span><a class="ColumnLink ColumnPageHeader-TitleColumn" href="https://www.zhihu.com/column/c_1093468071653646336">UE随笔</a></div></div><div class="ColumnPageHeader-Button"><div class="Popover"><button title="更多" id="Popover1-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover1-content" type="button" class="Button ColumnPageHeader-MenuToggler Button--plain"><svg width="24" height="24" viewBox="0 0 24 24" data-new-api="Dots24" data-old-api="Dots" class="Zi Zi--Dots" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0z"></path></svg></button></div><button type="button" class="Button ColumnPageHeader-WriteButton Button--blue"><svg width="24" height="24" viewBox="0 0 24 24" data-new-api="PencilPaper24" data-old-api="EditSurround" class="Zi Zi--EditSurround" fill="currentColor"><path d="M3.55 5.97a2.415 2.415 0 012.415-2.416h7.56a.75.75 0 010 1.5h-7.56a.915.915 0 00-.915.915v12.072c0 .505.41.915.915.915h12.074c.506 0 .915-.41.915-.915v-7.557a.75.75 0 011.5 0v7.557a2.415 2.415 0 01-2.415 2.415H5.965A2.415 2.415 0 013.55 18.04V5.969z" fill-rule="evenodd" clip-rule="evenodd"></path><path d="M20.239 3.77a.75.75 0 010 1.06l-8.206 8.206a.75.75 0 01-1.06-1.06l8.205-8.206a.75.75 0 011.06 0z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>写文章</button></div></div><div class="ColumnPageHeader-profile"><div class="Popover AppHeader-menu"><button id="Popover7-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover7-content" type="button" class="Button AppHeader-profileEntry Button--plain"><img class="Avatar AppHeader-profileAvatar" width="30" height="30" src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-ef69d369588e9764f9252225e6dc29ce_is.jpg" srcset="https://pic4.zhimg.com/v2-ef69d369588e9764f9252225e6dc29ce_im.jpg?source=32738c0c 2x" alt="点击打开奥塔康007的主页"></button></div><div class="Popover AppHeaderProfileMenu-creatorHintPopover"><div class="AppHeaderProfileMenu-creatorHintToggler" id="Popover8-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover8-content"></div></div></div></div><div class="Sticky--holder" style="position: relative; inset: 0px; display: block; float: none; margin: 0px; height: 52px;"></div></div></div><img class="TitleImage" src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-66158357a4b02c2e832dfe63798cca01_1440w.jpg" alt="UE UnrealInsights 使用与实现"><article class="Post-Main Post-NormalMain" tabindex="-1"><header class="Post-Header"><h1 class="Post-Title">UE UnrealInsights 使用与实现</h1><div class="Post-Author"><div class="AuthorInfo" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><div class="AuthorInfo"><meta itemprop="name" content="南京周润发"><meta itemprop="image" content="https://pic1.zhimg.com/v2-74e1a6777c0dbc55d34ce5b429e3041d_l.jpg?source=172ae18b"><meta itemprop="url" content="https://www.zhihu.com/people/xu-chen-71-65"><meta itemprop="zhihu:followerCount"><span class="UserLink AuthorInfo-avatarWrapper"><div class="Popover"><div id="Popover9-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover9-content"><a href="https://www.zhihu.com/people/xu-chen-71-65" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar Avatar--round AuthorInfo-avatar" width="38" height="38" src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-74e1a6777c0dbc55d34ce5b429e3041d_xs.jpg" srcset="https://pic1.zhimg.com/v2-74e1a6777c0dbc55d34ce5b429e3041d_l.jpg?source=172ae18b 2x" alt="南京周润发"></a></div></div></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><div class="Popover"><div id="Popover10-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover10-content"><a href="https://www.zhihu.com/people/xu-chen-71-65" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">南京周润发</a></div></div></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"><div class="ztext AuthorInfo-badgeText css-0">网易游戏码农</div></div></div></div></div></div><button type="button" class="Button FollowButton Button--primary Button--blue"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="PlusFill24" data-old-api="Plus" class="Zi Zi--Plus FollowButton-icon" fill="currentColor"><path d="M13.25 3.25a1.25 1.25 0 10-2.5 0v7.5h-7.5a1.25 1.25 0 100 2.5h7.5v7.5a1.25 1.25 0 102.5 0v-7.5h7.5a1.25 1.25 0 000-2.5h-7.5v-7.5z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>关注他</button></div><div class="LabelContainer-wrapper"></div><div role="button" tabindex="0"><span class="Voters"><span><span class="UserLink"><div class="Popover"><div id="Popover11-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover11-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/chang-xiao-qi-86">Jerish</a></div></div></span></span><span>、<span class="UserLink"><div class="Popover"><div id="Popover12-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover12-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="https://www.zhihu.com/people/lin-hai-wei-62">qbkivlin</a></div></div></span></span> 等 <button type="button" class="Button Button--plain">76 人赞同了该文章</button></span></div></header><div class="Post-RichTextContainer"><div class="css-1yuhvjn"><div class="RichText ztext Post-RichText css-yvdm7v" options="[object Object]"><h2 data-first-child="">Unreal Insights使用</h2><p data-pid="X8yKEMKd">UnrealInsights是UE的新一代Profile工具，用于替代原先的Stats，比如Frontend。它可以Profile CPU，GPU，Network，Animation，Slate，功能更强大，界面也更友好易用。比较常用的是CPU Profile，界面如下：</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-20f2c7ce0b6884cb1342f5b387fe3f15_b.jpg" data-caption="" data-size="normal" data-rawwidth="1600" data-rawheight="900" class="origin_image zh-lightbox-thumb" width="1600" data-original="https://pic2.zhimg.com/v2-20f2c7ce0b6884cb1342f5b387fe3f15_r.jpg"/></noscript><img src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-20f2c7ce0b6884cb1342f5b387fe3f15_1440w.jpg" data-caption="" data-size="normal" data-rawwidth="1600" data-rawheight="900" class="origin_image zh-lightbox-thumb lazy" width="1600" data-original="https://pic2.zhimg.com/v2-20f2c7ce0b6884cb1342f5b387fe3f15_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-20f2c7ce0b6884cb1342f5b387fe3f15_b.jpg" data-lazy-status="ok"></figure><p data-pid="6O54nnkb">前两个函数用于更新连续状态等内容，可不管，重点看后两个函数。于浏览profile数据。</p><p data-pid="3eOvTt5q">关于使用方式，官方文档中有详细的介绍</p><div class="RichText-LinkCardContainer"><a target="_blank" href="https://link.zhihu.com/?target=https%3A//docs.unrealengine.com/4.27/en-US/TestingAndOptimization/PerformanceAndProfiling/UnrealInsights/" data-draft-node="block" data-draft-type="link-card" data-text="Unreal Insights | Unreal Engine Documentation" class="LinkCard new css-1wr1m8" data-za-detail-view-id="172"><span class="LinkCard-contents"><span class="LinkCard-title two-line">Unreal Insights | Unreal Engine Documentation</span><span class="LinkCard-desc"><span style="display: inline-flex; align-items: center;">​<svg width="14" height="14" viewBox="0 0 24 24" data-new-api="Link24" data-old-api="InsertLink" class="Zi Zi--InsertLink" fill="currentColor"><path d="M5.327 18.883a3.005 3.005 0 010-4.25l2.608-2.607a.75.75 0 10-1.06-1.06l-2.608 2.607a4.505 4.505 0 006.37 6.37l2.608-2.607a.75.75 0 00-1.06-1.06l-2.608 2.607a3.005 3.005 0 01-4.25 0zm5.428-11.799a.75.75 0 001.06 1.06L14.48 5.48a3.005 3.005 0 014.25 4.25l-2.665 2.665a.75.75 0 001.061 1.06l2.665-2.664a4.505 4.505 0 00-6.371-6.372l-2.665 2.665zm5.323 2.117a.75.75 0 10-1.06-1.06l-7.072 7.07a.75.75 0 001.061 1.06l7.071-7.07z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>docs.unrealengine.com/4.27/en-US/TestingAndOptimization/PerformanceAndProfiling/UnrealInsights/</span></span></a></div><p data-pid="UcINd15G">命令行启动</p><p data-pid="SbCMKLMZ">添加-trace=[channel1,channel2…] -statnamedevents -tracehost=127.0.0.1</p><p data-pid="HNsGK5AI">本地先启动UnrealInsights服务器，然后启动游戏就能连上</p><p data-pid="KQKqwwui"> 一个例子如下，这几乎是最详细的标签了</p><p data-pid="t4H5EvOZ">-trace=CPU,Log,Bookmark,Frame,GPU,LoadTime,File,Net,Stats,Counters -statnamedevents -tracehost=127.0.0.1</p><p data-pid="2B_CLXcI">UE有快速Prfile方式，Windows环境下，只需先打开UnrealInsights.exe，再打开standalone游戏，就可以进行profile，不需要额外命令行。</p><h2>标记</h2><p data-pid="VKLCkqsu">Unreal Insight可以使用以下标记</p><p data-pid="akSXgsR4">TRACE_CPUPROFILER_EVENT_SCOPE(xxx)</p><p data-pid="ylMpIdL8">TRACE_BOOKMARK(TEXT("xxx %s "), string)</p><p data-pid="VAwiPqGu">也支持现有stats标记</p><p data-pid="SUu-zqCV">SCOPE_CYCLE_COUNTER(xxxxx)</p><h2>Channel</h2><p data-pid="shbYYgB6">Channel表示要Profile哪些类目，比如CpuChannel对应RACE_CPUPROFILER_EVENT_SCOPE标签，CpuChannel打开后该标签才会起效。</p><p data-pid="TTjEQH7g">Channel通过命令行参数-trace配置，比如-trace=channel1,channel2…</p><p data-pid="8HRHjI9e">XXXEngine.ini可以配置默认Channel，如果-trace没有跟Channel，就用Presets</p><p data-pid="-_Nkwp7j">[Trace.ChannelPresets]</p><p data-pid="AcgYxhpk">Default=cpu,frame,log,bookmark</p><p data-pid="uQfdbCW5">Rendering=gpu,cpu,frame,log,bookmark</p><h2>其他Insights</h2><p data-pid="UV38ADsn">Unreal Insights主要用于Profile CPU，UE还提供了其他几种Insights工具，用来Profile不同部分。</p><h3>Networking Insights</h3><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-0ed1ef939c1ee61445e932ca3f65e5d4_b.jpg" data-caption="" data-size="normal" data-rawwidth="1290" data-rawheight="730" class="origin_image zh-lightbox-thumb" width="1290" data-original="https://pic1.zhimg.com/v2-0ed1ef939c1ee61445e932ca3f65e5d4_r.jpg"/></noscript><img src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-0ed1ef939c1ee61445e932ca3f65e5d4_1440w.jpg" data-caption="" data-size="normal" data-rawwidth="1290" data-rawheight="730" class="origin_image zh-lightbox-thumb lazy" width="1290" data-original="https://pic1.zhimg.com/v2-0ed1ef939c1ee61445e932ca3f65e5d4_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-0ed1ef939c1ee61445e932ca3f65e5d4_b.jpg" data-lazy-status="ok"></figure><p data-pid="rLk3H9nE">用于Profile网络数据流。可以看到网络流量变化以及数据包具体内容，比如Actor同步数据，同步了哪个Actor，属性同步数据，同步了哪些属性。</p><p data-pid="sFZHNrSm">使用方法</p><p data-pid="Bm-GkoGl">-NetTrace=1 -tracehost=localhost -trace=net</p><p data-pid="4zzbgcfA">其他还有Animation Insights和Slate Insights，就不过多介绍了，官方文档有更详细的说明。</p><h2>Unreal Insights原理</h2><h3>开启流程</h3><p data-pid="qjm-zzSy">开启Unreal Insights主要使用FTraceAuxiliaryImpl类，该类负责解析命令行，控制连接服务器和打开insight文件，以及Unreal Insights的开启/关闭。</p><p data-pid="RF7peTtt">FTraceAuxiliaryImpl</p><p data-pid="L_hFMfo7">主要属性</p><p data-pid="1XA9plcA">Tmap&lt;uint32, FChannel&gt; Channels 当前要profile的channel，比如cpu，frame，network等等，key为channel name的hash。注意此处的Channel只是真正Profile所使用Trace::Channel的handler，它们是两个类型，修改它们的Active属性后，要同步到“真正”的Channel实例。</p><p data-pid="ALxuWRri">TraceDest 连接的服务器地址或写入的文件名</p><p data-pid="QlDLZ3rj">初始开启</p><p data-pid="pWVCQEns">FEngineLoop::PreInitPreStartupScreen函数调用FTraceAuxiliary::Initialize函数，传入CmdLine，开启UnrealInsight。</p><p data-pid="prSwMYli">FTraceAuxiliary::Initialize()</p><p data-pid="FwEG2BRn">首先，把程序简要信息写入Buffer，包括Platform，AppName等。</p><div class="highlight"><pre><code class="language-cpp"><span class="n">UE_TRACE_LOG</span><span class="p">(</span><span class="n">Diagnostics</span><span class="p">,</span> <span class="n">Session2</span><span class="p">,</span> <span class="n">Trace</span><span class="o">::</span><span class="n">TraceLogChannel</span><span class="p">)</span>
	<span class="o">&lt;&lt;</span> <span class="n">Session2</span><span class="p">.</span><span class="n">Platform</span><span class="p">(</span><span class="n">PREPROCESSOR_TO_STRING</span><span class="p">(</span><span class="n">UBT_COMPILED_PLATFORM</span><span class="p">))</span>
	<span class="o">&lt;&lt;</span> <span class="n">Session2</span><span class="p">.</span><span class="n">AppName</span><span class="p">(</span><span class="n">UE_APP_NAME</span><span class="p">)</span>
	<span class="o">&lt;&lt;</span> <span class="n">Session2</span><span class="p">.</span><span class="n">CommandLine</span><span class="p">(</span><span class="n">CommandLine</span><span class="p">)</span>
	<span class="o">&lt;&lt;</span> <span class="n">Session2</span><span class="p">.</span><span class="n">ConfigurationType</span><span class="p">(</span><span class="n">uint8</span><span class="p">(</span><span class="n">FApp</span><span class="o">::</span><span class="n">GetBuildConfiguration</span><span class="p">()))</span>
        <span class="o">&lt;&lt;</span> <span class="n">Session2</span><span class="p">.</span><span class="n">TargetType</span><span class="p">(</span><span class="n">uint8</span><span class="p">(</span><span class="n">FApp</span><span class="o">::</span><span class="n">GetBuildTargetType</span><span class="p">()));</span>
</code></pre></div><p data-pid="E99hUcqK">接着解析-trace=channel1,channel2…参数中指定的Channel，把它们加入到Channels map中。每个Channel都有Active状态，开启后才会收集该Channel的数据，默认开启。如果用户没有提供Channel，UE会去Engine.ini获取Trace.ChannelPresets指定的预置Channel，默认是cpu,frame,log,bookmark。</p><p data-pid="TAhezuQT">之后解析-tracehost和-tracehost，判断要把profile数据发到某个insight服务器还是写入某个文件。</p><ul><li data-pid="0CSZtpye">连接服务器会创建一条TCP连接，过程是阻塞的，可指定对方ip:port，如不指定port就用默认的1980端口。</li><li data-pid="nLP2M_dN">写入文件可指定path和文件名，如果是相对路径，会写入Profiling目录，如果没特殊需求，相对路径就够了。写文件之前要把得到的/Game/….路径转换为各平台的路径，比如安卓就是/sdcard/…开头的路径，之后以write模式打开文件，准备写入。</li></ul><p data-pid="VwtmC_l4">到这里初始化unreal insights读取命令行初始化就完成了，我们已配置channel，建立服务器连接或打开了文件。</p><p data-pid="D59DKwDH">windows缺省开启</p><p data-pid="DafwNZgF">我们大部分情况使用windows开发调试，因此UE为我们提供了windows缺省开启模式，只要本地打开insight客户端，再开游戏，就会使用默认Channel，自动连接，方便了profile。</p><h3>Channel定义</h3><p data-pid="JgqzYI3B">Channel使用UE_TRACE_CHANNEL_DEFINE定义，例如CpuChannel</p><p data-pid="MedOKraS">UE_TRACE_CHANNEL_DEFINE(CpuChannel)</p><p data-pid="z9ETY7W3">创建名为CpuChannelObject的FChannel实例，作为静态变量，然后创建名为CpuChannel的引用对象。之后创建名为FCpuChannelRegister的结构体和实例，主要作用为调用CpuChannelObject.Setup函数进行注册。Channel新建后会保存在GNewChannelList链表中，Channel信息被WriterBuffer发送之后，链表被清空。</p><h3>FChanne::Toggle函数的坑</h3><p data-pid="CJcvUKLa">观察FChannel，发现有Toggle函数可以开启/关闭某个Channel，但其底层使用了原子P/V操作来修改Enabled，Enabled是int类型而不是bool。</p><div class="highlight"><pre><code class="language-cpp"><span class="kt">bool</span> <span class="n">FChannel</span><span class="o">::</span><span class="n">Toggle</span><span class="p">(</span><span class="kt">bool</span> <span class="n">bEnabled</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">using</span> <span class="k">namespace</span> <span class="n">Private</span><span class="p">;</span>
	<span class="n">int64</span> <span class="n">OldRefCnt</span> <span class="o">=</span> <span class="n">AtomicAddRelaxed</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Enabled</span><span class="p">,</span> <span class="n">bEnabled</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

	<span class="n">UE_TRACE_LOG</span><span class="p">(</span><span class="n">Trace</span><span class="p">,</span> <span class="n">ChannelToggle</span><span class="p">,</span> <span class="n">TraceLogChannel</span><span class="p">)</span>
		<span class="o">&lt;&lt;</span> <span class="n">ChannelToggle</span><span class="p">.</span><span class="n">Id</span><span class="p">(</span><span class="n">Name</span><span class="p">.</span><span class="n">Hash</span><span class="p">)</span>
		<span class="o">&lt;&lt;</span> <span class="n">ChannelToggle</span><span class="p">.</span><span class="n">IsEnabled</span><span class="p">(</span><span class="n">IsEnabled</span><span class="p">());</span>

	<span class="k">return</span> <span class="nf">IsEnabled</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div><p data-pid="szA-jIpi">意味着要小心Toggle()函数执行的次数，如果执行序列未Toggle(false), Toggle(false), Toggle(true)，那么值还是false。</p><h3>收集Profile数据</h3><p data-pid="kTAkcCm9">收集Profile数据是Unreal Insights最重要的部分。</p><h3>创建profile标签</h3><p data-pid="ssNKLvQx">我们可以使用宏创建新的profile标签，常用的为TRACE_CPUPROFILER_EVENT_SCOPE(Name)，可以在函数的第一行添加它，这样就记录了函数的总执行时间。</p><p data-pid="263yUKuE">宏最终展开内容如下：</p><div class="highlight"><pre><code class="language-cpp"><span class="cp">#define TRACE_CPUPROFILER_EVENT_SCOPE_ON_CHANNEL_STR(NameStr, Channel) \
</span><span class="cp">	static uint32 PREPROCESSOR_JOIN(__CpuProfilerEventSpecId, __LINE__); \
</span><span class="cp">	if (bool(Channel|CpuChannel) &amp;&amp; PREPROCESSOR_JOIN(__CpuProfilerEventSpecId, __LINE__) == 0) { \
</span><span class="cp">		PREPROCESSOR_JOIN(__CpuProfilerEventSpecId, __LINE__) = FCpuProfilerTrace::OutputEventType(NameStr); \
</span><span class="cp">	} \
</span><span class="cp">	FCpuProfilerTrace::FEventScope PREPROCESSOR_JOIN(__CpuProfilerEventScope, __LINE__)(PREPROCESSOR_JOIN(__CpuProfilerEventSpecId, __LINE__), Channel);
</span></code></pre></div><p data-pid="KDEm3WHT">PREPROCESSOR_JOIN宏把两个参数拼接到一起，因此创建了名为__CpuProfilerEventSpecIdXXX的uint32变量，注意这是一个static变量，每个标签都对应一个，可以称为SpecId。之后判断该变量是否为0，即我们是否第一次进到这个标签，如果是第一次，要使用FCpuProfilerTrace::OutputEventType()函数获取新的Id，Id是自增的且可多线程访问。期间还有UE_TRACE_LOG写入操作，这个下文再介绍。</p><p data-pid="JypiKDcm">最后创建FCuProfilerTrace::FEventScope对象，该对象的生命周期就是我们的profile周期，构造函数开始profile，析构函数结束profile。</p><p data-pid="nbHFpLwl"><b>FEventScope</b></p><div class="highlight"><pre><code class="language-cpp"><span class="k">struct</span> <span class="nc">FEventScope</span>
<span class="p">{</span>
    <span class="n">FEventScope</span><span class="p">(</span><span class="n">uint32</span> <span class="n">InSpecId</span><span class="p">,</span> <span class="k">const</span> <span class="n">Trace</span><span class="o">::</span><span class="n">FChannel</span><span class="o">&amp;</span> <span class="n">Channel</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">bEnabled</span><span class="p">(</span><span class="n">Channel</span> <span class="o">|</span> <span class="n">CpuChannel</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bEnabled</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">OutputBeginEvent</span><span class="p">(</span><span class="n">InSpecId</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="o">~</span><span class="n">FEventScope</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bEnabled</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">OutputEndEvent</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="n">bEnabled</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div><p data-pid="CqoCUxsg">注意到无论构造函数还是析构函数，都会先判断bEnabled，而bEnabled由Chennel值决定。我们可以中途通过Trace.Start和Trace.Stop来动态改变Channel值，使后面代码不走，这样就能按需开启/关闭Profile数据收集了，但打开的TCP连接和文件描述符，还保留着。</p><p data-pid="AW_eBXtO"><b>构造函数</b></p><p data-pid="ECtt_Kmm">先看构造函数中的OutputBeginEvent，InSpecId就是我们之前创建的静态变量SpecId，函数内部又是两个宏。</p><div class="highlight"><pre><code class="language-cpp"><span class="cp">#define CPUPROFILERTRACE_OUTPUTBEGINEVENT_PROLOGUE() \
</span><span class="cp">	++FCpuProfilerTraceInternal::ThreadDepth; \
</span><span class="cp">	FCpuProfilerTraceInternal::FThreadBuffer* ThreadBuffer = FCpuProfilerTraceInternal::ThreadBuffer; \
</span><span class="cp">	if (!ThreadBuffer) \
</span><span class="cp">	{ \
</span><span class="cp">		ThreadBuffer = FCpuProfilerTraceInternal::CreateThreadBuffer(); \
</span><span class="cp">	} \
</span><span class="cp">
</span><span class="cp">#define CPUPROFILERTRACE_OUTPUTBEGINEVENT_EPILOGUE() \
</span><span class="cp">	uint64 Cycle = FPlatformTime::Cycles64(); \
</span><span class="cp">	uint64 CycleDiff = Cycle - ThreadBuffer-&gt;LastCycle; \
</span><span class="cp">	ThreadBuffer-&gt;LastCycle = Cycle; \
</span><span class="cp">	uint8* BufferPtr = ThreadBuffer-&gt;Buffer + ThreadBuffer-&gt;BufferSize; \
</span><span class="cp">	FTraceUtils::Encode7bit((CycleDiff &lt;&lt; 1) | 1ull, BufferPtr); \
</span><span class="cp">	FTraceUtils::Encode7bit(SpecId, BufferPtr); \
</span><span class="cp">	ThreadBuffer-&gt;BufferSize = (uint16)(BufferPtr - ThreadBuffer-&gt;Buffer); \
</span><span class="cp">	if (ThreadBuffer-&gt;BufferSize &gt;= FCpuProfilerTraceInternal::FullBufferThreshold) \
</span><span class="cp">	{ \
</span><span class="cp">		FCpuProfilerTraceInternal::FlushThreadBuffer(ThreadBuffer); \
</span><span class="cp">	}
</span><span class="cp"></span>
<span class="kt">void</span> <span class="n">FCpuProfilerTrace</span><span class="o">::</span><span class="n">OutputBeginEvent</span><span class="p">(</span><span class="n">uint32</span> <span class="n">SpecId</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">CPUPROFILERTRACE_OUTPUTBEGINEVENT_PROLOGUE</span><span class="p">();</span>
	<span class="n">CPUPROFILERTRACE_OUTPUTBEGINEVENT_EPILOGUE</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div><p data-pid="pgk3SCTo"><b>CPUPROFILERTRACE_OUTPUTBEGINEVENT_PROLOGUE</b></p><p data-pid="GFywnnXp">首先递增ThreadDepth，它是ThreadLocal变量，用于表示当前线程的CPUPROFILETRACE深度。之后按需创建同样是ThreadLocal变量的ThreadBuffer，用于记录Profile数据。</p><p data-pid="OxvjYTDv"><b>FThreadBuffer</b></p><p data-pid="X3c95Qsi">FThreadBuffer可以理解为一块内存，用于存储多个EventScope的相关数据。</p><p data-pid="4nfu4S9f">主要属性：</p><p data-pid="pUecTj1u">uint64 LastCycle 最后一次记录的时钟周期</p><p data-pid="IQRRqQ_C">uint8 Buffer[MaxBufferSize] 存储数据的Buffer，MaxBufferSize默认256</p><p data-pid="Z87y0lwl">uint16 BufferSize 当前存储数据的size</p><p data-pid="6wds5uEZ">类FCpuProfilerTraceInternal的静态成员ThreadBuffer就是当前线程所使用的ThreadBuffer。</p><p data-pid="SNGqTvpN"><b>CPUPROFILERTRACE_OUTPUTBEGINEVENT_EPILOGUE</b></p><p data-pid="jZKmTaFm">之后获取当前CPU时钟tick计数，需要高精度，各平台实现不同，比如Windows使用QueryPerformanceCounter，精度高于1微妙，ios平台则使用mach_absolute_time内核接口。得到tick计数后，只要计算与上次记录计数的Diff，然后把Diff和SpecId写入ThreadBuffer即可，因为后面计数会重置，以减小内存消耗。</p><p data-pid="0XLGyny0">注意到写入使用了Encode7bit接口，这是一种变长编码实现，可以节省内存。一个Byte只有7为存储数据，最高位表示当前值是否还有后续部分待读取。举个例子：</p><p data-pid="RgUzVoNv">存储127需要一个Byte</p><p data-pid="XroEi9wX">01111 1111</p><p data-pid="0D3gxHLD">存储128需要两个Byte</p><p data-pid="CjEBQeyl">1111 1111 0000 0001</p><p data-pid="qBlYvy3-">这种变长编码被广泛应用于Protobuf等序列化框架中。</p><p data-pid="h39upYQx">当ThreadBuffer长度超过了FullBufferThreshold，默认256-15，需要执行一次flush，使用UE_TRACE_LOG写入另一个区域，然后重置ThreadBuffer的Buffer和LastCycle。</p><p data-pid="9ckoRc1d"><b>析构函数</b></p><p data-pid="1owI-w_4">再看析构函数，其与构造函数对应，得到当前tick计数的Diff，然后写入ThreadBuffer，注意这次不需要写入id了。同样的，Buffer超阈值，或者Depth退回到0，要flush。</p><h3>UE_TRACE_LOG</h3><p data-pid="9pR_tWVf">Profile数据最终会通过UE_TRACE_LOG进行写入，现在分析它是如何工作的。</p><p data-pid="yqDFbeCV">首先看生成SpecId时写入的例子：</p><div class="highlight"><pre><code class="language-cpp"><span class="n">UE_TRACE_LOG</span><span class="p">(</span><span class="n">CpuProfiler</span><span class="p">,</span> <span class="n">EventSpec</span><span class="p">,</span> <span class="n">CpuChannel</span><span class="p">,</span> <span class="n">NameSize</span><span class="p">)</span>
	<span class="o">&lt;&lt;</span> <span class="n">EventSpec</span><span class="p">.</span><span class="n">Id</span><span class="p">(</span><span class="n">SpecId</span><span class="p">)</span>
	<span class="o">&lt;&lt;</span> <span class="n">EventSpec</span><span class="p">.</span><span class="n">CharSize</span><span class="p">(</span><span class="n">uint8</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">TCHAR</span><span class="p">)))</span>
        <span class="o">&lt;&lt;</span> <span class="n">EventSpec</span><span class="p">.</span><span class="n">Attachment</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="n">NameSize</span><span class="p">);</span>
</code></pre></div><p data-pid="JlSULLtX">不是很直观。。</p><p data-pid="FyU6IKwb">还是需要先把宏都展开</p><p data-pid="2LUb5_wy">第一步</p><div class="highlight"><pre><code class="language-cpp"><span class="cp">#define UE_TRACE_LOG(LoggerName, EventName, ChannelsExpr, ...)			TRACE_PRIVATE_LOG(LoggerName, EventName, ChannelsExpr, ##__VA_ARGS__)
</span></code></pre></div><p data-pid="MILu9N-P">UE_TRACE_LOG的前3个参数为Loggername，EventName，ChannelsExpr，最后一个参数为额外内存大小，这里是NameSize，用于之后存储Name。</p><p data-pid="266ci1SQ">Loggername不是一个独立的类型名或变量名，重点关注EventSpec和ChannlExpr，对应上面例子，就是EventSpec，CpuChannel，看下它们是怎么来的。</p><p data-pid="GNTd3Pn6">EventSpec定义</p><div class="highlight"><pre><code class="language-cpp"><span class="n">UE_TRACE_EVENT_BEGIN</span><span class="p">(</span><span class="n">CpuProfiler</span><span class="p">,</span> <span class="n">EventSpec</span><span class="p">,</span> <span class="n">Important</span><span class="p">)</span>
	<span class="n">UE_TRACE_EVENT_FIELD</span><span class="p">(</span><span class="n">uint32</span><span class="p">,</span> <span class="n">Id</span><span class="p">)</span>
	<span class="n">UE_TRACE_EVENT_FIELD</span><span class="p">(</span><span class="n">uint8</span><span class="p">,</span> <span class="n">CharSize</span><span class="p">)</span>
<span class="n">UE_TRACE_EVENT_END</span><span class="p">()</span>
</code></pre></div><p data-pid="8CJ13gmn">这会创建一个名为CpuProfilerEventSpecEvent的FEventNode实例，以及名为FCpuProfilerEventSpecFields的结构体。</p><p data-pid="QCI7elyK">第二步</p><div class="highlight"><pre><code class="language-cpp"><span class="cp">#define TRACE_PRIVATE_LOG(LoggerName, EventName, ChannelsExpr, ...) \
</span><span class="cp">	TRACE_PRIVATE_LOG_PRELUDE(Enter, LoggerName, EventName, ChannelsExpr, ##__VA_ARGS__) \
</span><span class="cp">		TRACE_PRIVATE_LOG_EPILOG()
</span><span class="cp"></span>		
<span class="cp">#define TRACE_PRIVATE_LOG_PRELUDE(EnterFunc, LoggerName, EventName, ChannelsExpr, ...) \
</span><span class="cp">	if (TRACE_PRIVATE_CHANNELEXPR_IS_ENABLED(ChannelsExpr)) \
</span><span class="cp">		if (auto LogScope = Trace::Private::TLogScope&lt;F##LoggerName##EventName##Fields&gt;::EnterFunc(__VA_ARGS__)) \
</span><span class="cp">if (const auto&amp; __restrict EventName = *(F##LoggerName##EventName##Fields*)LogScope.GetPointer())
</span></code></pre></div><p data-pid="Xhoxc6T3">这里会调用TLogScope&lt;FCpuProfilerEventSpecFields&gt;::Enter函数，创建一个FLogScope实例。</p><div class="highlight"><pre><code class="language-cpp"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="k">auto</span> <span class="n">TLogScope</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">Enter</span><span class="p">(</span><span class="n">uint32</span> <span class="n">ExtraSize</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uint32</span> <span class="n">Size</span> <span class="o">=</span> <span class="n">T</span><span class="o">::</span><span class="n">GetSize</span><span class="p">()</span> <span class="o">+</span> <span class="n">ExtraSize</span><span class="p">;</span>
	<span class="n">uint32</span> <span class="n">Uid</span> <span class="o">=</span> <span class="n">T</span><span class="o">::</span><span class="n">GetUid</span><span class="p">();</span>

	<span class="k">using</span> <span class="n">LogScopeType</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">TLogScopeSelector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">::</span><span class="n">bIsImportant</span><span class="o">&gt;::</span><span class="n">Type</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">LogScopeType</span><span class="o">::</span><span class="k">template</span> <span class="n">Enter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">::</span><span class="n">EventFlags</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Uid</span><span class="p">,</span> <span class="n">Size</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p data-pid="8B0OL3qr">Size包括了成员变量大小，例子中为Id和CharSize的大小，之后调用Enter函数返回FLogScope实例或FImportantLogScope实例，后者只是简单继承了一下。</p><div class="highlight"><pre><code class="language-cpp"><span class="k">class</span> <span class="nc">FLogScope</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
	<span class="k">template</span> <span class="o">&lt;</span><span class="n">uint32</span> <span class="n">Flags</span><span class="o">&gt;</span>
	<span class="k">static</span> <span class="n">FLogScope</span>		<span class="n">Enter</span><span class="p">(</span><span class="n">uint32</span> <span class="n">Uid</span><span class="p">,</span> <span class="n">uint32</span> <span class="n">Size</span><span class="p">);</span>
	<span class="n">uint8</span><span class="o">*</span>					<span class="nf">GetPointer</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">void</span>					<span class="nf">Commit</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">void</span>					<span class="k">operator</span> <span class="o">+=</span> <span class="p">(</span><span class="k">const</span> <span class="n">FLogScope</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">FLogScope</span><span class="o">&amp;</span>		<span class="k">operator</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="k">const</span>	<span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">constexpr</span> <span class="k">explicit</span>		<span class="k">operator</span> <span class="nf">bool</span> <span class="p">()</span> <span class="k">const</span>		<span class="p">{</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span> <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
	<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="kt">void</span>	<span class="n">EnterPrelude</span><span class="p">(</span><span class="n">uint32</span> <span class="n">Size</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">bMaybeHasAux</span><span class="p">);</span>
	<span class="kt">void</span>					<span class="nf">Enter</span><span class="p">(</span><span class="n">uint32</span> <span class="n">Uid</span><span class="p">,</span> <span class="n">uint32</span> <span class="n">Size</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">bMaybeHasAux</span><span class="p">);</span>
	<span class="kt">void</span>					<span class="nf">EnterNoSync</span><span class="p">(</span><span class="n">uint32</span> <span class="n">Uid</span><span class="p">,</span> <span class="n">uint32</span> <span class="n">Size</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">bMaybeHasAux</span><span class="p">);</span>
	<span class="k">struct</span>
	<span class="p">{</span>
		<span class="n">uint8</span><span class="o">*</span>				<span class="n">Ptr</span><span class="p">;</span>
		<span class="n">FWriteBuffer</span><span class="o">*</span>		<span class="n">Buffer</span><span class="p">;</span>
	<span class="p">}</span>						<span class="n">Instance</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div><p data-pid="J5RdppTs">最后进入到FLogScope::Enter函数，这里简单起见，只看FEventHeader版本。EnterPrelude函数中会获取当前线程的GTlsWriteBuffer，该Buffer用于实际数据写入，Buffer会预留FCpuProfilerEventSpecFields大小+Fields大小+NameSize（UE_TRACE_LOG最后一个参数）的内存，然后把Size和Uid写入Buffer。</p><div class="highlight"><pre><code class="language-cpp"><span class="kr">inline</span> <span class="kt">void</span> <span class="n">FLogScope</span><span class="o">::</span><span class="n">EnterNoSync</span><span class="p">(</span><span class="n">uint32</span> <span class="n">Uid</span><span class="p">,</span> <span class="n">uint32</span> <span class="n">Size</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">bMaybeHasAux</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">EnterPrelude</span><span class="o">&lt;</span><span class="n">FEventHeader</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Size</span><span class="p">,</span> <span class="n">bMaybeHasAux</span><span class="p">);</span>

	<span class="c1">// Event header
</span><span class="c1"></span>	<span class="k">auto</span><span class="o">*</span> <span class="n">Header</span> <span class="o">=</span> <span class="p">(</span><span class="n">uint16</span><span class="o">*</span><span class="p">)(</span><span class="n">Instance</span><span class="p">.</span><span class="n">Ptr</span><span class="p">);</span>
	<span class="n">Header</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">uint16</span><span class="p">(</span><span class="n">Size</span><span class="p">);</span>
	<span class="n">Header</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">uint16</span><span class="p">(</span><span class="n">Uid</span><span class="p">)</span><span class="o">|</span><span class="kt">int</span><span class="p">(</span><span class="n">EKnownEventUids</span><span class="o">::</span><span class="n">Flag_TwoByteUid</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">HeaderType</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="n">FLogScope</span><span class="o">::</span><span class="n">EnterPrelude</span><span class="p">(</span><span class="n">uint32</span> <span class="n">Size</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">bMaybeHasAux</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uint32</span> <span class="n">AllocSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">HeaderType</span><span class="p">)</span> <span class="o">+</span> <span class="n">Size</span> <span class="o">+</span> <span class="kt">int</span><span class="p">(</span><span class="n">bMaybeHasAux</span><span class="p">);</span>

	<span class="n">FWriteBuffer</span><span class="o">*</span> <span class="n">Buffer</span> <span class="o">=</span> <span class="n">Writer_GetBuffer</span><span class="p">();</span>
	<span class="n">Buffer</span><span class="o">-&gt;</span><span class="n">Cursor</span> <span class="o">+=</span> <span class="n">AllocSize</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">UNLIKELY</span><span class="p">(</span><span class="n">Buffer</span><span class="o">-&gt;</span><span class="n">Cursor</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">uint8</span><span class="o">*</span><span class="p">)</span><span class="n">Buffer</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="n">Buffer</span> <span class="o">=</span> <span class="n">Writer_NextBuffer</span><span class="p">(</span><span class="n">AllocSize</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c1">// The auxilary data null terminator.
</span><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">bMaybeHasAux</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Buffer</span><span class="o">-&gt;</span><span class="n">Cursor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">uint8</span><span class="o">*</span> <span class="n">Cursor</span> <span class="o">=</span> <span class="n">Buffer</span><span class="o">-&gt;</span><span class="n">Cursor</span> <span class="o">-</span> <span class="n">Size</span> <span class="o">-</span> <span class="kt">int</span><span class="p">(</span><span class="n">bMaybeHasAux</span><span class="p">);</span>
	<span class="n">Instance</span> <span class="o">=</span> <span class="p">{</span><span class="n">Cursor</span><span class="p">,</span> <span class="n">Buffer</span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div><p data-pid="GvukXAAW">接着执行下面的宏，FLogScope重载了+=操作符，会执行FLogScope::Commit函数，作用为把Buffer当前Cursor更新到Buffer.Commit，因此称为“提交”。</p><div class="highlight"><pre><code class="language-cpp"><span class="cp">#define TRACE_PRIVATE_LOG_EPILOG() \
</span><span class="cp">				LogScope += LogScope
</span><span class="cp"></span>				
<span class="kr">inline</span> <span class="kt">void</span> <span class="n">FLogScope</span><span class="o">::</span><span class="n">Commit</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
	<span class="n">FWriteBuffer</span><span class="o">*</span> <span class="n">Buffer</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">.</span><span class="n">Buffer</span><span class="p">;</span>
	<span class="n">AtomicStoreRelease</span><span class="p">((</span><span class="n">uint8</span><span class="o">**</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">Buffer</span><span class="o">-&gt;</span><span class="n">Committed</span><span class="p">),</span> <span class="n">Buffer</span><span class="o">-&gt;</span><span class="n">Cursor</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p data-pid="dTsxrscH">到这里，我们看完了第一个UE_TRACE_LOG执行的操作，最后会得到一个FLogScope对象，该对象关联了Buffer，以及一个FCpuProfilerEventSpecFields实例指针，名为EventSpec。</p><p data-pid="RAh0CBSO">下面是有些怪异的&lt;&lt;操作符，它并不会真正输出什么，只是逐个初始化EventSpec的属性，内存地址就是Buffer中预留的FCpuProfilerEventSpecFields。最后的Attachment函数用于外挂一些未声明的其他属性。</p><p data-pid="McZ7DwHS">一番操作后，Buffer内容如下：</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-670344001e97f6163df7b4a18161aeaf_b.jpg" data-caption="" data-size="normal" data-rawwidth="937" data-rawheight="463" class="origin_image zh-lightbox-thumb" width="937" data-original="https://pic4.zhimg.com/v2-670344001e97f6163df7b4a18161aeaf_r.jpg"/></noscript><img src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-670344001e97f6163df7b4a18161aeaf_1440w.jpg" data-caption="" data-size="normal" data-rawwidth="937" data-rawheight="463" class="origin_image zh-lightbox-thumb lazy" width="937" data-original="https://pic4.zhimg.com/v2-670344001e97f6163df7b4a18161aeaf_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-670344001e97f6163df7b4a18161aeaf_b.jpg" data-lazy-status="ok"></figure><p data-pid="aMuJivkd">不妨称一次UE_TRACE_LOG写入Buffer的内容称为一个“EventBlock”，可以认为是最小写入单位。</p><p data-pid="3mP_A1RV">接下来看FlushThreadBuffer中的UE_TRACE_LOG使用</p><div class="highlight"><pre><code class="language-cpp"><span class="n">UE_TRACE_LOG</span><span class="p">(</span><span class="n">CpuProfiler</span><span class="p">,</span> <span class="n">EventBatch</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">InThreadBuffer</span><span class="o">-&gt;</span><span class="n">BufferSize</span><span class="p">)</span>
<span class="o">&lt;&lt;</span> <span class="n">EventBatch</span><span class="p">.</span><span class="n">Attachment</span><span class="p">(</span><span class="n">InThreadBuffer</span><span class="o">-&gt;</span><span class="n">Buffer</span><span class="p">,</span> <span class="n">InThreadBuffer</span><span class="o">-&gt;</span><span class="n">BufferSize</span><span class="p">);</span>
</code></pre></div><p data-pid="YK2HJTj0">与之前例子类似，但这里EventBatch没有成员变量，只申请了BufferSize，然后把Buffer作为attachment数据写入。</p><p data-pid="Bl9J9RDL">此时写入的EventBlock内容：</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-481a0f163fd8412ad2efe13c659bccae_b.jpg" data-caption="" data-size="normal" data-rawwidth="578" data-rawheight="316" class="origin_image zh-lightbox-thumb" width="578" data-original="https://pic3.zhimg.com/v2-481a0f163fd8412ad2efe13c659bccae_r.jpg"/></noscript><img src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-481a0f163fd8412ad2efe13c659bccae_1440w.jpg" data-caption="" data-size="normal" data-rawwidth="578" data-rawheight="316" class="origin_image zh-lightbox-thumb lazy" width="578" data-original="https://pic3.zhimg.com/v2-481a0f163fd8412ad2efe13c659bccae_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-481a0f163fd8412ad2efe13c659bccae_b.jpg" data-lazy-status="ok"></figure><p data-pid="jt2xDTG5">ThreadBuffer很小，因此要多次写入才能填满一个TlsBuffer，写入操作其实就是memorycpy了ThreadBuffer的内存。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-79763e42e8b5e0fade8c9269f0758ff6_b.jpg" data-caption="" data-size="normal" data-rawwidth="1097" data-rawheight="398" class="origin_image zh-lightbox-thumb" width="1097" data-original="https://pic3.zhimg.com/v2-79763e42e8b5e0fade8c9269f0758ff6_r.jpg"/></noscript><img src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-79763e42e8b5e0fade8c9269f0758ff6_1440w.jpg" data-caption="" data-size="normal" data-rawwidth="1097" data-rawheight="398" class="origin_image zh-lightbox-thumb lazy" width="1097" data-original="https://pic3.zhimg.com/v2-79763e42e8b5e0fade8c9269f0758ff6_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-79763e42e8b5e0fade8c9269f0758ff6_b.jpg" data-lazy-status="ok"></figure><p data-pid="6yTUtH6H"><b>Uid</b></p><p data-pid="LLrrypkl">注意到每个Block开头都是Uid，它是每个FXXXFields结构比如FCpuProfilerEventSpecFields的标识符，一个FXXXFields由LoggerName和EventName唯一确定。在使用UE_TRACE_EVENT_BEGIN创建FXXXFields时，会同步创建一个对应的FEventNode对象，它会以单调递增方式创建新的Uid，并且内部记录了LoggerName和EventName。所有创建的FEventNode都会添加到GNewEventList链表中进行管理，类似GNewChannelList，这个链表只会存储新建EventNode，当EventNode信息被WriterBuffer发送之后，GNewEventList会被清空。</p><p data-pid="r_GRUlY9"><b>FWriteBuffer</b></p><p data-pid="1T_PU1Rd">前面介绍了UnrealInsight写入TlsBuffer数据的结构，那TlsBuffer有多大？写满了怎么办？因此这里看下UE如何管理TlsBuffer。</p><p data-pid="ux6-Leue">TlsBuffer全称为GTlsWriteBuffer，类型是FWriteBuffer，通过thread_local描述符，声明为每个线程独有。每个FWriteBuffer的BufferSize，由GPollBlockSize指定，默认4KB，但不都能存储数据，这块内存头部要存储FWriteBuffer本身，然后要再空一个uint32，还不确定用途。UE把这个Buffer称为Block。然后Block由更大的Page进行管理，类型为FPoolPage，申请内存的单位是Page。Page大小可以不同，初始化的Page包含64个Block，中途扩容的Page包含16个Block，这点很像UE的mallocbinned内存分配器了。不过观察426引擎代码，发现初始Page大小并没有被使用过，统一用到扩容Page大小。</p><p data-pid="pVxHlrWk">数据结构</p><p data-pid="wj_PeI_n">FWriteBuffer</p><p data-pid="gaOunhvf">uint16Size 可用空间</p><p data-pid="fBR-Am9x">FWriteBuffer* NextBuffer 指向的下个FWriteBuffer(Block)节点 </p><p data-pid="UEZksG53">Uint8* Cursor 存储数据的游标</p><p data-pid="9wUynvB0">Uint8* Commited 提交数据的游标</p><p data-pid="l2Sw5Hqh">uint16 ThreadId 对应线程id</p><p class="ztext-empty-paragraph"><br></p><p data-pid="pz0jdolU">FPoolPage</p><p data-pid="f2mCTbUA">FPoolPage* NextPage 指向的下个FPoolPage节点</p><p data-pid="01jrVEXJ">Uint32 AllocSize Page大小</p><p data-pid="ks_0KdBB">Block和Page的结构图如下：</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-6ff6ed9da92f4826ec9c9ee6ab09b44f_b.jpg" data-caption="" data-size="normal" data-rawwidth="1453" data-rawheight="582" class="origin_image zh-lightbox-thumb" width="1453" data-original="https://pic4.zhimg.com/v2-6ff6ed9da92f4826ec9c9ee6ab09b44f_r.jpg"/></noscript><img src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-6ff6ed9da92f4826ec9c9ee6ab09b44f_1440w.jpg" data-caption="" data-size="normal" data-rawwidth="1453" data-rawheight="582" class="origin_image zh-lightbox-thumb lazy" width="1453" data-original="https://pic4.zhimg.com/v2-6ff6ed9da92f4826ec9c9ee6ab09b44f_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-6ff6ed9da92f4826ec9c9ee6ab09b44f_b.jpg" data-lazy-status="ok"></figure><p data-pid="WWoN9-2o">有两点值得关注</p><ul><li data-pid="lON7P-Vy">Page中第一个Block头部存储了FPoolPage结构体，相比其他BlockBuffer会小一些</li><li data-pid="-jap-r1Y">每个Block的FWriteBuffer在内存块尾部，Cursor初始为Buffer头部，往后增长，因此判断Buffer满的条件为Cursor&gt;FWriteBuffer</li></ul><p data-pid="dL5zU4M8">UE维护一个GPoolFreeList指针，当申请完一个Page后，会取走第一个Block去使用，然后把最后一个Block的NextBuffer指向第二个Block，再把GPoolPreeList指向第二个Block，这样当下次需要Block时，直接取GPoolFreeList即可。</p><p data-pid="OVNImR_a">回到UE_TRACE_LOG写入Buffer代码，如果此时Buffer已满，就会执行Writer_NextBufferInternal()函数，获取下一个可用Buffer，并且把当前Buffer的NextBuffer指向新获取的Buffer。</p><p data-pid="2r95TxWx">被写入数据的Buffer由另一个链表管理，称为GNewThreadList。</p><p data-pid="Ec0AMLcR">因此，一个“满”的Buffer可能存在空隙，比如Buffer还有10Byte空闲，我们要写入12Byte，那么该Buffer就被判定为“满”了，12byte会被写入下个Buffer。</p><h3>发送Profile数据</h3><p data-pid="BPwT1qFZ">我们已经记录了Profile数据，并且写入了Buffer，之后这些数据如何被传到服务器，或写入文件？</p><p data-pid="dXVUsvHi">回到最开始的UnrealInsight初始化部分，会执行Trace::Initialize()函数，如果平台支持多线程（一般都支持），就启动独立的WriterThread，并以17ms为间隔进行tick。</p><p data-pid="JVsA-dTU">tick执行函数为Writer_WorkerUpdate()</p><div class="highlight"><pre><code class="language-cpp"><span class="k">static</span> <span class="kt">void</span> <span class="nf">Writer_WorkerUpdate</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">Writer_UpdateControl</span><span class="p">();</span>
	<span class="n">Writer_UpdateData</span><span class="p">();</span>
	<span class="n">Writer_DescribeAnnounce</span><span class="p">();</span>
	<span class="n">Writer_DrainBuffers</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div><p data-pid="EOb32S4K">前两个函数用于更新连续状态等内容，可以不管，重点看后两个函数。</p><p data-pid="oZoDeZ7I">Writer_DescribeAnnounce</p><p data-pid="fxxWDuQ9">我们每次用UE_TRACE_LOG写入Profile信息，都会用Uid开头作为标记，Uid由Loggername（如CpuProfiler）和EventName（如Scope）确定，还可能包含成员变量，因此要把这个对应关系也发到UnrealInsight服务器，这样在收到Uid之后才知道要如何处理后面的数据。UE_TRACE_LOG会生成FEventNode对象，里面包含了Uid对应的LoggerName，EventName，以及Field描述信息，相当于反射数据，指导UnrealInsight服务器如何解析数据。</p><p data-pid="vsgEl97q">举个例子：</p><p data-pid="j-75ImiE">使用标记TRACE_CPUPROFILER_EVENT_SCOPE(Name)来profile一个函数，首先要给这一行的标记生成一个SpecId，并把Name和SpecId的关系通过UE_TRACE_LOG写入TlsBuffer，这个Event称为EventSpec：</p><div class="highlight"><pre><code class="language-cpp"><span class="n">UE_TRACE_LOG</span><span class="p">(</span><span class="n">CpuProfiler</span><span class="p">,</span> <span class="n">EventSpec</span><span class="p">,</span> <span class="n">CpuChannel</span><span class="p">,</span> <span class="n">NameSize</span><span class="p">)</span>
	<span class="o">&lt;&lt;</span> <span class="n">EventSpec</span><span class="p">.</span><span class="n">Id</span><span class="p">(</span><span class="n">SpecId</span><span class="p">)</span>
	<span class="o">&lt;&lt;</span> <span class="n">EventSpec</span><span class="p">.</span><span class="n">CharSize</span><span class="p">(</span><span class="n">uint8</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">TCHAR</span><span class="p">)))</span>
	<span class="o">&lt;&lt;</span> <span class="n">EventSpec</span><span class="p">.</span><span class="n">Attachment</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="n">NameSize</span><span class="p">);</span>
</code></pre></div><p data-pid="Mp38heH6">此处的Uid对应CpuProfiler和EventSpec，服务器需要知道数据中包含了成员变量SpecId和CharSize，以及Attachment包含了Name数据。</p><p data-pid="Ah5hWwyF">再到FlushThreadBuffer</p><div class="highlight"><pre><code class="language-cpp"><span class="n">UE_TRACE_LOG</span><span class="p">(</span><span class="n">CpuProfiler</span><span class="p">,</span> <span class="n">EventBatch</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">InThreadBuffer</span><span class="o">-&gt;</span><span class="n">BufferSize</span><span class="p">)</span>
	<span class="o">&lt;&lt;</span> <span class="n">EventBatch</span><span class="p">.</span><span class="n">Attachment</span><span class="p">(</span><span class="n">InThreadBuffer</span><span class="o">-&gt;</span><span class="n">Buffer</span><span class="p">,</span> <span class="n">InThreadBuffer</span><span class="o">-&gt;</span><span class="n">BufferSize</span><span class="p">);</span>
</code></pre></div><p data-pid="DwPhwYlT">这里的Uid对应CpuProfiler和EventBatch，服务器需要解析该Buffer，获取SpecId和时钟tick计数。</p><p data-pid="zzcpyt0m">Writer_DescribeAnnounce函数会不断查找新创建的EventNode和Channel，并清空GNewEventList和GNewChannelList，把Uid对应的这些反射信息，都发给服务器。</p><p data-pid="33k4WJ-_">Writer_DrainBuffers</p><p data-pid="J9d8WZQI">最后终于到了发送FWriteBuffer部分。</p><p data-pid="9EIfTW1y">UE会遍历GNewThreadList，取出已经写入数据的Buffer，然后根据Buffer.Commited指针获取到要发送的数据，之后交给底层的IoWrite接口进行发送。IoWrite接口屏蔽了网络发送和本地写文件，上层无感知，只管写入即可。</p><p data-pid="zrIXrW64">处理完的FWriteBuffer又变成空闲可用状态，UE把它们重新加入到GPoolFreeList链表中，等待下次使用。</p><h3>总体流程图</h3><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-81387f9a8fa5d1e481cc9f724d649421_b.jpg" data-caption="" data-size="normal" data-rawwidth="1343" data-rawheight="985" class="origin_image zh-lightbox-thumb" width="1343" data-original="https://pic2.zhimg.com/v2-81387f9a8fa5d1e481cc9f724d649421_r.jpg"/></noscript><img src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-81387f9a8fa5d1e481cc9f724d649421_1440w.jpg" data-caption="" data-size="normal" data-rawwidth="1343" data-rawheight="985" class="origin_image zh-lightbox-thumb lazy" width="1343" data-original="https://pic2.zhimg.com/v2-81387f9a8fa5d1e481cc9f724d649421_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-81387f9a8fa5d1e481cc9f724d649421_b.jpg" data-lazy-status="ok"></figure><p></p></div></div></div><div role="button" tabindex="0" class="ContentItem-time">编辑于 2022-01-20 22:40</div><div class="Post-topicsAndReviewer"><div class="TopicList Post-Topics"><div class="Tag Topic css-1s3a4zw" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19824201&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/19824201" target="_blank"><div class="Popover"><div id="Popover2-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover2-content">虚幻引擎</div></div></a></span></div></div></div><div><div class="Sticky RichContent-actions is-fixed is-bottom" style="width: 690px; bottom: 0px; left: 445.667px;"><div class="ContentItem-actions" data-za-detail-view-path-module="BottomBar" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;id&quot;:&quot;458086085&quot;}}}"><span><button aria-label="赞同 76 " aria-live="polite" type="button" class="Button VoteButton VoteButton--up"><span style="display:inline-flex;align-items:center">​<svg width="10" height="10" viewBox="0 0 24 24" data-new-api="AgreeFill24" data-old-api="TriangleUp" class="Zi Zi--TriangleUp VoteButton-TriangleUp" fill="currentColor"><path d="M13.792 3.681c-.781-1.406-2.803-1.406-3.584 0l-7.79 14.023c-.76 1.367.228 3.046 1.791 3.046h15.582c1.563 0 2.55-1.68 1.791-3.046l-7.79-14.023z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>赞同 76</button><button aria-label="反对" aria-live="polite" type="button" class="Button VoteButton VoteButton--down"><span style="display:inline-flex;align-items:center">​<svg width="10" height="10" viewBox="0 0 24 24" data-new-api="OpposeFill24" data-old-api="TriangleDown" class="Zi Zi--TriangleDown" fill="currentColor"><path d="M13.792 20.319c-.781 1.406-2.803 1.406-3.584 0L2.418 6.296c-.76-1.367.228-3.046 1.791-3.046h15.582c1.563 0 2.55 1.68 1.791 3.046l-7.79 14.023z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span></button></span><button type="button" class="Button BottomActions-CommentBtn Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="ChatBubbleFill24" data-old-api="Comment" class="Zi Zi--Comment Button-zi" fill="currentColor"><path d="M12 2.75a9.25 9.25 0 104.737 17.197l2.643.817a1 1 0 001.25-1.25l-.8-2.588A9.25 9.25 0 0012 2.75z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>4 条评论</button><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="Popover3-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover3-content"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="PaperplaneFill24" data-old-api="Share" class="Zi Zi--Share Button-zi" fill="currentColor"><path d="M19.47 1.914a.8.8 0 011.204.778l-1.872 16.386a.9.9 0 01-1.204.743l-4.615-1.692a.7.7 0 00-.831.28l-1.927 3.02c-.43.674-1.474.369-1.474-.43v-3.865a.8.8 0 01.179-.504l5.808-7.148a.595.595 0 00-.897-.781l-5.93 6.354a1.1 1.1 0 01-1.258.252L2.57 13.46a.8.8 0 01-.08-1.415l16.98-10.13z"></path></svg></span>分享</button></div></div><button aria-live="polite" type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="HeartFill24" data-old-api="Heart" class="Zi Zi--Heart Button-zi" fill="currentColor"><path d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 01-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 01-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>喜欢</button><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="StarFill24" data-old-api="Star" class="Zi Zi--Star Button-zi" fill="currentColor"><path d="M10.484 3.307c.673-1.168 2.358-1.168 3.032 0l2.377 4.122a.25.25 0 00.165.12l4.655.987c1.319.28 1.84 1.882.937 2.884l-3.186 3.535a.25.25 0 00-.063.193l.5 4.733c.142 1.34-1.222 2.33-2.453 1.782l-4.346-1.938a.25.25 0 00-.204 0l-4.346 1.938c-1.231.549-2.595-.442-2.453-1.782l.5-4.733a.25.25 0 00-.064-.193L2.35 11.42c-.903-1.002-.382-2.604.937-2.884l4.655-.987a.25.25 0 00.164-.12l2.378-4.122z"></path></svg></span>收藏</button><button type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="TrayFullFill24" data-old-api="Deliver" class="Zi Zi--Deliver Button-zi" fill="currentColor"><g fill-rule="evenodd" clip-rule="evenodd"><path d="M7.821 12a.75.75 0 01.75-.75h6.857a.75.75 0 010 1.5H8.571a.75.75 0 01-.75-.75zm1.144-4a.75.75 0 01.75-.75h4.571a.75.75 0 010 1.5H9.715a.75.75 0 01-.75-.75z"></path><path d="M7.527 3.15a2.35 2.35 0 00-2.309 1.91L3.165 15.84a.85.85 0 00-.015.16v2.5a2.35 2.35 0 002.35 2.35h13a2.35 2.35 0 002.35-2.35V16a.848.848 0 00-.015-.16L18.78 5.06a2.35 2.35 0 00-2.308-1.91H7.527zm0 1.7a.65.65 0 00-.639.528l-1.88 9.872h13.984l-1.88-9.872a.65.65 0 00-.64-.528H7.528z"></path></g></svg></span>申请转载</button><div class="Post-ActionMenuButton"><div class="Popover"><div id="Popover4-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover4-content"><button type="button" class="Button Button--plain Button--withIcon Button--iconOnly"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="Dots24" data-old-api="Dots" class="Zi Zi--Dots Button-zi" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0z"></path></svg></span></button></div></div></div></div><div class="Post-SideActions" style="opacity: 1;"><button class="like"><div class="Post-SideActions-icon"><svg width="16" height="16" viewBox="0 0 24 24" data-new-api="AgreeFill24" data-old-api="TriangleUp" class="Zi Zi--TriangleUp Post-SideActions-upIcon" fill="currentColor"><path d="M13.792 3.681c-.781-1.406-2.803-1.406-3.584 0l-7.79 14.023c-.76 1.367.228 3.046 1.791 3.046h15.582c1.563 0 2.55-1.68 1.791-3.046l-7.79-14.023z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></div><div class="likeCount"><div class="likeCount-inner" data-previous="已赞同 77">赞同 76</div></div></button><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="Popover26-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover26-content"><button><div class="Post-SideActions-icon"><span style="display: inline-flex; align-items: center;">​<svg width="20" height="20" viewBox="0 0 24 24" data-new-api="PaperplaneFill24" data-old-api="Share" class="Zi Zi--Share" fill="currentColor"><path d="M19.47 1.914a.8.8 0 011.204.778l-1.872 16.386a.9.9 0 01-1.204.743l-4.615-1.692a.7.7 0 00-.831.28l-1.927 3.02c-.43.674-1.474.369-1.474-.43v-3.865a.8.8 0 01.179-.504l5.808-7.148a.595.595 0 00-.897-.781l-5.93 6.354a1.1 1.1 0 01-1.258.252L2.57 13.46a.8.8 0 01-.08-1.415l16.98-10.13z"></path></svg></span></div>分享</button></div></div></div></div><div class="Sticky--holder" style="position: static; inset: auto auto 0px 0px; display: block; float: none; margin: 0px 0px 10px; height: 54px;"></div></div></article><div class="Post-Sub Post-NormalSub"><div style="overflow: unset;" data-za-detail-view-path-module="CommentList" data-za-extra-module="{}"><div class="Comments-container css-plbgu"><div class="css-79elbk"><div><div class="css-1fo89v5"><img class="Avatar css-1oi6kgx" src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-ef69d369588e9764f9252225e6dc29ce_l.jpg" srcset="https://pic4.zhimg.com/v2-ef69d369588e9764f9252225e6dc29ce_l.jpg?source=32738c0c 2x"><div class="css-x0pxoz"><div class="css-i6bazn"><div class="css-0"><div class="InputLike css-ip4bff Editable"><div class="Dropzone Editable-content RichText RichText--editable RichText--clearBoth ztext" style="min-height: 38px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner" id="placeholder-cnofm" style="white-space: pre-wrap;">写评论 | Jerish 等 3 个人关注了作者</div></div><div class="DraftEditor-editorContainer"><div aria-describedby="placeholder-cnofm" class="notranslate public-DraftEditor-content" contenteditable="true" spellcheck="true" tabindex="0" style="outline: none; user-select: text; white-space: pre-wrap; overflow-wrap: break-word;" role="textbox"><div data-contents="true"><div class="Editable-unstyled" data-block="true" data-editor="cnofm" data-offset-key="cdfvf-0-0"><div data-offset-key="cdfvf-0-0" class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr"><span data-offset-key="cdfvf-0-0"><br data-text="true"></span></div></div></div></div></div></div></div><div></div><input multiple="" type="file" accept="image/webp,image/jpg,image/jpeg,image/png,image/gif" style="display: none;"></div></div></div></div></div></div><div class="css-z07uxh"><div class="css-we6n55"><div class="css-vpssrj"><div class="css-1k10w8f">4 条评论</div></div><div class="css-59erns"></div><div class="css-1hnxfhy"><div class="css-gjiv4z">默认</div><div class="css-1v9si9f">时间</div></div></div><div class="css-840pn3"><div class="css-1frn93x"><div class="css-vurnku"><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="Popover"><div id="Popover15-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover15-content"><a href="https://www.zhihu.com/people/29ef732471a46c9f03cc1ec00f0ab626" target="_blank" class="css-hxc9jr"><img class="Avatar css-1qchsfe" src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-943a44dd92771beffc950c4cf51cc24a_l.jpg" srcset="https://picx.zhimg.com/v2-943a44dd92771beffc950c4cf51cc24a_l.jpg?source=06d4cd63 2x" alt="Christmas" loading="lazy"></a></div></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="Popover"><div id="Popover16-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover16-content"><a href="https://www.zhihu.com/people/29ef732471a46c9f03cc1ec00f0ab626" target="_blank" class="css-1rd0h6f">Christmas</a></div></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" data-new-api="Dots24" data-old-api="Dots24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0z"></path></svg></div><div class="CommentContent css-1ygdre8">感谢大佬，帮助很大！</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">05-06</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="ChatBubbleFill24" data-old-api="ChatBubbleFill24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path d="M12 2.75a9.25 9.25 0 104.737 17.197l2.643.817a1 1 0 001.25-1.25l-.8-2.588A9.25 9.25 0 0012 2.75z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="ThumbFill24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>赞</button></div></div></div></div></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="Popover"><div id="Popover17-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover17-content"><a href="https://www.zhihu.com/people/883beffb114504de185282cd70af964e" target="_blank" class="css-hxc9jr"><img class="Avatar css-1qchsfe" src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg" srcset="https://pic1.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="漂浮的金链子" loading="lazy"></a></div></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="Popover"><div id="Popover18-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover18-content"><a href="https://www.zhihu.com/people/883beffb114504de185282cd70af964e" target="_blank" class="css-1rd0h6f">漂浮的金链子</a></div></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" data-new-api="Dots24" data-old-api="Dots24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0z"></path></svg></div><div class="CommentContent css-1ygdre8">真详细啊</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">01-18</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="ChatBubbleFill24" data-old-api="ChatBubbleFill24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path d="M12 2.75a9.25 9.25 0 104.737 17.197l2.643.817a1 1 0 001.25-1.25l-.8-2.588A9.25 9.25 0 0012 2.75z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="ThumbFill24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>赞</button></div></div></div></div></div><div><div class="css-194v73m"><div class="css-1jll2aj"><div class="Popover"><div id="Popover19-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover19-content"><a href="https://www.zhihu.com/people/b28d8d118811f2cf3db90dc5563277e8" target="_blank" class="css-hxc9jr"><img class="Avatar css-1qchsfe" src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-f545833331464a6880b2ea640670d2d9_l.jpg" srcset="https://picx.zhimg.com/v2-f545833331464a6880b2ea640670d2d9_l.jpg?source=06d4cd63 2x" alt="飞的飞" loading="lazy"></a></div></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="Popover"><div id="Popover20-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover20-content"><a href="https://www.zhihu.com/people/b28d8d118811f2cf3db90dc5563277e8" target="_blank" class="css-1rd0h6f">飞的飞</a></div></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" data-new-api="Dots24" data-old-api="Dots24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0z"></path></svg></div><div class="CommentContent css-1ygdre8">高产啊发哥</div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">01-17</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="ChatBubbleFill24" data-old-api="ChatBubbleFill24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path d="M12 2.75a9.25 9.25 0 104.737 17.197l2.643.817a1 1 0 001.25-1.25l-.8-2.588A9.25 9.25 0 0012 2.75z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="ThumbFill24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>赞</button></div></div></div></div><div><div class="css-8j5fyx"><div class="css-1jll2aj"><div class="Popover"><div id="Popover21-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover21-content"><a href="https://www.zhihu.com/people/fc0546ea07e1242831bb188736b132cc" target="_blank" class="css-hxc9jr"><img class="Avatar css-1qchsfe" src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-74e1a6777c0dbc55d34ce5b429e3041d_l.jpg" srcset="https://pica.zhimg.com/v2-74e1a6777c0dbc55d34ce5b429e3041d_l.jpg?source=06d4cd63 2x" alt="南京周润发" loading="lazy"></a></div></div></div><div class="css-14nvvry"><div class="css-1besdh8"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="Popover"><div id="Popover22-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover22-content"><a href="https://www.zhihu.com/people/fc0546ea07e1242831bb188736b132cc" target="_blank" class="css-1rd0h6f">南京周润发</a></div></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div><span class="css-h9ndtl" href="">作者</span></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" data-new-api="Dots24" data-old-api="Dots24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0z"></path></svg></div><div class="CommentContent css-1ygdre8"><img src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-c96dd18b15beb196b2daba95d26d9b1c.png" class="sticker" alt="[酷]"></div><div class="css-dbby2p"><div class="css-82fsyv"><div class="css-12cl38p">01-17</div></div><div class="css-18opwoy"><button type="button" class="Button  css-1o56bgb"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="ChatBubbleFill24" data-old-api="ChatBubbleFill24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path d="M12 2.75a9.25 9.25 0 104.737 17.197l2.643.817a1 1 0 001.25-1.25l-.8-2.588A9.25 9.25 0 0012 2.75z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button css-h1yvwn" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="ThumbFill24" class="ZDI ZDI--ThumbFill24 css-15ro776" fill="currentColor"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>1</button></div></div></div></div></div></div><div></div></div></div></div></div></div></div></div><div class="PostIndex-Contributions" data-za-detail-view-path-module="ColumnList" data-za-detail-view-path-module_name="文章被以下专栏收录" data-za-extra-module="{}"><h3 class="BlockTitle">文章被以下专栏收录</h3><ul><div class="ContentItem Column-ColumnItem"><div class="ContentItem-main"><div class="ContentItem-image"><a class="ColumnLink" href="https://www.zhihu.com/column/c_1093468071653646336"><div class="Popover"><div id="Popover5-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover5-content"><img class="Avatar Avatar--medium Avatar--round" width="40" height="40" src="./UE UnrealInsights 使用与实现 - 知乎_files/4b70deef7_xs.jpg" srcset="https://picx.zhimg.com/4b70deef7_l.jpg?source=172ae18b 2x" alt="UE随笔"></div></div></a></div><div class="ContentItem-head"><h2 class="ContentItem-title"><span><a class="ColumnLink ColumnItem-Title" href="https://www.zhihu.com/column/c_1093468071653646336"><div class="Popover"><div id="Popover6-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover6-content">UE随笔</div></div></a></span></h2><div class="ContentItem-meta">分享UE的使用心得与源码分析</div></div></div></div></ul></div><div role="complementary" aria-label="推荐阅读" class="Recommendations-Main" style="width: 1581px;"><h3 class="BlockTitle Recommendations-BlockTitle">推荐阅读</h3><ul class="Recommendations-List"><button class="PagingButton PagingButton-Previous" disabled="" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg width="40" height="40" viewBox="0 0 24 24" data-new-api="ArrowLeftSmall24" data-old-api="ArrowLeft" fill="#d3d3d3" class="Zi Zi--ArrowLeft"><path d="M10.752 12l4.025-3.78a.684.684 0 000-1.01.796.796 0 00-1.075 0l-4.42 4.15a.866.866 0 000 1.28l4.42 4.15a.796.796 0 001.075 0 .684.684 0 000-1.01L10.752 12z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></button><a href="https://zhuanlan.zhihu.com/p/32763178" class="PostItem"><div><h1 class="PostItem-Title">【角鲨烯】为什么这么贵？真的比【鱼油】更好么？</h1><p class="PostItem-Summary">（这是一篇旧文回顾）  提到“角鲨烯”和“鱼油”可能很多人都不陌生，但也有不少人问我这两种保健品到底有什么区别？同样是从深海鱼中提炼出来的保健品，貌似功效也有雷同，到底该如何选择…</p><div class="PostItem-Footer"><span>大狮狮</span><span class="PostItem-FooterTitle"></span></div></div></a><a href="https://zhuanlan.zhihu.com/p/44358024" class="PostItem"><div><h1 class="PostItem-Title">贪小便宜吃大亏——之电信送手机</h1><p class="PostItem-Summary">从很小的时候，父母就告诫我，天下没有免费的午餐，贪小便宜吃大亏。我不以为然，觉得我又不是傻子，吃亏的事情我能干吗？还总觉得哪些上当受骗的人好傻，如果换做是我肯定不会上当！这么多…</p><div class="PostItem-Footer"><span>宣绍户</span><span class="PostItem-FooterTitle"></span></div></div></a><a href="https://zhuanlan.zhihu.com/p/318106651" class="PostItem"><div><img src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-d52205f452b023c23e6decbadb5ccd37_250x0.jpg" srcset="https://pic1.zhimg.com/v2-d52205f452b023c23e6decbadb5ccd37_qhd.jpg?source=172ae18b 2x" class="PostItem-TitleImage" alt="20201128 基金操作一周小结"><h1 class="PostItem-Title">20201128 基金操作一周小结</h1><div class="PostItem-Footer"><span>小马过河</span><span class="PostItem-FooterTitle"></span></div></div></a><a href="https://zhuanlan.zhihu.com/p/288683605" class="PostItem"><div><img src="./UE UnrealInsights 使用与实现 - 知乎_files/v2-a8b4eed3ecc66cf78e16546220bd5fe9_250x0.jpg" srcset="https://pic3.zhimg.com/v2-a8b4eed3ecc66cf78e16546220bd5fe9_qhd.jpg?source=172ae18b 2x" class="PostItem-TitleImage" alt="2020双十一成交额 双11各电商平台销售额数据"><h1 class="PostItem-Title">2020双十一成交额 双11各电商平台销售额数据</h1><div class="PostItem-Footer"><span>一只小萝卜</span><span class="PostItem-FooterTitle"></span></div></div></a><button class="PagingButton PagingButton-Next" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg width="40" height="40" viewBox="0 0 24 24" data-new-api="ArrowRightSmall24" data-old-api="ArrowRight" fill="#d3d3d3" class="Zi Zi--ArrowRight"><path d="M13.248 12l-4.025 3.78a.684.684 0 000 1.01.796.796 0 001.075 0l4.42-4.15a.867.867 0 000-1.28l-4.42-4.15a.796.796 0 00-1.075 0 .684.684 0 000 1.01L13.248 12z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></button></ul></div></div></div></main><div role="complementary"><div class="CornerButtons"><div class="CornerAnimayedFlex"><button data-tooltip="回到顶部" data-tooltip-position="left" data-tooltip-will-hide-on-click="true" aria-label="回到顶部" type="button" class="Button CornerButton Button--plain"><svg width="24" height="24" viewBox="0 0 24 24" data-new-api="ArrowShapeUpwardFill24" data-old-api="BackToTop" aria-label="回到顶部" class="Zi Zi--BackToTop" fill="currentColor"><path d="M13.204 3.107a1.75 1.75 0 00-2.408 0L3.806 9.73c-1.148 1.088-.378 3.02 1.204 3.02h2.24V20c0 .966.784 1.75 1.75 1.75h6A1.75 1.75 0 0016.75 20v-7.25h2.24c1.582 0 2.353-1.932 1.204-3.02l-6.99-6.623z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></button></div></div></div></div></div><script id="js-clientConfig" type="text/json">{"fetchRoot":{"www":"https:\u002F\u002Fwww.zhihu.com","api":"https:\u002F\u002Fapi.zhihu.com","lens":"https:\u002F\u002Flens.zhihu.com","zhuanlan":"https:\u002F\u002Fzhuanlan.zhihu.com","walletpay":"https:\u002F\u002Fwalletpay.zhihu.com","captcha":"https:\u002F\u002Fcaptcha.zhihu.com","vzuu":"https:\u002F\u002Fv.vzuu.com","openapi":"https:\u002F\u002Fopenapi.zhihu.com","svip":"https:\u002F\u002Fsvip.zhihu.com"},"host":"zhihu.com","protocol":"https:","wwwHost":"www.zhihu.com","videoHost":"video.zhihu.com","allowSignUp":true}</script><script id="js-initialData" type="text/json">{"initialState":{"common":{"ask":{}},"loading":{"global":{"count":0},"local":{"env\u002FgetIpinfo\u002F":false,"article\u002Fget\u002F":false,"brand\u002FgetUrl\u002F":false,"article\u002FloadPostSearchEntity\u002F":false}},"club":{"tags":{},"admins":{"data":[]},"members":{"data":[]},"profile":{},"checkin":{},"comments":{"paging":{},"loading":{},"meta":{},"ids":{}},"postList":{"paging":{},"loading":{},"ids":{}},"recommend":{"data":[]},"silences":{"data":[]},"application":{"profile":null}},"entities":{"users":{"9b939bd116cd066ce372288d50538da8":{"uid":1437579071195046000,"userType":"people","id":"9b939bd116cd066ce372288d50538da8"},"xu-chen-71-65":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-74e1a6777c0dbc55d34ce5b429e3041d.jpg?source=172ae18b","uid":"30959470641152","userType":"people","isFollowing":false,"urlToken":"xu-chen-71-65","id":"fc0546ea07e1242831bb188736b132cc","description":"喜欢摸索计算机底层、游戏引擎、各种有意思的事物，欢迎一起交流。","name":"南京周润发","isAdvertiser":false,"headline":"网易游戏码农","gender":1,"url":"\u002Fpeople\u002Ffc0546ea07e1242831bb188736b132cc","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-74e1a6777c0dbc55d34ce5b429e3041d_l.jpg?source=172ae18b","isOrg":false,"type":"people","badge":[],"badgeV2":{"title":"","mergedBadges":[],"detailBadges":[],"icon":"","nightIcon":""},"exposedMedal":{"medalId":"972480281613197312","medalName":"每天逛逛","avatarUrl":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-cdc7c578bc7555f8113a409eaf2704b8_r.png?source=172ae18b","miniAvatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-cdc7c578bc7555f8113a409eaf2704b8_l.png?source=172ae18b","description":"累计登录 365 天","medalAvatarFrame":""}}},"questions":{},"answers":{},"articles":{"458086085":{"trackUrl":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper\u002Fcontent_monitor_log?si=__SESSIONID__&ti=__ATOKEN__&at=view&pf=__OS__&ed=BiBUKF0xBSkqGGpRA2R6CFx1ClFNgfJERpdg&idfa=__IDFA__&imei=__IMEI__&androidid=__ANDROIDID__&oaid=__OAID__&ci=__CREATIVEID__&zid=__ZONEID__"],"entityWords":[{"name":"uint64","mention":"uint64","matchorder":3,"begin":12464,"end":12470,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0,"attachedInfoBytes":"sgJOCgZ1aW50NjQSBE1hdGgYsGEgtmEoAzUAAAAAOgdhcnRpY2xlQABIAFIkYWQwNWRmNmYtYzEzYi00MDhhLWEyMTQtZWY5YTVmYmI1Yzk2","isOnAB":false,"isNatural":1},{"name":"文件描述符","mention":"文件描述符","matchorder":1,"begin":11675,"end":11680,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0,"attachedInfoBytes":"sgJbCg\u002Fmlofku7bmj4\u002Fov7DnrKYSCENvbXB1dGVyGJtbIKBbKAE1AAAAADoHYXJ0aWNsZUAASABSJGFkMDVkZjZmLWMxM2ItNDA4YS1hMjE0LWVmOWE1ZmJiNWM5Ng==","isOnAB":false,"isNatural":1},{"name":"网络数据流","mention":"网络数据流","matchorder":1,"begin":2658,"end":2663,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0,"attachedInfoBytes":"sgJbCg\u002FnvZHnu5zmlbDmja7mtYESCENvbXB1dGVyGOIUIOcUKAE1AAAAADoHYXJ0aWNsZUAASABSJGFkMDVkZjZmLWMxM2ItNDA4YS1hMjE0LWVmOWE1ZmJiNWM5Ng==","isOnAB":false,"isNatural":1},{"name":"insight客户端","mention":"insight客户端","matchorder":1,"begin":6167,"end":6177,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0,"attachedInfoBytes":"sgJcChBpbnNpZ2h05a6i5oi356uvEghDb21wdXRlchiXMCChMCgBNQAAAAA6B2FydGljbGVAAEgAUiRhZDA1ZGY2Zi1jMTNiLTQwOGEtYTIxNC1lZjlhNWZiYjVjOTY=","isOnAB":false,"isNatural":1},{"name":"Channel值","mention":"Channel值","matchorder":1,"begin":11624,"end":11632,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0,"attachedInfoBytes":"sgJSCgpDaGFubmVs5YC8EgRNYXRoGOhaIPBaKAE1AAAAADoHYXJ0aWNsZUAASABSJGFkMDVkZjZmLWMxM2ItNDA4YS1hMjE0LWVmOWE1ZmJiNWM5Ng==","isOnAB":false,"isNatural":1},{"name":"扩容Page","mention":"扩容Page","matchorder":1,"begin":34227,"end":34233,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0,"attachedInfoBytes":"sgJYCgrmianlrrlQYWdlEghDb21wdXRlchiziwIguYsCKAE1AAAAADoHYXJ0aWNsZUAASABSJGFkMDVkZjZmLWMxM2ItNDA4YS1hMjE0LWVmOWE1ZmJiNWM5Ng==","isOnAB":false,"isNatural":1},{"name":"时钟周期","mention":"时钟周期","matchorder":1,"begin":14218,"end":14222,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0,"attachedInfoBytes":"sgJUCgzml7bpkp\u002FlkajmnJ8SBE1hdGgYim8gjm8oATUAAAAAOgdhcnRpY2xlQABIAFIkYWQwNWRmNmYtYzEzYi00MDhhLWEyMTQtZWY5YTVmYmI1Yzk2","isOnAB":false,"isNatural":1},{"name":"bookmark","mention":"bookmark","matchorder":1,"begin":2088,"end":2096,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Commodity","score":0,"attachedInfoBytes":"sgJVCghib29rbWFyaxIJQ29tbW9kaXR5GKgQILAQKAE1AAAAADoHYXJ0aWNsZUAASABSJGFkMDVkZjZmLWMxM2ItNDA4YS1hMjE0LWVmOWE1ZmJiNWM5Ng==","isOnAB":false,"isNatural":1},{"name":"standalone","mention":"standalone","matchorder":1,"begin":1378,"end":1388,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Game","score":0,"attachedInfoBytes":"sgJSCgpzdGFuZGFsb25lEgRHYW1lGOIKIOwKKAE1AAAAADoHYXJ0aWNsZUAASABSJGFkMDVkZjZmLWMxM2ItNDA4YS1hMjE0LWVmOWE1ZmJiNWM5Ng==","isOnAB":false,"isNatural":1},{"name":"insight文件","mention":"insight文件","matchorder":1,"begin":3036,"end":3045,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0,"attachedInfoBytes":"sgJZCg1pbnNpZ2h05paH5Lu2EghDb21wdXRlchjcFyDlFygBNQAAAAA6B2FydGljbGVAAEgAUiRhZDA1ZGY2Zi1jMTNiLTQwOGEtYTIxNC1lZjlhNWZiYjVjOTY=","isOnAB":false,"isNatural":1},{"name":"ThreadLocal变量","mention":"ThreadLocal变量","matchorder":1,"begin":13925,"end":13938,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0,"attachedInfoBytes":"sgJZChFUaHJlYWRMb2NhbOWPmOmHjxIETWF0aBjlbCDybCgBNQAAAAA6B2FydGljbGVAAEgAUiRhZDA1ZGY2Zi1jMTNiLTQwOGEtYTIxNC1lZjlhNWZiYjVjOTY=","isOnAB":false,"isNatural":1},{"name":"mach_absolute_time","mention":"mach_absolute_time","matchorder":1,"begin":14642,"end":14660,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Commodity","score":0,"attachedInfoBytes":"sgJfChJtYWNoX2Fic29sdXRlX3RpbWUSCUNvbW1vZGl0eRiyciDEcigBNQAAAAA6B2FydGljbGVAAEgAUiRhZDA1ZGY2Zi1jMTNiLTQwOGEtYTIxNC1lZjlhNWZiYjVjOTY=","isOnAB":false,"isNatural":1}],"id":458086085,"title":"UE UnrealInsights 使用与实现","type":"article","articleType":"normal","excerptTitle":"","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F458086085","imageUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-66158357a4b02c2e832dfe63798cca01_720w.jpg?source=172ae18b","titleImage":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-66158357a4b02c2e832dfe63798cca01_720w.jpg?source=172ae18b","excerpt":"\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-4d44dbb2593a3fded36ac189914d4619_200x112.png\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1600\" data-rawheight=\"900\" data-watermark=\"watermark\" data-original-src=\"v2-4d44dbb2593a3fded36ac189914d4619\" data-watermark-src=\"v2-20f2c7ce0b6884cb1342f5b387fe3f15\" data-private-watermark-src=\"\" class=\"origin_image inline-img zh-lightbox-thumb\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-4d44dbb2593a3fded36ac189914d4619_r.png\"\u002F\u003EUnreal Insights使用UnrealInsights是UE的新一代Profile工具，用于替代原先的Stats，比如Frontend。它可以Profile CPU，GPU，Network，Animation，Slate，功能更强大，界面也更友好易用。比较常用的是CPU Profile，界面如下： 前两个函数用于更新连续状态等…","created":1642328362,"updated":1642689623,"author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-74e1a6777c0dbc55d34ce5b429e3041d.jpg?source=172ae18b","uid":"30959470641152","userType":"people","isFollowing":false,"urlToken":"xu-chen-71-65","id":"fc0546ea07e1242831bb188736b132cc","description":"喜欢摸索计算机底层、游戏引擎、各种有意思的事物，欢迎一起交流。","name":"南京周润发","isAdvertiser":false,"headline":"网易游戏码农","gender":1,"url":"\u002Fpeople\u002Ffc0546ea07e1242831bb188736b132cc","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-74e1a6777c0dbc55d34ce5b429e3041d_l.jpg?source=172ae18b","isOrg":false,"type":"people","badge":[],"badgeV2":{"title":"","mergedBadges":[],"detailBadges":[],"icon":"","nightIcon":""},"exposedMedal":{"medalId":"972480281613197312","medalName":"每天逛逛","avatarUrl":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-cdc7c578bc7555f8113a409eaf2704b8_r.png?source=172ae18b","miniAvatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-cdc7c578bc7555f8113a409eaf2704b8_l.png?source=172ae18b","description":"累计登录 365 天","medalAvatarFrame":""}},"commentPermission":"all","copyrightPermission":"need_review","state":"published","ipInfo":"","imageWidth":1024,"imageHeight":576,"content":"\u003Ch2\u003EUnreal Insights使用\u003C\u002Fh2\u003E\u003Cp data-pid=\"X8yKEMKd\"\u003EUnrealInsights是UE的新一代Profile工具，用于替代原先的Stats，比如Frontend。它可以Profile CPU，GPU，Network，Animation，Slate，功能更强大，界面也更友好易用。比较常用的是CPU Profile，界面如下：\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-20f2c7ce0b6884cb1342f5b387fe3f15_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1600\" data-rawheight=\"900\" class=\"origin_image zh-lightbox-thumb\" width=\"1600\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-20f2c7ce0b6884cb1342f5b387fe3f15_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1600&#39; height=&#39;900&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1600\" data-rawheight=\"900\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1600\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-20f2c7ce0b6884cb1342f5b387fe3f15_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-20f2c7ce0b6884cb1342f5b387fe3f15_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"6O54nnkb\"\u003E前两个函数用于更新连续状态等内容，可不管，重点看后两个函数。于浏览profile数据。\u003C\u002Fp\u003E\u003Cp data-pid=\"3eOvTt5q\"\u003E关于使用方式，官方文档中有详细的介绍\u003C\u002Fp\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fdocs.unrealengine.com\u002F4.27\u002Fen-US\u002FTestingAndOptimization\u002FPerformanceAndProfiling\u002FUnrealInsights\u002F\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EUnreal Insights | Unreal Engine Documentation\u003C\u002Fa\u003E\u003Cp data-pid=\"UcINd15G\"\u003E命令行启动\u003C\u002Fp\u003E\u003Cp data-pid=\"SbCMKLMZ\"\u003E添加-trace=[channel1,channel2…] -statnamedevents -tracehost=127.0.0.1\u003C\u002Fp\u003E\u003Cp data-pid=\"HNsGK5AI\"\u003E本地先启动UnrealInsights服务器，然后启动游戏就能连上\u003C\u002Fp\u003E\u003Cp data-pid=\"KQKqwwui\"\u003E 一个例子如下，这几乎是最详细的标签了\u003C\u002Fp\u003E\u003Cp data-pid=\"t4H5EvOZ\"\u003E-trace=CPU,Log,Bookmark,Frame,GPU,LoadTime,File,Net,Stats,Counters -statnamedevents -tracehost=127.0.0.1\u003C\u002Fp\u003E\u003Cp data-pid=\"2B_CLXcI\"\u003EUE有快速Prfile方式，Windows环境下，只需先打开UnrealInsights.exe，再打开standalone游戏，就可以进行profile，不需要额外命令行。\u003C\u002Fp\u003E\u003Ch2\u003E标记\u003C\u002Fh2\u003E\u003Cp data-pid=\"VKLCkqsu\"\u003EUnreal Insight可以使用以下标记\u003C\u002Fp\u003E\u003Cp data-pid=\"akSXgsR4\"\u003ETRACE_CPUPROFILER_EVENT_SCOPE(xxx)\u003C\u002Fp\u003E\u003Cp data-pid=\"ylMpIdL8\"\u003ETRACE_BOOKMARK(TEXT(&#34;xxx %s &#34;), string)\u003C\u002Fp\u003E\u003Cp data-pid=\"VAwiPqGu\"\u003E也支持现有stats标记\u003C\u002Fp\u003E\u003Cp data-pid=\"SUu-zqCV\"\u003ESCOPE_CYCLE_COUNTER(xxxxx)\u003C\u002Fp\u003E\u003Ch2\u003EChannel\u003C\u002Fh2\u003E\u003Cp data-pid=\"shbYYgB6\"\u003EChannel表示要Profile哪些类目，比如CpuChannel对应RACE_CPUPROFILER_EVENT_SCOPE标签，CpuChannel打开后该标签才会起效。\u003C\u002Fp\u003E\u003Cp data-pid=\"TTjEQH7g\"\u003EChannel通过命令行参数-trace配置，比如-trace=channel1,channel2…\u003C\u002Fp\u003E\u003Cp data-pid=\"8HRHjI9e\"\u003EXXXEngine.ini可以配置默认Channel，如果-trace没有跟Channel，就用Presets\u003C\u002Fp\u003E\u003Cp data-pid=\"-_Nkwp7j\"\u003E[Trace.ChannelPresets]\u003C\u002Fp\u003E\u003Cp data-pid=\"AcgYxhpk\"\u003EDefault=cpu,frame,log,bookmark\u003C\u002Fp\u003E\u003Cp data-pid=\"uQfdbCW5\"\u003ERendering=gpu,cpu,frame,log,bookmark\u003C\u002Fp\u003E\u003Ch2\u003E其他Insights\u003C\u002Fh2\u003E\u003Cp data-pid=\"UV38ADsn\"\u003EUnreal Insights主要用于Profile CPU，UE还提供了其他几种Insights工具，用来Profile不同部分。\u003C\u002Fp\u003E\u003Ch3\u003ENetworking Insights\u003C\u002Fh3\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-0ed1ef939c1ee61445e932ca3f65e5d4_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1290\" data-rawheight=\"730\" class=\"origin_image zh-lightbox-thumb\" width=\"1290\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-0ed1ef939c1ee61445e932ca3f65e5d4_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1290&#39; height=&#39;730&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1290\" data-rawheight=\"730\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1290\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-0ed1ef939c1ee61445e932ca3f65e5d4_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-0ed1ef939c1ee61445e932ca3f65e5d4_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"rLk3H9nE\"\u003E用于Profile网络数据流。可以看到网络流量变化以及数据包具体内容，比如Actor同步数据，同步了哪个Actor，属性同步数据，同步了哪些属性。\u003C\u002Fp\u003E\u003Cp data-pid=\"sFZHNrSm\"\u003E使用方法\u003C\u002Fp\u003E\u003Cp data-pid=\"Bm-GkoGl\"\u003E-NetTrace=1 -tracehost=localhost -trace=net\u003C\u002Fp\u003E\u003Cp data-pid=\"4zzbgcfA\"\u003E其他还有Animation Insights和Slate Insights，就不过多介绍了，官方文档有更详细的说明。\u003C\u002Fp\u003E\u003Ch2\u003EUnreal Insights原理\u003C\u002Fh2\u003E\u003Ch3\u003E开启流程\u003C\u002Fh3\u003E\u003Cp data-pid=\"qjm-zzSy\"\u003E开启Unreal Insights主要使用FTraceAuxiliaryImpl类，该类负责解析命令行，控制连接服务器和打开insight文件，以及Unreal Insights的开启\u002F关闭。\u003C\u002Fp\u003E\u003Cp data-pid=\"RF7peTtt\"\u003EFTraceAuxiliaryImpl\u003C\u002Fp\u003E\u003Cp data-pid=\"L_hFMfo7\"\u003E主要属性\u003C\u002Fp\u003E\u003Cp data-pid=\"1XA9plcA\"\u003ETmap&lt;uint32, FChannel&gt; Channels 当前要profile的channel，比如cpu，frame，network等等，key为channel name的hash。注意此处的Channel只是真正Profile所使用Trace::Channel的handler，它们是两个类型，修改它们的Active属性后，要同步到“真正”的Channel实例。\u003C\u002Fp\u003E\u003Cp data-pid=\"ALxuWRri\"\u003ETraceDest 连接的服务器地址或写入的文件名\u003C\u002Fp\u003E\u003Cp data-pid=\"QlDLZ3rj\"\u003E初始开启\u003C\u002Fp\u003E\u003Cp data-pid=\"pWVCQEns\"\u003EFEngineLoop::PreInitPreStartupScreen函数调用FTraceAuxiliary::Initialize函数，传入CmdLine，开启UnrealInsight。\u003C\u002Fp\u003E\u003Cp data-pid=\"prSwMYli\"\u003EFTraceAuxiliary::Initialize()\u003C\u002Fp\u003E\u003Cp data-pid=\"FwEG2BRn\"\u003E首先，把程序简要信息写入Buffer，包括Platform，AppName等。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003EUE_TRACE_LOG\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EDiagnostics\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESession2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ETrace\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETraceLogChannel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESession2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EPlatform\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EPREPROCESSOR_TO_STRING\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EUBT_COMPILED_PLATFORM\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESession2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAppName\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EUE_APP_NAME\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESession2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECommandLine\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECommandLine\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESession2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EConfigurationType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFApp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EGetBuildConfiguration\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESession2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETargetType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFApp\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EGetBuildTargetType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()));\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"E99hUcqK\"\u003E接着解析-trace=channel1,channel2…参数中指定的Channel，把它们加入到Channels map中。每个Channel都有Active状态，开启后才会收集该Channel的数据，默认开启。如果用户没有提供Channel，UE会去Engine.ini获取Trace.ChannelPresets指定的预置Channel，默认是cpu,frame,log,bookmark。\u003C\u002Fp\u003E\u003Cp data-pid=\"TAhezuQT\"\u003E之后解析-tracehost和-tracehost，判断要把profile数据发到某个insight服务器还是写入某个文件。\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"0CSZtpye\"\u003E连接服务器会创建一条TCP连接，过程是阻塞的，可指定对方ip:port，如不指定port就用默认的1980端口。\u003C\u002Fli\u003E\u003Cli data-pid=\"nLP2M_dN\"\u003E写入文件可指定path和文件名，如果是相对路径，会写入Profiling目录，如果没特殊需求，相对路径就够了。写文件之前要把得到的\u002FGame\u002F….路径转换为各平台的路径，比如安卓就是\u002Fsdcard\u002F…开头的路径，之后以write模式打开文件，准备写入。\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp data-pid=\"VwtmC_l4\"\u003E到这里初始化unreal insights读取命令行初始化就完成了，我们已配置channel，建立服务器连接或打开了文件。\u003C\u002Fp\u003E\u003Cp data-pid=\"D59DKwDH\"\u003Ewindows缺省开启\u003C\u002Fp\u003E\u003Cp data-pid=\"DafwNZgF\"\u003E我们大部分情况使用windows开发调试，因此UE为我们提供了windows缺省开启模式，只要本地打开insight客户端，再开游戏，就会使用默认Channel，自动连接，方便了profile。\u003C\u002Fp\u003E\u003Ch3\u003EChannel定义\u003C\u002Fh3\u003E\u003Cp data-pid=\"JgqzYI3B\"\u003EChannel使用UE_TRACE_CHANNEL_DEFINE定义，例如CpuChannel\u003C\u002Fp\u003E\u003Cp data-pid=\"MedOKraS\"\u003EUE_TRACE_CHANNEL_DEFINE(CpuChannel)\u003C\u002Fp\u003E\u003Cp data-pid=\"z9ETY7W3\"\u003E创建名为CpuChannelObject的FChannel实例，作为静态变量，然后创建名为CpuChannel的引用对象。之后创建名为FCpuChannelRegister的结构体和实例，主要作用为调用CpuChannelObject.Setup函数进行注册。Channel新建后会保存在GNewChannelList链表中，Channel信息被WriterBuffer发送之后，链表被清空。\u003C\u002Fp\u003E\u003Ch3\u003EFChanne::Toggle函数的坑\u003C\u002Fh3\u003E\u003Cp data-pid=\"CJcvUKLa\"\u003E观察FChannel，发现有Toggle函数可以开启\u002F关闭某个Channel，但其底层使用了原子P\u002FV操作来修改Enabled，Enabled是int类型而不是bool。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"kt\"\u003Ebool\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFChannel\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EToggle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Ebool\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EbEnabled\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enamespace\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EPrivate\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003Eint64\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EOldRefCnt\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EAtomicAddRelaxed\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEnabled\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EbEnabled\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"n\"\u003EUE_TRACE_LOG\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETrace\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EChannelToggle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ETraceLogChannel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EChannelToggle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EId\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EName\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EHash\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EChannelToggle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EIsEnabled\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EIsEnabled\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E());\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EIsEnabled\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"szA-jIpi\"\u003E意味着要小心Toggle()函数执行的次数，如果执行序列未Toggle(false), Toggle(false), Toggle(true)，那么值还是false。\u003C\u002Fp\u003E\u003Ch3\u003E收集Profile数据\u003C\u002Fh3\u003E\u003Cp data-pid=\"kTAkcCm9\"\u003E收集Profile数据是Unreal Insights最重要的部分。\u003C\u002Fp\u003E\u003Ch3\u003E创建profile标签\u003C\u002Fh3\u003E\u003Cp data-pid=\"ssNKLvQx\"\u003E我们可以使用宏创建新的profile标签，常用的为TRACE_CPUPROFILER_EVENT_SCOPE(Name)，可以在函数的第一行添加它，这样就记录了函数的总执行时间。\u003C\u002Fp\u003E\u003Cp data-pid=\"263yUKuE\"\u003E宏最终展开内容如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"cp\"\u003E#define TRACE_CPUPROFILER_EVENT_SCOPE_ON_CHANNEL_STR(NameStr, Channel) \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tstatic uint32 PREPROCESSOR_JOIN(__CpuProfilerEventSpecId, __LINE__); \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tif (bool(Channel|CpuChannel) &amp;&amp; PREPROCESSOR_JOIN(__CpuProfilerEventSpecId, __LINE__) == 0) { \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\t\tPREPROCESSOR_JOIN(__CpuProfilerEventSpecId, __LINE__) = FCpuProfilerTrace::OutputEventType(NameStr); \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\t} \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tFCpuProfilerTrace::FEventScope PREPROCESSOR_JOIN(__CpuProfilerEventScope, __LINE__)(PREPROCESSOR_JOIN(__CpuProfilerEventSpecId, __LINE__), Channel);\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"KDEm3WHT\"\u003EPREPROCESSOR_JOIN宏把两个参数拼接到一起，因此创建了名为__CpuProfilerEventSpecIdXXX的uint32变量，注意这是一个static变量，每个标签都对应一个，可以称为SpecId。之后判断该变量是否为0，即我们是否第一次进到这个标签，如果是第一次，要使用FCpuProfilerTrace::OutputEventType()函数获取新的Id，Id是自增的且可多线程访问。期间还有UE_TRACE_LOG写入操作，这个下文再介绍。\u003C\u002Fp\u003E\u003Cp data-pid=\"JypiKDcm\"\u003E最后创建FCuProfilerTrace::FEventScope对象，该对象的生命周期就是我们的profile周期，构造函数开始profile，析构函数结束profile。\u003C\u002Fp\u003E\u003Cp data-pid=\"nbHFpLwl\"\u003E\u003Cb\u003EFEventScope\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EFEventScope\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EFEventScope\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInSpecId\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ETrace\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFChannel\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EChannel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EbEnabled\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EChannel\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECpuChannel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EbEnabled\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003EOutputBeginEvent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInSpecId\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"o\"\u003E~\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFEventScope\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EbEnabled\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003EOutputEndEvent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n        \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Ebool\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EbEnabled\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"CqoCUxsg\"\u003E注意到无论构造函数还是析构函数，都会先判断bEnabled，而bEnabled由Chennel值决定。我们可以中途通过Trace.Start和Trace.Stop来动态改变Channel值，使后面代码不走，这样就能按需开启\u002F关闭Profile数据收集了，但打开的TCP连接和文件描述符，还保留着。\u003C\u002Fp\u003E\u003Cp data-pid=\"AW_eBXtO\"\u003E\u003Cb\u003E构造函数\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"ECtt_Kmm\"\u003E先看构造函数中的OutputBeginEvent，InSpecId就是我们之前创建的静态变量SpecId，函数内部又是两个宏。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"cp\"\u003E#define CPUPROFILERTRACE_OUTPUTBEGINEVENT_PROLOGUE() \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\t++FCpuProfilerTraceInternal::ThreadDepth; \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tFCpuProfilerTraceInternal::FThreadBuffer* ThreadBuffer = FCpuProfilerTraceInternal::ThreadBuffer; \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tif (!ThreadBuffer) \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\t{ \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\t\tThreadBuffer = FCpuProfilerTraceInternal::CreateThreadBuffer(); \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\t} \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E#define CPUPROFILERTRACE_OUTPUTBEGINEVENT_EPILOGUE() \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tuint64 Cycle = FPlatformTime::Cycles64(); \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tuint64 CycleDiff = Cycle - ThreadBuffer-&gt;LastCycle; \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tThreadBuffer-&gt;LastCycle = Cycle; \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tuint8* BufferPtr = ThreadBuffer-&gt;Buffer + ThreadBuffer-&gt;BufferSize; \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tFTraceUtils::Encode7bit((CycleDiff &lt;&lt; 1) | 1ull, BufferPtr); \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tFTraceUtils::Encode7bit(SpecId, BufferPtr); \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tThreadBuffer-&gt;BufferSize = (uint16)(BufferPtr - ThreadBuffer-&gt;Buffer); \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tif (ThreadBuffer-&gt;BufferSize &gt;= FCpuProfilerTraceInternal::FullBufferThreshold) \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\t{ \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\t\tFCpuProfilerTraceInternal::FlushThreadBuffer(ThreadBuffer); \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\t}\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFCpuProfilerTrace\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EOutputBeginEvent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESpecId\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003ECPUPROFILERTRACE_OUTPUTBEGINEVENT_PROLOGUE\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003ECPUPROFILERTRACE_OUTPUTBEGINEVENT_EPILOGUE\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"pgk3SCTo\"\u003E\u003Cb\u003ECPUPROFILERTRACE_OUTPUTBEGINEVENT_PROLOGUE\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"GFywnnXp\"\u003E首先递增ThreadDepth，它是ThreadLocal变量，用于表示当前线程的CPUPROFILETRACE深度。之后按需创建同样是ThreadLocal变量的ThreadBuffer，用于记录Profile数据。\u003C\u002Fp\u003E\u003Cp data-pid=\"OxvjYTDv\"\u003E\u003Cb\u003EFThreadBuffer\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"X3c95Qsi\"\u003EFThreadBuffer可以理解为一块内存，用于存储多个EventScope的相关数据。\u003C\u002Fp\u003E\u003Cp data-pid=\"4nfu4S9f\"\u003E主要属性：\u003C\u002Fp\u003E\u003Cp data-pid=\"pUecTj1u\"\u003Euint64 LastCycle 最后一次记录的时钟周期\u003C\u002Fp\u003E\u003Cp data-pid=\"IQRRqQ_C\"\u003Euint8 Buffer[MaxBufferSize] 存储数据的Buffer，MaxBufferSize默认256\u003C\u002Fp\u003E\u003Cp data-pid=\"Z87y0lwl\"\u003Euint16 BufferSize 当前存储数据的size\u003C\u002Fp\u003E\u003Cp data-pid=\"6wds5uEZ\"\u003E类FCpuProfilerTraceInternal的静态成员ThreadBuffer就是当前线程所使用的ThreadBuffer。\u003C\u002Fp\u003E\u003Cp data-pid=\"SNGqTvpN\"\u003E\u003Cb\u003ECPUPROFILERTRACE_OUTPUTBEGINEVENT_EPILOGUE\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"jZKmTaFm\"\u003E之后获取当前CPU时钟tick计数，需要高精度，各平台实现不同，比如Windows使用QueryPerformanceCounter，精度高于1微妙，ios平台则使用mach_absolute_time内核接口。得到tick计数后，只要计算与上次记录计数的Diff，然后把Diff和SpecId写入ThreadBuffer即可，因为后面计数会重置，以减小内存消耗。\u003C\u002Fp\u003E\u003Cp data-pid=\"0XLGyny0\"\u003E注意到写入使用了Encode7bit接口，这是一种变长编码实现，可以节省内存。一个Byte只有7为存储数据，最高位表示当前值是否还有后续部分待读取。举个例子：\u003C\u002Fp\u003E\u003Cp data-pid=\"RgUzVoNv\"\u003E存储127需要一个Byte\u003C\u002Fp\u003E\u003Cp data-pid=\"XroEi9wX\"\u003E01111 1111\u003C\u002Fp\u003E\u003Cp data-pid=\"0D3gxHLD\"\u003E存储128需要两个Byte\u003C\u002Fp\u003E\u003Cp data-pid=\"CjEBQeyl\"\u003E1111 1111 0000 0001\u003C\u002Fp\u003E\u003Cp data-pid=\"qBlYvy3-\"\u003E这种变长编码被广泛应用于Protobuf等序列化框架中。\u003C\u002Fp\u003E\u003Cp data-pid=\"h39upYQx\"\u003E当ThreadBuffer长度超过了FullBufferThreshold，默认256-15，需要执行一次flush，使用UE_TRACE_LOG写入另一个区域，然后重置ThreadBuffer的Buffer和LastCycle。\u003C\u002Fp\u003E\u003Cp data-pid=\"9ckoRc1d\"\u003E\u003Cb\u003E析构函数\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"1owI-w_4\"\u003E再看析构函数，其与构造函数对应，得到当前tick计数的Diff，然后写入ThreadBuffer，注意这次不需要写入id了。同样的，Buffer超阈值，或者Depth退回到0，要flush。\u003C\u002Fp\u003E\u003Ch3\u003EUE_TRACE_LOG\u003C\u002Fh3\u003E\u003Cp data-pid=\"9pR_tWVf\"\u003EProfile数据最终会通过UE_TRACE_LOG进行写入，现在分析它是如何工作的。\u003C\u002Fp\u003E\u003Cp data-pid=\"yqDFbeCV\"\u003E首先看生成SpecId时写入的例子：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003EUE_TRACE_LOG\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECpuProfiler\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventSpec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECpuChannel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ENameSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventSpec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EId\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESpecId\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventSpec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECharSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETCHAR\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventSpec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAttachment\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EName\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ENameSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"JlSULLtX\"\u003E不是很直观。。\u003C\u002Fp\u003E\u003Cp data-pid=\"FyU6IKwb\"\u003E还是需要先把宏都展开\u003C\u002Fp\u003E\u003Cp data-pid=\"2LUb5_wy\"\u003E第一步\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"cp\"\u003E#define UE_TRACE_LOG(LoggerName, EventName, ChannelsExpr, ...)\t\t\tTRACE_PRIVATE_LOG(LoggerName, EventName, ChannelsExpr, ##__VA_ARGS__)\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"MILu9N-P\"\u003EUE_TRACE_LOG的前3个参数为Loggername，EventName，ChannelsExpr，最后一个参数为额外内存大小，这里是NameSize，用于之后存储Name。\u003C\u002Fp\u003E\u003Cp data-pid=\"266ci1SQ\"\u003ELoggername不是一个独立的类型名或变量名，重点关注EventSpec和ChannlExpr，对应上面例子，就是EventSpec，CpuChannel，看下它们是怎么来的。\u003C\u002Fp\u003E\u003Cp data-pid=\"GNTd3Pn6\"\u003EEventSpec定义\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003EUE_TRACE_EVENT_BEGIN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECpuProfiler\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventSpec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EImportant\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EUE_TRACE_EVENT_FIELD\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EId\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EUE_TRACE_EVENT_FIELD\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECharSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003EUE_TRACE_EVENT_END\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"8CJ13gmn\"\u003E这会创建一个名为CpuProfilerEventSpecEvent的FEventNode实例，以及名为FCpuProfilerEventSpecFields的结构体。\u003C\u002Fp\u003E\u003Cp data-pid=\"QCI7elyK\"\u003E第二步\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"cp\"\u003E#define TRACE_PRIVATE_LOG(LoggerName, EventName, ChannelsExpr, ...) \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tTRACE_PRIVATE_LOG_PRELUDE(Enter, LoggerName, EventName, ChannelsExpr, ##__VA_ARGS__) \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\t\tTRACE_PRIVATE_LOG_EPILOG()\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\u003C\u002Fspan\u003E\t\t\n\u003Cspan class=\"cp\"\u003E#define TRACE_PRIVATE_LOG_PRELUDE(EnterFunc, LoggerName, EventName, ChannelsExpr, ...) \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\tif (TRACE_PRIVATE_CHANNELEXPR_IS_ENABLED(ChannelsExpr)) \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\t\tif (auto LogScope = Trace::Private::TLogScope&lt;F##LoggerName##EventName##Fields&gt;::EnterFunc(__VA_ARGS__)) \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003Eif (const auto&amp; __restrict EventName = *(F##LoggerName##EventName##Fields*)LogScope.GetPointer())\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"Xhoxc6T3\"\u003E这里会调用TLogScope&lt;FCpuProfilerEventSpecFields&gt;::Enter函数，创建一个FLogScope实例。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ETLogScope\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEnter\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EExtraSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESize\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EGetSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EExtraSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EUid\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EGetUid\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ELogScopeType\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Etypename\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ETLogScopeSelector\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EbIsImportant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ELogScopeType\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEnter\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEventFlags\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EUid\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"8B0OL3qr\"\u003ESize包括了成员变量大小，例子中为Id和CharSize的大小，之后调用Enter函数返回FLogScope实例或FImportantLogScope实例，后者只是简单继承了一下。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EFLogScope\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFlags\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"k\"\u003Estatic\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFLogScope\u003C\u002Fspan\u003E\t\t\u003Cspan class=\"n\"\u003EEnter\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EUid\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\t\t\t\t\t\u003Cspan class=\"nf\"\u003EGetPointer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\t\t\t\t\t\u003Cspan class=\"nf\"\u003ECommit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\t\t\t\t\t\u003Cspan class=\"k\"\u003Eoperator\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFLogScope\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFLogScope\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\t\t\u003Cspan class=\"k\"\u003Eoperator\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Ebool\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E\t\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"k\"\u003Econstexpr\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eexplicit\u003C\u002Fspan\u003E\t\t\u003Cspan class=\"k\"\u003Eoperator\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ebool\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E\t\t\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Eprivate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\t\u003Cspan class=\"n\"\u003EEnterPrelude\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Ebool\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EbMaybeHasAux\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\t\t\t\t\t\u003Cspan class=\"nf\"\u003EEnter\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EUid\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Ebool\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EbMaybeHasAux\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\t\t\t\t\t\u003Cspan class=\"nf\"\u003EEnterNoSync\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EUid\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Ebool\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EbMaybeHasAux\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\t\t\t\t\u003Cspan class=\"n\"\u003EPtr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"n\"\u003EFWriteBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\t\t\u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\t\t\t\t\t\t\u003Cspan class=\"n\"\u003EInstance\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"J5RdppTs\"\u003E最后进入到FLogScope::Enter函数，这里简单起见，只看FEventHeader版本。EnterPrelude函数中会获取当前线程的GTlsWriteBuffer，该Buffer用于实际数据写入，Buffer会预留FCpuProfilerEventSpecFields大小+Fields大小+NameSize（UE_TRACE_LOG最后一个参数）的内存，然后把Size和Uid写入Buffer。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"kr\"\u003Einline\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFLogScope\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEnterNoSync\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EUid\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Ebool\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EbMaybeHasAux\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EEnterPrelude\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFEventHeader\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EbMaybeHasAux\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"c1\"\u003E\u002F\u002F Event header\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\t\u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EHeader\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint16\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInstance\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EPtr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EHeader\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Euint16\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EHeader\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Euint16\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EUid\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E|\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEKnownEventUids\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFlag_TwoByteUid\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EHeaderType\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"kr\"\u003Einline\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFLogScope\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EEnterPrelude\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Ebool\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EbMaybeHasAux\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003Euint32\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EAllocSize\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EHeaderType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESize\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EbMaybeHasAux\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"n\"\u003EFWriteBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EWriter_GetBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECursor\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EAllocSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EUNLIKELY\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECursor\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EWriter_NextBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAllocSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"c1\"\u003E\u002F\u002F The auxilary data null terminator.\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\t\u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EbMaybeHasAux\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECursor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECursor\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECursor\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESize\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EbMaybeHasAux\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EInstance\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECursor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"GvukXAAW\"\u003E接着执行下面的宏，FLogScope重载了+=操作符，会执行FLogScope::Commit函数，作用为把Buffer当前Cursor更新到Buffer.Commit，因此称为“提交”。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"cp\"\u003E#define TRACE_PRIVATE_LOG_EPILOG() \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\t\t\t\tLogScope += LogScope\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\u003C\u002Fspan\u003E\t\t\t\t\n\u003Cspan class=\"kr\"\u003Einline\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFLogScope\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECommit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EFWriteBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInstance\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EAtomicStoreRelease\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E((\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E**\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECommitted\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECursor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"dTsxrscH\"\u003E到这里，我们看完了第一个UE_TRACE_LOG执行的操作，最后会得到一个FLogScope对象，该对象关联了Buffer，以及一个FCpuProfilerEventSpecFields实例指针，名为EventSpec。\u003C\u002Fp\u003E\u003Cp data-pid=\"RAh0CBSO\"\u003E下面是有些怪异的&lt;&lt;操作符，它并不会真正输出什么，只是逐个初始化EventSpec的属性，内存地址就是Buffer中预留的FCpuProfilerEventSpecFields。最后的Attachment函数用于外挂一些未声明的其他属性。\u003C\u002Fp\u003E\u003Cp data-pid=\"McZ7DwHS\"\u003E一番操作后，Buffer内容如下：\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-670344001e97f6163df7b4a18161aeaf_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"463\" class=\"origin_image zh-lightbox-thumb\" width=\"937\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-670344001e97f6163df7b4a18161aeaf_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;937&#39; height=&#39;463&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"937\" data-rawheight=\"463\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"937\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-670344001e97f6163df7b4a18161aeaf_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-670344001e97f6163df7b4a18161aeaf_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"aMuJivkd\"\u003E不妨称一次UE_TRACE_LOG写入Buffer的内容称为一个“EventBlock”，可以认为是最小写入单位。\u003C\u002Fp\u003E\u003Cp data-pid=\"3mP_A1RV\"\u003E接下来看FlushThreadBuffer中的UE_TRACE_LOG使用\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003EUE_TRACE_LOG\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECpuProfiler\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventBatch\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInThreadBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBufferSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventBatch\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAttachment\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInThreadBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInThreadBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBufferSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"YK2HJTj0\"\u003E与之前例子类似，但这里EventBatch没有成员变量，只申请了BufferSize，然后把Buffer作为attachment数据写入。\u003C\u002Fp\u003E\u003Cp data-pid=\"Bl9J9RDL\"\u003E此时写入的EventBlock内容：\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-481a0f163fd8412ad2efe13c659bccae_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"578\" data-rawheight=\"316\" class=\"origin_image zh-lightbox-thumb\" width=\"578\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-481a0f163fd8412ad2efe13c659bccae_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;578&#39; height=&#39;316&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"578\" data-rawheight=\"316\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"578\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-481a0f163fd8412ad2efe13c659bccae_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-481a0f163fd8412ad2efe13c659bccae_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"jt2xDTG5\"\u003EThreadBuffer很小，因此要多次写入才能填满一个TlsBuffer，写入操作其实就是memorycpy了ThreadBuffer的内存。\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-79763e42e8b5e0fade8c9269f0758ff6_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1097\" data-rawheight=\"398\" class=\"origin_image zh-lightbox-thumb\" width=\"1097\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-79763e42e8b5e0fade8c9269f0758ff6_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1097&#39; height=&#39;398&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1097\" data-rawheight=\"398\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1097\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-79763e42e8b5e0fade8c9269f0758ff6_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-79763e42e8b5e0fade8c9269f0758ff6_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"6yTUtH6H\"\u003E\u003Cb\u003EUid\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"LLrrypkl\"\u003E注意到每个Block开头都是Uid，它是每个FXXXFields结构比如FCpuProfilerEventSpecFields的标识符，一个FXXXFields由LoggerName和EventName唯一确定。在使用UE_TRACE_EVENT_BEGIN创建FXXXFields时，会同步创建一个对应的FEventNode对象，它会以单调递增方式创建新的Uid，并且内部记录了LoggerName和EventName。所有创建的FEventNode都会添加到GNewEventList链表中进行管理，类似GNewChannelList，这个链表只会存储新建EventNode，当EventNode信息被WriterBuffer发送之后，GNewEventList会被清空。\u003C\u002Fp\u003E\u003Cp data-pid=\"r_GRUlY9\"\u003E\u003Cb\u003EFWriteBuffer\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"1T_PU1Rd\"\u003E前面介绍了UnrealInsight写入TlsBuffer数据的结构，那TlsBuffer有多大？写满了怎么办？因此这里看下UE如何管理TlsBuffer。\u003C\u002Fp\u003E\u003Cp data-pid=\"ux6-Leue\"\u003ETlsBuffer全称为GTlsWriteBuffer，类型是FWriteBuffer，通过thread_local描述符，声明为每个线程独有。每个FWriteBuffer的BufferSize，由GPollBlockSize指定，默认4KB，但不都能存储数据，这块内存头部要存储FWriteBuffer本身，然后要再空一个uint32，还不确定用途。UE把这个Buffer称为Block。然后Block由更大的Page进行管理，类型为FPoolPage，申请内存的单位是Page。Page大小可以不同，初始化的Page包含64个Block，中途扩容的Page包含16个Block，这点很像UE的mallocbinned内存分配器了。不过观察426引擎代码，发现初始Page大小并没有被使用过，统一用到扩容Page大小。\u003C\u002Fp\u003E\u003Cp data-pid=\"pVxHlrWk\"\u003E数据结构\u003C\u002Fp\u003E\u003Cp data-pid=\"wj_PeI_n\"\u003EFWriteBuffer\u003C\u002Fp\u003E\u003Cp data-pid=\"gaOunhvf\"\u003Euint16Size 可用空间\u003C\u002Fp\u003E\u003Cp data-pid=\"fBR-Am9x\"\u003EFWriteBuffer* NextBuffer 指向的下个FWriteBuffer(Block)节点 \u003C\u002Fp\u003E\u003Cp data-pid=\"UEZksG53\"\u003EUint8* Cursor 存储数据的游标\u003C\u002Fp\u003E\u003Cp data-pid=\"9wUynvB0\"\u003EUint8* Commited 提交数据的游标\u003C\u002Fp\u003E\u003Cp data-pid=\"l2Sw5Hqh\"\u003Euint16 ThreadId 对应线程id\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"pz0jdolU\"\u003EFPoolPage\u003C\u002Fp\u003E\u003Cp data-pid=\"f2mCTbUA\"\u003EFPoolPage* NextPage 指向的下个FPoolPage节点\u003C\u002Fp\u003E\u003Cp data-pid=\"01jrVEXJ\"\u003EUint32 AllocSize Page大小\u003C\u002Fp\u003E\u003Cp data-pid=\"ks_0KdBB\"\u003EBlock和Page的结构图如下：\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-6ff6ed9da92f4826ec9c9ee6ab09b44f_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1453\" data-rawheight=\"582\" class=\"origin_image zh-lightbox-thumb\" width=\"1453\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-6ff6ed9da92f4826ec9c9ee6ab09b44f_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1453&#39; height=&#39;582&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1453\" data-rawheight=\"582\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1453\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-6ff6ed9da92f4826ec9c9ee6ab09b44f_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-6ff6ed9da92f4826ec9c9ee6ab09b44f_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp data-pid=\"WWoN9-2o\"\u003E有两点值得关注\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"lON7P-Vy\"\u003EPage中第一个Block头部存储了FPoolPage结构体，相比其他BlockBuffer会小一些\u003C\u002Fli\u003E\u003Cli data-pid=\"-jap-r1Y\"\u003E每个Block的FWriteBuffer在内存块尾部，Cursor初始为Buffer头部，往后增长，因此判断Buffer满的条件为Cursor&gt;FWriteBuffer\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp data-pid=\"dL5zU4M8\"\u003EUE维护一个GPoolFreeList指针，当申请完一个Page后，会取走第一个Block去使用，然后把最后一个Block的NextBuffer指向第二个Block，再把GPoolPreeList指向第二个Block，这样当下次需要Block时，直接取GPoolFreeList即可。\u003C\u002Fp\u003E\u003Cp data-pid=\"OVNImR_a\"\u003E回到UE_TRACE_LOG写入Buffer代码，如果此时Buffer已满，就会执行Writer_NextBufferInternal()函数，获取下一个可用Buffer，并且把当前Buffer的NextBuffer指向新获取的Buffer。\u003C\u002Fp\u003E\u003Cp data-pid=\"2r95TxWx\"\u003E被写入数据的Buffer由另一个链表管理，称为GNewThreadList。\u003C\u002Fp\u003E\u003Cp data-pid=\"Ec0AMLcR\"\u003E因此，一个“满”的Buffer可能存在空隙，比如Buffer还有10Byte空闲，我们要写入12Byte，那么该Buffer就被判定为“满”了，12byte会被写入下个Buffer。\u003C\u002Fp\u003E\u003Ch3\u003E发送Profile数据\u003C\u002Fh3\u003E\u003Cp data-pid=\"BPwT1qFZ\"\u003E我们已经记录了Profile数据，并且写入了Buffer，之后这些数据如何被传到服务器，或写入文件？\u003C\u002Fp\u003E\u003Cp data-pid=\"dXVUsvHi\"\u003E回到最开始的UnrealInsight初始化部分，会执行Trace::Initialize()函数，如果平台支持多线程（一般都支持），就启动独立的WriterThread，并以17ms为间隔进行tick。\u003C\u002Fp\u003E\u003Cp data-pid=\"JVsA-dTU\"\u003Etick执行函数为Writer_WorkerUpdate()\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Estatic\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EWriter_WorkerUpdate\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EWriter_UpdateControl\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EWriter_UpdateData\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EWriter_DescribeAnnounce\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"n\"\u003EWriter_DrainBuffers\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"EOb32S4K\"\u003E前两个函数用于更新连续状态等内容，可以不管，重点看后两个函数。\u003C\u002Fp\u003E\u003Cp data-pid=\"oZoDeZ7I\"\u003EWriter_DescribeAnnounce\u003C\u002Fp\u003E\u003Cp data-pid=\"fxxWDuQ9\"\u003E我们每次用UE_TRACE_LOG写入Profile信息，都会用Uid开头作为标记，Uid由Loggername（如CpuProfiler）和EventName（如Scope）确定，还可能包含成员变量，因此要把这个对应关系也发到UnrealInsight服务器，这样在收到Uid之后才知道要如何处理后面的数据。UE_TRACE_LOG会生成FEventNode对象，里面包含了Uid对应的LoggerName，EventName，以及Field描述信息，相当于反射数据，指导UnrealInsight服务器如何解析数据。\u003C\u002Fp\u003E\u003Cp data-pid=\"vsgEl97q\"\u003E举个例子：\u003C\u002Fp\u003E\u003Cp data-pid=\"j-75ImiE\"\u003E使用标记TRACE_CPUPROFILER_EVENT_SCOPE(Name)来profile一个函数，首先要给这一行的标记生成一个SpecId，并把Name和SpecId的关系通过UE_TRACE_LOG写入TlsBuffer，这个Event称为EventSpec：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003EUE_TRACE_LOG\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECpuProfiler\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventSpec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECpuChannel\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ENameSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventSpec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EId\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESpecId\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventSpec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECharSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euint8\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETCHAR\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventSpec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAttachment\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EName\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ENameSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"Mp38heH6\"\u003E此处的Uid对应CpuProfiler和EventSpec，服务器需要知道数据中包含了成员变量SpecId和CharSize，以及Attachment包含了Name数据。\u003C\u002Fp\u003E\u003Cp data-pid=\"Ah5hWwyF\"\u003E再到FlushThreadBuffer\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003EUE_TRACE_LOG\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECpuProfiler\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventBatch\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInThreadBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBufferSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEventBatch\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAttachment\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EInThreadBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EInThreadBuffer\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EBufferSize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"DwPhwYlT\"\u003E这里的Uid对应CpuProfiler和EventBatch，服务器需要解析该Buffer，获取SpecId和时钟tick计数。\u003C\u002Fp\u003E\u003Cp data-pid=\"zzcpyt0m\"\u003EWriter_DescribeAnnounce函数会不断查找新创建的EventNode和Channel，并清空GNewEventList和GNewChannelList，把Uid对应的这些反射信息，都发给服务器。\u003C\u002Fp\u003E\u003Cp data-pid=\"33k4WJ-_\"\u003EWriter_DrainBuffers\u003C\u002Fp\u003E\u003Cp data-pid=\"J9d8WZQI\"\u003E最后终于到了发送FWriteBuffer部分。\u003C\u002Fp\u003E\u003Cp data-pid=\"9EIfTW1y\"\u003EUE会遍历GNewThreadList，取出已经写入数据的Buffer，然后根据Buffer.Commited指针获取到要发送的数据，之后交给底层的IoWrite接口进行发送。IoWrite接口屏蔽了网络发送和本地写文件，上层无感知，只管写入即可。\u003C\u002Fp\u003E\u003Cp data-pid=\"zrIXrW64\"\u003E处理完的FWriteBuffer又变成空闲可用状态，UE把它们重新加入到GPoolFreeList链表中，等待下次使用。\u003C\u002Fp\u003E\u003Ch3\u003E总体流程图\u003C\u002Fh3\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-81387f9a8fa5d1e481cc9f724d649421_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1343\" data-rawheight=\"985\" class=\"origin_image zh-lightbox-thumb\" width=\"1343\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-81387f9a8fa5d1e481cc9f724d649421_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;1343&#39; height=&#39;985&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1343\" data-rawheight=\"985\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1343\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-81387f9a8fa5d1e481cc9f724d649421_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-81387f9a8fa5d1e481cc9f724d649421_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003C\u002Fp\u003E","adminClosedComment":false,"topics":[{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19824201","type":"topic","id":"19824201","name":"虚幻引擎"}],"voteupCount":76,"voting":0,"heavyUpStatus":"allow_heavy_up","column":{"description":"","canManage":false,"intro":"分享UE的使用心得与源码分析","isFollowing":false,"urlToken":"c_1093468071653646336","id":"c_1093468071653646336","articlesCount":51,"acceptSubmission":true,"title":"UE随笔","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1093468071653646336","commentPermission":"all","created":1553483103,"updated":1644307732,"imageUrl":"https:\u002F\u002Fpicx.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-74e1a6777c0dbc55d34ce5b429e3041d.jpg?source=172ae18b","uid":"30959470641152","userType":"people","isFollowing":false,"urlToken":"xu-chen-71-65","id":"fc0546ea07e1242831bb188736b132cc","description":"喜欢摸索计算机底层、游戏引擎、各种有意思的事物，欢迎一起交流。","name":"南京周润发","isAdvertiser":false,"headline":"网易游戏码农","gender":1,"url":"\u002Fpeople\u002Ffc0546ea07e1242831bb188736b132cc","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-74e1a6777c0dbc55d34ce5b429e3041d_l.jpg?source=172ae18b","isOrg":false,"type":"people"},"followers":1001,"type":"column"},"commentCount":4,"contributions":[{"id":36868224,"state":"accepted","type":"first_publish","column":{"description":"","canManage":false,"intro":"分享UE的使用心得与源码分析","isFollowing":false,"urlToken":"c_1093468071653646336","id":"c_1093468071653646336","articlesCount":51,"acceptSubmission":true,"title":"UE随笔","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1093468071653646336","commentPermission":"all","created":1553483103,"updated":1644307732,"imageUrl":"https:\u002F\u002Fpicx.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-74e1a6777c0dbc55d34ce5b429e3041d.jpg?source=172ae18b","uid":"30959470641152","userType":"people","isFollowing":false,"urlToken":"xu-chen-71-65","id":"fc0546ea07e1242831bb188736b132cc","description":"喜欢摸索计算机底层、游戏引擎、各种有意思的事物，欢迎一起交流。","name":"南京周润发","isAdvertiser":false,"headline":"网易游戏码农","gender":1,"url":"\u002Fpeople\u002Ffc0546ea07e1242831bb188736b132cc","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-74e1a6777c0dbc55d34ce5b429e3041d_l.jpg?source=172ae18b","isOrg":false,"type":"people"},"followers":1001,"type":"column"}}],"isTitleImageFullScreen":false,"upvotedFollowees":[],"commercialInfo":{"isCommercial":false,"plugin":{}},"suggestEdit":{"status":false,"reason":"","tip":"","url":"","title":""},"reason":"","annotationAction":[],"canTip":false,"tipjarorsCount":0,"isLabeled":false,"hasPublishingDraft":false,"isFavorited":false,"favlistsCount":143,"isNormal":true,"status":0,"shareText":"UE UnrealInsights 使用与实现 - 来自知乎专栏「UE随笔」，作者: 南京周润发 https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F458086085 （想看更多？下载 @知乎 App：http:\u002F\u002Fweibo.com\u002Fp\u002F100404711598 ）","canComment":{"status":true,"reason":""},"mcnFpShow":-1,"isVisible":true,"isLiked":false,"likedCount":11,"hasColumn":true,"republishers":[],"isNewLinkCard":true,"emojiReaction":{"cryFaceCount":0,"cryFaceHasSet":false,"hugCount":0,"hugHasSet":false,"likeCount":11,"likeHasSet":false,"onlookerCount":0,"onlookerHasSet":false},"abParam":{"shangyebiaoshi":"1"},"attachedInfo":"kgIkCgkxODk5Mjc2MDcSCTQ1ODA4NjA4NRgHIgpJTUFHRV9URVhU","shareGuide":{"hasPositiveBubble":false,"hasTimeBubble":false,"hitShareGuideCluster":false},"settings":{"tableOfContents":{"enabled":false}},"canReference":false,"reactionInstruction":{}}},"columns":{"c_1093468071653646336":{"description":"","canManage":false,"intro":"分享UE的使用心得与源码分析","isFollowing":false,"urlToken":"c_1093468071653646336","id":"c_1093468071653646336","articlesCount":51,"acceptSubmission":true,"title":"UE随笔","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1093468071653646336","commentPermission":"all","created":1553483103,"updated":1644307732,"imageUrl":"https:\u002F\u002Fpicx.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-74e1a6777c0dbc55d34ce5b429e3041d.jpg?source=172ae18b","uid":"30959470641152","userType":"people","isFollowing":false,"urlToken":"xu-chen-71-65","id":"fc0546ea07e1242831bb188736b132cc","description":"喜欢摸索计算机底层、游戏引擎、各种有意思的事物，欢迎一起交流。","name":"南京周润发","isAdvertiser":false,"headline":"网易游戏码农","gender":1,"url":"\u002Fpeople\u002Ffc0546ea07e1242831bb188736b132cc","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-74e1a6777c0dbc55d34ce5b429e3041d_l.jpg?source=172ae18b","isOrg":false,"type":"people"},"followers":1001,"type":"column"}},"topics":{},"roundtables":{},"favlists":{},"comments":{},"notifications":{},"ebooks":{},"activities":{},"feeds":{},"pins":{},"promotions":{},"drafts":{},"chats":{},"posts":{},"clubs":{},"clubTags":{},"zvideos":{},"zvideoContributions":{},"briefs":{},"eduCourses":{}},"currentUser":"9b939bd116cd066ce372288d50538da8","account":{"lockLevel":{},"unlockTicketStatus":false,"unlockTicket":null,"challenge":[],"errorStatus":false,"message":"","isFetching":false,"accountInfo":{},"urlToken":{"loading":false},"cardUserInfo":{"vipInfo":{}},"handleWidget":{},"widgetList":[],"userWidgetId":""},"settings":{"socialBind":null,"inboxMsg":null,"notification":{},"email":{},"privacyFlag":null,"blockedUsers":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"blockedFollowees":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"ignoredTopics":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"restrictedTopics":null,"laboratory":{}},"notification":{},"people":{"profileStatus":{},"activitiesByUser":{},"answersByUser":{},"answersSortByVotesByUser":{},"answersIncludedByUser":{},"votedAnswersByUser":{},"thankedAnswersByUser":{},"voteAnswersByUser":{},"thankAnswersByUser":{},"topicAnswersByUser":{},"zvideosByUser":{},"articlesByUser":{},"articlesSortByVotesByUser":{},"articlesIncludedByUser":{},"pinsByUser":{},"questionsByUser":{},"commercialQuestionsByUser":{},"favlistsByUser":{},"followingByUser":{},"followersByUser":{},"mutualsByUser":{},"followingColumnsByUser":{},"followingQuestionsByUser":{},"followingFavlistsByUser":{},"followingTopicsByUser":{},"publicationsByUser":{},"columnsByUser":{},"allFavlistsByUser":{},"brands":null,"creationsByUser":{},"creationsSortByVotesByUser":{},"creationsFeed":{},"infinity":{},"batchUsers":{},"profileInfinity":null},"env":{"ab":{"config":{"params":[{"id":"vessay_v2_sdk","type":"Int","value":"1","layerId":"Qtkm"},{"id":"pc_ppt_publish","type":"Int","value":"1","layerId":"pc_ppt_publish"},{"id":"helpcenter_pc","type":"Int","value":"1","layerId":"helpcenter_pc"},{"id":"pc_comment","type":"Int","value":"1","layerId":"EsOR"},{"id":"pc_follow","type":"Int","value":"1","layerId":"pc_follow"},{"id":"pc_player_rp","type":"Int","value":"0","layerId":"pc_player_rp"},{"id":"use_biz_comment","type":"Int","value":"1","layerId":"use_biz_comment"}],"experiments":[{"expId":"pc_ppt_publish-2_v2","expPrefix":"pc_ppt_publish","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"helpcenter_pc-2_v11","expPrefix":"helpcenter_pc","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"pc_comment-2_v4","expPrefix":"pc_comment","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"pc_follow-3_v5","expPrefix":"pc_follow","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"pc_player_rp-1_v1","expPrefix":"pc_player_rp","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"use_biz_comment-2_v5","expPrefix":"use_biz_comment","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false}],"chains":[{"chainId":"_all_"}],"encodedParams":"CtQBGwA\u002FAEcAtABpAWoBdAE7AswC1wLYAk8DUAOgA6EDogO3A\u002FMD9AMzBIwEjQSmBNYEEQUyBVEFiwWMBZ4FMAYxBn4G6wYnB3cHeAfYB9wH3QcnCGcIdAh2CHkIxQjaCD8JQglUCVUJYAmNCcMJxAnFCcYJxwnICckJygnLCcwJ0QnlCfEJ9AkECkkKZQprCpgKpQqpCr4KxArUCt0K7Qr9Cv4KKQs7CzwLQwtGC3ELdguFC4cLjQu5C8AL1wvgC+UL5gssDDgMcQyPDKwMwwzJDPgMtQsSagAAAAEAAQACAwAAAAAAAAAAAAAABAQABAABAQAAAQABAAAAAAAAAgIABAAABgAAAAEAAAAAAAAAAAAAAAAAAAAABwMAAAAAAQAAAAEBAQAHAAEBAAEAAAAAAAUAAAIAAAAGAQAAAAAAAAM="},"triggers":{}},"userAgent":{"Edge":false,"IE":false,"Wechat":false,"Weibo":false,"QQ":false,"MQQBrowser":false,"Qzone":false,"Mobile":false,"Android":false,"iOS":false,"isAppleDevice":false,"Zhihu":false,"ZhihuHybrid":false,"isBot":false,"Tablet":false,"UC":false,"Quark":false,"Sogou":false,"Qihoo":false,"Baidu":false,"BaiduApp":false,"Safari":false,"GoogleBot":false,"AndroidDaily":false,"iOSDaily":false,"WxMiniProgram":false,"BaiduMiniProgram":false,"QQMiniProgram":false,"JDMiniProgram":false,"isWebView":false,"isMiniProgram":false,"origin":"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F105.0.0.0 Safari\u002F537.36 Edg\u002F105.0.1343.27"},"appViewConfig":{},"ctx":{"path":"\u002Fp\u002F458086085","query":{},"href":"http:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F458086085","host":"zhuanlan.zhihu.com"},"trafficSource":"production","edition":{"beijing":false,"baidu":false,"sogou":false,"baiduBeijing":false,"sogouBeijing":false,"sogouInput":false,"baiduSearch":false,"googleSearch":false,"shenma":false,"miniProgram":false,"xiaomi":false},"theme":"light","appHeaderTheme":{"current":"normal","disable":true,"normal":{"bgColor":"GBK99A"},"custom":{"bgColor":"GBK99A"}},"enableShortcut":true,"referer":"https:\u002F\u002Fwww.bing.com\u002F","xUDId":"ADAds6PjzxOPTmBuqv67KXaBAfLOjNtmuyk=","mode":"ssr","conf":{},"xTrafficFreeOrigin":"","ipInfo":{"cityName":"上海","countryName":"中国","regionName":"上海","countryCode":"CN"},"logged":true,"vars":{"passThroughHeaders":{}}},"me":{"columnContributions":[]},"label":{"recognizerLists":{}},"ecommerce":{},"comments":{"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"parent":{}},"commentsV2":{"stickers":[],"commentWithPicPermission":{},"notificationsComments":{},"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"conversationMore":{},"parent":{}},"pushNotifications":{"default":{"isFetching":false,"isDrained":false,"ids":[]},"follow":{"isFetching":false,"isDrained":false,"ids":[]},"vote_thank":{"isFetching":false,"isDrained":false,"ids":[]},"currentTab":"default","notificationsCount":{"default":0,"follow":0,"vote_thank":0}},"messages":{"data":{},"currentTab":"common","messageCount":0},"register":{"registerValidateSucceeded":null,"registerValidateErrors":{},"registerConfirmError":null,"sendDigitsError":null,"registerConfirmSucceeded":null},"login":{"loginUnregisteredError":false,"loginBindWechatError":false,"loginConfirmError":null,"sendDigitsError":null,"needSMSIdentify":false,"validateDigitsError":false,"loginConfirmSucceeded":null,"qrcodeLoginToken":"","qrcodeLoginScanStatus":0,"qrcodeLoginError":null,"qrcodeLoginReturnNewToken":false},"switches":{},"captcha":{"captchaNeeded":false,"captchaValidated":false},"sms":{"supportedCountries":[]},"chat":{"chats":{},"inbox":{"recents":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"strangers":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"friends":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"search":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"config":{"newCount":0,"strangerMessageSwitch":false,"strangerMessageUnread":false,"friendCount":0}},"global":{"isChatMqttExisted":false}},"emoticons":{"emoticonGroupList":[],"emoticonGroupDetail":{}},"creator":{"currentCreatorUrlToken":null,"homeData":{"recommendQuestions":[]},"tools":{"question":{"invitationCount":{"questionFolloweeCount":0,"questionTotalCount":0},"goodatTopics":[]},"customPromotion":{"itemLists":{}},"recommend":{"recommendTimes":{}}},"explore":{"academy":{"tabs":[],"article":{}}},"rights":[],"newRights":[],"rightsStatus":{},"levelUpperLimit":10,"account":{"growthLevel":{}},"mcn":{},"applyStatus":{},"videoSupport":{},"textBenefit":{},"mcnManage":{},"tasks":{},"newTasks":{"creatorTask":{"tasks":[],"des":[]}},"scoreInfo":{},"recentlyCreated":[],"analysis":{"all":{},"answer":{},"zvideo":{},"article":{},"pin":{},"singleContent":{}},"announcement":{},"bannerList":[],"school":{"tabs":[],"contents":[],"banner":null,"entities":{}},"creatorsRecommendInfo":{},"menusShowControlByServer":{"bVipRecomend":false,"creationRelationship":false},"income":{"aggregation":{}}},"answers":{"voters":{},"copyrightApplicants":{},"favlists":{},"newAnswer":{},"entityWords":{},"concernedUpvoters":{},"simpleConcernedUpvoters":{},"paidContent":{},"settings":{}},"recommendation":{"homeRecommendations":[]},"shareTexts":{},"articles":{"voters":{},"concernedUpvoters":{}},"previewPost":{},"favlists":{"relations":{}},"columns":{"voters":{}},"reward":{"answer":{},"article":{},"question":{}},"video":{"data":{},"shareVideoDetail":{},"last":{}},"topstory":{"recommend":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"follow":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"room":{"meta":{},"isFetching":false,"afterId":0,"items":[],"next":null},"followWonderful":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"sidebar":null,"announcement":{},"hotList":[],"guestFeeds":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followExtra":{"isNewUser":null,"isFetched":false,"followCount":0,"followers":[]},"hotDaily":{"data":[],"paging":{}},"hotHighlight":{"isFetching":false,"isDrained":false,"data":[],"paging":{}},"banner":{},"commercialBanner":{"show":false,"banner":{},"trackData":{}},"video":{"items":[],"next":null,"isLoading":false,"isDrained":false}},"readStatus":{},"column":{},"requestColumn":{"categories":[],"error":null},"articleContribution":{"contributeRequests":[],"deleteContributeIdList":[],"handledContributeIdList":[],"recommendedColumns":[],"pinnedColumns":[],"sentContributeRequestsIdList":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"c_1093468071653646336"]},"columnContribution":{"contributeRequests":[],"autoInviteEnabled":false,"recommendedContributors":[],"contributionInvitation":null},"draftHistory":{"history":{},"drafts":{}},"upload":{},"articleDraft":{"titleImage":"","titleImageSize":{},"isTitleImageFullScreen":false,"canTitleImageFullScreen":false,"title":"","titleImageUploading":false,"error":"","content":"","draftLoading":false,"updating":false,"globalLoading":false,"pendingVideo":{"resource":null,"error":null},"deleteFail":{"fail":false},"recommendTopics":[],"selectedColumn":0,"articleDisclaimers":[]},"articleDrafts":{"isDrained":false,"isLoading":false,"items":[]},"columnAutocomplete":{"users":[],"friends":[]},"columnCollection":{},"userProfit":{"permission":{"permissionStatus":{"zhiZixuan":0,"recommend":-1,"task":0,"plugin":0,"infinity":0},"visible":false}},"mcn":{"bindInfo":{},"memberCategoryList":[],"producerList":[],"categoryList":[],"lists":{},"banners":{},"protocolStatus":{"isAgreedNew":true,"isAgreedOld":true},"probationCountdownDays":0},"zvideos":{"campaignVideoList":{},"campaigns":{},"tagoreCategory":[],"recommendations":{},"insertable":{},"recruit":{"form":{"platform":"","nickname":"","followerCount":"","domain":"","contact":""},"submited":false,"ranking":[]},"club":{},"qyActivityData":{},"talkActivityData":{},"party2022ActivityData":{},"batchVideos":{},"contribution":{"selectedContribution":null,"campaign":null,"configs":{},"contributionLists":{},"recommendQuestions":{"isLoading":true,"paging":{"isEnd":false,"isStart":true,"totals":0},"data":[]},"questionSearchResults":{"isLoading":true,"paging":{"isEnd":false,"isStart":true,"totals":0},"data":[]}},"creationReferences":{},"zvideoCollection":{},"zvideoGrant":{},"collectData":{"isFetching":false,"list":[]},"videoSource":{"isLoaded":false}},"republish":{},"commentPermission":{},"creatorRightStatus":{"list":[]}},"fetchHost":"www.zhihu.com","subAppName":"column"}</script><script crossorigin="" src="./UE UnrealInsights 使用与实现 - 知乎_files/vendor.4bb309fcb0b4b803488b.js.download"></script><script crossorigin="" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.lib_09e9ad9b.7ecaffb5e5e7b964c1e5.js.download"></script><script crossorigin="" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.lib_330004dc.c475248f53a2a41d1aaa.js.download"></script><script crossorigin="" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.lib_79b5cf47.2e14e141df7aa7169c59.js.download"></script><script crossorigin="" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.lib_29107295.cbb422fac870dbff6194.js.download"></script><script crossorigin="" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.lib_0ad37f8a.adad3b5ab7b95dd51ffc.js.download"></script><script crossorigin="" src="./UE UnrealInsights 使用与实现 - 知乎_files/column.app.1552bd8b4930aa16be5e.js.download"></script><script defer="" src="./UE UnrealInsights 使用与实现 - 知乎_files/aria.js.download"></script><script src="./UE UnrealInsights 使用与实现 - 知乎_files/hm.js.download" async=""></script><script crossorigin="" src="./UE UnrealInsights 使用与实现 - 知乎_files/zap.js.download"></script><script src="./UE UnrealInsights 使用与实现 - 知乎_files/push.js.download"></script><div><div style="display: none;"><i>想来知乎工作？请发送邮件到 jobs@zhihu.com</i></div></div><div><div><div class="css-8pdeid"></div></div></div><script crossorigin="" src="./UE UnrealInsights 使用与实现 - 知乎_files/emoticon.js.download"></script><div><div><div class="Editable-languageSuggestions" style="left: -1179px; top: -999px;"><div><div class="Popover"><label class="Editable-languageSuggestionsInput Input-wrapper"><input autocomplete="off" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-activedescendant="AutoComplete14-0" id="Popover13-toggle" aria-haspopup="true" aria-owns="Popover13-content" class="Input" placeholder="选择语言" value=""><svg width="24" height="24" viewBox="0 0 24 24" data-new-api="ArrowUpDown24" data-old-api="Select" fill="#afbdcf" class="Zi Zi--Select"><path d="M12.53 3.47a.75.75 0 00-1.06 0l-5 5a.75.75 0 001.06 1.06L12 5.06l4.47 4.47a.75.75 0 101.06-1.06l-5-5zm-5 11a.75.75 0 00-1.06 1.06l5 5a.75.75 0 001.06 0l5-5a.75.75 0 10-1.06-1.06L12 18.94l-4.47-4.47z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></label></div></div></div></div></div></body></html>