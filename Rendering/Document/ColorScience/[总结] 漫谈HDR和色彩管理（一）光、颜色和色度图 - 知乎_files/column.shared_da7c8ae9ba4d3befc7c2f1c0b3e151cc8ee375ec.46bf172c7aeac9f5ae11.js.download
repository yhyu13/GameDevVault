(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1453:function(e,t,n){"use strict";n.d(t,"b",(function(){return a}));var r=n(42),c={400:"请求参数有误",401:"用户认证失败",403:"服务已拒绝",404:"资源不存在",405:"请求方式有误",410:"资源已解散",502:"网关错误",503:"服务无响应",504:"网关超时"},a=function(e){var t;return(null==e||null===(t=e.payload)||void 0===t?void 0:t.message)||(null==e?void 0:e.status)&&c[e.status]||"操作失败"};t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)("ui/showToast").dispatch({icon:"fail",text:a(e)})}},1475:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r,c=n(9),a=n(3),o=n(0),i=n(91),s=n(1),l=n(56),u=n(515),d=n(86),f=n(110);function p(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}var h={comment_img:"comment_img",dynamic_top:"dynamic_top",comment_sticker:"comment_sticker",block_keyword:"block_keyword"},m=(r={},Object(a.a)(r,h.comment_img,"https://pic1.zhimg.com/v2-1b6677f81c2df41f55332474e15bc5a8.png"),Object(a.a)(r,h.dynamic_top,"https://pic1.zhimg.com/v2-e16a265a43592abd5b98fceef02a1614.png"),Object(a.a)(r,h.comment_sticker,"https://pic1.zhimg.com/v2-183a98cd480d24cd3e3246ba7a26303b.png"),Object(a.a)(r,h.block_keyword,"https://pic3.zhimg.com/v2-0ad4e8aa43c3279cc7536f2fb7ac8348.png"),r);t.b=Object(d.a)((function(e){var t=e.show,n=e.setShow,r=e.type,a=e.isLogin,d=Object(s.useState)(""),h=p(c.a,d,2),b=h[0],g=h[1],v=Object(s.useState)(!1),j=p(c.a,v,2),O=j[0],y=j[1],M=Object(f.b)(),x=Object(i.a)((function(){t&&n(!1)}));return Object(s.useEffect)((function(){!b&&a&&(y(!0),M("/api/v4/unlimited/vip_rights/popup?token="+r).then((function(e){g(e.payload.button.text)})).catch((function(){})).then((function(){y(!1)})))}),[t]),Object(o.b)(l.b,{css:{".Modal-content":{padding:0,marginTop:0}},onClose:x,children:t&&!O&&Object(o.c)(o.a,{children:[Object(o.b)("img",{alt:"",src:m[r],css:{height:"230px",width:"400px",display:"block"}}),Object(o.b)("div",{css:{padding:20},children:Object(o.b)("div",{role:"button",tabIndex:0,css:function(e){return{padding:8,background:"linear-gradient(135deg, ".concat(e.colors.GYL06A," 0.2%, ").concat(e.colors.GYL08A," 100%)"),borderRadius:3,textAlign:"center",fontsize:14,color:e.colors.GYL12A,userSelect:"none","&:hover":{cursor:"pointer"}}},onClick:u.a.show,children:b||"开通会员立即解锁"})})]})})}))},1516:function(e,t,n){"use strict";var r=n(0),c=n(2),a=n.n(c),o=n(7),i=n.n(o),s=Array.from(Array(12),(function(e,t){return Object(r.b)("span",{className:"Spinner-blade-12"},t)}));function l(e){var t=e.className,n=e.white,c=e.large;return Object(r.b)("div",{className:i()("Spinner-blade",t,{"Spinner-blade--large":c,"Spinner-blade--white":n}),children:s})}l.propTypes={className:a.a.string,large:a.a.bool,white:a.a.bool};var u=l;t.a=u},1544:function(e,t,n){"use strict";var r=n(9),c=n(0),a=n(1),o=n(75),i=n.n(o),s=n(11),l=n(511);function u(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}var d=Object(s.connect)((function(e){return{hasData:e.emoticons.emoticonGroupList.length>0}}));t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.alwaysShow,n=void 0!==t&&t;return function(e){return d(i()((function(t){var o=t.hasData,i=Object(a.useState)(!1),d=u(r.a,i,2),f=d[0],p=d[1],h=Object(s.useDispatch)();return Object(a.useEffect)((function(){o?p(!0):h(Object(l.d)()).then((function(e){var t=e.payload.data[0].id;h(Object(l.e)(t)),p(!0)})).catch((function(){p(!0)}))}),[h,o]),(!f||!n)&&Object(c.b)(e,Object.assign({},t))}),e))}}},1554:function(e,t,n){"use strict";var r=n(12),c=n(13),a=n(14),o=n(15),i=n(6),s=n(0),l=n(1),u=n(11),d=n(25),f=n(2),p=n.n(f),h=n(7),m=n.n(h),b=n(520),g=n.n(b),v=n(507),j=n(8),O=n(511),y=n(46),M=n(107),x=n(1475),E=n(9),k=n(91),w=n(354);function C(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}function S(e){var t,n,r,c,a,o,i,u,d,f=e.className,p=e.emoticonGroupList,h=e.curEmoticonGroupId,b=e.onGroupSelected,g=e.vipEnabled,v=Object(l.useRef)(),j=Object(w.a)(g,p),O=(t=v,n=Object(l.useState)({left:null,x:null}),r=C(E.a,n,2),c=r[0],a=r[1],o=Object(l.useState)(!1),i=C(E.a,o,2),u=i[0],d=i[1],{onMouseDown:Object(k.a)((function(e){var n;d(!0);var r=null===(n=t.current)||void 0===n?void 0:n.scrollLeft,c=e.clientX;a({left:r,x:c}),e.preventDefault()})),onMouseMove:Object(k.a)((function(e){if(u){var n=e.clientX-c.x;t.current&&(t.current.scrollLeft=c.left-n)}})),onMouseUp:Object(k.a)((function(){u&&d(!1)}))});return Object(s.b)("div",{className:m()("EmoticonsFooter",f),children:Object(s.b)("ul",Object.assign(Object.assign({className:"EmoticonsFooter-items",ref:v},O),{},{children:j.map((function(e){return Object(s.b)("li",{className:m()("EmoticonsFooter-item",{"EmoticonsFooter-item--selected":h===e.id}),onClick:function(){b(e.id)},children:Object(s.b)("img",{alt:"",src:e.iconUrl,className:"EmoticonsFooter-itemIcon"})},e.id)}))}))})}var I=n(1516);function R(e){var t=e.item,n=e.type,r=e.onSelectEmoticon,c=t.title,a=t.staticImageUrl,o=t.dynamicImageUrl,i=function(e){o&&(e.target.src=o)},l=function(e){o&&(e.target.src=a)},u=function(){r(t,n)};return Object(s.c)(j.a,{zaType:"Button",zaText:c,zaEventType:"Click",zaBlock:"vip"===n?"VipEmoticon":"Emoticon",as:"li",className:m()("EmoticonPanel-item",{"EmoticonPanel-item--big":"emoji"!==n}),onClick:u,onKeyPress:function(e){" "===e.key&&u()},tabIndex:0,children:[Object(s.b)("img",{src:a,title:"emoji"===n?c:"",className:m()({"EmoticonPanel-itemImg--small":"emoji"===n,"EmoticonPanel-itemImg--big":"emoji"!==n}),onMouseOver:i,onMouseOut:l,onFocus:i,onBlur:l,alt:c}),"emoji"!==n&&Object(s.b)("span",{className:"EmoticonPanel-itemTitle",children:c})]})}function T(e){var t=e.type,n=e.data,r=void 0===n?[]:n,c=e.onSelectEmoticon;return 0===r.length?Object(s.b)(I.a,{className:"EmoticonPanel-spinner"}):Object(s.b)("ul",{className:"EmoticonPanel",children:r.map((function(e){return Object(s.b)(R,{item:e,type:t,onSelectEmoticon:c},e.id)}))})}function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}T.propTypes={type:p.a.string.isRequired,data:p.a.array.isRequired,onSelectEmoticon:p.a.func.isRequired};var A=function(e){Object(a.a)(n,e);var t=N(n);function n(){var e;Object(r.a)(this,n);for(var c=arguments.length,a=new Array(c),o=0;o<c;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).getCurEmoticonGroupPanleData=function(){var t=e.props,n=t.curEmoticonGroupId;return t.emoticonPanelList.filter((function(e){return e.groupId===n}))},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props,t=e.changeSelectedEmoticonPanel,n=e.curEmoticonPanelId,r=e.className,c=this.getCurEmoticonGroupPanleData();return c.length<=1?null:Object(s.b)("ul",{className:m()("EmoticonPagination",r),children:c.map((function(e){return Object(s.b)("li",{className:m()("EmoticonPagination-bullet",{"EmoticonPagination-bullet--active":e.id===n}),onClick:function(){t(e.id)}},e.id)}))})}}]),n}(l.Component);A.propsTypes={className:p.a.string};var B=Object(u.connect)((function(e){var t=e.emoticons;return{curEmoticonGroupId:t.curEmoticonGroupId,emoticonPanelList:t.emoticonPanelList,curEmoticonPanelId:t.curEmoticonPanelId}}),{changeSelectedEmoticonPanel:O.b})(A),z=n(3),P=n(932),L=n(28);function _(e){var t=e.show,n=e.onClick,r=Object(k.a)((function(){null==n||n()}));return t&&Object(s.c)(j.a,{zaType:"Button",zaEventType:"Click",zaAction:"OpenUrl",zaBlock:"VipBrand",extra:{link:{url:L.y}},css:function(e){return Object(z.a)({backgroundColor:e.colorMod(e.colors.GYL08A).alpha(.25),color:e.colors.GYL12A,display:"flex",alignItems:"center",justifyContent:"center",height:"25px",fontSize:"12px",lineHeight:"17px",userSelect:"none"},"&:hover",{cursor:"pointer"})},onClick:r,children:["开通会员解锁全部会员表情 ",Object(s.b)(P.a,{})]})}function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var G={containerClass:"Emoticons-panelContainer",ContainerEl:"ul",threshold:10},H=function(e){Object(a.a)(n,e);var t=D(n);function n(e){var c;return Object(r.a)(this,n),(c=t.call(this,e)).state={showVipStickerModal:!1},c.setShowVipStickerModal=function(e){c.setState({showVipStickerModal:e})},c.handleGetSwiperInstance=function(e){c.mousetrap=new g.a,c.swiperInstance=e,c.mousetrap.bind("left",(function(){e.slidePrev()})),c.mousetrap.bind("right",(function(){e.slideNext()}))},c.handleEmoticonGroupSelected=function(e){var t=c.props,n=t.getEmoticonsDetail,r=t.emoticonGroupDetail,a=t.changeSelectedEmoticonGroup,o=t.changeSelectedEmoticonPanel;r[e]||n(e),a(e),o("".concat(e,"-0"))},c.handleSlideChange=function(){var e=c.props,t=e.emoticonPanelList,n=e.getEmoticonsDetail,r=e.changeSelectedEmoticonPanel,a=e.changeSelectedEmoticonGroup;if(c.swiperInstance){var o=t[c.swiperInstance.activeIndex];r(o.id),a(o.groupId),0===o.data.length&&n(o.groupId)}},c.handleRequestVip=function(){c.setShowVipStickerModal(!0)},c.handleSelectEmoticon=function(e,t){var n=c.props,r=n.onSelectEmoticon,a=n.isVip;"vip"!==t||a?r(e,t):c.handleRequestVip()},c.swiperInstance=Object(l.createRef)(),c}return Object(c.a)(n,[{key:"componentWillUnmount",value:function(){var e=this.props,t=e.changeSelectedEmoticonGroup,n=e.changeSelectedEmoticonPanel,r=e.emoticonPanelList;t(r[0].groupId),n(r[0].id),this.mousetrap.reset()}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,r=t.emoticonGroupList,c=void 0===r?[]:r,a=t.curEmoticonGroupId,o=t.emoticonPanelList,i=t.curEmoticonPanelId,l=t.isVip,u=t.vipEnabled,d=void 0!==u&&u,f=t.Swiper,p=t.noBorder,h=void 0!==p&&p,b=this.state.showVipStickerModal,g=this.setShowVipStickerModal,v=Object(w.a)(d,o);return Object(s.b)(j.b,{block:"EmoticonsCard",children:Object(s.c)("div",{className:m()("Emoticons",{"Emoticons--bordered":!h},n),children:[f?Object(s.b)(f,Object.assign(Object.assign({},G),{},{activeSlideKey:i,getSwiper:this.handleGetSwiperInstance,on:{slideChange:this.handleSlideChange},children:v.map((function(t){return Object(s.b)("li",{className:"Emoticons-panels-item",children:Object(s.b)(T,{type:t.type,data:t.data,onSelectEmoticon:e.handleSelectEmoticon})},t.id)}))})):Object(s.b)("div",{css:{height:183}}),Object(s.b)(B,{className:"Emoticons-Pagination"}),Object(s.b)(_,{show:d&&!l,onClick:this.handleRequestVip}),Object(s.b)(S,{emoticonGroupList:c,curEmoticonGroupId:a,onGroupSelected:this.handleEmoticonGroupSelected,vipEnabled:d}),Object(s.b)(x.b,{show:b,setShow:g,type:x.a.comment_sticker})]})})}}]),n}(l.Component);H.propTypes={className:p.a.string,onSelectEmoticon:p.a.func};t.a=Object(d.compose)(Object(u.connect)((function(e){var t=e.emoticons,n=t.emoticonGroupList,r=t.curEmoticonGroupId,c=t.emoticonGroupDetail,a=t.emoticonPanelList;return{emoticonGroupList:n,curEmoticonGroupId:r,emoticonGroupDetail:c,emoticonPanelList:void 0===a?[]:a,curEmoticonPanelId:t.curEmoticonPanelId,isVip:Object(y.j)(e)}}),{getEmoticonsDetail:O.e,changeSelectedEmoticonGroup:O.a,changeSelectedEmoticonPanel:O.b}),Object(M.a)(null),(function(e){return function(t){var r=Object(v.a)((function(){return Promise.all([n.e(67),n.e(77)]).then(n.t.bind(null,1855,7))}));return Object(s.b)(e,Object.assign(Object.assign({},t),{},{Swiper:r}))}}))(H)},1560:function(e,t,n){"use strict";var r=n(9),c=n(0),a=n(75),o=n.n(a),i=n(18),s=n(354),l=n(16),u=n(177);function d(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}function f(e){return e.reduce((function(e,t){var n;return[].concat(d(l.a,e),d(l.a,null!==(n=t.stickers)&&void 0!==n?n:[]))}),[])}var p=function(){return window.zh_emoticon?Promise.resolve(f(window.zh_emoticon)):Object(u.loadScript)("https://unpkg.zhimg.com/@cfe/emoticon@1.2.4/lib/emoticon.js").then((function(){return window.zh_emoticon?f(window.zh_emoticon):[]}))},h=n(1);function m(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.alwaysShow,n=void 0!==t&&t;return function(e){return o()((function(t){var a=Object(h.useState)(!1),o=m(r.a,a,2),l=o[0],u=o[1];return Object(h.useEffect)((function(){Object(s.c)()?u(!0):p().then((function(e){Object(s.e)(Object(i.camelizeKeys)(e)),u(!0)})).catch((function(){u(!0)}))}),[]),(l||n)&&Object(c.b)(e,Object.assign({},t))}),e)}}},1617:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return i}));var r=n(1),c=n.n(r),a=n(20),o=Object.assign;function i(e){return c.a.createElement(a.a,o(o({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:(t=e.className,"function"==typeof t?t():"ZDI ZDI--ImagePlus24"+(t?" "+t:""))}),c.a.createElement("path",{fillRule:"evenodd",d:"M3 5.42a2.415 2.415 0 0 1 2.415-2.416h13.17a2.415 2.415 0 0 1 2.414 2.415V11.5a.75.75 0 0 1-1.5 0V5.42a.915.915 0 0 0-.915-.916H5.415a.915.915 0 0 0-.915.915v7.42a.75.75 0 0 1-1.5 0V5.42Zm12.09 8.022a5.57 5.57 0 0 0-3.192 1.005l-2.053 1.435a8.52 8.52 0 0 1-4.882 1.538H4.5v1.16c0 .506.41.916.915.916H14a.75.75 0 0 1 0 1.5H5.415A2.415 2.415 0 0 1 3 18.58v-1.356c0-.72.585-1.305 1.305-1.305h.658a7.02 7.02 0 0 0 4.023-1.267l2.052-1.435a7.07 7.07 0 0 1 4.051-1.276h.191a.75.75 0 1 1 0 1.5h-.19ZM6.5 8.937a2.417 2.417 0 1 1 4.833 0 2.417 2.417 0 0 1-4.833 0Zm2.417-.917a.917.917 0 1 0 0 1.834.917.917 0 0 0 0-1.834ZM19.5 14a.75.75 0 0 1 .75.75v2h2a.75.75 0 0 1 0 1.5h-2v2a.75.75 0 0 1-1.5 0v-2h-2a.75.75 0 0 1 0-1.5h2v-2a.75.75 0 0 1 .75-.75Z",clipRule:"evenodd"}));var t}function s(e){return c.a.createElement(i,o(o({},e),{className:function(){return"Zi Zi--AddImage"+(e.className?" "+e.className:"")}}))}},1618:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return i}));var r=n(1),c=n.n(r),a=n(20),o=Object.assign;function i(e){return c.a.createElement(a.a,o(o({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:(t=e.className,"function"==typeof t?t():"ZDI ZDI--EmoHappy24"+(t?" "+t:""))}),c.a.createElement("path",{fillRule:"evenodd",d:"M12 20.5a8.5 8.5 0 1 0 0-17 8.5 8.5 0 0 0 0 17Zm0 1.5c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z",clipRule:"evenodd"}),c.a.createElement("path",{d:"M10 10.25a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0ZM16.5 10.25a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0Z"}),c.a.createElement("path",{fillRule:"evenodd",d:"M8.712 13.807a.75.75 0 0 1 .98.406 2.488 2.488 0 0 0 1.352 1.347 2.503 2.503 0 0 0 3.263-1.347.75.75 0 0 1 1.386.575 3.99 3.99 0 0 1-2.164 2.159 4.004 4.004 0 0 1-5.222-2.16.75.75 0 0 1 .405-.98Z",clipRule:"evenodd"}));var t}function s(e){return c.a.createElement(i,o(o({},e),{className:function(){return"Zi Zi--Emotion"+(e.className?" "+e.className:"")}}))}},1634:function(e,t,n){"use strict";n.d(t,"a",(function(){return cr}));var r=n(12),c=n(13),a=n(14),o=n(15),i=n(6),s=n(0),l=n(1),u=n.n(l),d=n(2),f=n.n(d),p=n(56),h=n(17),m=n(931),b=n(91),g=n(49),v=n(11),j=n(75),O=n.n(j),y=n(315),M=n(9),x=n(104),E=n(153),k=function(e){var t,n=e.content,r=(n=void 0===n?{}:n).text,c=void 0===r?"":r,a=e.content,o=void 0===a?{}:a,i=e.meta,s=(i=void 0===i?{}:i).content_type,l=e.extra,u=(l=void 0===l?{}:l).message_type;if(!("contentplugin"===s))return e;var d=null==o||null===(t=o.plugin)||void 0===t?void 0:t.plugin_type,f=Object.prototype.hasOwnProperty.call(E.h,d),p=f?E.a.plugin:E.a.text,h=f?u:"risk_tip",m=f?c:"Web 端暂不支持查看该消息，请在新版 App 中查看";return Object(x.produce)(e,(function(e){e.meta.content_type=p,e.extra.message_type=h,e.content.text=m}))},w=n(816),C=null,S=function(e){var t=e.id,n=e.onMessage;return C?Promise.resolve(C):Object(w.a)([{name:"zhihu/message/v1/im/user/".concat(t,"/"),onMessage:n,parser:function(e){var t=JSON.parse(e.toString());return k(t)}}]).then((function(e){return C=e}))},I=n(46);function R(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}var T=Object(l.createContext)(null),N=function(e){var t=e.children,n=Object(v.useSelector)(I.b),r=Object(l.useState)(null),c=R(M.a,r,2),a=c[0],o=c[1],i=Object(v.useDispatch)(),u=Object(b.a)((function(e){i(Object(y.l)(e,n.id))}));return Object(l.useEffect)((function(){null!=n&&n.id&&"guest"!==(null==n?void 0:n.userType)&&!a&&S({id:n.id,onMessage:u}).then((function(e){o(e)}))}),[n,u,a]),Object(l.useEffect)((function(){}),[a]),Object(s.b)(T.Provider,{value:a,children:t})},A=n(748),B=n.n(A),z=function(){return 1e3*B()(5,10)},P=z(),L=function(e){var t=e.runner,n=e.onEnd,r=Object(l.useRef)({time:P,loopCount:0,timer:null}),c=function(){r.current.loopCount=0,r.current.time=P},a=Object(b.a)((function(){if(r.current.loopCount>=10)return n&&n(),void c();r.current.timer=setTimeout((function(){r.current.loopCount+=1,t().finally((function(){r.current.time=r.current.time+z()*r.current.loopCount,a()}))}),r.current.time)})),o=Object(b.a)((function(){r.current.loopCount||a()})),i=Object(b.a)((function(){n&&n(),c(),r.current.timer&&clearTimeout(r.current.timer)}));return Object(l.useState)({startLoop:o,stopLoop:i})[0]};function _(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}var D,G,H=function(){var e=Object(l.useContext)(T),t=Object(l.useState)("connect"),n=_(M.a,t,2),r=n[0],c=n[1];return Object(l.useEffect)((function(){if(null!=e&&e.client){var t=["close","connect","end","reconnect"].map((function(e){return{ev:e,handler:function(){return c(e)}}}));return t.forEach((function(t){e.client.on(t.ev,t.handler)})),function(){try{var n="function"==typeof e.client.off?"off":"removeListener";if(!e.client[n])return;t.forEach((function(t){e.client[n](t.ev,t.handler)}))}catch(e){var r;null===(r=window.Raven)||void 0===r||r.captureException(e)}}}}),[e,c]),r},K=(D=function(e){var t=e.children,n=e.senderId,r=e.entryName,c=void 0===r?"":r,a=Object(v.useDispatch)(),o=Object(l.useRef)(0),i=Object(b.a)((function(){return a(Object(y.k)({senderId:n}))})),s=H(),u=Object(b.a)((function(){g.b.timing("ChatMQTT.".concat(c,".end.default.default.count"),Date.now()-o.current,1)})),d=L({runner:i,onEnd:u}),f=d.startLoop,p=d.stopLoop;return Object(l.useEffect)((function(){switch(s){case"end":g.b.increment("ChatMQTT.".concat(c,".end.default.default.count")),o.current=Date.now(),f();break;case"close":g.b.increment("ChatMQTT.".concat(c,".close.default.default.count"))}}),[s,f,c,p]),t},G=Object(l.forwardRef)((function(e,t){return Object(s.b)(N,{children:Object(s.b)(D,Object.assign(Object.assign({},e),{},{ref:t}))})})),O()(G,D)),U=n(16),F=n(7),V=n.n(F),Z=n(1268),q=n(63),W=n(25),Q=n(148),Y=n(1560),J=n(3),X=n(1442),$=n(1411),ee=n(4),te=n(62),ne=n(151),re=n(1516),ce=n(23),ae=n(178),oe=n(827),ie=n(118),se=n.n(ie),le=n(65),ue=["user","size","noBadge","noLink","linkProps"],de=se()(le.findImageSpec),fe=function(e,t){return Object(le.imgUrl)(e,de(t))},pe=function(e){var t=e.user,n=e.size,r=void 0===n?38:n,c=e.noBadge,a=void 0!==c&&c,o=e.noLink,i=void 0!==o&&o,l=e.linkProps,u=Object(ce.default)(e,ue),d=t.avatarUrl,f=t.isOrg,p=t.urlToken,h=!i&&p?"https://www.zhihu.com/".concat(f?"org":"people","/").concat(p):null,m=Object(s.b)(ee.Image,{loading:"lazy",src:fe(d,r),srcSet:"".concat(fe(d,2*r)," 2x"),size:r,display:"block",css:{borderRadius:"50%"}});return Object(s.c)(ee.Box,Object.assign(Object.assign({display:"inline-block",size:r,css:{position:"relative"}},u),{},{children:[h?Object(s.b)(oe.a,Object.assign(Object.assign({href:h,target:"_blank"},l),{},{children:m})):m,!a&&Object(s.b)(ae.c,{css:Object(ae.e)(r),isOrg:f,badge:t.badgeV2||t.badge,linkify:!i,enableTooltip:!0})]}))},he=n(66),me=n(185),be=n(38);function ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var ve=function(e){Object(a.a)(n,e);var t=ge(n);function n(){var e;return Object(r.a)(this,n),(e=t.call(this)).handleShieldUser=e.handleShieldUser.bind(Object(he.a)(e)),e}return Object(c.a)(n,[{key:"handleShieldUser",value:function(){var e=this.props,t=e.dispatch,n=e.user.urlToken,r=e.onClose;t(Object(me.k)(n,!0)).then((function(){return t(Object(be.g)("屏蔽成功"))})),r()}},{key:"render",value:function(){var e=this.props,t=e.onClose,n=e.shown,r=e.user;return Object(s.b)(p.b,{onClose:t,title:"确定要屏蔽".concat(r.name,"？"),children:n&&Object(s.c)("div",{children:["屏蔽后，对方将不能关注你、向你发私信、评论你的实名回答、使用「@」提及你、邀请你回答问题，但仍然可以查看你的公开信息。",Object(s.c)(p.a,{direction:"horizontal",children:[Object(s.b)(h.c,{onClick:t,color:"grey",children:"取消"}),Object(s.b)(h.c,{preset:"primary",color:"blue",onClick:this.handleShieldUser,children:"确定"})]})]})})}}]),n}(l.Component),je=Object(v.connect)()(ve),Oe=n(277),ye=n(508),Me=n(1377);function xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var Ee=function(e){Object(a.a)(n,e);var t=xe(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props,t=e.showReport,n=e.className,r=e.onReportClick,c=e.onMessageDelete,a=e.onMultiSelectClick;return Object(s.c)("ul",{className:V()("ActionMenu",n),children:[Object(s.b)("li",{className:"ActionMenu-item",onClick:c,children:"删除"}),t&&Object(s.b)("li",{className:"ActionMenu-item",onClick:r,children:"举报"}),t&&Object(s.b)("li",{className:"ActionMenu-item",onClick:a,children:"多选"})]})}}]),n}(l.Component);Ee.propsTypes={className:f.a.string,showReport:f.a.bool,onMessageDelete:f.a.func.isRequired,onReportClick:f.a.func.isRequired,onMultiSelectClick:f.a.func.isRequired};var ke=function(e,t){var n=e.isOpen,r=e.onToggleMenu,c=e.onDeleteClick,a=e.onReportClick,o=e.onMultiSelectClick,i=e.showReport;Object(l.useEffect)((function(){if(n)return window.addEventListener("wheel",r),function(){window.removeEventListener("wheel",r)}}),[n,r]);var u=Object(l.useCallback)((function(e){e.stopPropagation(),r()}),[r]);return Object(s.c)(s.a,{children:[Object(s.b)("button",{type:"button",onClick:u,"aria-label":"更多",ref:t,className:"Chat-ActionMenuPopover-Button",children:Object(s.b)(Me.a,{className:"Message-status--more"})}),Object(s.b)(ye.a,{isOpen:n,fixed:!0,arrowed:!0,target:null==t?void 0:t.current,children:Object(s.b)(Ee,{onMessageDelete:c,onReportClick:a,onMultiSelectClick:o,showReport:i})})]})},we=Object(l.forwardRef)(ke);var Ce=n(18),Se=n(19),Ie=n(476),Re=n(8),Te=n(120),Ne=function(e){var t=e.result,n=e.isInMessage,r=e.onClick,c=t.name,a=t.coverPath,o=void 0===a?"https://i1.wp.com/pic4.zhimg.com/80/v2-231f5c4e7db8b6c08493a220be85705e_hd.png?ssl=1":a,i=t.className,s=void 0===i?"":i,l=t.intro;return u.a.createElement("div",{className:V()("KfeCollection-MessageEventCard",s,{"KfeCollection-MessageEventCard--InMessage":n}),onClick:r},u.a.createElement("img",{src:o,className:"KfeCollection-MessageEventCard-cover"}),u.a.createElement("div",{className:"KfeCollection-MessageEventCard-content"},u.a.createElement("div",{className:"KfeCollection-MessageEventCard-title"},c),u.a.createElement("div",{className:"KfeCollection-MessageEventCard-text"},l)))},Ae=function(e){var t=e.result,n=e.onClick,r=e.isInMessage,c=void 0!==r&&r,a=e.hasClickZA,o=void 0===a||a,i=t.token,s=t.id;return u.a.createElement(Re.b,{block:"EcomMessageEventCard",content:{type:Te.b.event,id:s}},u.a.createElement(Re.f,{shouldTrackClick:o,zaType:"Card",zaAction:"Unknown",zaText:"留资卡片",zaEventType:"Unknown",onClick:function(e){o&&Se.a.trackEvent(e.target,{id:c?9970:10048,action:"Click",name:"留资卡片"}),n(i)}},u.a.createElement(Ie.a,{options:[{},c?{card:{content:{id:String(s)}}}:{},{id:c?9968:10046,name:"留资卡片"}]},u.a.createElement(Ne,{result:t,isInMessage:c}))))};Ae.propTypes={className:f.a.string,result:f.a.object.isRequired,extra:f.a.shape({ua:f.a.object,theme:f.a.string}).isRequired};var Be=Ae,ze=n(10),Pe=n.n(ze),Le=n(299),_e=n(941);function De(){return(De=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ge(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}var He,Ke=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(He=_e.props)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(He)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}(),["sx","variant"]),Ue=new RegExp("^(".concat(Ke.join("|"),")$")),Fe=/^m[trblxy]?$/,Ve=function(e){return function(t){var n={};for(var r in t)e(r||"")&&(n[r]=t[r]);return n}},Ze=Ve((function(e){return Ue.test(e)})),qe=Ve((function(e){return Fe.test(e)})),We=Ve((function(e){return!Fe.test(e)})),Qe=function(e){e.size;var t=Ge(e,["size"]);return u.a.createElement(Le.Box,De({as:"svg",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"currentcolor"},t))},Ye=(Object(l.forwardRef)((function(e,t){return u.a.createElement(Le.Flex,De({ref:t,as:"label",tx:"forms",variant:"label"},e,{__css:{width:"100%"}}))})),Object(l.forwardRef)((function(e,t){return u.a.createElement(Le.Box,De({ref:t,as:"input",type:"text",tx:"forms",variant:"input"},e,{__css:{display:"block",width:"100%",p:2,appearance:"none",fontSize:"inherit",lineHeight:"inherit",border:"1px solid",borderRadius:"default",color:"inherit",bg:"transparent"}}))}))),Je=function(e){return u.a.createElement(Qe,e,u.a.createElement("path",{d:"M7 10l5 5 5-5z"}))},Xe=(Object(l.forwardRef)((function(e,t){return u.a.createElement(Le.Flex,qe(e),u.a.createElement(Le.Box,De({ref:t,as:"select",tx:"forms",variant:"select"},We(e),{__css:{display:"block",width:"100%",p:2,appearance:"none",fontSize:"inherit",lineHeight:"inherit",border:"1px solid",borderRadius:"default",color:"inherit",bg:"transparent"}})),u.a.createElement(Je,{sx:{ml:-28,alignSelf:"center",pointerEvents:"none"}}))})),Object(l.forwardRef)((function(e,t){return u.a.createElement(Le.Box,De({ref:t,as:"textarea",tx:"forms",variant:"textarea"},e,{__css:{display:"block",width:"100%",p:2,appearance:"none",fontSize:"inherit",lineHeight:"inherit",border:"1px solid",borderRadius:"default",color:"inherit",bg:"transparent"}}))})),function(e){return u.a.createElement(Qe,e,u.a.createElement("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}))}),$e=function(e){return u.a.createElement(Qe,e,u.a.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}))},et=function(e){return u.a.createElement(u.a.Fragment,null,u.a.createElement(Xe,De({},e,{__css:{display:"none","input:checked ~ &":{display:"block"}}})),u.a.createElement($e,De({},e,{__css:{display:"block","input:checked ~ &":{display:"none"}}})))},tt=(Object(l.forwardRef)((function(e,t){var n=e.className,r=e.sx,c=e.variant,a=void 0===c?"radio":c,o=Ge(e,["className","sx","variant"]);return u.a.createElement(Le.Box,null,u.a.createElement(Le.Box,De({ref:t,as:"input",type:"radio"},o,{sx:{position:"absolute",opacity:0,zIndex:-1,width:1,height:1,overflow:"hidden"}})),u.a.createElement(Le.Box,De({as:et,"aria-hidden":"true",tx:"forms",variant:a,className:n,sx:r},Ze(o),{__css:{mr:2,borderRadius:9999,color:"gray","input:checked ~ &":{color:"primary"},"input:focus ~ &":{bg:"highlight"}}})))})),function(e){return u.a.createElement(Qe,e,u.a.createElement("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}))}),nt=function(e){return u.a.createElement(Qe,e,u.a.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}))},rt=function(e){return u.a.createElement(u.a.Fragment,null,u.a.createElement(tt,De({},e,{__css:{display:"none","input:checked ~ &":{display:"block"}}})),u.a.createElement(nt,De({},e,{__css:{display:"block","input:checked ~ &":{display:"none"}}})))};Object(l.forwardRef)((function(e,t){var n=e.className,r=e.sx,c=e.variant,a=void 0===c?"checkbox":c,o=Ge(e,["className","sx","variant"]);return u.a.createElement(Le.Box,null,u.a.createElement(Le.Box,De({ref:t,as:"input",type:"checkbox"},o,{sx:{position:"absolute",opacity:0,zIndex:-1,width:1,height:1,overflow:"hidden"}})),u.a.createElement(Le.Box,De({as:rt,"aria-hidden":"true",tx:"forms",variant:a,className:n,sx:r},Ze(o),{__css:{mr:2,borderRadius:4,color:"gray","input:checked ~ &":{color:"primary"},"input:focus ~ &":{color:"primary",bg:"highlight"}}})))})),Object(l.forwardRef)((function(e,t){var n=De({},e);return u.a.createElement(Le.Box,De({ref:t,as:"input",type:"range",tx:"forms",variant:"slider"},n,{__css:{display:"block",width:"100%",height:4,my:2,cursor:"pointer",appearance:"none",borderRadius:9999,color:"inherit",bg:"gray",":focus":{outline:"none",color:"primary"},"&::-webkit-slider-thumb":{appearance:"none",width:16,height:16,bg:"currentcolor",border:0,borderRadius:9999,variant:"forms.slider.thumb"}}}))})),Object(l.forwardRef)((function(e,t){var n=e.checked,r=Ge(e,["checked"]);return u.a.createElement(Le.Box,De({ref:t,as:"button",type:"button",role:"switch",tx:"forms",variant:"switch","aria-checked":n},r,{__css:{appearance:"none",m:0,p:0,width:40,height:24,color:"primary",bg:"transparent",border:"1px solid",borderColor:"primary",borderRadius:9999,"&[aria-checked=true]":{bg:"primary"},":focus":{outline:"none",boxShadow:"0 0 0 2px"}}}),u.a.createElement(Le.Box,{"aria-hidden":!0,style:{transform:n?"translateX(16px)":"translateX(0)"},sx:{mt:"-1px",ml:"-1px",width:24,height:24,borderRadius:9999,border:"1px solid",borderColor:"primary",bg:"background",transitionProperty:"transform",transitionTimingFunction:"ease-out",transitionDuration:"0.1s",variant:"forms.switch.thumb"}}))}));function ct(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}var at=function(e){var t=e.className,n=void 0===t?"":t,r=e.eventData,c=e.onClose,a=e.onSubmit,o=e.extra,i=r.token,s=r.name,d=r.intro,f=r.submitText,m=o.originPhone,b=Object(l.useState)(m),g=ct(Pe.a,b,2),v=g[0],j=g[1],O=function(e){Se.a.trackEvent(e.target,{id:9972,action:"Submit"}),a({token:i,phone:v})};return u.a.createElement(Re.b,{block:"EcomMessageEventModal",content:{type:Te.b.event}},u.a.createElement(Re.f,{zaText:"留资卡片",zaType:"Popup"},u.a.createElement(Ie.a,{options:[{},{},{id:9971,name:"留资卡片"}]},u.a.createElement(p.b,{title:s,onClose:c,className:V()("KfeCollection-MessageEventModal",n),key:i},u.a.createElement("div",{className:"KfeCollection-MessageEventModal-intro"},d),u.a.createElement(Ye,{className:"KfeCollection-MessageEventModal-phone",placeholder:"点击输入用户手机号码",value:v,onChange:function(e){j(e.target.value)},fontSize:"14px",color:"GBK02A",width:"100%"}),u.a.createElement("div",{className:"KfeCollection-MessageEventModal-buttonGroup"},u.a.createElement(Re.a,{zaType:"Button",zaAction:"Unknown",zaText:"取消",onClick:function(e){Se.a.trackEvent(e.target,{id:9972,action:"Cancel"}),c()}},u.a.createElement(h.c,{className:"KfeCollection-MessageEventModal-cancelButton"},"取消")),v?u.a.createElement(Re.a,{zaType:"Button",zaAction:"Unknown",zaText:f||"确认报名"},u.a.createElement(h.c,{onClick:O,preset:h.b.Primary,color:h.a.Blue,type:"submit"},f||"确认报名")):u.a.createElement(h.c,{onClick:O,disabled:!v,preset:h.b.Primary,color:h.a.Blue,type:"submit"},f||"确认报名"))))))};at.propTypes={className:f.a.string,eventData:f.a.object.isRequired,extra:f.a.shape({ua:f.a.object,theme:f.a.string,originPhone:f.a.any}).isRequired,onClose:f.a.func,onSubmit:f.a.func};var ot=at,it=n(1453);function st(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}var lt=function(e){var t=e.message,n=Object(l.useRef)(),r=Object(l.useState)(!1),c=st(M.a,r,2),a=c[0],o=c[1];return Object(s.b)(ee.Text,{ref:n,color:a?"inherit":"primary",css:{cursor:a?"text":"pointer"},onClick:function(){a||(o(!0),Se.a.trackEvent(n.current,{action:"Click",id:6880}))},dangerouslySetInnerHTML:{__html:a?t.richText||t.text:t.extraContent}})};var ut=function(e){var t=e.message,n=e.senderId,r=e.sendMessage,c=Object(b.a)((function(e){if("A"===e.target.tagName&&e.target.href){var t=e.target.href,c=new URLSearchParams(t.split("?")[1]).get("message"),a=t.match(/www.zhihu.com\/inbox\/([\d\w]+)/);null!=a&&a[1]&&n===a[1]&&(e.preventDefault(),r({contentType:E.a.text,receiverId:n,data:{text:c}}))}}));return Object(s.b)("div",{className:V()("TextMessage",{"TextMessage-sender":"sender"===t.userType,"TextMessage-receiver":"receiver"===t.userType}),children:t.unfriendly&&"sender"===t.userType?Object(s.b)(lt,{message:t}):Object(s.b)(ee.Text,{onClick:c,dangerouslySetInnerHTML:{__html:t.richText||t.text}})})};function dt(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}var ft=function(e){var t=e.senderId,n=e.message,r=e.isEcomMerchant,c=Object(v.useDispatch)(),a=Object(v.useSelector)((function(e){var t;return null===(t=e.account.accountInfo)||void 0===t?void 0:t.phoneNo})),o=Object(l.useState)({}),i=dt(M.a,o,2),u=i[0],d=i[1],f=Object(l.useState)(!1),p=dt(M.a,f,2),h=p[0],m=p[1],b=Object(l.useMemo)((function(){return Object(Ce.camelizeKeys)(n)}),[n]),g=b.ecomCard,j=void 0===g?{}:g,O=Object(l.useMemo)((function(){return function(e){var t,n=e.data,r=void 0===n?{}:n,c=e.title;return{cardData:Object.assign(Object.assign({},r),{},{name:r.name||c,coverPath:r.cover}),sendModalData:Object.assign(Object.assign({},r),{},{name:r.name||c,submitText:null==r||null===(t=r.formFields)||void 0===t?void 0:t.submitText})}}(j)}),[j]),x=function(){m(!1)};return Object(s.c)(s.a,{children:[1===j.cardType&&Object(s.b)(Be,{result:Object.assign(Object.assign({},O.cardData),{},{id:b.id}),extra:{},isInMessage:!0,hasClickZA:!r||r&&"sender"===n.userType,onClick:function(){return e={type:"event",info:O.sendModalData,camelMessage:b},t=e.info,void(r&&"receiver"===n.userType?c(Object(be.g)("商家不能参与自己发起的活动哦")):(d(Object.assign({},t)),m(!0)));var e,t}}),2===j.cardType&&Object(s.b)(ut,{message:Object.assign(Object.assign({},n),{},{text:"web 上暂不支持优惠券消息，请至 app 查看"})}),h&&Object(s.b)(ot,{eventData:u,extra:{originPhone:a},onSubmit:function(e){return function(e){var n=e.cardType,r=e.modalData;if(1===n){var a=r.token,o=r.phone,i={receiverId:t,phone:o};c(Object(y.o)({contentType:"ecomcard",token:a,data:i})).then((function(){x()})).catch(it.a)}}({cardType:1,modalData:e})},onClose:x})]})},pt=n(70);function ht(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}var mt=function(e){return new RegExp(/https:\/\/www.zhihu.com\/inbox\/+[\s\S]*?is_ecom=1/).test(e)};var bt=function(e){var t=e.senderId,n=e.message,r=e.isEcomMerchant,c=void 0!==r&&r,a=Object(v.useDispatch)(),o=Object(Re.l)().trackEvent,i=Object(l.useState)(""),u=ht(M.a,i,2),d=u[0],f=u[1],p=Object(b.a)((function(e){if(!e)return"";var t=(new DOMParser).parseFromString(e,"text/html"),n=t.querySelectorAll("a");if(!n.length)return"";n.forEach((function(e){mt(e.href)&&e.setAttribute("data-za-not-track-link",!0)})),f(t.querySelector("body").innerHTML)}));Object(l.useEffect)((function(){p(n.richText||n.text)}),[p,n]);var h=Object(b.a)((function(e){var r,i,s,l,u=e.target,d=u.tagName,f=u.href;if("A"===d){if(f&&!mt(f))return;if(e.stopPropagation(),e.preventDefault(),c&&"receiver"===n.userType)return void a(Object(be.g)("您不可以点击自己的卡片哦"));Se.a.trackEvent(e.target,{id:9969,action:"Click",name:"欢迎语卡片"},{module:[{card:{content:{type:"Message",id:String(n.id)}}}]}),o({block:"EcomWelcome",action:"Unknown",eventType:"Click",elementLocation:{type:"Text",content:{type:"Message",id:n.id}}}),r=e,s=n.id,l=n.contentType,a(Object(y.p)({contentType:l,receiverId:t,data:(i={},Object(J.a)(i,l,n[l]),Object(J.a)(i,"text",r.target.text||"问题等待配置"),i),tempMessageId:s}))}}));return Object(s.b)("div",{className:V()("TextMessage","EcomWelcomeTextMessage",{"TextMessage-sender":"sender"===n.userType,"TextMessage-receiver":"receiver"===n.userType}),children:Object(s.b)(Re.b,{block:"MessageEcomWelcomeCard",content:{type:"Message",id:n.id},children:Object(s.b)(Re.f,{zaType:"Card",zaAction:"Unknown",zaText:"交付欢迎语卡片",zaEventType:"Unknown",onClick:h,children:Object(s.b)(pt.a,{trackCardShow:!0,view:{id:9968,name:"欢迎语卡片"},extra:{module:[{card:{content:{id:String(n.id)}}}]},children:Object(s.b)(ee.Text,{dangerouslySetInnerHTML:{__html:d}})})})})})},gt=n(398);function vt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var jt=function(e){Object(a.a)(n,e);var t=vt(n);function n(){var e;Object(r.a)(this,n);for(var c=arguments.length,a=new Array(c),o=0;o<c;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={previewImg:null,imageUrl:e.props.image.url},e.getImageStyle=function(){var t=e.props.image,n=t.width,r=t.height,c=r/n;return r>E.d||n>E.d?c>1?{height:"".concat(E.d,"px"),minWidth:"".concat(E.g,"px")}:c<1?{width:"".concat(E.d,"px"),minHeight:"".concat(E.g,"px"),height:E.d*c}:{height:"".concat(E.d,"px"),width:"".concat(E.d,"px")}:{maxWidth:"".concat(E.d,"px"),maxHeight:"".concat(E.d,"px"),width:n,height:r}},e.isTempUrl=function(e){return e.startsWith("blob")},e.handleImageClick=function(t){var n=e.state.imageUrl;e.isTempUrl(n)||e.setState({previewImg:t.target})},e}return Object(c.a)(n,[{key:"componentDidUpdate",value:function(){var e=this,t=this.props.image.url,n=this.state.imageUrl;t!==n&&Object(le.loadImage)(t).then((function(){e.setState({imageUrl:t}),URL.revokeObjectURL(n)}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.imageUrl,r=t.previewImg;return Object(s.c)("div",{children:[Object(s.b)("img",{alt:"",className:V()("ImageMessage",{"ImageMessage--temp":this.isTempUrl(n)}),src:Object(le.imgUrl)(n,"hd"),onClick:this.handleImageClick,style:this.getImageStyle()}),r&&Object(s.b)(gt.a,{className:"ImageMessage-ImageView",img:r,onClose:function(){return e.setState({previewImg:null})}})]})}}]),n}(l.Component);jt.propTypes={image:f.a.shape({width:f.a.number,height:f.a.number,url:f.a.string})};var Ot=Object(l.memo)((function(e){var t=e.item,n=e.onListItemClick;return Object(s.c)(Re.a,{as:ee.Flex,zaType:"Text",zaBlock:"IconItem",alignItems:"center",justifyContent:"center",sx:function(e){return{width:"calc(25% - 9px)",height:"70px",backgroundColor:e.colors.GBK10A,borderRadius:"8px",flexFlow:"column wrap","&:hover":{backgroundColor:e.colors.GBK09A,cursor:"pointer"},"&:nth-child(n+5)":{marginTop:"12px"}}},onClick:function(){n(t.title)},children:[Object(s.b)(ee.Image,{src:t.icon,width:20,height:20}),Object(s.b)(ee.Text,{color:"GBK04A",fontSize:13,width:"100%",textAlign:"center",mt:"7px",children:t.title})]})})),yt=function(e){var t=e.icons,n=e.onListItemClick;return Object(s.b)(Re.b,{block:"IconListMessage",children:Object(s.b)(Re.f,{zaType:"Block",as:ee.Flex,className:"IconListMessage",sx:{maxWidth:"388px",flexFlow:"row wrap",justifyContent:"space-between",margin:"16px 8px 0 8px"},children:null==t?void 0:t.map((function(e){return Object(s.b)(Ot,{item:e,onListItemClick:n},e.title)}))})})},Mt=n(1355);function xt(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}var Et=Object(l.memo)((function(e){var t=e.item,n=e.onListItemClick;return Object(s.b)(Re.a,{as:ee.Text,zaType:"Text",zaBlock:"CardListItem",onClick:function(){n(t)},color:"GBL07A",py:"12px",pr:14,pl:12,fontSize:14,sx:function(e){return{"&:last-child":{borderRadius:" 0px 0px 8px 8px"},"&:not(:last-child)":{boxShadow:"inset 0px -0.5px 0px ".concat(e.colors.GBK09B)},"&:hover":{backgroundColor:e.colors.GBK09A,cursor:"pointer"}}},children:t})})),kt=function(e){var t=e.card,n=e.replySource,r=e.onListItemClick,c=t.title,a=t.refresh,o=t.list,i=t.pageSize,u=Object(l.useState)(0),d=xt(M.a,u,2),f=d[0],p=d[1],h=Object(l.useMemo)((function(){return o.slice(f,f+i)}),[o,f,i]),m=Object(l.useCallback)((function(){p(f+i>=o.length?0:f+i)}),[f,i,o.length]);return Object(s.b)(Re.b,{block:"CardMessage",extra:{configMap:{replySource:"".concat(n)}},children:Object(s.c)(Re.f,{zaType:"Block",as:ee.Box,className:"CardMessage",bg:"GBK10A",css:function(e){return{position:"relative",width:"388px",borderRadius:"8px",marginRight:"8px",marginLeft:"8px",fontSize:"14px",lineHeight:1,"&::before":{content:'""',position:"absolute",width:"8px",height:"8px",left:"-4px",top:"14px",background:e.colors.GBK10A,transform:"rotate(45deg)"}}},children:[c&&Object(s.c)(ee.Flex,{py:15,pr:14,pl:12,alignItems:"center",justifyContent:"space-between",sx:function(e){return{boxShadow:"inset 0px -0.5px 0px ".concat(e.colors.GBK09B)}},children:[Object(s.b)(ee.Text,{color:"GBK03A",fontSize:1,fontWeight:500,children:c}),a&&Object(s.c)(ee.Text,{onClick:m,color:"GBL05A",fontWeight:500,sx:function(e){return{"&:hover":{color:e.colors.GBL07A,cursor:"pointer"}}},children:[Object(s.b)(Mt.b,{css:{verticalAlign:"middle"},size:18}),Object(s.b)("span",{css:{verticalAlign:"middle",marginLeft:"4px"},children:"换一批"})]})]}),Object(s.b)(ee.Box,{children:h.map((function(e){return Object(s.b)(Et,{item:e,onListItemClick:r},e)}))})]})})};function wt(e){var t=e.message,n=e.senderId,r=e.sendMessage,c=t.plugin,a=c.pluginContent,o=c.pluginType,i=Object(Ce.camelizeKeys)(JSON.parse(a)),u=i.card,d=i.tabs,f=i.replySource,p=Object(l.useCallback)((function(e){r({contentType:E.a.text,receiverId:n,replySource:f,data:{text:e}})}),[n,r,f]);return o===E.h.GUESS_YOU_WANT_ASK?Object(s.b)(Re.b,{block:"PluginMessage",children:Object(s.c)(ee.Box,{className:"PluginMessage",children:[Object(s.b)(kt,{card:u,replySource:f,onListItemClick:p}),Object(s.b)(yt,{icons:d,onListItemClick:p})]})}):""}var Ct=Object(l.memo)(wt),St=n(1357),It=n(110);function Rt(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}var Tt="3d198a56310c02c4a83efb9f4a4c027e",Nt=["https://www.zhihu.com/staffService/"+Tt];var At=Object(l.createContext)({showModal:!1,setShowModal:function(){return null}});function Bt(e){var t=e.item,n=e.selected,r=e.onClick,c=Object(b.a)((function(){return r(t)}));return Object(s.b)(h.c,{label:t.name,color:n?h.a.Blue:h.a.Grey,preset:h.b.Secondary,css:{marginRight:"8px"},onClick:c},t.id)}function zt(e){var t=e.senderId,n=e.showModal,r=e.onClose,c=Object(l.useState)([]),a=Rt(M.a,c,2),o=a[0],i=a[1],u=Object(l.useState)(null),d=Rt(M.a,u,2),f=d[0],h=d[1],m=Object(v.useDispatch)(),g=Object(It.b)();Object(l.useEffect)((function(){n&&g("/api/v4/customer_service/question_tag",{ignoreCode:!0}).then((function(e){var t;i((null===(t=e.payload)||void 0===t?void 0:t.data)||[])})).catch((function(){return null}))}),[n,g]);var j=Object(b.a)(Object(St.a)((function(e){g("/api/v4/customer_service/choose_question_tag",{method:"POST",body:{adminId:Tt,tagId:e.id},ignoreCode:!0}).catch((function(){return null})),m(Object(y.p)({contentType:E.a.text,receiverId:t,data:{text:e.name}})),r(),h(null)}),300)),O=Object(b.a)((function(e){h(e.id),j(e)}));return Object(s.b)(p.b,{css:{width:"694px",".Modal-content":{padding:"0 0 55px 0",marginTop:0}},onClose:r,children:n&&Object(s.c)(s.a,{children:[Object(s.b)("div",{css:function(e){return{padding:"12px 0 10px 20px",fontSize:"20px",lineHeight:"28px",borderBottom:"1px solid "+e.colors.GBK09A,color:e.colors.GBK02A}},children:"选个问题类型，小管家为你解答"}),o.map((function(e){return Object(s.c)(l.Fragment,{children:[Object(s.b)("div",{css:function(e){return{marginTop:"20px",paddingLeft:"20px",fontSize:"15px",lineHeight:"18px",color:e.colors.GBK03A}},children:e.categoryName}),Object(s.b)("div",{css:{marginTop:"16px",paddingLeft:"20px"},children:e.items.map((function(e){return Object(s.b)(Bt,{item:e,selected:f===e.id,onClick:O},e.id)}))})]},e.categoryId)}))]})})}var Pt=function(e){var t=e.message,n=e.onRequestReport,r=e.onRequestBlock,c=Object(l.useRef)(),a=Object(l.useContext)(At),o=a.showModal,i=a.setShowModal;return Object(s.b)(ee.Text,{ref:c,m:"20px auto",p:"10px 12px",bg:"GBK10A",color:"GBK07A",maxWidth:388,minHeight:40,fontSize:12,sx:{lineHeight:"20px",borderRadius:"8px",a:{color:"primary"}},dangerouslySetInnerHTML:{__html:Object(l.useMemo)((function(){return t.text.replace("https://www.zhihu.com/report?report_location=1","#report").replace("http://www.zhihu.com/defriend","#block")}),[t.text])},onClick:function(e){var t=e.target.href;t&&(e.preventDefault(),n&&t.endsWith("#report")?(n(),Se.a.trackEvent(c.current,{action:"Click",id:6882})):r&&t.endsWith("#block")?(r(),Se.a.trackEvent(c.current,{action:"Click",id:6883})):!function(e){return Nt.includes(e)}(t)?t.includes("/consult/sendCard")||t.includes("/consult/me/settings")?te.a.alert("PC 端暂不支持该操作，请打开 App 操作"):window.open(t,"_blank"):o||i(!0))}})};function Lt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var _t=function(e){Object(a.a)(n,e);var t=Lt(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.sticker.url;return Object(s.b)("img",{className:"StickerMessage",src:Object(le.imgUrl)(e,"xl"),alt:""})}}]),n}(l.Component);_t.propTypes={sticker:f.a.shape({id:f.a.string,url:f.a.string})};var Dt=n(81),Gt=function(e){return(new Date).getTime()-Number(e)<864e5?Object(Dt.toSmartString)(e):Object(Dt.toAbsoluteDateTimeString)(e)},Ht=function(e){var t=e.time;if(!t)return null;var n=new Date(t);return Object(s.b)("time",{dateTime:n.toISOString(),children:Gt(n)})},Kt=Object(l.memo)(Ht);function Ut(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var Ft=function(e){Object(a.a)(n,e);var t=Ut(n);function n(){var e;Object(r.a)(this,n);for(var c=arguments.length,a=new Array(c),o=0;o<c;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).ref=Object(l.createRef)(),e.state={isMoreActionMenuShow:!1,isShieldUserModalShown:!1},e.handleDocClick=function(t){e.state.isMoreActionMenuShow&&e.ref.current&&!e.ref.current.contains(t.target)&&(t.stopPropagation(),t.preventDefault(),e.setState({isMoreActionMenuShow:!1}))},e.toggleMoreActionMenu=function(){e.setState({isMoreActionMenuShow:!e.state.isMoreActionMenuShow})},e.handleMessageDelete=function(){var t=e.props,n=t.deleteMessage,r=t.message.id,c=t.sender.id;te.a.confirm(Object(s.b)("div",{style:{textAlign:"center"},children:"是否删除该条消息"}),{title:"删除消息"}).then((function(){return n(r,c)}),(function(){}))},e.handleReSendMessage=function(){var t=e.props,n=t.deleteLocalMessage,r=t.sender.id,c=t.sendMessage,a=t.message,o=a.id,i=a.contentType;if(i!==E.a.ecomcard)if(i!==E.a.image)n(o,r),c({contentType:i,receiverId:r,data:Object(J.a)({},i,a[i]),tempMessageId:o});else{var s=a.image.url;if(s.startsWith("blob")){var l=a.file,u=e.props,d=u.uploadImage,f=u.setImageSendFailure,p=o;d(l).then((function(e){return c({contentType:E.a.image,receiverId:r,data:{image:{height:e.payload.dataRawheight,width:e.payload.dataRawwidth,url:e.payload.src}},tempMessageId:p})})).then((function(){URL.revokeObjectURL(s)})).catch((function(){f({tempMessageId:p,receiverId:r,file:l})}))}else c({contentType:i,receiverId:r,data:Object(J.a)({},i,a[i]),tempMessageId:o})}},e.handleReSendIconClick=function(){te.a.confirm(null,{title:"是否重新发送消息"}).then((function(){e.handleReSendMessage()}),(function(){}))},e.renderMessage=function(t){var n=e.props,r=n.sender.id,c=n.isEcomMerchant,a=n.sendMessage,o=t.isEcomWelcomeCard;return t.contentType===E.a.text?o?Object(s.b)(bt,{senderId:r,message:t,isEcomMerchant:c}):Object(s.b)(ut,{message:t,senderId:r,sendMessage:a}):t.contentType===E.a.image?Object(s.b)(jt,{image:t.image}):t.contentType===E.a.sticker?Object(s.b)(_t,{sticker:t.sticker}):t.contentType===E.a.ecomcard?Object(s.b)(ft,{senderId:r,message:t,isEcomMerchant:c}):t.contentType===E.a.plugin?Object(s.b)(ne.a,{replacement:Object(s.b)(ee.Box,{children:"无法识别的消息"}),children:Object(s.b)(Ct,{senderId:r,message:t,sendMessage:a})}):"web 上暂不支持此类消息，请至 app 查看"},e.handleReportClick=function(){var t=e.props,n=t.toggleSelectMessage,r=t.toggleReportModal;n(!0,t.message),r()},e.renderMessageStatus=function(t){var n=e.props.onMultiSelectClick;if(t===E.e.success){var r=e.state.isMoreActionMenuShow,c="receiver"===e.props.message.userType;return Object(s.b)("div",{className:"Message-status--wrapper",children:Object(s.b)(we,{ref:e.ref,isOpen:r,onToggleMenu:e.toggleMoreActionMenu,onDeleteClick:e.handleMessageDelete,onReportClick:e.handleReportClick,onMultiSelectClick:n,showReport:!c})})}return t===E.e.loading?Object(s.b)(re.a,{className:"Message-status--loading"}):t===E.e.failure?Object(s.b)($.a,{className:"Message-status--failure",onClick:e.handleReSendIconClick}):null},e.selectStateChange=function(t){var n=e.props,r=n.toggleSelectMessage,c=n.message;r(t.currentTarget.checked,c)},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleDocClick)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleDocClick)}},{key:"render",value:function(){var e=this,t=this.props,n=t.message,r=t.sender,c=t.receiver,a=t.multiSelectMode,o=t.isMessageSelected,i=n.type,l=n.userType,u=n.status,d=n.showTime,f=n.createdTime,p=this.state.isShieldUserModalShown,h=Object(s.b)(s.a,{children:d&&Object(s.b)("p",{className:"Message-time",children:Object(s.b)(Kt,{time:f})})});if("risk_tip"===i||"tip"===i)return Object(s.c)(s.a,{children:[h,p&&Object(s.b)(je,{shown:p,onClose:function(){return e.setState({isShieldUserModalShown:!1})},user:r}),Object(s.b)(Pt,{message:n,onRequestReport:this.handleReportClick,onRequestBlock:function(){e.setState({isShieldUserModalShown:!0})}})]});var m="receiver"===l?c:r,b="receiver"!==l&&a;return Object(s.c)("div",{className:"Message-wrapper",children:[h,Object(s.c)("div",{className:V()("Message",{"Message--reverse":"receiver"===l}),children:[Object(s.c)(ee.Flex,{alignItems:"center",children:[b&&Object(s.b)(X.a,{css:{borderRadius:"50%",marginRight:22},checked:o,onChange:this.selectStateChange}),Object(s.b)(pe,{user:m,size:40})]}),Object(s.c)("div",{className:V()("Message-content",{"Message-content--reverse":"receiver"===l}),children:[this.renderMessage(n),Object(s.b)("div",{className:"Message-status",children:this.renderMessageStatus(u)})]})]})]})}}]),n}(l.Component);Ft.propsTypes={message:f.a.object,sender:f.a.object,receiver:f.a.object};var Vt=Object(v.connect)(null,{deleteMessage:y.f,deleteLocalMessage:y.e,sendMessage:y.p,setImageSendFailure:y.q,uploadImage:Oe.b})(Ft);function Zt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var qt=function(e){Object(a.a)(n,e);var t=Zt(n);function n(){var e;Object(r.a)(this,n);for(var c=arguments.length,a=new Array(c),o=0;o<c;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={showQuestionTagModal:!1},e.scrollToBottom=function(){e.messageBoxEle.scrollTop=e.messageBoxEle.scrollHeight},e.handleGetHistoryMessage=function(t){var n=e.props,r=n.isLoading,c=n.getHistoryMessages,a=n.senderId,o=n.isEnd;!t||r||o||c({senderId:a})},e.setShowQuestionTagModal=function(t){return e.setState({showQuestionTagModal:t})},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.getHistoryMessages,n=e.senderId,r=e.messages,c=e.setMessageRead,a=e.sender,o=void 0===a?{}:a,i=e.location.query;0!==r.length&&o.id?this.scrollToBottom():t({senderId:n,clientScene:i.client_scene}).catch((function(){location.href="//www.zhihu.com/messages"}));c(n)}},{key:"componentDidUpdate",value:function(e){var t=e.messages,n=void 0===t?[]:t,r=this.props,c=r.messages,a=r.setMessageRead,o=r.senderId,i=n[n.length-1]||{},s=c[c.length-1]||{};i.id!==s.id&&(this.scrollToBottom(),"sender"===s.userType&&a(o));var l=e.sender,u=(l=void 0===l?{}:l).id,d=this.props.sender;(d=void 0===d?{}:d).id!==u&&this.scrollToBottom()}},{key:"render",value:function(){var e=this,t=this.props,n=t.messages,r=t.receiver,c=t.sender,a=void 0===c?{}:c,o=t.senderId,i=t.isLoading,l=t.isEcomMerchant,u=t.multiSelectMode,d=t.selectedMessages,f=t.onMultiSelectClick,p=t.toggleSelectMessage,h=t.toggleReportModal,m=this.state.showQuestionTagModal;return a.id?Object(s.c)(At.Provider,{value:{showModal:m,setShowModal:this.setShowQuestionTagModal},children:[Object(s.b)(Q.b,{isLoading:i,onLoad:this.handleGetHistoryMessage,placeholder:Object(s.b)(Z.a,{className:"MessagesBox-loading"}),isPrevDrained:!1,isDrained:!0,getContainer:function(e){return e},className:"MessagesBox",onRef:function(t){e.messageBoxEle=t},children:n.map((function(e){return Object(s.b)("div",{children:Object(s.b)(Vt,{message:e,receiver:r,sender:a,isEcomMerchant:l,multiSelectMode:u,isMessageSelected:d.find((function(t){return t.id===e.id})),toggleSelectMessage:p,onMultiSelectClick:f,toggleReportModal:h})},e.tempMessageId||e.id)}))}),Object(s.b)(zt,{showModal:m,onClose:function(){return e.setShowQuestionTagModal(!1)},senderId:o})]}):Object(s.b)(Z.a,{className:"MessagesBox-loading"})}}]),n}(l.Component);qt.PropsTypes={senderId:f.a.string};var Wt=Object(W.compose)(q.withRouter,Object(v.connect)((function(e,t){var n=t.senderId,r=e.chat.chats[n]||{},c=r.receiver,a=void 0===c?{}:c,o=r.sender,i=void 0===o?{}:o,s=r.messages,l=void 0===s?[]:s,u=r.isLoading,d=void 0!==u&&u,f=r.isEnd;return{receiver:a,sender:i,messages:l,isLoading:d,isEnd:void 0===f||f,isEcomMerchant:(e.chat.chats||{}).isEcomMerchant}}),{getHistoryMessages:y.j,setMessageRead:y.r}),Object(Y.a)())(qt),Qt=n(125),Yt=n.n(Qt),Jt=n(109),Xt=n(386),$t=n(28),en=n(753),tn=n(1617);function nn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var rn=function(e){Object(a.a)(n,e);var t=nn(n);function n(){var e;Object(r.a)(this,n);for(var c=arguments.length,a=new Array(c),o=0;o<c;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).checkSize=function(t){var n=e.props.showNotification;if(t.size>1024*$t.L*1024)return n("请上传小于 ".concat($t.L,"M 的图片。"),"red"),!1},e.sendImage=function(t){var n=t.file;(0,e.props.handleSendImage)(n),e.uploadInput.value=""},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this,t=this.props.className;return Object(s.b)(en.a,{accept:"image/png,image/jpeg",onRef:function(t){e.uploadInput=t},customUpload:this.sendImage,beforeUpload:this.checkSize,multiple:!0,children:Object(s.b)(tn.a,{className:t})})}}]),n}(l.Component);rn.propTypes={senderId:f.a.string,className:f.a.string,handleSendImage:f.a.func};var cn=Object(v.connect)(null,{showNotification:be.g})(rn),an=n(1618),on=n(1544),sn=n(1554);function ln(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var un=function(e){Object(a.a)(n,e);var t=ln(n);function n(){var e;Object(r.a)(this,n);for(var c=arguments.length,a=new Array(c),o=0;o<c;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={isEmoticonsHidden:!0},e.toggleEmoticonPanel=function(){e.setState({isEmoticonsHidden:!e.state.isEmoticonsHidden})},e.handleSelectEmoticon=function(t,n){var r=e.props,c=r.insertEmoji,a=r.handleSendEmoticon;"emoji"===n?c(t.placeholder):a(t),e.toggleEmoticonPanel()},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.className,t=this.state.isEmoticonsHidden;return Object(s.c)("div",{className:"EmoticonTool",children:[!t&&Object(s.b)("div",{className:"EmoticonTool--mask",onClick:this.toggleEmoticonPanel}),!t&&Object(s.b)(sn.a,{className:"EmoticonTool-panel",onSelectEmoticon:this.handleSelectEmoticon}),Object(s.b)(an.a,{className:V()("EmoticonTool-icon",e),onClick:this.toggleEmoticonPanel})]})}}]),n}(l.Component);un.propTypes={senderId:f.a.string,className:f.a.string};var dn=Object(on.a)()(un),fn={0:{prefix:null,text:"免费",key:""},1:{prefix:"¥",key:"discountPrice"},2:{prefix:"¥",key:"discountPrice"},3:{suffix:"折",key:"discountRate"}},pn=function(e){var t=e.couponInfo,n=void 0===t?{}:t,r=n.couponType,c=fn[void 0===r?1:r],a=c.text||"discountPrice"===c.key?n[c.key]/100:n[c.key];return u.a.createElement("div",{className:V()("KfeCollection-MessageCouponCard-coupon")},c.prefix&&u.a.createElement("span",{className:V()("KfeCollection-MessageCouponCard-tag","tag-prefix")},c.prefix),a,c.suffix&&u.a.createElement("span",{className:V()("KfeCollection-MessageCouponCard-tag","tag-suffix")},c.suffix))},hn=function(e){var t=e.result,n=e.isInMessage,r=t.title,c=t.description,a=t.className,o=void 0===a?"KfeCollection-MessageCouponCard-orangeCoupon--light":a;return u.a.createElement("div",{className:V()("KfeCollection-MessageCouponCard",o,{"KfeCollection-MessageCouponCard--InMessage":n})},u.a.createElement("div",{className:"KfeCollection-MessageCouponCard-content"},u.a.createElement("div",{className:"KfeCollection-MessageCouponCard-title"},r),u.a.createElement("div",{className:"KfeCollection-MessageCouponCard-text"},c)),u.a.createElement(pn,{couponInfo:t}))},mn=function(e){var t=e.result,n=e.onClick,r=e.isInMessage,c=void 0!==r&&r,a=e.extra.theme,o=void 0===a?"light":a,i=t.id;return u.a.createElement(Re.b,{block:"EcomMessageCouponCard",content:{type:Te.a.coupon,id:i}},u.a.createElement(Re.a,{shouldTrackShow:!0,zaType:"Card",zaAction:"Unknown",zaText:"留资卡片",zaEventType:"Unknown",onClick:function(e){Se.a.trackEvent(e.target,{id:10049,action:"Click",name:String(i)}),n()}},u.a.createElement(Ie.a,{options:[{},{},{id:10047,name:String(i)}]},u.a.createElement(hn,{result:t,isInMessage:c,theme:o}))))};mn.propTypes={className:f.a.string,result:f.a.object.isRequired,extra:f.a.shape({ua:f.a.object,theme:f.a.string,styles:f.a.object}).isRequired};var bn=mn,gn=n(556),vn=n(58),jn=Object.assign;var On=function(e){return u.a.createElement(vn.a,jn({width:"24",height:"24",fill:"none",viewBox:"0 0 26 26"},e),u.a.createElement("path",{fill:"#fff",d:"M0 0h24v24H0z",opacity:".01"}),u.a.createElement("path",{fill:"#646464",fillRule:"evenodd",d:"M16.875 7.149c.182 1.255-.302 3.01-1.436 5.369-.328.6-.62 1.479-.597 1.768.013.169.08.316.215.448l3.042-3.042a1.626 1.626 0 0 1 2.228-.068l.747.742c.611.612.634 1.59.068 2.228l-1.483 1.487c.455.17 1 .51 1.314.982.315.471.532 1.493.532 3.177 0 .663-.532 1.273-1.236 1.273l-6.062-.015c-.25.193-.528.346-.826.453l-2.161.652a.85.85 0 0 1-.844-.212c-.203-.203-.318-.5-.2-.896-.003.003-6.924.018-6.924.018A1.247 1.247 0 0 1 2 20.259l.013-1.49c-.013-.77.13-1.155.314-1.435.181-.274.443-.54.63-.73l.014-.013c.445-.452 1.444-.737 2.777-.98 2.487-.454 2.875-.819 2.915-1.325.01-.131-.162-.851-.548-1.606-1.255-2.444-1.705-3.934-1.49-5.502C6.944 4.827 8.662 3 11.752 3c3.09 0 4.776 1.77 5.122 4.149Zm.65 6.886-5.272 5.282c-.271.332-.678 1.873-.678 1.873s1.582-.41 1.92-.721l5.235-5.229-1.205-1.205ZM8.11 7.382C8.391 5.7 9.513 4.506 11.754 4.5c2.241-.005 3.397 1.221 3.635 2.863.129.883-.288 2.394-1.285 4.469-.439.8-.81 1.918-.758 2.57a2.12 2.12 0 0 0 .649 1.393l-2.577 2.582c-.557.62-.79 1.614-.79 1.614l-7.125.02.012-1.334c0-.408.08-.634.36-.873.233-.2.552-.34.877-.439.451-.11.918-.208 1.372-.303 1.016-.214 1.972-.415 2.563-.706.866-.426 1.378-1.061 1.472-1.954.075-.707-.72-2.44-.72-2.44S7.85 8.956 8.111 7.382Zm10.34 9.91-2.713 2.71 4.26.008s-.056-1.624-.213-2.012c-.082-.155-.275-.458-1.335-.707Zm.575-4.752a.375.375 0 0 1 .489.036l.71.717a.376.376 0 0 1-.036.489l-.574.574-1.206-1.206.617-.61Z",clipRule:"evenodd"}))},yn=Object.assign;var Mn=function(e){return u.a.createElement(vn.a,yn({width:"24",height:"24",fill:"none",viewBox:"0 0 24 24"},e),u.a.createElement("path",{fill:"#fff",d:"M0 0h24v24H0z",opacity:".01"}),u.a.createElement("path",{fill:"#646464",fillRule:"evenodd",d:"M3.004 18.5a2.285 2.285 0 0 0 2.285 2.284h13.736a2.285 2.285 0 0 0 2.285-2.285v-3.732a.763.763 0 0 0-.759-.846h-.01a1.526 1.526 0 0 1 .01-3.053.763.763 0 0 0 .759-.847V6.29a2.285 2.285 0 0 0-2.285-2.285H5.289A2.285 2.285 0 0 0 3.004 6.29v3.732a.763.763 0 0 0 .759.846h.015a1.526 1.526 0 0 1-.015 3.053.763.763 0 0 0-.759.846v3.732ZM17.5 12.394c0 1.423.975 2.62 2.293 2.957v3.147a.768.768 0 0 1-.767.768H5.289a.768.768 0 0 1-.767-.768v-3.147a3.054 3.054 0 0 0 0-5.915V6.29c0-.424.343-.768.767-.768h13.736c.424 0 .767.344.767.768v3.147a3.054 3.054 0 0 0-2.293 2.958Zm-3.807 0a1.535 1.535 0 1 1-3.07 0 1.535 1.535 0 0 1 3.07 0Zm1.517 0a3.052 3.052 0 1 1-6.104 0 3.052 3.052 0 0 1 6.104 0Z",clipRule:"evenodd"}))},xn=n(57),En=n.n(xn),kn=n(124),wn=n.n(kn);function Cn(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}var Sn=function(e){var t=e.cardList,n=e.onSend,r=e.onClose,c=e.isEvent,a=c?Be:bn;return Object(s.b)(p.b,{title:c?"活动":"优惠券",onClose:r,className:"EcomCardTool-Modal",children:Object(s.b)("ul",{className:"EcomCardTool-Modal--list",children:t.map((function(e,t){return Object(s.b)("li",{className:"EcomCardTool-Modal--cardItem",children:Object(s.b)(a,{result:e,extra:{},onClick:function(){return n(Object.assign(Object.assign({},e),{},{cardType:c?1:2}))}})},e.token||t)}))})})};Sn.propTypes={onClose:f.a.func.isRequired,cardList:f.a.array,onSend:f.a.func};var In=function(e){var t=e.senderId,n=e.className,r=e.isEvent,c=e.onHandleFirstInterActive,a=Object(v.useSelector)((function(e){return e.env.theme})),o=Object(v.useDispatch)(),i=Object(l.useState)(!1),u=Cn(M.a,i,2),d=u[0],f=u[1],p=Object(l.useState)([]),h=Cn(M.a,p,2),m=h[0],g=h[1],j=Object(b.a)((function(){o(Object(y.h)({senderId:t})).then((function(e){var t;return g(null===(t=e.payload)||void 0===t?void 0:t.data)}))})),O=Object(b.a)((function(){o(Object(y.g)()).then((function(e){var t,n,r;return n=null===(t=e.payload)||void 0===t?void 0:t.data,r=!wn()(n)&&n.map((function(e){return Object.assign(Object.assign({},e),{},{className:1===(null==e?void 0:e.template.id)?"KfeCollection-MessageCouponCard-orangeCoupon--".concat(a):"KfeCollection-MessageCouponCard-blueCoupon--".concat(a),description:e.intro})}))||[],void g(Cn(U.a,r))}))}));Object(l.useEffect)((function(){r&&j()}),[r,j]),Object(l.useEffect)((function(){r||O()}),[r,O]);var x=r?On:Mn,k=function(e){var n=e.token,r=e.cardType,a=e.id;(function(e){var n=e.token,r=e.cardType;if(c(),1===r){var a=Yt()("TempEventCard_");return o(Object(y.a)(t,a,r)),o(Object(y.n)({contentType:E.a.ecomcard,token:n,data:{receiverId:t,cardType:r},tempMessageId:a}))}return o(Object(y.n)({contentType:E.a.ecomcard,id:n,data:{receiverId:t,cardType:r}}))})({token:n||a,cardType:r}).then((function(){f(!1)})).catch(En.a)};return Object(s.b)(Re.b,{block:"EcomMessageEcomCardTool",content:{type:"Message"},children:Object(s.b)(pt.a,{trackCardShow:!0,view:{id:r?9975:9976,url:"fakeurl://dialogue/user.*"},children:Object(s.c)("div",{className:"EcomCardTool",children:[Object(s.b)(Re.f,{shouldTrackClick:!0,zaText:r?"留资卡片":"优惠券卡片",zaType:"Button",zaEventType:"Click",children:Object(s.b)(x,{className:V()("EcomCardTool-icon",n),width:22,height:22,onClick:function(e){d||!wn()(m)?(f(!d),Object(gn.a)(e,{id:r?9978:9979,action:"Click"})):o(Object(be.g)("请先去 ecom.zhihu.com 配置","red"))}})}),d&&Object(s.b)(Sn,{isEvent:r,cardList:m,onSend:function(e){return k(e)},onClose:function(){return f(!1)}})]})})})};In.propTypes={senderId:f.a.string,className:f.a.string,isEvent:f.a.bool,onHandleFirstInterActive:f.a.func};var Rn=In;function Tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var Nn=function(e){Object(a.a)(n,e);var t=Tn(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props,t=e.senderId,n=e.insertEmoji,r=e.handleSendImage,c=e.handleSendEmoticon,a=e.onHandleFirstInterActive,o=e.isEcomMerchant;return Object(s.c)("ul",{className:"ToolBar",children:[Object(s.b)("li",{className:"ToolBar-item",children:Object(s.b)(dn,{className:"ToolBar-Icon",senderId:t,insertEmoji:n,handleSendEmoticon:c})}),Object(s.b)("li",{className:"ToolBar-item",children:Object(s.b)(cn,{className:"ToolBar-Icon",senderId:t,handleSendImage:r})}),o&&Object(s.c)(s.a,{children:[Object(s.b)("li",{className:"ToolBar-item",children:Object(s.b)(Rn,{isEvent:!0,className:"ToolBar-Icon",senderId:t,onHandleFirstInterActive:a},"event")},"event"),Object(s.b)("li",{className:"ToolBar-item",children:Object(s.b)(Rn,{isEvent:!1,className:"ToolBar-Icon",senderId:t,onHandleFirstInterActive:a},"coupon")},"coupon")]})]})}}]),n}(l.Component);Nn.propTypes={senderId:f.a.string,insertEmoji:f.a.func,handleSendImage:f.a.func,handleSendEmoticon:f.a.func,onHandleFirstInterActive:f.a.func};var An=Object(v.connect)((function(e){return{isEcomMerchant:(e.chat.chats||{}).isEcomMerchant}}))(Nn),Bn=n(732);function zn(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}var Pn=function(e){var t=Object(l.useState)(!1),n=zn(M.a,t,2),r=n[0],c=n[1];return r?null:Object(s.b)(Ln,Object.assign(Object.assign({},e),{},{dispose:function(){return c(!0)}}))},Ln=function(e){var t=e.endSignal,n=void 0!==t&&t,r=e.dispose,c=Object(l.useState)(0),a=zn(M.a,c,2),o=a[0],i=a[1];Object(l.useEffect)((function(){i(Date.now())}),[]);var s=Object(b.a)((function(e){var t=e-o;t>0&&t<=6e4&&(Object(gn.a)(null,{id:9980,action:"StatusReport"}),null==r||r())}));return Object(l.useEffect)((function(){if(n){var e=Date.now();s(e)}}),[s,n]),Object(Bn.a)(r,6e4),null};Pn.propTypes={endSignal:f.a.bool};var _n=Pn,Dn=function(e){var t=e.handleSendTextMessage,n=e.inputValue,r=H();return Object(s.c)("div",{className:"InputBox-footer",children:[Object(s.b)("div",{className:"InputBox-footerDesc",css:function(e){return{color:"connect"===r?e.colors.GBK07A:e.colors.GBL07A}},children:"按 Enter 键发送"}),Object(s.b)(h.c,{preset:"primary",color:"blue",className:"InputBox-sendBtn",onClick:t,disabled:!n.trim(),children:"发送"})]})};function Gn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var Hn=function(e){Object(a.a)(n,e);var t=Gn(n);function n(){var e;Object(r.a)(this,n);for(var c=arguments.length,a=new Array(c),o=0;o<c;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={cursorPosition:0,firstInteractive:!1},e.inputRef=Object(l.createRef)(),e.countDownTimer=null,e.handleSetFirsetInteractive=function(){e.setState({firstInteractive:!0})},e.checkSize=function(t){var n=e.props.showNotification;return!(t.size>1024*$t.L*1024)||(n("请上传小于 ".concat($t.L,"M 的图片。"),"red"),!1)},e.handleKeyDown=function(t){var n=e.props,r=n.inputMessage,c=n.senderId,a=n.inputValue;13===t.keyCode&&(t.ctrlKey||t.metaKey)?r({senderId:c,inputValue:"".concat(a,"\n")}):13!==t.keyCode||t.shiftKey||e.handleSendTextMessage(t)},e.handleSendImage=function(t){var n;if(t&&e.checkSize(t)){var r=e.props,c=r.uploadImage,a=r.sendMessage,o=r.senderId,i=r.addTempImageMessage,s=r.setImageSendFailure,l=Yt()("TempImage_");e.handleSetFirsetInteractive(),Object(Xt.a)(t).then((function(e){var n=URL.createObjectURL(e);Object(le.loadImage)(n).then((function(r){var u=r.height,d=r.width;i(o,n,l,u,d),c(e).then((function(e){return a({contentType:E.a.image,receiverId:o,data:{image:{height:e.payload.dataRawheight,width:e.payload.dataRawwidth,url:e.payload.src}},tempMessageId:l})})).catch((function(){s({tempMessageId:l,receiverId:o,file:t})}))}))})),null===(n=e.inputRef.current)||void 0===n||n.focus()}},e.handleSendEmoticon=function(t){var n,r=t.id,c=t.dynamicImageUrl,a=t.staticImageUrl,o=t.title,i=e.props,s=i.senderId,l=i.sendMessage;e.handleSetFirsetInteractive(),l({contentType:"sticker",receiverId:s,data:{sticker:{sticker_id:r,url:c||a,title:o}}}),Se.a.trackEvent(null,{id:3640,action:"Click",name:o}),null===(n=e.inputRef.current)||void 0===n||n.focus()},e.handleSendTextMessage=function(t){var n=e.props,r=n.senderId,c=n.sendMessage,a=n.inputValue,o=n.location.query,i=o.source_type,s=o.source_id;a.length>1e4?te.a.alert("发送文字不得超过 1 万字，请重新编辑后再次发送",{title:"发送失败"}):a.trim()&&(e.handleSetFirsetInteractive(),t.preventDefault(),c({contentType:E.a.text,receiverId:r,data:{text:a},sourceType:i,sourceId:s}),Se.a.trackEvent(null,{id:5309,action:"Click"}))},e.insertEmoji=function(t){var n,r=e.props,c=r.inputMessage,a=r.senderId,o=r.inputValue,i=e.state.cursorPosition,s=[o.slice(0,i),t,o.slice(i)].join("");e.setState({cursorPosition:i+t.length}),c({senderId:a,inputValue:s}),Se.a.trackEvent(null,{id:3641,action:"Click",name:t.slice(1,t.length-1)}),null===(n=e.inputRef.current)||void 0===n||n.focus()},e.handleBlur=function(t){e.setState({cursorPosition:t.target.selectionStart})},e.handleInputMessage=function(t){var n=e.props;(0,n.inputMessage)({senderId:n.senderId,inputValue:t.target.value})},e.handleInputRef=function(t){e.inputRef.current=t},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.inputRef.current&&(this.inputRef.current.focus(),this.inputRef.current.addEventListener("keydown",this.handleKeyDown))}},{key:"componentWillUnmount",value:function(){this.inputRef.current&&this.inputRef.current.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this.props,t=e.inputValue,n=e.senderId,r=e.sender;if(null!=r&&r.isForbidden){var c=r.feedbacker;return Object(s.b)("div",{className:"InputBox",css:{justifyContent:"flex-end"},children:Object(s.b)("div",{className:"InputBox-footer",children:Object(s.c)("div",{className:"InputBox-footerDesc",css:{textAlign:"center",paddingRight:0},children:["要反馈",Object(s.b)(q.Link,{to:"/messages/".concat(c.token),css:function(e){return{color:e.colors.GBK06A,fontWeight:"bold",paddingLeft:"4px"}},children:"@".concat(c.name)})]})})})}return Object(s.c)("div",{className:"InputBox",children:[Object(s.b)(_n,{endSignal:this.state.firstInteractive}),Object(s.b)(An,{senderId:n,insertEmoji:this.insertEmoji,handleSendImage:this.handleSendImage,handleSendEmoticon:this.handleSendEmoticon,onHandleFirstInterActive:this.handleSetFirsetInteractive}),Object(s.b)(Jt.a,{multiline:!0,spread:!0,value:t,className:"InputBox-input",onRef:this.handleInputRef,onChange:this.handleInputMessage,onBlur:this.handleBlur}),Object(s.b)(Dn,{handleSendTextMessage:this.handleSendTextMessage,inputValue:t})]})}}]),n}(l.Component);var Kn=Object(W.compose)(q.withRouter,Object(v.connect)((function(e,t){var n=t.senderId,r=(e.chat.chats[n]||{}).inputValue;return{inputValue:void 0===r?"":r}}),{sendMessage:y.p,inputMessage:y.m,uploadImage:Oe.b,addTempImageMessage:y.b,setImageSendFailure:y.q,showNotification:be.g}))(Hn);function Un(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var Fn=function(e){Object(a.a)(n,e);var t=Un(n);function n(){var e;Object(r.a)(this,n);for(var c=arguments.length,a=new Array(c),o=0;o<c;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={isAlertShow:!0},e.handleCloseAlert=function(){e.setState({isAlertShow:!1})},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props,t=e.message,n=e.className;return this.state.isAlertShow?Object(s.c)("div",{className:V()("AbnormalAlert",n),children:[Object(s.b)("span",{className:"AbnormalAlert-message",dangerouslySetInnerHTML:{__html:t}}),Object(s.b)(m.a,{className:"AbnormalAlert-icon",onClick:this.handleCloseAlert})]}):null}}]),n}(l.Component);Fn.propsTypes={message:f.a.object,className:f.a.string};var Vn=n(20),Zn=Object.assign;function qn(e){return u.a.createElement(Vn.a,Zn(Zn({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:(t=e.className,"function"==typeof t?t():"ZDI ZDI--ExclamationTriangle24"+(t?" "+t:""))}),u.a.createElement("path",{fillRule:"evenodd",d:"M10.389 3.43c.716-1.24 2.506-1.24 3.222 0l8.135 14.092c.716 1.24-.179 2.79-1.61 2.79H3.864c-1.432 0-2.327-1.55-1.61-2.79L10.388 3.43Zm1.923.75a.36.36 0 0 0-.624 0L3.552 18.272a.36.36 0 0 0 .312.54h16.272c.277 0 .45-.3.311-.54L12.312 4.18Z",clipRule:"evenodd"}),u.a.createElement("path",{d:"M11.25 12.846a.75.75 0 1 0 1.5 0V9.347a.75.75 0 1 0-1.5 0v3.499ZM11 15.87a1 1 0 1 0 2 0 1 1 0 0 0-2 0Z"}));var t}function Wn(e){var t=e.onClose,n=e.onReport;return Object(s.c)(ee.Flex,{css:{position:"relative"},justifyContent:"center",p:10,height:169,children:[Object(s.b)(ee.Box,{css:function(e){return{position:"absolute",top:0,margin:"0 20px",borderTop:"1px solid ".concat(e.colors.GBK09A)}}}),Object(s.b)(h.c,{preset:"plain",css:{position:"absolute",right:"20px",top:"20px"},onClick:t,children:Object(s.b)(m.c,{})}),Object(s.c)(h.c,{preset:"plain",flexDirection:"column",onClick:n,css:function(e){return{color:e.colors.GBK03A}},children:[Object(s.b)(ee.Flex,{justifyContent:"center",alignItems:"center",width:50,height:50,mb:"7px",css:{background:"#FFFFFF",boxShadow:"0px 0px 8px rgba(0, 0, 0, 0.08)",borderRadius:"135px"},children:Object(s.b)(qn,{})}),Object(s.b)(ee.Flex,{justifyContent:"center",children:"举报"})]})]})}var Qn=n(304),Yn=Object.assign;var Jn=function(e){return u.a.createElement(vn.a,Yn({width:"200",height:"88",fill:"none",viewBox:"0 0 200 88"},e),u.a.createElement("path",{fill:"#E3EAF1",d:"M90.78 11.188H52.292v66.743h9.43l1.259 8.04 12.754-8.04H90.78V11.189zM74.51 69.597l-7.488 4.713-.734-4.713h-5.389V19.47h21.186v50.126H74.51zM45.189 41.222H31.193c0-1.473.105-2.98.123-4.557V19.477H47.27v-4.054a4.224 4.224 0 0 0-1.262-2.99 4.307 4.307 0 0 0-3.024-1.238H18.072c.088-.277.175-.555.262-.797C19.192 7.834 21.938.002 21.938.002a13.32 13.32 0 0 0-7.54 2.183c-1.784 1.248-2.851 2.131-4.286 6.082-1.662 4.54-3.114 8.923-4.094 11.54C4.514 23.981.875 31.328.875 31.328a18.295 18.295 0 0 0 7.872-1.906c3.5-1.854 5.249-4.696 6.421-9.01l.28-.936h7.295v17.188c0 1.56-.14 3.067-.227 4.557H9.64a8.404 8.404 0 0 0-5.914 2.426 8.242 8.242 0 0 0-2.449 5.856h20.399a55.358 55.358 0 0 1-2.432 11.401 52.49 52.49 0 0 1-9.412 16.478A103.517 103.517 0 0 1 0 86.687s9.78 3.674 16.952-2.98c4.34-4.037 8.223-11.92 10.095-17.898a87.786 87.786 0 0 0 3.499-16.34h18.65v-4.28a3.918 3.918 0 0 0-1.169-2.81 4.022 4.022 0 0 0-2.838-1.157z"}),u.a.createElement("path",{fill:"#E3EAF1",d:"m35.222 58.361-7.226 4.661 15.746 23.305a21.572 21.572 0 0 0 2.099-6.931 9.843 9.843 0 0 0-.875-6.775l-9.744-14.26zm125.555-14.01v-29.23a7322.86 7322.86 0 0 0 29.496-1.507l2.659-.156c1.207-1.248 2.764-7.485 2.152-9.443-.228-.78-.665-2.08-1.995-1.733a103.979 103.979 0 0 1-13.366 2.27c-8.642 1.005-12.403 1.265-24.387 2.131-20.994 1.525-39.713 2.253-39.713 2.253a7.857 7.857 0 0 0 .64 3.114 7.923 7.923 0 0 0 1.823 2.617 8.012 8.012 0 0 0 2.713 1.697 8.085 8.085 0 0 0 3.169.507c7.12-.294 17.494-.78 28.114-1.282v28.762h-39.941c0 2.197.881 4.303 2.449 5.857a8.406 8.406 0 0 0 5.914 2.425h31.578v22.11c0 2.772-1.452 3.725-3.849 3.794h-12.247a12.979 12.979 0 0 0 2.613 4.826 13.117 13.117 0 0 0 4.385 3.335 19.423 19.423 0 0 0 8.468.866c4.251-.208 9.272-2.581 9.272-11.158V52.633h35.252c1.067 0 2.091-.42 2.845-1.167A3.965 3.965 0 0 0 200 48.648v-4.297h-39.223z"}),u.a.createElement("path",{fill:"#E3EAF1",d:"M133.169 24.611a7.192 7.192 0 0 0-2.065-1.914 7.273 7.273 0 0 0-5.476-.882 7.26 7.26 0 0 0-2.571 1.167l-1.172.85 13.296 18.279 6.998-5.06-9.01-12.44zm46.048-.617L169.455 36.8l6.997 5.198 14.119-18.522-1.172-.867a7.294 7.294 0 0 0-8.066-.49 7.196 7.196 0 0 0-2.116 1.876z"}))},Xn=n(236);function $n(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var r=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(t,void 0!==n&&n<r?n:r)}return e(t,n)}function er(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var tr=function(e){Object(a.a)(n,e);var t=er(n);function n(){var e;Object(r.a)(this,n);for(var c=arguments.length,a=new Array(c),o=0;o<c;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={isReportModalShow:!1,selectedMessages:[],multiSelectMode:!1},e.toggleReportModal=function(){e.setState((function(e){return{isReportModalShow:!e.isReportModalShow,selectedMessages:!e.multiSelectMode&&e.isReportModalShow?[]:e.selectedMessages}}))},e.enterMultiSelectMode=function(){e.setState({multiSelectMode:!0})},e.leaveMultiSelectMode=function(){e.setState({multiSelectMode:!1,selectedMessages:[]})},e.toggleSelectMessage=function(t,n){var r=e.props.showNotification;t&&e.state.selectedMessages.length>=20?r("最多选择20条信息"):e.setState((function(e){return{selectedMessages:t?[].concat($n(U.a,e.selectedMessages),[n]):e.selectedMessages.filter((function(e){var t=e.id;return n.id!==t}))}}))},e.onReport=function(){0!==e.state.selectedMessages.length&&e.toggleReportModal()},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.senderId,n=e.getEcomProfile;(0,e.getAccountInfo)(),t&&n(t)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.senderId,r=e.sender,c=e.warning,a=c.status,o=c.message,i=this.state,l=i.isReportModalShow,u=i.selectedMessages,d=i.multiSelectMode,f=r||{},p=f.name,h=void 0===p?"":p,m=f.vipInfo,b=void 0===m?{}:m,g=u.map((function(e){var t=e.type,n=e.id,r=e.associateId;return"risk_tip"===t||"tip"===t?r:n})),v=(b||{}).vipIcon;return n?Object(s.c)("div",{className:V()("ChatBox",t),children:[a&&Object(s.b)(Fn,{message:o,className:"ChatBox-alert"}),l&&Object(s.b)(Xn.a,{type:"message",urlTokens:g,shown:!0,onClose:this.toggleReportModal}),Object(s.c)("header",{className:"ChatBox-title",children:[Object(s.b)("span",{children:h}),v&&Object(s.b)("img",{src:v.url,className:"ChatBox-titleVipIcon",alt:""})]}),Object(s.b)("div",{className:"MessagesBox-wrapper",children:Object(s.b)(Wt,{senderId:n,multiSelectMode:d,selectedMessages:u,onMultiSelectClick:this.enterMultiSelectMode,toggleSelectMessage:this.toggleSelectMessage,toggleReportModal:this.toggleReportModal})}),d&&Object(s.b)(Wn,{onClose:this.leaveMultiSelectMode,onReport:this.onReport}),!d&&Object(s.b)(Kn,{senderId:n,sender:r})]}):Object(s.b)("div",{className:"ChatBox-empty",children:Object(s.b)(Jn,{className:"ChatBox-emptyImage"})})}}]),n}(l.Component);tr.propTypes={senderId:f.a.string,className:f.a.string};var nr=Object(v.connect)((function(e,t){var n=t.senderId,r=e.chat.chats[n]||{},c=r.receiver,a=void 0===c?{}:c,o=r.sender,i=void 0===o?{}:o,s=r.warning;return{receiver:a,sender:i,warning:void 0===s?{}:s}}),{getAccountInfo:Qn.b,getEcomProfile:y.i,showNotification:be.g})(tr);function rr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var c=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var cr=function(e){Object(a.a)(n,e);var t=rr(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props,t=e.memberHashId,n=e.isModalShow,r=e.handleCloseModal;return Object(s.b)(p.b,{className:"ChatBoxModal",spread:!0,onClose:r,contentClassName:"ChatBoxModal-content",closeButton:Object(s.b)(h.c,{preset:"plain",className:"ChatBoxModal-closeButton",onClick:r,"aria-label":"关闭",children:Object(s.b)(m.a,{className:"ChatBoxModal-closeIcon"})}),children:n&&Object(s.b)(K,{senderId:t,entryName:"ChatBoxModal",children:Object(s.b)(nr,{type:"default",senderId:t,className:"Chat-ChatBox"},t)})})}}]),n}(l.Component);cr.propTypes={memberHashId:f.a.string,handleCloseModal:f.a.func,isModalShow:f.a.bool}}}]);
//# sourceMappingURL=column.shared_da7c8ae9ba4d3befc7c2f1c0b3e151cc8ee375ec.46bf172c7aeac9f5ae11.js.map