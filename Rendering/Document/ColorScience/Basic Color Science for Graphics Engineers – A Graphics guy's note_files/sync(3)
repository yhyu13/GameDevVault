(function() {window.GUM_DOMAIN="gum.criteo.com";window.CONFIG_CSM_DOMAIN_NAME="csm.sg1.as.criteo.net";window.CALLER_ID="72";var CONFIG_JS_CALLBACK=TRC.getRTUS;var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function __awaiter(i,a,s,u){return new(s=s||Promise)(function(e,t){function n(e){try{r(u.next(e))}catch(e){t(e)}}function o(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,o)}r((u=u.apply(i,a||[])).next())})}function __generator(n,o){var r,i,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=o.call(n,s)}catch(e){t=[6,e],i=0}finally{r=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}var PUBLIC_TOP_TLDS=["co.id","co.il","co.jp","co.kr","co.nz","co.th","co.uk","com.au","com.br","com.mx","com.my","com.pl","com.sg","com.tr","com.vn"];function getCookie(e,t){if(!hasCookieStorage(e))return null;for(var n=e.cookie.split(";"),o=0;o<n.length;o++){var r=n[o],i=r.substr(0,r.indexOf("=")).replace(/^\s+|\s+$/g,""),a=r.substr(r.indexOf("=")+1);if(i===t&&a)return decodeURIComponent(a)}return null}function setCookieOnMainDomain(e,t,n,o){var r=e.location.hostname;if(!hasCookieStorage(e))return r;var i=new Date;i.setTime(i.getTime()+60*o*60*1e3);for(var a="expires="+i.toUTCString(),s=r.split("."),u=null,c=1;c<s.length;++c)if(u=s.slice(s.length-c-1,s.length).join("."),!(-1<PUBLIC_TOP_TLDS.indexOf(u))){var l="domain=."+u;try{e.cookie=t+"="+encodeURIComponent(n)+";"+a+";"+l+";path=/";var d=getCookie(e,t);if(d&&d===n)break}catch(e){}}return u||r}function deleteCookie(e,t){setCookieOnMainDomain(e,t,"",0)}function hasCookieStorage(e){try{return void 0!==e.cookie}catch(e){return!1}}var TCFCompatibleConsentProvider=function(){function e(e,t,n){void 0===n&&(n=function(e){}),this.tcfv1ConsentProvider=e,this.tcfv2ConsentProvider=t,this.logger=n}return e.prototype.getReadyToRetrieveProvider=function(){return this.tcfv2ConsentProvider.hasCallerFunctionInFrame()?this.tcfv2ConsentProvider:this.tcfv1ConsentProvider.hasCallerFunctionInFrame()?this.tcfv1ConsentProvider:void 0!==this.tcfv2ConsentProvider.getCMPFrame()?this.tcfv2ConsentProvider:void 0!==this.tcfv1ConsentProvider.getCMPFrame()?this.tcfv1ConsentProvider:void 0},e.prototype.retrieveConsentForPassback=function(e){var t=this.getReadyToRetrieveProvider();void 0===t&&(this.logger("No compatible GDPR privacy provider found"),e(void 0)),t===this.tcfv1ConsentProvider?this.tcfv1ConsentProvider.retrieveConsentForPassback(e):t===this.tcfv2ConsentProvider&&this.tcfv2ConsentProvider.retrieveConsent(e)},e.prototype.retrieveConsent=function(e){var t=this.getReadyToRetrieveProvider();void 0===t&&(this.logger("No compatible GDPR privacy provider found"),e(void 0)),null==t||t.retrieveConsent(e)},e.prototype.readyToRetrieve=function(){return this.tcfv2ConsentProvider.readyToRetrieve()||this.tcfv1ConsentProvider.readyToRetrieve()},e}();function tryParseJson(e){try{return JSON.parse(e)}catch(e){return}}var StorageOrigin,PrivateModeStatus,CRITEO_VENDOR_ID=91,TCFv1ConsentProvider=function(){function e(e,t,n){void 0===n&&(n=function(e){}),this.cmpCallbacks={},this.currentWindow=e,this.timeout=t.tcfTimeout,this.pingTimeout=t.tcfPingTimeout,this.pingDelay=t.tcfPingDelay,this.cmpAutoDetect=t.cmpAutoDetect,this.logger=n}return e.prototype.getCMPFrame=function(){for(var e,t=this.currentWindow,n=0;n<10;++n){try{t.frames.__cmpLocator&&(e=t)}catch(e){}if(t===this.currentWindow.top)break;t=t.parent}return e},e.prototype.hasCallerFunctionInFrame=function(){return"function"==typeof this.currentWindow.__cmp},e.prototype.readyToRetrieve=function(){return this.hasCallerFunctionInFrame()||void 0!==this.getCMPFrame()},e.prototype.pingWithTimeout=function(o,e,t,n){function r(e,t){i.logger(t),clearTimeout(e),n()}var i=this;return window.setTimeout(function(){var n=window.setTimeout(function(){r(o,"Timeout: Unable to get ping return after "+e+"ms")},e);i.executeCommand("ping",null,function(e,t){clearTimeout(n),t?(i.logger("GDPR CMP ping returned"),!0!==e.cmpLoaded&&r(o,"GDPR ping returned cmpLoaded which is not true"),i.logger("GDPR ping returned cmpLoaded which is true")):r(o,"Error sending ping to GDPR CMP")})},t)},e.prototype.retrieveConsent=function(e){this.executeRetrieveConsent("getConsentData",null,e)},e.prototype.retrieveConsentForPassback=function(e){this.executeRetrieveConsent("getVendorConsents",[CRITEO_VENDOR_ID],e)},e.prototype.executeRetrieveConsent=function(e,t,n){var o=this,r=!1,i=window.setTimeout(function(){r=!0,o.logger("Timeout: Unable to resolve GDPR consent after "+o.timeout+"ms"),n(void 0)},this.timeout),a=!1!==this.cmpAutoDetect?this.pingWithTimeout(i,this.pingTimeout,this.pingDelay,function(){r=!0,o.logger("Timeout: Unable to ping GDPR API after "+o.pingTimeout+"ms"),n(void 0)}):void 0;this.executeCommand(e,t,function(e,t){clearTimeout(a),r||(clearTimeout(i),t?(o.logger("GDPR consent retrieved"),o.processConsentData(e,n)):(o.logger("Error retrieving GDPR consent data from CMP"),n(void 0)))})},e.prototype.processConsentData=function(e,t){if(e){var n={};void 0!==e.consentData&&(n.consentData=e.consentData),void 0!==e.gdprApplies&&(n.gdprApplies=!!e.gdprApplies),t(n)}else this.logger("Unable to read GDPR consent data from CMP"),t(void 0)},e.prototype.executeCommand=function(e,t,n){var i=this;if(!this.hasCallerFunctionInFrame()){this.logger("No GDPR CMP defined on current frame");var a=this.getCMPFrame();this.currentWindow.__cmp=function(e,t,n){if(!a)return i.logger("GDPR CMP not found in any frame"),void n({msg:"GDPR CMP not found in any frame"},!1);var o=Math.random().toString(10),r={__cmpCall:{command:e,parameter:t,callId:o}};i.cmpCallbacks[o]=n,a.postMessage(r,"*")},this.currentWindow.addEventListener("message",function(e){var t="string"==typeof e.data?tryParseJson(e.data):e.data;if(t&&t.__cmpReturn&&t.__cmpReturn.callId&&t.__cmpReturn.returnValue){var n=t.__cmpReturn;i.cmpCallbacks&&i.cmpCallbacks[n.callId]&&(i.cmpCallbacks[n.callId](n.returnValue,n.success),delete i.cmpCallbacks[n.callId])}},!1)}this.currentWindow.__cmp(e,t,n)},e}(),CRITEO_VENDOR_ID$1=91,TCF_V2_VERSION=2,TCFv2ConsentProvider=function(){function e(e,t,n){void 0===n&&(n=function(e){}),this.cmpCallbacks={},this.currentWindow=e,this.timeout=t.tcfTimeout,this.pingTimeout=t.tcfPingTimeout,this.pingDelay=t.tcfPingDelay,this.cmpAutoDetect=t.cmpAutoDetect,this.logger=n}return e.prototype.getCMPFrame=function(){for(var e,t=this.currentWindow,n=0;n<10;++n){try{t.frames.__tcfapiLocator&&(e=t)}catch(e){}if(t===this.currentWindow.top)break;t=t.parent}return e},e.prototype.hasCallerFunctionInFrame=function(){return"function"==typeof this.currentWindow.__tcfapi},e.prototype.readyToRetrieve=function(){return this.hasCallerFunctionInFrame()||void 0!==this.getCMPFrame()},e.prototype.pingWithTimeout=function(n,e,t,o){function r(e,t){i.logger(t),clearTimeout(e),o()}var i=this;return window.setTimeout(function(){var t=window.setTimeout(function(){r(n,"Timeout: Unable to get TCFv2 ping return after "+e+"ms")},e);i.executeCommand("ping",TCF_V2_VERSION,function(e){clearTimeout(t),i.logger("TCFv2 CMP ping returned in ms"),"error"===e.cmpStatus?r(n,"Error status on ping to TCFv2 CMP"):!0!==e.cmpLoaded?r(n,"TCFv2 ping returned cmpLoaded = false"):i.logger("TCFv2 ping returned cmpLoaded = true")})},t)},e.prototype.retrieveConsent=function(n){var o=this,r=!1,i=window.setTimeout(function(){r=!0,o.logger("Timeout: Unable to resolve TCFv2 consent after "+o.timeout+"ms"),n(void 0)},this.timeout),a=!1!==this.cmpAutoDetect?this.pingWithTimeout(i,this.pingTimeout,this.pingDelay,function(){r=!0,o.logger("Timeout: Unable to ping TCFv2 API after "+o.pingTimeout+"ms"),n(void 0)}):void 0;this.executeCommand("getTCData",TCF_V2_VERSION,function(e,t){clearTimeout(a),r||(clearTimeout(i),t?(o.logger("TCFv2 consent retrieved in ms"),o.processResponseData(e,n)):(o.logger("Error retrieving TCFv2 consent data from CMP"),n(void 0)))},[CRITEO_VENDOR_ID$1])},e.prototype.processResponseData=function(e,t){var n,o;if(e){var r={};void 0!==e.tcString&&(r.consentData=e.tcString),void 0!==e.gdprApplies&&(r.gdprApplies=!!e.gdprApplies),r.version=e.tcfPolicyVersion?e.tcfPolicyVersion:TCF_V2_VERSION,r.purposes=null===(n=null==e?void 0:e.purpose)||void 0===n?void 0:n.consents,r.vendorConsents=null===(o=null==e?void 0:e.vendor)||void 0===o?void 0:o.consents,t(r)}else this.logger("Unable to read GDPR consent data from CMP"),t(void 0)},e.prototype.executeCommand=function(e,t,n,o){var a=this;if(!this.hasCallerFunctionInFrame()){this.logger("No TCFv2 CMP defined on current frame");var s=this.getCMPFrame();this.currentWindow.__tcfapi=function(e,t,n,o){if(!s)return a.logger("TCFv2 CMP not found in any frame"),void n({msg:"TCFv2 CMP not found in any frame"},!1);var r=Math.random().toString(10),i={__tcfapiCall:{command:e,version:t,parameter:o,callId:r}};a.cmpCallbacks[r]=n,s.postMessage(i,"*")},this.currentWindow.addEventListener("message",function(e){var t="string"==typeof e.data?tryParseJson(e.data):e.data;if(t&&t.__tcfapiReturn&&t.__tcfapiReturn.callId&&t.__tcfapiReturn.returnValue){var n=t.__tcfapiReturn;a.cmpCallbacks&&a.cmpCallbacks[n.callId]&&"function"==typeof a.cmpCallbacks[n.callId]&&(a.cmpCallbacks[n.callId](n.returnValue,n.success),delete a.cmpCallbacks[n.callId])}},!1)}this.currentWindow.__tcfapi(e,t,n,o)},e}(),USPAPI_VERSION=1,CCPAConsentProvider=function(){function e(e,t,n){void 0===n&&(n=function(e){}),this.uspapiCallbacks={},this.currentWindow=e,this.timeout=t.uspApiTimeout,this.logger=n}return e.prototype.getCMPFrame=function(){for(var e,t=this.currentWindow,n=0;n<10;++n){try{t.frames.__uspapiLocator&&(e=t)}catch(e){}if(t===this.currentWindow.top)break;t=t.parent}return e},e.prototype.hasCallerFunctionInWindow=function(){return"function"==typeof this.currentWindow.__uspapi},e.prototype.readyToRetrieve=function(){return this.hasCallerFunctionInWindow()||void 0!==this.getCMPFrame()},e.prototype.retrieveConsent=function(n){var o=this,r=!1,i=window.setTimeout(function(){r=!0,o.logger("Timeout: Unable to resolve CCPA consent after "+o.timeout+"ms"),n(void 0)},this.timeout);this.executeCommand("getUSPData",USPAPI_VERSION,function(e,t){r||(clearTimeout(i),t?(o.logger("CCPA consent retrieved"),o.processResponseData(e,n)):(o.logger("Error retrieving CCPA consent data from CMP"),n(void 0)))})},e.prototype.processResponseData=function(e,t){e?t(e):(this.logger("Unable to read CCPA consent data from CMP"),t(void 0))},e.prototype.executeCommand=function(e,t,n){var i=this;if(!this.hasCallerFunctionInWindow()){this.logger("No CCPA CMP defined on current frame");var a=this.getCMPFrame();this.currentWindow.__uspapi=function(e,t,n){if(!a)return i.logger("CCPA CMP not found in any frame"),void n({msg:"CCPA CMP not found in any frame"},!1);var o=Math.random().toString(10),r={__uspapiCall:{command:e,parameter:t,callId:o}};i.uspapiCallbacks[o]=n,a.postMessage(r,"*")},this.currentWindow.addEventListener("message",function(e){var t="string"==typeof e.data?tryParseJson(e.data):e.data;if(t&&t.__uspapiReturn&&t.__uspapiReturn.callId&&t.__uspapiReturn.returnValue){var n=t.__uspapiReturn;i.uspapiCallbacks&&i.uspapiCallbacks[n.callId]&&(i.uspapiCallbacks[n.callId](n.returnValue,n.success),delete i.uspapiCallbacks[n.callId])}},!1)}this.currentWindow.__uspapi(e,t,n)},e.prototype.hasUserOptOut=function(e){return!(!e||!e.uspString||"1YNY"===e.uspString.toUpperCase()||"1YNN"===e.uspString.toUpperCase()||"1YN-"===e.uspString.toUpperCase()||"1-N-"===e.uspString.toUpperCase()||"1---"===e.uspString)},e}(),ConsentManager=function(){function e(e,t,n,o,r){void 0===t&&(t=1e4),void 0===n&&(n=50),void 0===o&&(o=1e3),void 0===r&&(r=50);var i={tcfTimeout:t,tcfPingTimeout:n,tcfPingDelay:o,uspApiTimeout:r},a={uspApiTimeout:t},s=new TCFv1ConsentProvider(e,i),u=new TCFv2ConsentProvider(e,i);this.tcfPrivacyProvider=new TCFCompatibleConsentProvider(s,u),this.ccpaConsentProvider=new CCPAConsentProvider(e,a)}return e.prototype.retrieveConsentGDPR=function(){var n=this;return new Promise(function(t,e){n.tcfPrivacyProvider.readyToRetrieve()?n.tcfPrivacyProvider.retrieveConsent(function(e){return t(e)}):t(void 0)})},e.prototype.retrieveConsentCCPA=function(){var n=this;return new Promise(function(t,e){n.ccpaConsentProvider.readyToRetrieve()?n.ccpaConsentProvider.retrieveConsent(function(e){return t(e)}):t(void 0)})},e}();!function(e){e[e.None=0]="None",e[e.Cookie=1]="Cookie",e[e.LocalStorage=2]="LocalStorage",e[e.Delegation=4]="Delegation"}(StorageOrigin=StorageOrigin||{}),function(e){e[e.Unknown=0]="Unknown",e[e.Deactivated=1]="Deactivated",e[e.Activated=2]="Activated"}(PrivateModeStatus=PrivateModeStatus||{});var AllUserData=function(){function e(e){this.userDataHandlers=e}return e.prototype.getSid=function(){return this.userDataHandlers.sid().fromAllStorages()},e.prototype.getIdCpy=function(){return this.userDataHandlers.idCpy().fromAllStorages()},e.prototype.getLocalWebId=function(){return this.userDataHandlers.localWebId().fromAllStorages()},e.prototype.getOptOut=function(){return this.userDataHandlers.optOut().fromAllStorages()},e.prototype.getBundle=function(){return this.userDataHandlers.bundle().fromAllStorages()},e}(),UserData=function(){function t(e,t){this.value=e,this.origin=t}return t.fromUserIdentificationData=function(e){return new t(e.value,e.origin)},t.fromValue=function(e){return new t(e,StorageOrigin.None)},t.prototype.hasValue=function(){return""!==String(this.value)&&null!==this.value&&void 0!==this.value},t}(),StorableUserData=function(a){function e(e,t,n,o,r){var i=a.call(this,n,o)||this;return i.storageKey=e,i.expirationTimeHours=t,i.storageAdapter=r,i}return __extends(e,a),e.prototype.hasValue=function(){return""!==String(this.value)&&null!==this.value&&void 0!==this.value},e.prototype.saveOnAllStorages=function(){if(this.hasValue()){var e="boolean"==typeof this.value?this.value?"1":"0":String(this.value);this.storageAdapter.writeToAllStorages(this.storageKey,e,this.expirationTimeHours)}},e.prototype.toJSON=function(){return{value:this.value,origin:this.origin}},e}(UserData),StorableUserDataHandlers=function(){function t(e){this.storageAdapter=e}return t.prototype.sid=function(){return this.createGuid(t.SID_COOKIE_NAME)},t.prototype.idCpy=function(){return this.createGuid(t.IDCPY_COOKIE_NAME)},t.prototype.localWebId=function(){return this.createGuid(t.LWID_COOKIE_NAME)},t.prototype.optOut=function(){return new StorableUserDataHandler(Boolean,t.OPTOUT_COOKIE_NAME,t.OPTOUT_RETENTION_TIME_HOUR,this.storageAdapter)},t.prototype.bundle=function(){return this.createGuid(t.BUNDLE_COOKIE_NAME)},t.prototype.createGuid=function(e){return new StorableUserDataHandler(String,e,t.GUID_RETENTION_TIME_HOUR,this.storageAdapter)},t.SID_COOKIE_NAME="cto_sid",t.IDCPY_COOKIE_NAME="cto_idcpy",t.LWID_COOKIE_NAME="cto_lwid",t.OPTOUT_COOKIE_NAME="cto_optout",t.BUNDLE_COOKIE_NAME="cto_bundle",t.GUID_RETENTION_TIME_HOUR=9360,t.OPTOUT_RETENTION_TIME_HOUR=43200,t}(),StorableUserDataHandler=function(){function e(e,t,n,o){this.type=e,this.storageKey=t,this.expirationTimeHours=n,this.storageAdapter=o}return e.prototype.fromAllStorages=function(){var e=this.storageAdapter.readFromAllStorages(this.storageKey),t="boolean"==typeof(new this.type).valueOf()?"1"===e.value:e.value;return this.create(t,e.origin)},e.prototype.fromValue=function(e){return this.create(e,StorageOrigin.None)},e.prototype.removeFromAllStorages=function(){this.storageAdapter.removeFromAllStorages(this.storageKey)},e.prototype.create=function(e,t){return new StorableUserData(this.storageKey,this.expirationTimeHours,e,t,this.storageAdapter)},e}(),Syncframe=function(){function e(e,t,n){this.criteoGlobalVendorListId=91,this.window=e,this.document=e.document,this.userDataHandlers=new StorableUserDataHandlers(t),n=null!=n?n:"gum.criteo.com",this.syncframeOrigin="https://"+n,this.syncframeEndpoint="https://"+n+"/syncframe",this.window.criteo_syncframe_state||(this.window.criteo_syncframe_state={syncframeRequested:!1}),this.window.criteo_syncframe_state.appendSyncframeRequestQueue||(this.window.criteo_syncframe_state.appendSyncframeRequestQueue=[])}return e.prototype.getSyncframeListener=function(n,o){var r=this;return function(e){if(!r.discardMessageFromOtherFrames(e)||r.window.criteo_syncframe_state.ForceSyncframeMessageHandling){var t=e.data;(null==t?void 0:t.requestId)===n&&(e.stopImmediatePropagation(),r.handleSyncframeResponse(t,o),r.window.criteo_syncframe_state.firstSyncframeCompleted=!0,r.window.criteo_syncframe_state.syncframeRequested=!1,r.tryUnqueueAppendSyncframeRequests())}}},e.prototype.userBundleHasAlreadyBeenRetrieved=function(){return this.userDataHandlers.bundle().fromAllStorages().hasValue()},e.prototype.canDropSyncframe=function(){return!this.window.criteo_syncframe_state.syncframeRequested},e.prototype.discardMessageFromOtherFrames=function(e){return!e.data||e.origin!=this.syncframeOrigin},e.prototype.appendGumIframeIfDoesNotExist=function(e,t,n){var o,r=this;!0===(null===(o=this.window.criteo_syncframe_state)||void 0===o?void 0:o.firstSyncframeCompleted)||this.userBundleHasAlreadyBeenRetrieved()?this.appendGumIframe(e,t,n):this.canDropSyncframe()?this.appendGumIframe(e,t,n):this.queueAppendSyncframeRequest(function(){return r.appendGumIframeIfDoesNotExist(e,t,n)})},e.prototype.doOnCompletedDom=function(e){var t=this;if(this.window.addEventListener)if("complete"===this.document.readyState)e();else{var n=function(){t.window.removeEventListener("load",n),t.document.removeEventListener("DOMContentLoaded",n),e()};this.window.addEventListener("load",n,!1),this.document.addEventListener("DOMContentLoaded",n,!1)}},e.prototype.appendGumIframe=function(e,t,n){t();var o=e();if(this.consentAllowsSyncframeToBeDropped(o.consent)){this.window.addEventListener("message",this.getSyncframeListener(o.requestId,n),!0);var r=this.createIFrame(o);this.document.body.appendChild(r),this.window.criteo_syncframe_state.syncframeRequested=!0}else this.handleSyncframeResponse({},n)},e.prototype.consentAllowsSyncframeToBeDropped=function(e){var t;return 2!==(null==e?void 0:e.gdprVersion)||!0!==(null==e?void 0:e.gdprApplies)||!0===(null===(t=null==e?void 0:e.vendorConsents)||void 0===t?void 0:t[this.criteoGlobalVendorListId])},e.prototype.queueAppendSyncframeRequest=function(e){void 0!==this.window.criteo_syncframe_state.appendSyncframeRequestQueue&&this.window.criteo_syncframe_state.appendSyncframeRequestQueue.push(e)},e.prototype.tryUnqueueAppendSyncframeRequests=function(){for(var e,t,n=null===(e=this.window.criteo_syncframe_state.appendSyncframeRequestQueue)||void 0===e?void 0:e.shift();void 0!==n;)n(),n=null===(t=this.window.criteo_syncframe_state.appendSyncframeRequestQueue)||void 0===t?void 0:t.shift()},e.prototype.createIFrame=function(e){var t,n=this.document.createElement("iframe"),o={uid:e.uid,lwid:e.localWebId,bundle:e.bundle,optout:e.optoutCookie,sid:e.secureIdCookie,tld:e.topLevelDomain,topUrl:e.topUrl,version:"string"==typeof e.version?null===(t=e.version)||void 0===t?void 0:t.replace(/\./g,"_"):e.version,cw:e.canWriteCookie,lsw:e.canWriteLocalStorage,origin:e.origin,pm:e.privateMode,rtusCallerId:e.rtusCallerId,requestId:e.requestId},r=[];return r.push("origin="+e.origin),r.push("topUrl="+e.topUrl),e.consent&&(void 0!==e.consent.gdprApplies&&r.push("gdpr="+(e.consent.gdprApplies?1:0)),void 0!==e.consent.consentData&&r.push("gdpr_consent="+e.consent.consentData),void 0!==e.consent.uspString&&r.push("us_privacy="+e.consent.uspString)),e.isDebug&&r.push("debug=1"),n.src=this.syncframeEndpoint+"?"+r.join("&")+"#"+JSON.stringify(o),n.width="0",n.height="0",n.frameBorder="0",n.style.borderWidth="0px",n.style.margin="0px",n.style.display="none",n.title="Criteo GUM iframe",n},e}(),RtusSyncframe=function(r){function e(e,t){var n,o=r.call(this,t,e.storageAdapter,null===(n=t)||void 0===n?void 0:n.GUM_DOMAIN)||this;return o.adapter=e,o.adapter=e,o}return __extends(e,r),e.prototype.discardMessageFromOtherFrames=function(e){return r.prototype.discardMessageFromOtherFrames.call(this,e)||!("function"==typeof this.window.fetch)},e.prototype.handleSyncframeResponse=function(e){e.optout?(this.adapter.logCounter("Origin.FromSyncframeOptout"),this.userDataHandlers.sid().removeFromAllStorages(),this.userDataHandlers.idCpy().removeFromAllStorages(),this.userDataHandlers.optOut().fromValue(!0).saveOnAllStorages(),this.userDataHandlers.bundle().removeFromAllStorages()):(e.uid&&(this.adapter.logCounter("Origin.FromSyncframeIdcpy"),this.userDataHandlers.idCpy().fromValue(e.uid).saveOnAllStorages()),e.bundle&&(this.adapter.logCounter("Origin.FromSyncframeBundle"),this.userDataHandlers.bundle().fromValue(e.bundle).saveOnAllStorages()),e.removeSid?(this.adapter.logCounter("Origin.FromSyncframeRemoveSid"),this.userDataHandlers.sid().removeFromAllStorages(),this.adapter.removeRtusResponse()):e.sid&&(this.adapter.logCounter("Origin.FromSyncframeSid"),this.userDataHandlers.sid().fromValue(e.sid).saveOnAllStorages()),e.sid||e.uid||e.bundle||this.adapter.sendMetrics()),this.adapter.onSyncframeResponseHandled()},e.prototype.fetchUserData=function(){return new AllUserData(this.userDataHandlers)},e.prototype.appendGumIFrameOnCompletedDomIfItDoesNotExist=function(e){var t=this,n=Math.random().toString();this.doOnCompletedDom(function(){return t.appendGumIframeIfDoesNotExist(function(){return t.createSyncframeRequest(e(),n)},function(){return t.adapter.logCounter("Events.SyncframeDropped")})})},e.prototype.createSyncframeRequest=function(e,t){return{uid:this.userDataHandlers.idCpy().fromAllStorages().toJSON(),localWebId:this.userDataHandlers.localWebId().fromAllStorages().toJSON(),bundle:this.userDataHandlers.bundle().fromAllStorages().toJSON(),optoutCookie:this.userDataHandlers.optOut().fromAllStorages().toJSON(),secureIdCookie:this.userDataHandlers.sid().fromAllStorages().toJSON(),topLevelDomain:e.topLevelDomain,topUrl:e.topUrl,version:void 0,canWriteCookie:e.canWriteCookie,canWriteLocalStorage:e.canWriteLocalStorage,origin:"rtus",privateMode:void 0,consent:e.consent,rtusCallerId:parseInt(this.window.CALLER_ID,10),isDebug:!1,requestId:t}},e}(Syncframe),LocalStorage=function(){function e(e){this.window=e}return e.prototype.setItem=function(e,t){if(this.hasStorages())try{this.window.localStorage.setItem(e,t)}catch(e){}},e.prototype.getItem=function(e){return this.hasStorages()?this.window.localStorage.getItem(e):null},e.prototype.removeItem=function(e){if(this.hasStorages())return this.window.localStorage.removeItem(e)},e.prototype.hasStorages=function(){try{return this.window.localStorage&&this.window.sessionStorage}catch(e){return!1}},e}(),RtusStorageAdapter=function(){function e(){this.storage=new LocalStorage(window)}return e.prototype.readFromAllStorages=function(e){var t=getCookie(document,e),n=this.storage.getItem(e);return t||n?{value:t||n,origin:(t&&StorageOrigin.Cookie)|(n&&StorageOrigin.LocalStorage)}:{value:null,origin:StorageOrigin.None}},e.prototype.removeFromAllStorages=function(e){deleteCookie(document,e),this.storage.removeItem(e)},e.prototype.writeToAllStorages=function(e,t,n){setCookieOnMainDomain(document,e,t,n),this.storage.setItem(e,t)},e}(),eventQueue=[],consentManager=new ConsentManager(window),localStorage=new LocalStorage(window),syncframe=new RtusSyncframe({logCounter:logCounter,onSyncframeResponseHandled:function(){var e=syncframe.fetchUserData();fetchGumResponseAndStoreItInLocalStorage(e.getSid(),e.getOptOut(),e.getIdCpy(),e.getBundle())},sendMetrics:sendMetrics,removeRtusResponse:function(){localStorage.removeItem(RTUS_RESPONSE_LS_KEY),localStorage.removeItem(RTUS_RESPONSE_LS_KEY_WITH_CALLERID)},storageAdapter:new RtusStorageAdapter},window),cookiesWriteable=!1,localStorageWritable=!1,gdprConsent=void 0,ccpaConsent=void 0,rtusResponseFromLocalStorage=null,FETCHED_CALLED=!1,CURRENT_SCRIPT_SRC=document.currentScript.src,RTUS_RESPONSE_LS_KEY="cto_rtus",RTUS_RESPONSE_LS_KEY_WITH_CALLERID=RTUS_RESPONSE_LS_KEY+"_"+window.CALLER_ID,JSON_DELIMITER_REGEX=/\(({[^}]*})\)/g,JS_CALLBACK=CONFIG_JS_CALLBACK||function(e){},DEFAULT_RTUS_RESPONSE={status:"Unknown",userid:""};function fetchGumResponseAndStoreItInLocalStorage(e,t,n,o){if(FETCHED_CALLED)sendMetrics();else{var r=new Headers;e.hasValue()&&(r.set("X-CRTO-SID",e.value),logCounter("Headers.Sid")),t.value&&(r.set("X-CRTO-OPTOUT","1"),logCounter("Headers.Optout")),n.hasValue()&&(r.set("X-CRTO-IDCPY",n.value),logCounter("Headers.Idpcy")),o.hasValue()&&(r.set("X-CRTO-BUNDLE",o.value),logCounter("Headers.Bundle")),logCounter("Events.InitiateFetch"),fetch(CURRENT_SCRIPT_SRC,{headers:r,cache:"reload",mode:"cors"}).then(function(e){return e.text().then(function(e){if(FETCHED_CALLED=!0,!(0<e.indexOf('"status":"Unknown"'))){var t=JSON_DELIMITER_REGEX.exec(e);t&&t[1]&&(localStorage.setItem(RTUS_RESPONSE_LS_KEY_WITH_CALLERID,t[1]),logCounter("Events.SaveResponseOnLocalStorage")),sendMetrics()}})}).catch(logCounter.bind(null,"Events.FetchError")).then(sendMetrics)}}function parseJSON(e){try{return JSON.parse(e)}catch(e){return logCounter("Events.JsonParseError"),{}}}function getTld(){var e=setCookieOnMainDomain(document,"cto_tld_test","test",1);return deleteCookie(document,"cto_tld_test"),e}function canWriteCookies(){return canWrite(function(e,t,n){return setCookieOnMainDomain(document,e,t,n)},function(e){return getCookie(document,e)},function(e){return deleteCookie(document,e)})}function canWriteLocalStorage(){return canWrite(function(e,t,n){return localStorage.setItem(e,t)},function(e){return localStorage.getItem(e)},function(e){return localStorage.removeItem(e)})}function canWrite(e,t,n){e("cto_write_test","testWrite",1);var o="testWrite"===t("cto_write_test");return n("cto_write_test"),o}function createGumRequest(){var e=extractHostname(getHighestAccessibleUrl(getHighestAccessibleWindow(window))),t=encodeURIComponent(e);return{topLevelDomain:getTld(),topUrl:t,canWriteCookie:cookiesWriteable,canWriteLocalStorage:localStorageWritable,consent:{gdprApplies:null==gdprConsent?void 0:gdprConsent.gdprApplies,consentData:null==gdprConsent?void 0:gdprConsent.consentData,gdprVersion:null==gdprConsent?void 0:gdprConsent.version,vendorConsents:null==gdprConsent?void 0:gdprConsent.vendorConsents,uspString:null==ccpaConsent?void 0:ccpaConsent.uspString,ccpaVersion:null==ccpaConsent?void 0:ccpaConsent.version}}}function extractHostname(e){var t=document.createElement("a");return t.href=e,t.hostname}function getHighestAccessibleUrl(e){var t=e.topFrame,n="";if(e.err)try{try{n=t.top.location.href}catch(e){var o=t.location.ancestorOrigins;n=o[o.length-1]}}catch(e){n=t.document.referrer}else n=t.location.href;return n}function getHighestAccessibleWindow(e){var t=e,n=!1;try{for(;t.parent.document!==t.document;){if(!t.parent.document){n=!0;break}t=t.parent}}catch(e){n=!0}return{topFrame:t,err:n}}function init(){return __awaiter(this,void 0,void 0,function(){var t,n,o,r,i,a;return __generator(this,function(e){switch(e.label){case 0:return logCounter("Events.StartInit"),t=syncframe.fetchUserData(),n=t.getSid(),o=t.getOptOut(),r=t.getIdCpy(),i=t.getBundle(),a=t.getLocalWebId(),cookiesWriteable=canWriteCookies(),localStorageWritable=canWriteLocalStorage(),[4,consentManager.retrieveConsentGDPR()];case 1:return gdprConsent=e.sent(),[4,consentManager.retrieveConsentCCPA()];case 2:return ccpaConsent=e.sent(),a.hasValue()&&logCounter("Origin.FromLocalWebId"),syncframe.appendGumIFrameOnCompletedDomIfItDoesNotExist(createGumRequest),(rtusResponseFromLocalStorage=localStorage.getItem(RTUS_RESPONSE_LS_KEY_WITH_CALLERID)||localStorage.getItem(RTUS_RESPONSE_LS_KEY))?(JS_CALLBACK(parseJSON(rtusResponseFromLocalStorage)),logCounter("Origin.FromLocalRtusResponse"),sendMetrics(),[2]):((n.hasValue()||o.value||r.hasValue()||i.hasValue())&&(n.hasValue()&&logCounter("Origin.FromLocalSid"),o.value&&logCounter("Origin.FromLocalOptout"),r.hasValue()&&logCounter("Origin.FromIdCpy"),i.hasValue()&&logCounter("Origin.FromBundle"),fetchGumResponseAndStoreItInLocalStorage(n,o,r,i)),JS_CALLBACK(DEFAULT_RTUS_RESPONSE),[2])}})})}function logCounter(e){eventQueue.push("entry=c~Idfs.Rtus."+(window.CALLER_ID||"UnknownCaller")+"."+e+"~1")}function sendMetrics(){if(0!==eventQueue.length){var e=eventQueue.join("&"),t="https://"+window.CONFIG_CSM_DOMAIN_NAME+"/iev?"+e;if(!window.CONFIG_CSM_DOMAIN_NAME)return console.log("Pixel",t);(new Image).src=t,eventQueue=[]}}init();
})();