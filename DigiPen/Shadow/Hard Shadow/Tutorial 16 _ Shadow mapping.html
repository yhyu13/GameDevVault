<!DOCTYPE html>
<!-- saved from url=(0112)http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#stratified-poisson-sampling -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tutorial 16 : Shadow mapping</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free tutorials for modern Opengl (3.3 and later) in C/C++">
    <link rel="canonical" href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="./Tutorial 16 _ Shadow mapping_files/main.css">
    <link href="./Tutorial 16 _ Shadow mapping_files/syntax.css" rel="stylesheet">

    <script async="" src="./Tutorial 16 _ Shadow mapping_files/analytics.js.download"></script><script>

      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-22633480-2', {'siteSpeedSampleRate': 40});
      ga('send', 'pageview');
      
    </script>
    
</head>


    <body data-gr-c-s-loaded="true">

    
    <header class="site-header">

  <script>
    String.prototype.replaceAt=function(index, character) {
    return this.substr(0, index) + character + this.substr(index+character.length);
    }
    
    function myFunction() {
    var x = document.getElementById("myLanguage").value
    var pageurl = "/cn/intermediate-tutorials/tutorial-16-shadow-mapping/"
    if (pageurl.charAt(3) == '/') {
      if(x=='en'){
        pageurl = pageurl.substring(3);
      } else {
        pageurl = pageurl.replaceAt(1, x);
      }
      window.open ('' + pageurl,'_self',false);
    } else { 
      window.open ('/' + x + pageurl,'_self',false);
    }
    
    
    }
  </script>
  
  <div class="wrap">
    
      <a class="site-title" href="http://www.opengl-tutorial.org/cn/">opengl-tutorial</a>
    

    <nav class="site-nav">
      
      <a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path>
        </svg>
      </a>

      <ul class="trigger">
        
        

        <li><a href="http://www.opengl-tutorial.org/cn/beginners-tutorials/">Basic tutorials</a>
          <span class="arrow">▼</span>
          <ul class="sub-menu">
            
            
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/cn/beginners-tutorials/tutorial-1-opening-a-window/">第一课：打开一个窗口</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/cn/beginners-tutorials/tutorial-2-the-first-triangle/">第二课：绘制第一个三角形</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/cn/beginners-tutorials/tutorial-3-matrices/">﻿第三课：矩阵</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/cn/beginners-tutorials/tutorial-4-a-colored-cube/">第四课：彩色立方体</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/cn/beginners-tutorials/tutorial-5-a-textured-cube/">第五课：带纹理的立方体</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/cn/beginners-tutorials/tutorial-6-keyboard-and-mouse/">第六课：键盘和鼠标</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/cn/beginners-tutorials/tutorial-7-model-loading/">第七课：模型加载</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/cn/beginners-tutorials/tutorial-8-basic-shading/">第八课：基本着色</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
          </ul>
        </li>
        <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/">Intermediate tutorials</a>
          <span class="arrow">▼</span>
          <ul class="sub-menu">
            
            
            
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-9-vbo-indexing/">第九课：VBO索引</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-10-transparency/">第十课：透明</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-11-2d-text/">第十一课：2D文本</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-12-opengl-extensions/">第十二课：OpenGL扩展</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-13-normal-mapping/">第十三课：法线贴图</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-14-render-to-texture/">教程14：渲染到纹理</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-15-lightmaps/">第十五课：光照贴图（Lightmap）</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/">Tutorial 16 : Shadow mapping</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-17-quaternions/">Tutorial 17 : Rotations</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/billboards-particles/">Tutorial 18 : Billboards &amp; Particles</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    
                    <span class="arrow">▶</span><ul class="sub-menu">
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/billboards-particles/billboards/">Billboards</a></li>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/billboards-particles/particles-instancing/">Particles / Instancing</a></li>

                
              
            
              
              
            
            
              
              </ul></li>
            
          </ul>
        </li>
        <li><a href="http://www.opengl-tutorial.org/cn/miscellaneous/">Miscellaneous</a>
          <span class="arrow">▼</span>
          <ul class="sub-menu">
            
            
            
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/miscellaneous/faq/">FAQ</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/miscellaneous/contribute/">Contribute</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    
                    <span class="arrow">▶</span><ul class="sub-menu">
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/miscellaneous/contribute/translation/">Translation</a></li>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    
                    </ul></li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/miscellaneous/math-cheatsheet/">Math Cheatsheet</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/miscellaneous/useful-tools-links/">Useful Tools &amp; Links</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/miscellaneous/an-fps-counter/">An FPS counter</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/miscellaneous/building-your-own-c-application/">Building your own C application</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/miscellaneous/clicking-on-objects/">Clicking on objects</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    
                    <span class="arrow">▶</span><ul class="sub-menu">
                  
                  <li><a href="http://www.opengl-tutorial.org/cn/miscellaneous/clicking-on-objects/picking-with-an-opengl-hack/">Picking with an OpenGL hack</a></li>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                  <li><a href="http://www.opengl-tutorial.org/cn/miscellaneous/clicking-on-objects/picking-with-a-physics-library/">Picking with a physics library</a></li>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                  <li><a href="http://www.opengl-tutorial.org/cn/miscellaneous/clicking-on-objects/picking-with-custom-ray-obb-function/">Picking with custom Ray-OBB function</a></li>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
            
              
              </ul></li>
            
          </ul>
        </li>
        <li><a href="http://www.opengl-tutorial.org/cn/download/">Download</a></li>


        <li><select id="myLanguage" onchange="myFunction()">
          
            <option value="en">english</option>	    
          
            <option value="cn" selected="1">chinese</option>	    
          
            <option value="jp">japanese</option>	    
          
            <option value="ru">russian</option>	    
          
            <option value="fr">français</option>	    
          
            <option value="kr">korean</option>	    
          
            <option value="hu">hungarian</option>	    
          
	       </select></li>
       </ul>
      </nav></div>
    
  
</header>

    

    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Tutorial 16 : Shadow mapping</h1>
  </header>

  <article class="post-content">
  <ul id="markdown-toc">
  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#basic-shadowmap" id="markdown-toc-basic-shadowmap">Basic shadowmap</a>    <ul>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#rendering-the-shadow-map" id="markdown-toc-rendering-the-shadow-map">Rendering the shadow map</a>        <ul>
          <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#setting-up-the-rendertarget-and-the-mvp-matrix" id="markdown-toc-setting-up-the-rendertarget-and-the-mvp-matrix">Setting up the rendertarget and the MVP matrix</a></li>
          <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#the-shaders" id="markdown-toc-the-shaders">The shaders</a></li>
          <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#result" id="markdown-toc-result">Result</a></li>
        </ul>
      </li>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#using-the-shadow-map" id="markdown-toc-using-the-shadow-map">Using the shadow map</a>        <ul>
          <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#basic-shader" id="markdown-toc-basic-shader">Basic shader</a></li>
          <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#result---shadow-acne" id="markdown-toc-result---shadow-acne">Result - Shadow acne</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#problems" id="markdown-toc-problems">Problems</a>    <ul>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#shadow-acne" id="markdown-toc-shadow-acne">Shadow acne</a></li>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#peter-panning" id="markdown-toc-peter-panning">Peter Panning</a></li>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#aliasing" id="markdown-toc-aliasing">Aliasing</a>        <ul>
          <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#pcf" id="markdown-toc-pcf">PCF</a></li>
          <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#poisson-sampling" id="markdown-toc-poisson-sampling">Poisson Sampling</a></li>
          <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#stratified-poisson-sampling" id="markdown-toc-stratified-poisson-sampling">Stratified Poisson Sampling</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#going-further" id="markdown-toc-going-further">Going further</a>    <ul>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#early-bailing" id="markdown-toc-early-bailing">Early bailing</a></li>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#spot-lights" id="markdown-toc-spot-lights">Spot lights</a></li>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#point-lights" id="markdown-toc-point-lights">Point lights</a></li>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#combination-of-several-lights" id="markdown-toc-combination-of-several-lights">Combination of several lights</a></li>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#automatic-light-frustum" id="markdown-toc-automatic-light-frustum">Automatic light frustum</a></li>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#exponential-shadow-maps" id="markdown-toc-exponential-shadow-maps">Exponential shadow maps</a></li>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#light-space-perspective-shadow-maps" id="markdown-toc-light-space-perspective-shadow-maps">Light-space perspective Shadow Maps</a></li>
      <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#cascaded-shadow-maps" id="markdown-toc-cascaded-shadow-maps">Cascaded shadow maps</a></li>
    </ul>
  </li>
  <li><a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-16-shadow-mapping/#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

<p>In Tutorial 15 we learnt how to create lightmaps, which encompasses static lighting. While it produces very nice shadows, it doesn’t deal with animated models.</p>

<p>Shadow maps are the current (as of 2016) way to make dynamic shadows. The great thing about them is that it’s fairly easy to get to work. The bad thing is that it’s terribly difficult to get to work <em>right</em>.</p>

<p>In this tutorial, we’ll first introduce the basic algorithm, see its shortcomings, and then implement some techniques to get better results. Since at time of writing (2012) shadow maps are still a heavily researched topic, we’ll give you some directions to further improve your own shadowmap, depending on your needs.</p>

<h1 id="basic-shadowmap">Basic shadowmap</h1>

<p>The basic shadowmap algorithm consists in two passes. First, the scene is rendered from the point of view of the light. Only the depth of each fragment is computed. Next, the scene is rendered as usual, but with an extra test to see it the current fragment is in the shadow.</p>

<p>The “being in the shadow” test is actually quite simple. If the current sample is further from the light than the shadowmap at the same point, this means that the scene contains an object that is closer to the light. In other words, the current fragment is in the shadow.</p>

<p>The following image might help you understand the principle :</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/shadowmapping.png" alt=""></p>

<h2 id="rendering-the-shadow-map">Rendering the shadow map</h2>

<p>In this tutorial, we’ll only consider directional lights - lights that are so far away that all the light rays can be considered parallel. As such, rendering the shadow map is done with an orthographic projection matrix. An orthographic matrix is just like a usual perspective projection matrix, except that no perspective is taken into account - an object will look the same whether it’s far or near the camera.</p>

<h3 id="setting-up-the-rendertarget-and-the-mvp-matrix">Setting up the rendertarget and the MVP matrix</h3>

<p>Since Tutorial 14, you know how to render the scene into a texture in order to access it later from a shader.</p>

<p>Here we use a 1024x1024 16-bit depth texture to contain the shadow map. 16 bits are usually enough for a shadow map. Feel free to experiment with these values. Note that we use a depth texture, not a depth renderbuffer, since we’ll need to sample it later.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// The framebuffer, which regroups 0, 1, or more textures, and 0 or 1 depth buffer.
</span> <span class="n">GLuint</span> <span class="n">FramebufferName</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 <span class="n">glGenFramebuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">FramebufferName</span><span class="p">);</span>
 <span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span> <span class="n">FramebufferName</span><span class="p">);</span>

 <span class="c1">// Depth texture. Slower than a depth buffer, but you can sample it later in your shader
</span> <span class="n">GLuint</span> <span class="n">depthTexture</span><span class="p">;</span>
 <span class="n">glGenTextures</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">depthTexture</span><span class="p">);</span>
 <span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">depthTexture</span><span class="p">);</span>
 <span class="n">glTexImage2D</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="n">GL_DEPTH_COMPONENT16</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="n">GL_DEPTH_COMPONENT</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
 <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MAG_FILTER</span><span class="p">,</span> <span class="n">GL_NEAREST</span><span class="p">);</span>
 <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="n">GL_NEAREST</span><span class="p">);</span>
 <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_WRAP_S</span><span class="p">,</span> <span class="n">GL_CLAMP_TO_EDGE</span><span class="p">);</span>
 <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_WRAP_T</span><span class="p">,</span> <span class="n">GL_CLAMP_TO_EDGE</span><span class="p">);</span>

 <span class="n">glFramebufferTexture</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span> <span class="n">GL_DEPTH_ATTACHMENT</span><span class="p">,</span> <span class="n">depthTexture</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

 <span class="n">glDrawBuffer</span><span class="p">(</span><span class="n">GL_NONE</span><span class="p">);</span> <span class="c1">// No color buffer is drawn to.
</span>
 <span class="c1">// Always check that our framebuffer is ok
</span> <span class="k">if</span><span class="p">(</span><span class="n">glCheckFramebufferStatus</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">)</span> <span class="o">!=</span> <span class="n">GL_FRAMEBUFFER_COMPLETE</span><span class="p">)</span>
 <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</code></pre></div></div>

<p>The MVP matrix used to render the scene from the light’s point of view is computed as follows :</p>

<ul>
  <li>The Projection matrix is an orthographic matrix which will encompass everything in the axis-aligned box (-10,10),(-10,10),(-10,20) on the X,Y and Z axes respectively. These values are made so that our entire *visible *scene is always visible ; more on this in the Going Further section.</li>
  <li>The View matrix rotates the world so that in camera space, the light direction is -Z (would you like to re-read <a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-3-matrices/">Tutorial 3</a> ?)</li>
  <li>The Model matrix is whatever you want.</li>
</ul>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">lightInvDir</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="n">f</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>

 <span class="c1">// Compute the MVP matrix from the light's point of view
</span> <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">depthProjectionMatrix</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">ortho</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
 <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">depthViewMatrix</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">lookAt</span><span class="p">(</span><span class="n">lightInvDir</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">));</span>
 <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">depthModelMatrix</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span>
 <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">depthMVP</span> <span class="o">=</span> <span class="n">depthProjectionMatrix</span> <span class="o">*</span> <span class="n">depthViewMatrix</span> <span class="o">*</span> <span class="n">depthModelMatrix</span><span class="p">;</span>

 <span class="c1">// Send our transformation to the currently bound shader,
</span> <span class="c1">// in the "MVP" uniform
</span> <span class="n">glUniformMatrix4fv</span><span class="p">(</span><span class="n">depthMatrixID</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">GL_FALSE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">depthMVP</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="the-shaders">The shaders</h3>

<p>The shaders used during this pass are very simple. The vertex shader is a pass-through shader which simply compute the vertex’ position in homogeneous coordinates :</p>

<div class="language-glsl highlightglslvs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#version 330 core
</span>
<span class="c1">// Input vertex data, different for all executions of this shader.
</span><span class="k">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec3</span> <span class="n">vertexPosition_modelspace</span><span class="p">;</span>

<span class="c1">// Values that stay constant for the whole mesh.
</span><span class="k">uniform</span> <span class="kt">mat4</span> <span class="n">depthMVP</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">(){</span>
 <span class="nb">gl_Position</span> <span class="o">=</span>  <span class="n">depthMVP</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">vertexPosition_modelspace</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The fragment shader is just as simple : it simply writes the depth of the fragment at location 0 (i.e. in our depth texture).</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#version 330 core
</span>
<span class="c1">// Ouput data
</span><span class="k">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">out</span> <span class="kt">float</span> <span class="n">fragmentdepth</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">(){</span>
    <span class="c1">// Not really needed, OpenGL does it anyway
</span>    <span class="n">fragmentdepth</span> <span class="o">=</span> <span class="nb">gl_FragCoord</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Rendering a shadow map is usually more than twice as fast as the normal render, because only low precision depth is written, instead of both the depth and the color; Memory bandwidth is often the biggest performance issue on GPUs.</p>

<h3 id="result">Result</h3>

<p>The resulting texture looks like this :</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/DepthTexture.png" alt=""></p>

<p>A dark colour means a small z ; hence, the upper-right corner of the wall is near the camera. At the opposite, white means z=1 (in homogeneous coordinates), so this is very far.</p>

<h2 id="using-the-shadow-map">Using the shadow map</h2>

<h3 id="basic-shader">Basic shader</h3>

<p>Now we go back to our usual shader. For each fragment that we compute, we must test whether it is “behind” the shadow map or not.</p>

<p>To do this, we need to compute the current fragment’s position <em>in the same space that the one we used when creating the shadowmap</em>. So we need to transform it once with the usual MVP matrix, and another time with the depthMVP matrix.</p>

<p>There is a little trick, though. Multiplying the vertex’ position by depthMVP will give homogeneous coordinates, which are in [-1,1] ; but texture sampling must be done in [0,1].</p>

<p>For instance, a fragment in the middle of the screen will be in (0,0) in homogeneous coordinates ; but since it will have to sample the middle of the texture, the UVs will have to be (0.5, 0.5).</p>

<p>This can be fixed by tweaking the fetch coordinates directly in the fragment shader but it’s more efficient to multiply the homogeneous coordinates by the following matrix, which simply divides coordinates by 2 ( the diagonal : [-1,1] -&gt; [-0.5, 0.5] ) and translates them ( the lower row : [-0.5, 0.5] -&gt; [0,1] ).</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">biasMatrix</span><span class="p">(</span>
<span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span>
<span class="p">);</span>
<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">depthBiasMVP</span> <span class="o">=</span> <span class="n">biasMatrix</span><span class="o">*</span><span class="n">depthMVP</span><span class="p">;</span>
</code></pre></div></div>

<p>We can now write our vertex shader. It’s the same as before, but we output 2 positions instead of 1 :</p>

<ul>
  <li>gl_Position is the position of the vertex as seen from the current camera</li>
  <li>ShadowCoord is the position of the vertex as seen from the last camera (the light)</li>
</ul>

<div class="language-glsl highlightglslvs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Output position of the vertex, in clip space : MVP * position
</span><span class="nb">gl_Position</span> <span class="o">=</span>  <span class="n">MVP</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">vertexPosition_modelspace</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// Same, but with the light's view matrix
</span><span class="n">ShadowCoord</span> <span class="o">=</span> <span class="n">DepthBiasMVP</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">vertexPosition_modelspace</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<p>The fragment shader is then very simple :</p>

<ul>
  <li>texture( shadowMap, ShadowCoord.xy ).z is the distance between the light and the nearest occluder</li>
  <li>ShadowCoord.z is the distance between the light and the current fragment</li>
</ul>

<p>… so if the current fragment is further than the nearest occluder, this means we are in the shadow (of said nearest occluder) :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">visibility</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">texture</span><span class="p">(</span> <span class="n">shadowMap</span><span class="p">,</span> <span class="n">ShadowCoord</span><span class="p">.</span><span class="n">xy</span> <span class="p">).</span><span class="n">z</span>  <span class="o">&lt;</span>  <span class="n">ShadowCoord</span><span class="p">.</span><span class="n">z</span><span class="p">){</span>
    <span class="n">visibility</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We just have to use this knowledge to modify our shading. Of course, the ambient colour isn’t modified, since its purpose in life is to fake some incoming light even when we’re in the shadow (or everything would be pure black)</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">color</span> <span class="o">=</span>
 <span class="c1">// Ambient : simulates indirect lighting
</span> <span class="n">MaterialAmbientColor</span> <span class="o">+</span>
 <span class="c1">// Diffuse : "color" of the object
</span> <span class="n">visibility</span> <span class="o">*</span> <span class="n">MaterialDiffuseColor</span> <span class="o">*</span> <span class="n">LightColor</span> <span class="o">*</span> <span class="n">LightPower</span> <span class="o">*</span> <span class="n">cosTheta</span><span class="o">+</span>
 <span class="c1">// Specular : reflective highlight, like a mirror
</span> <span class="n">visibility</span> <span class="o">*</span> <span class="n">MaterialSpecularColor</span> <span class="o">*</span> <span class="n">LightColor</span> <span class="o">*</span> <span class="n">LightPower</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">cosAlpha</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="result---shadow-acne">Result - Shadow acne</h3>

<p>Here’s the result of the current code. Obviously, the global idea it there, but the quality is unacceptable.</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/1rstTry.png" alt=""></p>

<p>Let’s look at each problem in this image. The code has 2 projects : shadowmaps and shadowmaps_simple; start with whichever you like best. The simple version is just as ugly as the image above, but is simpler to understand.</p>

<h1 id="problems">Problems</h1>

<h2 id="shadow-acne">Shadow acne</h2>

<p>The most obvious problem is called <em>shadow acne</em> :</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/ShadowAcne.png" alt=""></p>

<p>This phenomenon is easily explained with a simple image :</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/shadow-acne.png" alt=""></p>

<p>The usual “fix” for this is to add an error margin : we only shade if the current fragment’s depth (again, in light space) is really far away from the lightmap value. We do this by adding a bias :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">bias</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">005</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">visibility</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">texture</span><span class="p">(</span> <span class="n">shadowMap</span><span class="p">,</span> <span class="n">ShadowCoord</span><span class="p">.</span><span class="n">xy</span> <span class="p">).</span><span class="n">z</span>  <span class="o">&lt;</span>  <span class="n">ShadowCoord</span><span class="p">.</span><span class="n">z</span><span class="o">-</span><span class="n">bias</span><span class="p">){</span>
    <span class="n">visibility</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The result is already much nicer :</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/FixedBias.png" alt=""></p>

<p>However, you can notice that because of our bias, the artefact between the ground and the wall has gone worse. What’s more, a bias of 0.005 seems too much on the ground, but not enough on curved surface : some artefacts remain on the cylinder and on the sphere.</p>

<p>A common approach is to modify the bias according to the slope :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">bias</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">005</span><span class="o">*</span><span class="n">tan</span><span class="p">(</span><span class="n">acos</span><span class="p">(</span><span class="n">cosTheta</span><span class="p">));</span> <span class="c1">// cosTheta is dot( n,l ), clamped between 0 and 1
</span><span class="n">bias</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">bias</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">);</span>
</code></pre></div></div>

<p>Shadow acne is now gone, even on curved surfaces.</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/VariableBias.png" alt=""></p>

<p>Another trick, which may or may not work depending on your geometry, is to render only the back faces in the shadow map. This forces us to have a special geometry ( see next section - Peter Panning ) with thick walls, but at least, the acne will be on surfaces which are in the shadow :</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/shadowmapping-backfaces.png" alt=""></p>

<p>When rendering the shadow map, cull front-facing triangles :</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1">// We don't use bias in the shader, but instead we draw back faces,
</span>        <span class="c1">// which are already separated from the front faces by a small distance
</span>        <span class="c1">// (if your geometry is made this way)
</span>        <span class="n">glCullFace</span><span class="p">(</span><span class="n">GL_FRONT</span><span class="p">);</span> <span class="c1">// Cull front-facing triangles -&gt; draw only back-facing triangles
</span></code></pre></div></div>

<p>And when rendering the scene, render normally (backface culling)</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         <span class="n">glCullFace</span><span class="p">(</span><span class="n">GL_BACK</span><span class="p">);</span> <span class="c1">// Cull back-facing triangles -&gt; draw only front-facing triangles
</span></code></pre></div></div>

<p>This method is used in the code, in addition to the bias.</p>

<h2 id="peter-panning">Peter Panning</h2>

<p>We have no shadow acne anymore, but we still have this wrong shading of the ground, making the wall to look as if it’s flying (hence the term “Peter Panning”). In fact, adding the bias made it worse.</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/PeterPanning.png" alt=""></p>

<p>This one is very easy to fix : simply avoid thin geometry. This has two advantages :</p>

<ul>
  <li>First, it solves Peter Panning : it the geometry is more deep than your bias, you’re all set.</li>
  <li>Second, you can turn on backface culling when rendering the lightmap, because now, there is a polygon of the wall which is facing the light, which will occlude the other side, which wouldn’t be rendered with backface culling.</li>
</ul>

<p>The drawback is that you have more triangles to render ( two times per frame ! )</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/NoPeterPanning.png" alt=""></p>

<h2 id="aliasing">Aliasing</h2>

<p>Even with these two tricks, you’ll notice that there is still aliasing on the border of the shadow. In other words, one pixel is white, and the next is black, without a smooth transition inbetween.</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/Aliasing.png" alt=""></p>

<h3 id="pcf">PCF</h3>

<p>The easiest way to improve this is to change the shadowmap’s sampler type to <em>sampler2DShadow</em>. The consequence is that when you sample the shadowmap once, the hardware will in fact also sample the neighboring texels, do the comparison for all of them, and return a float in [0,1] with a bilinear filtering of the comparison results.</p>

<p>For instance, 0.5 means that 2 samples are in the shadow, and 2 samples are in the light.</p>

<p>Note that it’s not the same than a single sampling of a filtered depth map ! A comparison always returns true or false; PCF gives a interpolation of 4 “true or false”.</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/PCF_1tap.png" alt=""></p>

<p>As you can see, shadow borders are smooth, but shadowmap’s texels are still visible.</p>

<h3 id="poisson-sampling">Poisson Sampling</h3>

<p>An easy way to deal with this is to sample the shadowmap N times instead of once. Used in combination with PCF, this can give very good results, even with a small N. Here’s the code for 4 samples :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">texture</span><span class="p">(</span> <span class="n">shadowMap</span><span class="p">,</span> <span class="n">ShadowCoord</span><span class="p">.</span><span class="n">xy</span> <span class="o">+</span> <span class="n">poissonDisk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">700</span><span class="p">.</span><span class="mi">0</span> <span class="p">).</span><span class="n">z</span>  <span class="o">&lt;</span>  <span class="n">ShadowCoord</span><span class="p">.</span><span class="n">z</span><span class="o">-</span><span class="n">bias</span> <span class="p">){</span>
    <span class="n">visibility</span><span class="o">-=</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>poissonDisk is a constant array defines for instance as follows :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">vec2</span> <span class="n">poissonDisk</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="kt">vec2</span><span class="p">[](</span>
  <span class="kt">vec2</span><span class="p">(</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">94201624</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">39906216</span> <span class="p">),</span>
  <span class="kt">vec2</span><span class="p">(</span> <span class="mi">0</span><span class="p">.</span><span class="mi">94558609</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">76890725</span> <span class="p">),</span>
  <span class="kt">vec2</span><span class="p">(</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">094184101</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">92938870</span> <span class="p">),</span>
  <span class="kt">vec2</span><span class="p">(</span> <span class="mi">0</span><span class="p">.</span><span class="mi">34495938</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">29387760</span> <span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>This way, depending on how many shadowmap samples will pass, the generated fragment will be more or less dark :</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/SoftShadows.png" alt=""></p>

<p>The 700.0 constant defines how much the samples are “spread”. Spread them too little, and you’ll get aliasing again; too much, and you’ll get this :* banding <em>(this screenshot doesn’t use PCF for a more dramatic effect, but uses 16 samples instead)</em>
*</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/SoftShadows_Close.png" alt=""></p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/SoftShadows_Wide.png" alt=""></p>

<h3 id="stratified-poisson-sampling">Stratified Poisson Sampling</h3>

<p>We can remove this banding by choosing different samples for each pixel. There are two main methods : Stratified Poisson or Rotated Poisson. Stratified chooses different samples; Rotated always use the same, but with a random rotation so that they look different. In this tutorial I will only explain the stratified version.</p>

<p>The only difference with the previous version is that we index <em>poissonDisk</em> with a random index :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="c1">// A random number between 0 and 15, different for each pixel (and each i !)
</span>        <span class="n">visibility</span> <span class="o">-=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span><span class="n">texture</span><span class="p">(</span> <span class="n">shadowMap</span><span class="p">,</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">ShadowCoord</span><span class="p">.</span><span class="n">xy</span> <span class="o">+</span> <span class="n">poissonDisk</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">/</span><span class="mi">700</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>  <span class="p">(</span><span class="n">ShadowCoord</span><span class="p">.</span><span class="n">z</span><span class="o">-</span><span class="n">bias</span><span class="p">)</span><span class="o">/</span><span class="n">ShadowCoord</span><span class="p">.</span><span class="n">w</span><span class="p">)</span> <span class="p">));</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>We can generate a random number with a code like this, which returns a random number in [0,1[ :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kt">float</span> <span class="n">dot_product</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">seed4</span><span class="p">,</span> <span class="kt">vec4</span><span class="p">(</span><span class="mi">12</span><span class="p">.</span><span class="mi">9898</span><span class="p">,</span><span class="mi">78</span><span class="p">.</span><span class="mi">233</span><span class="p">,</span><span class="mi">45</span><span class="p">.</span><span class="mi">164</span><span class="p">,</span><span class="mi">94</span><span class="p">.</span><span class="mi">673</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">fract</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">dot_product</span><span class="p">)</span> <span class="o">*</span> <span class="mi">43758</span><span class="p">.</span><span class="mi">5453</span><span class="p">);</span>
</code></pre></div></div>

<p>In our case, seed4 will be the combination of i (so that we sample at 4 different locations) and … something else. We can use gl_FragCoord ( the pixel’s location on the screen ), or Position_worldspace :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1">//  - A random sample, based on the pixel's screen location.
</span>        <span class="c1">//    No banding, but the shadow moves with the camera, which looks weird.
</span>        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="mi">16</span><span class="p">.</span><span class="mi">0</span><span class="o">*</span><span class="n">random</span><span class="p">(</span><span class="nb">gl_FragCoord</span><span class="p">.</span><span class="n">xyy</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span><span class="o">%</span><span class="mi">16</span><span class="p">;</span>
        <span class="c1">//  - A random sample, based on the pixel's position in world space.
</span>        <span class="c1">//    The position is rounded to the millimeter to avoid too much aliasing
</span>        <span class="c1">//int index = int(16.0*random(floor(Position_worldspace.xyz*1000.0), i))%16;
</span></code></pre></div></div>

<p>This will make patterns such as in the picture above disappear, at the expense of visual noise. Still, a well-done noise is often less objectionable than these patterns.</p>

<p><img src="./Tutorial 16 _ Shadow mapping_files/PCF_stratified_4tap.png" alt=""></p>

<p>See <a href="https://github.com/opengl-tutorials/ogl/blob/master/tutorial16_shadowmaps/ShadowMapping.fragmentshader">tutorial16/ShadowMapping.fragmentshader</a> for three example implementions.</p>

<h1 id="going-further">Going further</h1>

<p>Even with all these tricks, there are many, many ways in which our shadows could be improved. Here are the most common :</p>

<h2 id="early-bailing">Early bailing</h2>

<p>Instead of taking 16 samples for each fragment (again, it’s a lot), take 4 distant samples. If all of them are in the light or in the shadow, you can probably consider that all 16 samples would have given the same result : bail early. If some are different, you’re probably on a shadow boundary, so the 16 samples are needed.</p>

<h2 id="spot-lights">Spot lights</h2>

<p>Dealing with spot lights requires very few changes. The most obvious one is to change the orthographic projection matrix into a perspective projection matrix :</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">lightPos</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">depthProjectionMatrix</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">perspective</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="mf">45.0</span><span class="n">f</span><span class="p">),</span> <span class="mf">1.0</span><span class="n">f</span><span class="p">,</span> <span class="mf">2.0</span><span class="n">f</span><span class="p">,</span> <span class="mf">50.0</span><span class="n">f</span><span class="p">);</span>
<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">depthViewMatrix</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">lookAt</span><span class="p">(</span><span class="n">lightPos</span><span class="p">,</span> <span class="n">lightPos</span><span class="o">-</span><span class="n">lightInvDir</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">));</span>
</code></pre></div></div>

<p>same thing, but with a perspective frustum instead of an orthographic frustum. Use texture2Dproj to account for perspective-divide (see footnotes in tutorial 4 - Matrices)</p>

<p>The second step is to take into account the perspective in the shader. (see footnotes in tutorial 4 - Matrices. In a nutshell, a perspective projection matrix actually doesn’t do any perspective at all. This is done by the hardware, by dividing the projected coordinates by w. Here, we emulate the transformation in the shader, so we have to do the perspective-divide ourselves. By the way, an orthographic matrix always generates homogeneous vectors with w=1, which is why they don’t produce any perspective)</p>

<p>Here are two way to do this in GLSL. The second uses the built-in textureProj function, but both methods produce exactly the same result.</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span> <span class="n">texture</span><span class="p">(</span> <span class="n">shadowMap</span><span class="p">,</span> <span class="p">(</span><span class="n">ShadowCoord</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">ShadowCoord</span><span class="p">.</span><span class="n">w</span><span class="p">)</span> <span class="p">).</span><span class="n">z</span>  <span class="o">&lt;</span>  <span class="p">(</span><span class="n">ShadowCoord</span><span class="p">.</span><span class="n">z</span><span class="o">-</span><span class="n">bias</span><span class="p">)</span><span class="o">/</span><span class="n">ShadowCoord</span><span class="p">.</span><span class="n">w</span> <span class="p">)</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">textureProj</span><span class="p">(</span> <span class="n">shadowMap</span><span class="p">,</span> <span class="n">ShadowCoord</span><span class="p">.</span><span class="n">xyw</span> <span class="p">).</span><span class="n">z</span>  <span class="o">&lt;</span>  <span class="p">(</span><span class="n">ShadowCoord</span><span class="p">.</span><span class="n">z</span><span class="o">-</span><span class="n">bias</span><span class="p">)</span><span class="o">/</span><span class="n">ShadowCoord</span><span class="p">.</span><span class="n">w</span> <span class="p">)</span>
</code></pre></div></div>

<h2 id="point-lights">Point lights</h2>

<p>Same thing, but with depth cubemaps. A cubemap is a set of 6 textures, one on each side of a cube; what’s more, it is not accessed with standard UV coordinates, but with a 3D vector representing a direction.</p>

<p>The depth is stored for all directions in space, which make possible for shadows to be cast all around the point light.</p>

<h2 id="combination-of-several-lights">Combination of several lights</h2>

<p>The algorithm handles several lights, but keep in mind that each light requires an additional rendering of the scene in order to produce the shadowmap. This will require an enormous amount of memory when applying the shadows, and you might become bandwidth-limited very quickly.</p>

<h2 id="automatic-light-frustum">Automatic light frustum</h2>

<p>In this tutorial, the light frustum hand-crafted to contain the whole scene. While this works in this restricted example, it should be avoided. If your map is 1Km x 1Km, each texel of your 1024x1024 shadowmap will take 1 square meter; this is lame. The projection matrix of the light should be as tight as possible.</p>

<p>For spot lights, this can be easily changed by tweaking its range.</p>

<p>Directional lights, like the sun, are more tricky : they really <em>do</em> illuminate the whole scene. Here’s a way to compute a the light frustum :</p>

<ol>
  <li>
    <p>Potential Shadow Receivers, or PSRs for short, are objects which belong at the same time to the light frustum, to the view frustum, and to the scene bounding box. As their name suggest, these objects are susceptible to be shadowed : they are visible by the camera and by the light.</p>
  </li>
  <li>
    <p>Potential Shadow Casters, or PCFs, are all the Potential Shadow Receivers, plus all objects which lie between them and the light (an object may not be visible but still cast a visible shadow).</p>
  </li>
</ol>

<p>So, to compute the light projection matrix, take all visible objects, remove those which are too far away, and compute their bounding box; Add the objects which lie between this bounding box and the light, and compute the new bounding box (but this time, aligned along the light direction).</p>

<p>Precise computation of these sets involve computing convex hulls intersections, but this method is much easier to implement.</p>

<p>This method will result in popping when objects disappear from the frustum, because the shadowmap resolution will suddenly increase. Cascaded Shadow Maps don’t have this problem, but are harder to implement, and you can still compensate by smoothing the values over time.</p>

<h2 id="exponential-shadow-maps">Exponential shadow maps</h2>

<p>Exponential shadow maps try to limit aliasing by assuming that a fragment which is in the shadow, but near the light surface, is in fact “somewhere in the middle”. This is related to the bias, except that the test isn’t binary anymore : the fragment gets darker and darker when its distance to the lit surface increases.</p>

<p>This is cheating, obviously, and artefacts can appear when two objects overlap.</p>

<h2 id="light-space-perspective-shadow-maps">Light-space perspective Shadow Maps</h2>

<p>LiSPSM tweaks the light projection matrix in order to get more precision near the camera. This is especially important in case of “duelling frustra” : you look in a direction, but a spot light “looks” in the opposite direction. You have a lot of shadowmap precision near the light, i.e. far from you, and a low resolution near the camera, where you need it the most.</p>

<p>However LiSPM is tricky to implement. See the references for details on the implementation.</p>

<h2 id="cascaded-shadow-maps">Cascaded shadow maps</h2>

<p>CSM deals with the exact same problem than LiSPSM, but in a different way. It simply uses several (2-4) standard shadow maps for different parts of the view frustum. The first one deals with the first meters, so you’ll get great resolution for a quite little zone. The next shadowmap deals with more distant objects. The last shadowmap deals with a big part of the scene, but due tu the perspective, it won’t be more visually important than the nearest zone.</p>

<p>Cascarded shadow maps have, at time of writing (2012), the best complexity/quality ratio. This is the solution of choice in many cases.</p>

<h1 id="conclusion">Conclusion</h1>

<p>As you can see, shadowmaps are a complex subject. Every year, new variations and improvement are published, and to day, no solution is perfect.</p>

<p>Fortunately, most of the presented methods can be mixed together : It’s perfectly possible to have Cascaded Shadow Maps in Light-space Perspective, smoothed with PCF… Try experimenting with all these techniques.</p>

<p>As a conclusion, I’d suggest you to stick to pre-computed lightmaps whenever possible, and to use shadowmaps only for dynamic objects. And make sure that the visual quality of both are equivalent : it’s not good to have a perfect static environment and ugly dynamic shadows, either.</p>

  </article>

  <div style="width:100%;display:flex;justify-content:space-between">
    
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          
            <a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-15-lightmaps/">◀ 第十五课：光照贴图（Lightmap）</a>
          
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-17-quaternions/">Tutorial 17 : Rotations ▶</a>
          

  </div>

</div>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <div class="footer-col-1 column">
      <ul>
        <li><a href="mailto:contact@opengl-tutorial.org">contact@opengl-tutorial.org</a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <a href="https://github.com/opengl-tutorials/ogl" target="_blank">
        <span class="icon github">
          <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
            <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
            c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
            c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
            c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
            C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
            c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
            c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
            c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
            c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path>
          </svg>
        </span>
        <span class="username"></span>
      </a>
        
      <a href="https://twitter.com/GraphicsTut" target="_blank">
        <span class="icon twitter">
          <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
            <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
            c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
            c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
            c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
            C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
            c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
            c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path>
          </svg>
        </span>
        <span class="username"></span>
      </a>
      <a href="https://plus.google.com/107410003823545892786" target="_blank">
        <span class="icon gplus">
          <svg class="gplus-icon-svg" enable-background="new 0 0 128 128" height="128px" id="Layer_1" version="1.1" viewBox="0 0 128 128" width="128px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle cx="64" cy="64" fill="#C2C2C2" r="64"></circle><g><g><path d="M49.424,97.875c-19.018,0-34.491-15.193-34.491-33.874c0-18.68,15.473-33.875,34.491-33.875     c8.318,0,16.354,2.952,22.624,8.309l-8.771,9.899c-3.838-3.279-8.758-5.086-13.853-5.086c-11.652,0-21.13,9.31-21.13,20.752     c0,11.441,9.479,20.75,21.13,20.75c9.858,0,16.311-4.723,18.407-13.197H49.587V58.432h32.347v6.562     C81.934,84.659,68.869,97.875,49.424,97.875z" fill="#FFFFFF"></path></g><polygon fill="#FFFFFF" points="117.934,58.438 107.934,58.438 107.934,48.438 99.934,48.438 99.934,58.438 89.934,58.438     89.934,66.438 99.934,66.438 99.934,76.438 107.934,76.438 107.934,66.438 117.934,66.438   "></polygon></g></g>
          </svg>
        </span>
      </a>
    </div>

    <div class="footer-col-3 column">
      <p class="text">Free tutorials for modern Opengl (3.3 and later) in C/C++</p>
    </div>

  </div>

</footer>


    
</body></html>